/*! Map4D JS SDK v2.4.6+9. Copyright (c) 2023 IOTLink */
var map4d=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=56)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.SURFACE=0]="SURFACE",t[t.ROADS=1]="ROADS",t[t.BOUNDARY=2]="BOUNDARY",t[t.LABEL=3]="LABEL",t[t.RASTER=4]="RASTER",t[t.SKY=5]="SKY",t[t.POI=6]="POI",t[t.BUILDING=7]="BUILDING",t[t.LINE=8]="LINE",t[t.FILL=9]="FILL",t[t.CIRCLE=10]="CIRCLE",t[t.SYMBOL=11]="SYMBOL",t[t.USERPOI=12]="USERPOI",t[t.USERBUILDING=13]="USERBUILDING",t[t.GEOJSON=14]="GEOJSON",t[t.RASTER_OVERLAY=15]="RASTER_OVERLAY",t[t.POI_OVERLAY=16]="POI_OVERLAY",t[t.BUILDING_OVERLAY=17]="BUILDING_OVERLAY",t[t.IMAGE_OVERLAY=18]="IMAGE_OVERLAY"}(e.LayerType||(e.LayerType={}));var i=function(){function t(t,e){void 0===e&&(e=0),this.id=t,this.order=e}return t.prototype.equal=function(t){return this.id==t.id},t.prototype.lessThan=function(t){return this.order==t.order?this.id<t.id:this.order<t.order},t}();e.LayerId=i,e.compareLayerId=function(t,e){return t.order==e.order?t.id==e.id?0:t.id>e.id:t.order>e.order};var n=function(){function t(t,e,r,n){this.layerId=new i(t,e),this.layerType=r,this.mapView=n}return t.prototype.getOrder=function(){return this.layerId.order},t.prototype.getLayerId=function(){return this.layerId.id},t.prototype.getLayerType=function(){return this.layerType},t.prototype.setOrder=function(t){this.layerId.order=t},t.prototype.setLayerRenderer=function(t){this.layerRenderer=t},t}();e.Layer=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),n=r(13),o=r(12),a=r(3),s=r(20),l=r(6),u=function(){function t(){}return Object.defineProperty(t,"pixelScale",{get:function(){return t._pixelScale},set:function(e){t._pixelScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"touchBoxSize",{get:function(){return t._touchBoxSize},set:function(e){t._touchBoxSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"resourceScale",{get:function(){return Math.round(t._pixelScale)},enumerable:!0,configurable:!0}),t.getTileSize=function(){return i.MapConstants.baseTileSize*t.pixelScale},t.extendOptions=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var i=0,n=e;i<n.length;i++){var o=n[i];for(var a in o)null!=o[a]&&(t[a]=o[a])}return t},t.pointToPixel=function(e){return new o.Point(e.x*t.pixelScale,e.y*t.pixelScale)},t.pixelToPoint=function(e){return new o.Point(e.x/t.pixelScale,e.y/t.pixelScale)},t.getTimePanTo=function(t,e,r){var o=t.distanceTo(e)/500;return o*=r<10?.01:r<14?.5:1.5,o=n.MathUtils.clamp(o,i.MapConstants.minTimeSpanTo,i.MapConstants.maxTimeSpanTo),Math.round(o)},t.getCameraPositionForLatLngBounds=function(t,e,r,i){var o=r.getScreenSize(),u=r.getZoom(),h=1<<u,c=l.ProjectionMercator.projectScale(t.getSouthwest(),h),p=l.ProjectionMercator.projectScale(t.getNortheast(),h),f=p.x-c.x,d=c.y-p.y;f=f<=0?1:f,d=d<=0?1:d;var g=Number.MAX_VALUE;if(f>0||d>0){var y=o.x/f,m=o.y/d;y-=(e.left+e.right)/f,m-=(e.top+e.bottom)/d,g=Math.min(y,m)}var v=u;g>0?v=n.MathUtils.clamp(u+Math.log2(g),i.getMinZoom(),i.getMaxZoom()):(console.warn("Cannot calculate zoom level for bounds. Vertical or horizontal padding is greater than map's height or width"),v=i.getMinZoom()),v=Math.floor(v);var _=Math.pow(2,v),b=c.add(p).multiply(.5),w=l.ProjectionMercator.unproject(b,h),x=l.ProjectionMercator.projectScale(w,_),M=x.add(o.multiply(.5)),T=x.add(o.multiply(-.5));return M=M.subtract(new a.Vector2(e.left,e.top)),T=T.add(new a.Vector2(e.right,e.bottom)),x=M.add(T).multiply(.5),new s.CameraPosition(l.ProjectionMercator.unproject(x,_),0,0,v)},t.getNextZoomByStep=function(t,e,r){return r?Math.ceil(t/e)*e:Math.floor(t/e)*e},t._pixelScale=1,t._touchBoxSize=1,t}();e.MapUtils=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9),n=r(11),o=r(35),a=r(45),s=r(12),l=function(){function t(){}return Object.defineProperty(t,"placeFontSize",{get:function(){return 12},enumerable:!0,configurable:!0}),Object.defineProperty(t,"maxTiltIntersectWithScreen",{get:function(){return 90-f.fov*p.rad2Deg},enumerable:!0,configurable:!0}),t.none=-1,t.baseTileSize=256,t.minLatitude=-85.0511287798066,t.maxLatitude=85.0511287798066,t.maxLongitude=180,t.minLongitude=-180,t.maxDegrees=360,t.radiusEarthMeters=6378137,t.halfEarthCircumFerenceInMeter=t.radiusEarthMeters*Math.PI,t.earthCircumFerenceInMeter=2*t.halfEarthCircumFerenceInMeter,t.tileCacheSize=512,t.baseMapLowestOrder=Number.MIN_SAFE_INTEGER,t.baseMapMiddleOrder=-1e6,t.buildingLayerOrder=0,t.userPOILayerOrder=1,t.pointGeoJsonWidth=32,t.pointGeoJsonHeight=32,t.maxPlacePerTile=6,t.placeSelectedIdPrefix="maplink-selected-place-",t.placeWidth=26,t.placeHeight=32,t.spritePadding=2,t.poiFontWeight="normal",t.poiMaxWidth=120,t.poiNumLine=2,t.poiAnchor=new s.Point(.5,1),t.poiLabelAnchor=new s.Point(1.1,.5),t.poiDefaultColor=new n.Color(.5,.6,.7),t.pointGeoJsonAnchor=[.5,1],t.infoWindowPadding=2,t.flingMinVelocity=-1e4,t.flingMaxVelocity=1e4,t.flingTimeConstant=150,t.flingSpeedMultiply=15,t.zoomSpeedMouseWheel=15,t.minDurationFlyTo=1e3,t.maxDurationFlyTo=13e3,t.maxBearingAngle=720,t.defaultMinZoom=3,t.defaultMinZoom3d=17,t.defaultMaxZoom=22,t.defaultMaxNativeZoom=19,t.geoJsonMinNativeZoom=20,t.vectorBuildingsMinZoom=17,t.tileExtend=4096,t.defaultAnimationDuration=300,t.dropAnimationDuration=1500,t.defaultFlyZoom=17,t.minTilt=0,t.maxTilt2D=40,t.maxTilt3D=87,t.minTiltReduceFog=75,t.minTimeMoving=150,t.minTimeDoubleZoom=500,t.minTimeSpanTo=500,t.maxTimeSpanTo=4e3,t.skyboxMapBorderMinimum=.001,t.metersPerPixelAtLatitude=0,t.mapBackgroundColor2D=n.Color.fromHex("#f2efe9"),t.mapBackgroundColor3D=n.Color.fromHex("#e1e1e1"),t.satellitePOIColor=new n.Color(1,1,1),t.satellitePOIHalo=new n.Color(0,0,0),t.mapBackgroundScaleRatio=2e4,t.clusterMaxPointCount=1e6,t.biasMatrix=new i.Matrix4(new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1])),t.FPS=1e3/15,t.buildingOverlayIdPrefix="_overlay",t.customBuildingType="custom_building",t.touchBoxSize=8,t.zoomStep=.25,t.distanceRatioToForceMoveCamera=3,t.gridIndexExtent=4096,t.gridIndexN=4,t.gridIndexPadding=0,t}();e.MapConstants=l;var u=function(){function t(){}return t.getModelTextureUrl=function(t){return a.MapSettings.getResourseBaseUrl+"/sdk/textures/"+t},t.getModelObjUrl=function(t){return a.MapSettings.getResourseBaseUrl+"/sdk/models/"+t},t.getMapStyleUrl=function(t){return o.Env.apiPrefix+"/map/style/"+t+"?key="+a.MapSettings.getAccessKey()},t.baseMapUrl=o.Env.apiPrefix+"/tile/{z}/{x}/{y}",t}();e.ServerConstants=u;var h=function(){function t(){}return t.defaultSymbol="markerDefault",t.geoJsonLayerId="geoJsonLayerId",t}();e.SymbolConstants=h;var c=function(){function t(){}return t.rasterLayerId="1.0.rasterLayer",t.surfaceLayerId="1.1.vector.surfaces",t.roadsLayerId="1.2.vector.roads",t.boundaryLayerId="1.3.vector.boundaries",t.skyLayerId="1.9.skyLayer",t.labelLayerId="4.label.tile",t.rasterOverlayLayerId="1.4.rasterOverlay",t.imageOverlayLayerId="5.imageOverlay",t.buildingOverlayLayerId="2.buildingOverlay",t.pointLayerId="2.maplink.vector.tile.points",t.pointOverlayLayerId="2.maplink.overlay.tile.points",t.userPOILayerId="1.maplink.vector.tile.user.poi",t.buildingLayerId="2.buildingLayer",t.userBuildingLayerId="3.userBuilding.layer",t.roadTileLayerId="roadTileLayer",t.labelTileLayerId="labelTileLayer",t.pointTileLayerId="pointTileLayer",t.buildingTileLayerId="buildingTileLayer",t.rasterTileLayerId="rasterTileLayer",t}();e.LayerConstants=c;var p=function(){function t(){}return t.rad2Deg=180/Math.PI,t.deg2Rad=Math.PI/180,t.epsilon=1e-6,t}();e.MathConstants=p;var f=function(){function t(){}return t.fov=30*p.deg2Rad,t.nearPlane=.1,t.farPlane=1e3,t.height=15.5,t}();e.CameraConstants=f;var d=function(){function t(){}return t.numTrianglesOnRoundCap=6,t.numTrianglesOnRoundJoin=5,t.numTrianglesPerCircle=4,t}();e.PolyConstants=d;var g=function(){function t(){}return t.rainFrequency=.004,t.rainParticleRotation=-25,t.snowFrequency=.004,t}();e.ParticleConstants=g;var y=function(){function t(){}return t.refreshTime=6e4,t.refreshDistance=1e4,t}();e.WeatherConstants=y;var m=function(){function t(){}return t.getSkyColor=function(e){return t.skyColors[e]},t.getFogColor=function(e){return t.fogColors[e]},t.getLightColor=function(e){return t.lightColors[e]},t.skyColors={Morning:n.Color.fromHex("cdf9ff"),Noon:n.Color.fromHex("0783f4"),AfterNoon:n.Color.fromHex("243a8b"),Evening:n.Color.fromHex("182863")},t.fogColors={Morning:n.Color.fromHex("FAD8C4"),Noon:n.Color.fromHex("FAFAFA"),AfterNoon:n.Color.fromHex("FAA899"),Evening:n.Color.fromHex("141c36")},t.lightColors={Morning:n.Color.fromHex("#DE8989"),Noon:n.Color.fromHex("#F8F8F8"),AfterNoon:n.Color.fromHex("#BE321A"),Evening:n.Color.fromHex("#1E0032")},t}();e.ColorConstants=m;var v=function(){function t(){}return t.morningTime=6,t.noonTime=12,t.afterNoonTime=16,t.eveningTime=18,t}();e.TimeConstants=v;var _=function(){function t(){}return Object.defineProperty(t,"fontSize",{get:function(){return 24},enumerable:!0,configurable:!0}),t.fontTextureWidth=1e3,t.fontTextureHeight=400,t}();e.FontConstant=_;var b=function(){function t(){}return t.maxCurvedTextAngle=22,t}();e.LabelConstant=b},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var e=this.length,r=0,i=0;return e>0&&(r=this.x/e,i=this.y/e),new t(r,i)},t.prototype.set=function(t){this.x=t.x,this.y=t.y},t.prototype.invert=function(){return new t(-this.x,-this.y)},t.prototype.rotate90=function(){return new t(this.y,-this.x)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y)},t.prototype.rotateBy=function(e){var r=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180);return new t(this.x*r-this.y*i,this.x*i+this.y*r)},t.prototype.rotateByRadian=function(e){var r=Math.cos(e),i=Math.sin(e);return new t(this.x*r-this.y*i,this.x*i+this.y*r)},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y},t.perp=function(e,r){return new t(r[1]-e[1],e[0]-r[0])},t.neg=function(e){return new t(-e.x,-e.y)},t}();e.Vector2=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=r(2),s=function(t){function e(e,r){var i=t.call(this,o.ClassType.LATLNG)||this;return i.lat=e,i.lng=r,i}return n(e,t),e.prototype.equals=function(t){return this.lat==t.lat&&this.lng==t.lng},e.prototype.valid=function(){return isFinite(this.lat)&&Math.abs(this.lat)<=90},e.prototype.toString=function(){return"("+this.lat+", "+this.lng+")"},e.convert=function(t){if(o.Map4dObject.isClassType(t,o.ClassType.LATLNG))return t;if(Array.isArray(t)&&2===t.length)return new e(Number(t[1]),Number(t[0]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t&&"lat"in t&&"lng"in t)return new e(Number(t.lat),Number(t.lng));throw new Error("`ILngLat` argument must be specified as a LngLat instance, an object {lat: <lat>, lng: <lng>}, or an array of [<lng>, <lat>]")},e.prototype.distanceTo=function(t){if(null==t)return 0;var r=e.convert(t),i=a.MathConstants.deg2Rad*this.lat,n=a.MathConstants.deg2Rad*this.lng,o=a.MathConstants.deg2Rad*r.lat,s=a.MathConstants.deg2Rad*r.lng,l=Math.sin((o-i)/2),u=Math.sin((s-n)/2);return 2*a.MapConstants.radiusEarthMeters*Math.asin(Math.sqrt(l*l+Math.cos(i)*Math.cos(o)*u*u))},e.prototype.normalize=function(){var t=this.lat>0?-1:1,r=(this.lat-90*t)%180+90*t;return t=this.lng>0?-1:1,new e(r,(this.lng-180*t)%380+180*t)},e.prototype.add=function(t){return new e(this.lat+t.lat,this.lng+t.lng).normalize()},e.prototype.subtract=function(t){return t?new e(this.lat-t.lat,this.lng-t.lng).normalize():this},e}(o.Map4dObject);e.LatLng=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.MARKER=0]="MARKER",t[t.CIRCLE=1]="CIRCLE",t[t.POLYLINE=2]="POLYLINE",t[t.POLYGON=3]="POLYGON",t[t.POI=4]="POI",t[t.BUILDING=5]="BUILDING",t[t.VECTOR_TILE_LAYER=6]="VECTOR_TILE_LAYER",t[t.BUILDING_QUERY_RESULT=7]="BUILDING_QUERY_RESULT",t[t.POLYLINE_DATA=8]="POLYLINE_DATA",t[t.POLYGON_DATA=9]="POLYGON_DATA",t[t.ICON=10]="ICON",t[t.LATLNG=11]="LATLNG",t[t.POINT=12]="POINT",t[t.CAMERA_POSITION=13]="CAMERA_POSITION",t[t.LATLNG_BOUNDS=14]="LATLNG_BOUNDS",t[t.MARKER_LABEL=15]="MARKER_LABEL",t[t.FEATURE=16]="FEATURE",t[t.TILE_FEATURE=17]="TILE_FEATURE",t[t.VECTOR_TILE_FEATURE=18]="VECTOR_TILE_FEATURE"}(e.ClassType||(e.ClassType={}));var i=function(){function t(t){this.classType=t}return t.isClassType=function(t,e){return(t||{}).classType==e},t}();e.Map4dObject=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(4),o=r(2),a=r(13),s=r(1),l=function(){function t(){}return t.projectInternal=function(t,e){var r=a.MathUtils.clamp(t.lat,o.MapConstants.minLatitude,o.MapConstants.maxLatitude);return new i.Vector2(o.MapConstants.maxLongitude+t.lng,o.MapConstants.maxLongitude-o.MathConstants.rad2Deg*Math.log(Math.tan(Math.PI/4+r*Math.PI/o.MapConstants.maxDegrees))).multiply(e/o.MapConstants.maxDegrees)},t.worldSize=function(t){return t*s.MapUtils.getTileSize()},t.getMetersPerPixelAtLatitude=function(t,e){var r=Math.pow(2,e),i=a.MathUtils.clamp(t,o.MapConstants.minLatitude,o.MapConstants.maxLatitude);return Math.cos(i*o.MathConstants.deg2Rad)*Math.PI*2*o.MapConstants.radiusEarthMeters/this.worldSize(r)},t.convertToMeterFromLatLng=function(t){var e=a.MathUtils.clamp(t.lat,o.MapConstants.minLatitude,o.MapConstants.maxLatitude),r=t.lng,n=1-1e-15,s=a.MathUtils.clamp(Math.sin(o.MathConstants.deg2Rad*e),-n,n),l=o.MapConstants.radiusEarthMeters*r*o.MathConstants.deg2Rad,u=.5*o.MapConstants.radiusEarthMeters*Math.log((1+s)/(1-s));return new i.Vector2(l,u)},t.convertToLatLngFromMeter=function(t){var e=(2*Math.atan(Math.exp(t.y/o.MapConstants.radiusEarthMeters))-Math.PI/2)*o.MathConstants.rad2Deg,r=t.x*o.MathConstants.rad2Deg/o.MapConstants.radiusEarthMeters;return new n.LatLng(e,r)},t.projectScale=function(t,e){return this.projectInternal(t,this.worldSize(e))},t.projectZoom=function(t,e){return this.projectInternal(t,1<<e)},t.unproject=function(t,e){var r=t.multiply(o.MapConstants.maxDegrees/this.worldSize(e));return new n.LatLng(o.MapConstants.maxDegrees/Math.PI*Math.atan(Math.exp((o.MapConstants.maxLongitude-r.y)*o.MathConstants.deg2Rad))-90,r.x-o.MapConstants.maxLongitude)},t}();e.ProjectionMercator=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(48),n=r(26),o=r(41),a=r(32),s=r(88),l=r(33),u=r(2),h=r(65),c=r(1),p=function(){function t(t){this.gl=t,this.models=new Map,this.textures=new Map,this.texts=new Map,this.initialized=!1,this.modelRequestsMap=new Map,this.textureRequestsMap=new Map,this.visibleBuildingIds=new Map,this.clear2DColor=u.MapConstants.mapBackgroundColor2D}return t.getInstance=function(t){var e=t.id;null==this.instances&&(this.instances=new Map);var r=this.instances.get(e);return r||(r=new this(t),this.instances.set(e,r)),r},t.releaseInstance=function(t){var e=t.id;if(null!=this.instances){var r=this.instances.get(e);r&&(r.textures.forEach((function(t){return t.destroy()})),r.models.forEach((function(t){return t.destroy()})),r.textures.clear(),r.models.clear(),this.instances.delete(e))}},t.prototype.init=function(t,e){this.initialized||(this.initialized=!0,this.taskManager=e,this.requestRender=t)},t.prototype.isAllRequestFinished=function(){return 0==this.modelRequestsMap.size&&0==this.textureRequestsMap.size},t.prototype.hasVisibleBuildingId=function(t){return this.visibleBuildingIds.has(t)},t.prototype.clearVisibleBuildingId=function(){this.visibleBuildingIds.clear()},t.prototype.retainVisibleBuildingId=function(t){var e=this.visibleBuildingIds.get(t);null!=e?this.visibleBuildingIds.set(t,e+1):this.visibleBuildingIds.set(t,1)},t.prototype.removeVisibleBuildingId=function(t){if(this.visibleBuildingIds.has(t)){var e=this.visibleBuildingIds.get(t)-1;0==e?this.visibleBuildingIds.delete(t):this.visibleBuildingIds.set(t,e)}},t.prototype.getModel=function(t){return this.models.get(t)},t.prototype.releaseModel=function(t){var e=this.models.get(t);e&&e.reference<=1&&(e.release(),this.models.delete(t))},t.prototype.getTexture=function(t){return this.textures.get(t)},t.prototype.releaseTexture=function(t){var e=this.textures.get(t);e&&e.reference<=1&&(e.release(),this.textures.delete(t))},t.prototype.createModel=function(t,e,r){var o=this;if(void 0===r&&(r=null),null==t||""==t)return null;if(!i.UrlUtils.isUrlRequest(e))return null;var s=new n.Model(this.gl);s.retain(),this.models.set(t,s);var l=new a.RequestTask(a.Resource.Model);return l.url=e,l.completion=function(e){if(null!=e.data){var i=e.data[0].highestPosition;s.init3dObjectFormArrayBuffer(e.data[0].data),s.setHighestModelPosition(i),s.points=e.data[0].points,s.minX=e.data[0].minX,s.minY=e.data[0].minY,s.minZ=e.data[0].minZ,s.maxX=e.data[0].maxX,s.maxY=e.data[0].maxY,s.maxZ=e.data[0].maxZ,o.modelRequestsMap.delete(t),o.requestRender(),r&&r()}},this.modelRequestsMap.set(t,l),this.taskManager.postTask(l),s},t.prototype.createExtrudeModel=function(t){var e=new n.Model(this.gl);return e.retain(),this.models.set(t,e),e},t.prototype.createImageOverlayTexture=function(t){var e=this;if(null==t)return null;var r=new o.Texture(this.gl);return r.loadImage(i.UrlUtils.isUrlRequest(t)?t:h.Images.get(t),(function(){e.requestRender()}),!1),r.retain(),this.textures.set(t,r),r},t.prototype.createMarkerTexture=function(t,e,r){var n=this;if(void 0===r&&(r=null),null==t||""==t)return null;null==e&&(e=u.SymbolConstants.defaultSymbol);var a=new o.Texture(this.gl);return a.loadImage(i.UrlUtils.isUrlRequest(e)?e:h.Images.get(e),(function(){n.requestRender(),r&&r()})),a.retain(),this.textures.set(t,a),a},t.prototype.createStyleTexture=function(t,e){var r=this;if(null!=t&&""!=t&&!this.textures.has(t)){var i=new o.Texture(this.gl);i.loadImage(e,(function(){r.requestRender()})),i.retain(),this.textures.set(t,i)}},t.prototype.createBuildingTexture=function(t,e){var r=this;if(null==t||""==t)return null;if(!i.UrlUtils.isUrlRequest(e))return null;var n=new o.Texture(this.gl);n.retain(),this.textures.set(t,n);var s=new a.RequestTask(a.Resource.Texture);return s.url=e,s.completion=function(e){if(null!=e.data){n.loadImageFromArrayBuffer(e.data.data,e.data.width,e.data.height,!0,(function(){r.textureRequestsMap.delete(t),r.requestRender()}))}},this.textureRequestsMap.set(t,s),this.taskManager.postTask(s),n},t.prototype.createPolylineIconTexture=function(t,e,r){var i=this;if(void 0===r&&(r=null),null==t||""==t)return null;null==e&&(e=h.Images.circleBlueIcon);var n=new o.TextureFiltering(this.gl.LINEAR,this.gl.LINEAR),s=new o.TextureWrapping(this.gl.REPEAT,this.gl.REPEAT),l=new o.TextureOptions(this.gl.TEXTURE_2D,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n,s),u=new o.Texture(this.gl,l);if(e.startsWith("http")){var c=new a.RequestTask(a.Resource.Texture);c.url=e,c.completion=function(t){if(null!=t.data){u.loadImageFromArrayBuffer(t.data.data,t.data.width,t.data.height,!0,(function(){r&&r(),i.requestRender()}))}},this.taskManager.postTask(c)}else u.loadImage(e,(function(){r&&r(),i.requestRender()}));return u.retain(),this.textures.set(t,u),u},t.prototype.createPolylineDashTexture=function(t,e,r,i){if(null==t||""==t||!i)return null;var n=new o.TextureFiltering(this.gl.LINEAR,this.gl.LINEAR),a=new o.TextureWrapping(this.gl.REPEAT,this.gl.REPEAT),s=new o.TextureOptions(this.gl.TEXTURE_2D,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n,a),l=new o.Texture(this.gl,s);return l.retain(),this.textures.set(t,l),l.loadImageDataArray(i,e,r,this.gl.LINEAR),l},t.prototype.acquireText=function(t,e,r,i,n){void 0===r&&(r=u.MapConstants.poiFontWeight),void 0===i&&(i=u.MapConstants.poiMaxWidth),void 0===n&&(n=u.MapConstants.poiNumLine);var o=t+" "+e+" "+r+" "+i+" "+n,a=this.texts.get(o);return null!=a?(a.model.retain(),a):(a=l.TextLabelFactory.getInstance(this.gl).createText(o,new s.TextLabel(t,e),r,i*c.MapUtils.pixelScale,n),this.texts.set(o,a),a)},t.prototype.releaseText=function(t){var e=this.texts.get(t);null!=e&&(e.model.release(),e.model.reference<=0&&this.texts.delete(t))},t.instances=null,t}();e.MapResourceManager=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(30),o=r(4),a=r(6),s=r(19),l=r(2),u=r(1),h=r(20),c=r(24),p=function(){function t(){}return t.lat=function(t,e){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return l.MathConstants.rad2Deg*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.lon=function(t,e){return e/Math.pow(2,t)*l.MapConstants.maxDegrees-l.MapConstants.maxLongitude},t.screenCoordinateToNDC=function(t,e){var r=2*t.x/e.x-1,n=1-2*t.y/e.y;return new i.Vector2(r,n)},t.NDCCoordinateToScreen=function(t,e){var r=e.x*(1+t.x)/2,n=e.y*(1-t.y)/2;return new i.Vector2(r,n)},t.screenCoordinateToLatLng=function(t,e,r,i){return void 0===i&&(i=0),this.screenCoordinateToLatLngZoom(t,e,r,e.getZoom(),i)},t.screenCoordinateToLatLngZoom=function(e,r,s,u,p){if(void 0===p&&(p=0),r.getTilt()>l.MapConstants.maxTiltIntersectWithScreen){var f=this.screenCoordinateToLatLng(new i.Vector2(0,0),new h.CameraPosition(r.getTarget(),l.MapConstants.maxTiltIntersectWithScreen,r.getBearing(),r.getZoom()),s),d=this.latLngToScreenCoordinate(f,0,r,s).y/s.y*s.y;if(e.y<d)return new o.LatLng(1/0,1/0)}u<0&&(u=r.getZoom());var g=t.getElevationPixelFromMeter(p,r)*Math.sin(l.MathConstants.deg2Rad*-r.getTilt()),y=c.CameraUtils.calculateInverseViewProjectionMatrix(r,s.x,s.y),m=Math.pow(2,u),v=t.screenCoordinateToNDC(new i.Vector2(e.x,e.y-g),s),_=y.transform(new n.Vector3(v.x,v.y,-1),1),b=y.transform(new n.Vector3(v.x,v.y,1),1),w=b.z-_.z,x=_.x-(b.x-_.x)*_.z/w,M=_.y-(b.y-_.y)*_.z/w,T=r.getTarget(),A=Math.pow(2,u),L=a.ProjectionMercator.projectScale(T,A);return a.ProjectionMercator.unproject(new i.Vector2(x+L.x,L.y-M),m)},t.pixelCoordinateToCameraCoordinate=function(e,r){return t.pixelCoordinateToCameraCoordinateZoom(e,r,r.getZoom())},t.pixelCoordinateToScreenCoordinate=function(e,r,o,a,s){var l=t.pixelCoordinateToCameraCoordinate(e,r),u=t.getElevationPixelFromMeter(a,r),h=new n.Vector3(l.x,l.y,u),p=s;null==p&&(p=c.CameraUtils.calculateViewProjectionMatrix(r,o.x,o.y));var f=p.transform(h,1),d=(f.x+1)*o.x/2,g=o.y-(f.y+1)*o.y/2;return new i.Vector2(d,g)},t.pixelCoordinateToCameraCoordinateZoom=function(t,e,r){var i=Math.pow(2,r),n=a.ProjectionMercator.worldSize(i),o=a.ProjectionMercator.projectScale(e.getTarget(),i);o.x=o.x-n/2,o.y=n/2-o.y;var s=t;return s.x=s.x-n/2,s.y=n/2-s.y,s.x-=o.x,s.y-=o.y,s},t.latLngToScreenCoordinate=function(t,e,r,i,n){return this.latLngToScreenCoordinateZoom(t,e,r,i,r.getZoom(),n)},t.latLngToScreenCoordinateZoom=function(e,r,i,n,o,s){o<0&&(o=i.getZoom());var l=Math.pow(2,o),u=a.ProjectionMercator.projectScale(e,l);return t.pixelCoordinateToScreenCoordinate(u,i,n,r,s)},t.tileCoordinateToLatLngBounds=function(e){var r=e.getX(),i=e.getY(),n=e.getZoom(),a=new o.LatLng(t.lat(n,i+1),t.lon(n,r)),l=new o.LatLng(t.lat(n,i),t.lon(n,r+1));return new s.LatLngBounds(a,l)},t.pixelCoordinateToVectorTileCoordinate=function(t,e,r,n){var o=u.MapUtils.getTileSize()*n,a=t.x-e*o,s=t.y-r*o;return a=a/o-.5,s=.5-s/o,new i.Vector2(a,s)},t.getElevationPixelFromMeter=function(e,r){return e=Math.max(e,0),t.getPixelFromMeter(e,r.getTarget().lat,r.getZoom())},t.getPixelFromMeter=function(t,e,r){return t/a.ProjectionMercator.getMetersPerPixelAtLatitude(e,r)},t}();e.GeometryUtils=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(30),n=function(){function t(t){void 0===t&&(t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),this.data=t}return t.prototype.setIdentity=function(t,e,r){return void 0===t&&(t=1),void 0===e&&(e=1),void 0===r&&(r=1),this.data[0]=t,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=e,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=r,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1,this},t.prototype.copy=function(t){return this.data[0]=t.data[0],this.data[1]=t.data[1],this.data[2]=t.data[2],this.data[3]=t.data[3],this.data[4]=t.data[4],this.data[5]=t.data[5],this.data[6]=t.data[6],this.data[7]=t.data[7],this.data[8]=t.data[8],this.data[9]=t.data[9],this.data[10]=t.data[10],this.data[11]=t.data[11],this.data[12]=t.data[12],this.data[13]=t.data[13],this.data[14]=t.data[14],this.data[15]=t.data[15],this},t.translate=function(e,r,i){return void 0===i&&(i=0),new t(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,r,i,1]))},t.prototype.translate=function(t,e,r){return void 0===r&&(r=0),this.data[12]+=t,this.data[13]+=e,this.data[14]+=r,this},Object.defineProperty(t.prototype,"position",{get:function(){return new i.Vector3(this.data[12],this.data[13],this.data[14])},enumerable:!0,configurable:!0}),t.rotateX=function(e){e*=Math.PI/180;var r=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1]))},t.prototype.setRotationX=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return this.setIdentity(),this.data[5]=r,this.data[6]=e,this.data[9]=-e,this.data[10]=r,this},t.prototype.rotateX=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t),i=this.data[1],n=this.data[2];return this.data[1]=i*r-n*e,this.data[2]=i*e+n*r,i=this.data[5],n=this.data[6],this.data[5]=i*r-n*e,this.data[6]=i*e+n*r,i=this.data[9],n=this.data[10],this.data[9]=i*r-n*e,this.data[10]=i*e+n*r,i=this.data[13],n=this.data[14],this.data[13]=i*r-n*e,this.data[14]=i*e+n*r,this},t.rotateY=function(e){e*=Math.PI/180;var r=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1]))},t.prototype.setRotationY=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return this.setIdentity(),this.data[0]=r,this.data[2]=e,this.data[8]=-e,this.data[10]=r,this},t.prototype.rotateY=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t),i=this.data[0],n=this.data[2];return this.data[0]=i*r-n*e,this.data[2]=i*e+n*r,i=this.data[4],n=this.data[6],this.data[4]=i*r-n*e,this.data[6]=i*e+n*r,i=this.data[8],n=this.data[10],this.data[8]=i*r-n*e,this.data[10]=i*e+n*r,i=this.data[12],n=this.data[14],this.data[12]=i*r-n*e,this.data[14]=i*e+n*r,this},t.rotateZ=function(e){e*=Math.PI/180;var r=Math.sin(e),i=Math.cos(e);return new t(new Float32Array([i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1]))},t.prototype.setRotationZ=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return this.setIdentity(),this.data[0]=r,this.data[1]=e,this.data[4]=-e,this.data[5]=r,this},t.prototype.rotateZ=function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t),i=this.data[0],n=this.data[1];return this.data[0]=i*r-n*e,this.data[1]=i*e+n*r,i=this.data[4],n=this.data[5],this.data[4]=i*r-n*e,this.data[5]=i*e+n*r,i=this.data[8],n=this.data[9],this.data[8]=i*r-n*e,this.data[9]=i*e+n*r,i=this.data[12],n=this.data[13],this.data[12]=i*r-n*e,this.data[13]=i*e+n*r,this},t.scale=function(e,r,i){return null==r&&(r=e,i=e),new t(new Float32Array([e,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1]))},t.prototype.scale=function(t,e,r){null==e&&(e=t,r=t);var i=this.data[0],n=this.data[1],o=this.data[2];return this.data[0]=i*t,this.data[1]=n*e,this.data[2]=o*r,i=this.data[4],n=this.data[5],o=this.data[6],this.data[4]=i*t,this.data[5]=n*e,this.data[6]=o*r,i=this.data[8],n=this.data[9],o=this.data[10],this.data[8]=i*t,this.data[9]=n*e,this.data[10]=o*r,i=this.data[12],n=this.data[13],o=this.data[14],this.data[12]=i*t,this.data[13]=n*e,this.data[14]=o*r,this},t.prototype.multiply=function(e){var r=new t(new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));if(null==e)return r;for(var i=0;i<4;++i)for(var n=0;n<4;++n)for(var o=0;o<4;++o)r.data[4*i+o]+=this.data[4*i+n]*e.data[4*n+o];return r},t.prototype.fconcat=function(t,e,r,i,n,o,a,s,l,u,h,c,p,f,d,g){var y=this.data[0],m=this.data[1],v=this.data[2],_=this.data[3];return this.data[0]=y*t+m*n+v*l+_*p,this.data[1]=y*e+m*o+v*u+_*f,this.data[2]=y*r+m*a+v*h+_*d,this.data[3]=y*i+m*s+v*c+_*g,y=this.data[4],m=this.data[5],v=this.data[6],_=this.data[7],this.data[4]=y*t+m*n+v*l+_*p,this.data[5]=y*e+m*o+v*u+_*f,this.data[6]=y*r+m*a+v*h+_*d,this.data[7]=y*i+m*s+v*c+_*g,y=this.data[8],m=this.data[9],v=this.data[10],_=this.data[11],this.data[8]=y*t+m*n+v*l+_*p,this.data[9]=y*e+m*o+v*u+_*f,this.data[10]=y*r+m*a+v*h+_*d,this.data[11]=y*i+m*s+v*c+_*g,y=this.data[12],m=this.data[13],v=this.data[14],_=this.data[15],this.data[12]=y*t+m*n+v*l+_*p,this.data[13]=y*e+m*o+v*u+_*f,this.data[14]=y*r+m*a+v*h+_*d,this.data[15]=y*i+m*s+v*c+_*g,this},t.prototype.concat=function(t){return null==t?this:this.fconcat(t.data[0],t.data[1],t.data[2],t.data[3],t.data[4],t.data[5],t.data[6],t.data[7],t.data[8],t.data[9],t.data[10],t.data[11],t.data[12],t.data[13],t.data[14],t.data[15])},t.ortho=function(e,r,i,n,o,a){return void 0===o&&(o=-100),void 0===a&&(a=100),new t(new Float32Array([2/(r-e),0,0,0,0,2/(n-i),0,0,0,0,-2/(a-o),0,-(e+r)/(r-e),-(n+i)/(n-i),-(o+a)/(o-a),1]))},t.prototype.setOrtho=function(t,e,r,i,n,o){return void 0===n&&(n=-100),void 0===o&&(o=100),this.data[0]=2/(e-t),this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=2/(i-r),this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=-2/(o-n),this.data[11]=-1,this.data[12]=-(t+e)/(e-t),this.data[13]=-(i+r)/(i-r),this.data[14]=-(n+o)/(n-o),this.data[15]=1,this},t.perspective=function(e,r,i,n){var o=Math.tan(e/2)*i,a=o*r;return t.frustum(-a,a,-o,o,i,n)},t.prototype.setPerspective=function(t,e,r,i){var n=Math.tan(t/2)*r,o=n*e;return this.setFrustum(-o,o,-n,n,r,i)},t.frustum=function(e,r,i,n,o,a){return void 0===o&&(o=-100),void 0===a&&(a=100),new t(new Float32Array([2*o/(r-e),0,0,0,0,2*o/(n-i),0,0,(r+e)/(r-e),(n+i)/(n-i),-(a+o)/(a-o),-1,0,0,-2*o*a/(a-o),0]))},t.prototype.setFrustum=function(t,e,r,i,n,o){void 0===n&&(n=-100),void 0===o&&(o=100),this.data[0]=2*n/(e-t),this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=2*n/(i-r),this.data[6]=0,this.data[7]=0,this.data[8]=(e+t)/(e-t),this.data[9]=(i+r)/(i-r),this.data[10]=-(o+n)/(o-n),this.data[11]=-1,this.data[12]=0,this.data[13]=0,this.data[14]=-2*n*o/(o-n),this.data[15]=0},t.prototype.transform=function(t,e){void 0===e&&(e=0);var r=this.data[0]*t.x+this.data[4]*t.y+this.data[8]*t.z+this.data[12]*e,n=this.data[1]*t.x+this.data[5]*t.y+this.data[9]*t.z+this.data[13]*e,o=this.data[2]*t.x+this.data[6]*t.y+this.data[10]*t.z+this.data[14]*e;return 0==(e=this.data[3]*t.x+this.data[7]*t.y+this.data[11]*t.z+this.data[15]*e)&&(e=1),new i.Vector3(r/e,n/e,o/e)},t.prototype.buffer=function(){return this.data},t.lookAt=function(e,r,n,o){void 0===n&&(n=1),void 0===o&&(o=new i.Vector3(0,0,1));var a=e.subtract(r).normalize(),s=o.cross(a).normalize(),l=a.cross(s).normalize(),u=t.translate(-e.x,-e.y,-e.z);return u.fconcat(s.x,l.x,a.x,0,s.y,l.y,a.y,0,s.z,l.z,a.z,0,0,0,0,1),u.scale(n)},t.prototype.lookAt=function(t,e,r,n){void 0===r&&(r=1),void 0===n&&(n=new i.Vector3(0,0,1));var o=t.subtract(e).normalize(),a=n.cross(o).normalize(),s=o.cross(a).normalize();return this.setIdentity(),this.translate(-t.x,-t.y,-t.z),this.fconcat(a.x,s.x,o.x,0,a.y,s.y,o.y,0,a.z,s.z,o.z,0,0,0,0,1),this.scale(r)},t.prototype.inverse=function(){for(var e=this.data.slice(),r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),i=0;i<4;++i){for(var n=i;n<4&&0==e[4*n+i];)++n;if(4==n||0==e[4*n+i])return console.log("Cannot calculate inverse, determinant is zero"),this;if(n!=i){var o=e.slice(4*i,4*(i+1)),a=e.slice(4*n,4*(n+1));e.set(a,4*i),e.set(o,4*n);var s=r.slice(4*i,4*(i+1)),l=r.slice(4*n,4*(n+1));r.set(l,4*i),r.set(s,4*n)}var u=e.slice(4*i,4*(i+1)),h=r.slice(4*i,4*(i+1));for(n=0;n<4;++n){a=e.slice(4*n,4*(n+1)),l=r.slice(4*n,4*(n+1));if(n!=i){if(0!=a[i]){for(var c=-a[i]/u[i],p=i;p<4;++p)a[p]=a[p]+c*u[p];e.set(a,4*n);for(p=0;p<4;++p)l[p]=l[p]+c*h[p];r.set(l,4*n)}}else{if(0==(c=u[i]))return console.log("Cannot calculate inverse, determinant is zero"),this;for(p=i;p<4;++p)a[p]=a[p]/c;e.set(a,4*n);for(p=0;p<4;++p)l[p]=l[p]/c;r.set(l,4*n)}}}return new t(r)},t}();e.Matrix4=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n,o,a=r(27),s=r(26),l=r(162),u=r(53),h=r(41),c=r(65),p=r(35);!function(t){t[t.SYMBOL_SHADER=0]="SYMBOL_SHADER",t[t.POLYLINE_SHADER=1]="POLYLINE_SHADER",t[t.FILL_SHADER=2]="FILL_SHADER",t[t.GEOJSON_SHADER=3]="GEOJSON_SHADER",t[t.RASTER_SHADER=4]="RASTER_SHADER",t[t.RASTER_WITH_SHADOW_SHADER=5]="RASTER_WITH_SHADOW_SHADER",t[t.RASTER_FOG_SHADER=6]="RASTER_FOG_SHADER",t[t.RASTER_3D_WITH_SHADOW_SHADER=7]="RASTER_3D_WITH_SHADOW_SHADER",t[t.CIRCLE_SHADER=8]="CIRCLE_SHADER",t[t.BUILDING_OUTLINING=9]="BUILDING_OUTLINING",t[t.BUILDING_SHADER=10]="BUILDING_SHADER",t[t.BUILDING_SELECTION_SHADER=11]="BUILDING_SELECTION_SHADER",t[t.DEBUG_SELECTION_SHADER=12]="DEBUG_SELECTION_SHADER",t[t.PARTICLE_SHADER=13]="PARTICLE_SHADER",t[t.SHADOW_MAPPING_SHADER=14]="SHADOW_MAPPING_SHADER",t[t.BUILDING_WITH_SHADOW_SHADER=15]="BUILDING_WITH_SHADOW_SHADER",t[t.SKY_SHARDER=16]="SKY_SHARDER",t[t.TEXT_LABEL_SHADER=17]="TEXT_LABEL_SHADER",t[t.TILE_DEBUG_SHADER=18]="TILE_DEBUG_SHADER",t[t.LINE_COLLISION_SHADER=19]="LINE_COLLISION_SHADER"}(i=e.ShaderEnum||(e.ShaderEnum={})),function(t){t[t.SYMBOL_MODEL=0]="SYMBOL_MODEL",t[t.RASTER_MODEL=1]="RASTER_MODEL",t[t.CIRCLE_MODEL=2]="CIRCLE_MODEL",t[t.SKY_MODEL=3]="SKY_MODEL",t[t.SELECTION_DEBUG_MODEL=4]="SELECTION_DEBUG_MODEL",t[t.PARTICLE_QUAD_MODEL=5]="PARTICLE_QUAD_MODEL"}(n=e.ModelEnum||(e.ModelEnum={})),function(t){t[t.WHITE_TEXTURE=0]="WHITE_TEXTURE",t[t.RAIN_TEXTURE=1]="RAIN_TEXTURE",t[t.SNOW_TEXTURE=2]="SNOW_TEXTURE",t[t.WATER_DISPLACEMENT=3]="WATER_DISPLACEMENT",t[t.WATER_COLOR=4]="WATER_COLOR",t[t.POLYLINE_TEXTURE=5]="POLYLINE_TEXTURE"}(o=e.TextureEnum||(e.TextureEnum={}));var f=function(){function t(t){this.gl=t,this.shaders=new Map,this.models=new Map,this.textures=new Map,this.init()}return t.getInstance=function(t){var e=t.id;null==this.instances&&(this.instances=new Map);var r=this.instances.get(e);return r||(r=new this(t),this.instances.set(e,r)),r},t.releaseInstance=function(t){var e=t.id;if(null!=this.instances){var r=this.instances.get(e);r&&(r.textures.forEach((function(t){return t.destroy()})),r.models.forEach((function(t){return t.destroy()})),r.shaders.forEach((function(t){return t.destroy()})),r.textures.clear(),r.models.clear(),r.shaders.clear(),this.instances.delete(e))}},t.prototype.createShader=function(t,e){return new a.Shader(this.gl,t,e)},t.prototype.createModel=function(t){var e=this.gl,r=new s.Model(e),i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null);var n=[new a.AttributeInfo("a_position",3,0,5),new a.AttributeInfo("a_uv",2,3,5)];return r.numOfVertices=6,r.arrayBuffer=i,r.attributeInfos=n,r},t.prototype.init=function(){var t=this.createShader(l.ShaderSource.basicVS,l.ShaderSource.basicFS);this.shaders.set(i.RASTER_SHADER,t),this.shaders.set(i.RASTER_FOG_SHADER,this.createShader(l.ShaderSource.rasterFogVS,l.ShaderSource.rasterFogFS)),this.shaders.set(i.RASTER_WITH_SHADOW_SHADER,this.createShader(l.ShaderSource.raster3DWithShadowVS,l.ShaderSource.rasterWithShadowFS+l.ShaderSource.shadowFS)),this.shaders.set(i.RASTER_3D_WITH_SHADOW_SHADER,this.createShader(l.ShaderSource.raster3DWithShadowVS,l.ShaderSource.raster3DWithShadowFS+l.ShaderSource.shadowFS)),this.shaders.set(i.SYMBOL_SHADER,this.createShader(l.ShaderSource.markerVS,l.ShaderSource.markerFS)),this.shaders.set(i.POLYLINE_SHADER,this.createShader(l.ShaderSource.polylineVS,l.ShaderSource.polylineFS)),this.shaders.set(i.FILL_SHADER,this.createShader(l.ShaderSource.fillVS,l.ShaderSource.fillFS)),this.shaders.set(i.GEOJSON_SHADER,this.createShader(l.ShaderSource.geoJsonVS,l.ShaderSource.geoJsonFS)),this.shaders.set(i.CIRCLE_SHADER,this.createShader(l.ShaderSource.circleVS,l.ShaderSource.circleFS)),this.shaders.set(i.BUILDING_OUTLINING,this.createShader(l.ShaderSource.buildingVS,l.ShaderSource.buildingOutliningFS)),this.shaders.set(i.BUILDING_SHADER,this.createShader(l.ShaderSource.buildingVS,l.ShaderSource.buildingFS)),this.shaders.set(i.BUILDING_SELECTION_SHADER,this.createShader(l.ShaderSource.buildingSelectionVS,l.ShaderSource.buildingSelectionFS)),this.shaders.set(i.SKY_SHARDER,this.createShader(l.ShaderSource.skyVS,l.ShaderSource.skyFS)),this.shaders.set(i.DEBUG_SELECTION_SHADER,this.createShader(l.ShaderSource.debugSelectionVS,l.ShaderSource.debugSelectionFS)),this.shaders.set(i.PARTICLE_SHADER,t),this.shaders.set(i.SHADOW_MAPPING_SHADER,this.createShader(l.ShaderSource.shadowMappingVS,l.ShaderSource.shadowMappingFS)),this.shaders.set(i.TEXT_LABEL_SHADER,this.createShader(l.ShaderSource.textLabelVS,l.ShaderSource.textLabelFS)),this.shaders.set(i.BUILDING_WITH_SHADOW_SHADER,this.createShader(l.ShaderSource.buildingWithShadowVS,l.ShaderSource.buildingWithShadowFS+l.ShaderSource.shadowFS)),p.Env.isTileDebug&&this.shaders.set(i.TILE_DEBUG_SHADER,this.createShader(l.ShaderSource.tileDebugVS,l.ShaderSource.tileDebugFS)),p.Env.isCollisionDebug&&this.shaders.set(i.LINE_COLLISION_SHADER,this.createShader(l.ShaderSource.collisionDebugVS,l.ShaderSource.collisionDebugFS));var e=new Float32Array([-1,-1,0,0,1,-1,1,0,0,0,1,1,0,1,0,1,1,0,1,0,1,-1,0,1,1,-1,-1,0,0,1]),r=this.createModel(e),f=[],d=new u.CircleBuilderContext;d.addVertex=function(t){f.push(t.x,t.y)},u.buildCircle(d);var g=new s.Model(this.gl);g.init(f,[new a.AttributeInfo("a_extrude",2,0,2)],d.indices),this.models.set(n.RASTER_MODEL,r),this.models.set(n.SYMBOL_MODEL,r),this.models.set(n.SKY_MODEL,r),this.models.set(n.CIRCLE_MODEL,g),this.models.set(n.SELECTION_DEBUG_MODEL,r),this.models.set(n.PARTICLE_QUAD_MODEL,r);var y=new h.Texture(this.gl);this.textures.set(o.WHITE_TEXTURE,y);var m=new h.Texture(this.gl);m.loadImage(c.Images.get("rainTexture"),null),this.textures.set(o.RAIN_TEXTURE,m);var v=new h.Texture(this.gl);v.loadImage(c.Images.get("snowTexture"),null),this.textures.set(o.SNOW_TEXTURE,v);var _=new h.TextureFiltering(this.gl.LINEAR_MIPMAP_LINEAR,this.gl.LINEAR),b=new h.TextureWrapping(this.gl.REPEAT,this.gl.REPEAT),w=new h.TextureOptions(this.gl.TEXTURE_2D,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,_,b),x=new h.Texture(this.gl,w);x.loadImage(c.Images.waterDisplacement,null),this.textures.set(o.WATER_DISPLACEMENT,x);var M=new h.Texture(this.gl,w);M.loadImage(c.Images.waterColor,null),this.textures.set(o.WATER_COLOR,M)},t.prototype.getShader=function(t){return this.shaders.get(t)},t.prototype.getModel=function(t){return this.models.get(t)},t.prototype.getTexture=function(t){return this.textures.get(t)},t.instances=null,t}();e.ResourceManager=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),this.alpha=i,this._buffer=new Float32Array([t,e,r])}return t.prototype.rgbBuffer=function(){return this._buffer},t.prototype.buffer=function(){return new Float32Array([this.red,this.green,this.blue,this.alpha])},Object.defineProperty(t.prototype,"red",{get:function(){return this._buffer[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"green",{get:function(){return this._buffer[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blue",{get:function(){return this._buffer[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+255*this.red+","+255*this.green+","+255*this.blue+","+this.alpha+")"},enumerable:!0,configurable:!0}),t.fromHex=function(e){void 0===e&&(e="000000"),4!=e.length&&7!=e.length&&9!=e.length||(e=e.substring(1,e.length)),3==e.length&&(e=e.split("").map((function(t){return t+t})).join(""));var r=parseInt(e,16);return 6==e.length?new t((r>>16)/255,(r>>8&255)/255,(255&r)/255):new t((r>>24&255)/255,(r>>16&255)/255,(r>>8&255)/255,(255&r)/255)},t.fromInt=function(e){return void 0===e&&(e=0),e<0&&(e=0),new t((e>>16&255)/255,(e>>8&255)/255,(255&e)/255)},t.fromVec3=function(e){return new t(e.x,e.y,e.z)},t.mix=function(e,r,i){return new t(e.red*i+r.red*(1-i),e.green*i+r.green*(1-i),e.blue*i+r.blue*(1-i),e.alpha*i+r.alpha*(1-i))},Object.defineProperty(t.prototype,"code",{get:function(){var t=function(t){var e=Math.floor(255*t).toString(16);return e=(e=1==e.length?"0"+e:e).length>2?e.substr(0,2):e};return"#"+t(this.red)+t(this.green)+t(this.blue)+t(this.alpha)},enumerable:!0,configurable:!0}),t.isValid=function(t){return/^#?([0-9A-Fa-f]){6,8}$/i.test(t)},t}();e.Color=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(46),a=r(5),s=function(t){function e(e,r){var i=t.call(this,a.ClassType.POINT)||this;if(null==e||null==r)throw Error("Parameters can not be null");return i.x=e,i.y=r,i}return n(e,t),e.convertPointToMBPoint=function(t){return new o(t.x,t.y)},e.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},e.prototype.toString=function(){return"("+String(this.x)+","+String(this.y)+")"},e.convert=function(t){if(a.Map4dObject.isClassType(t,a.ClassType.POINT))return t;if(Array.isArray(t)&&2===t.length)return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t&&"x"in t&&"y"in t)return new e(Number(t.x),Number(t.y));throw new Error("`IPoint` argument must be specified as a Point instance, an object {x: <x>, y: <y>}, or an array of [<x>, <y>]")},e}(a.Map4dObject);e.Point=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.clamp=function(t,e,r){return t<e?e:t>r?r:t},t.toRadians=function(t){return t*Math.PI/180},t.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t.findNextPowerOf2=function(t){return t-=1,1<<Math.log2(t)+1},t.findPreviousPowerOf2=function(t){return 1<<31-Math.clz32(t)},t}();e.MathUtils=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.mapState=t,this.layer=e}return t.prototype.renderSelection=function(){},t.prototype.renderShadowMapping=function(){},t.prototype.getRenderTiles=function(){return this.layer.mapView.tileManager.getTilePyramid().getRenderTiles()},t.prototype.getVisibleTiles=function(){return this.layer.mapView.tileManager.getVisibleTiles()},t.getSelectionCode=function(){return this.selectionCode++,(t.selectionCode<t.MIN_SELECTION_CODE||this.selectionCode>t.MAX_SELECTION_CODE)&&(t.selectionCode=t.MIN_SELECTION_CODE),t.selectionCode},t.resetSelectionCode=function(){t.selectionCode=0},t.MIN_SELECTION_CODE=1,t.MAX_SELECTION_CODE=16777215,t.selectionCode=0,t}();e.LayerRenderer=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5);!function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.Raster=4]="Raster",t[t.Building=5]="Building"}(e.GeometryType||(e.GeometryType={}));var a=function(t){function e(e,r,i,n){var a=t.call(this,o.ClassType.TILE_FEATURE)||this;return a.id=e,a.type=r,a.geometries=i,a.properties=n,a}return n(e,t),e.prototype.getId=function(){return this.id},e.prototype.getType=function(){return this.type},e.prototype.getGeometries=function(){return this.geometries},e.prototype.getProperties=function(){return this.properties},e}(o.Map4dObject);e.TileFeature=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.id=t,this.order=e}return t.prototype.equal=function(t){return this.id==t.id},t.prototype.lessThan=function(t){return this.order==t.order?this.id<t.id:this.order<t.order},t}();e.Order=i,e.compareOrderASC=function(t,e){return t.order==e.order?t.id<e.id?-1:t.id>e.id?1:0:t.order-e.order},e.compareOrderDESC=function(t,e){return t.order==e.order?t.id<e.id?1:t.id>e.id?-1:0:e.order-t.order}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.raster="raster",t.roadmap="roadmap",t.satellite="satellite",t.map3d="map3d"}(e.MapType||(e.MapType={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(78),n=r(121);!function(t){t[t.BASEMAP=0]="BASEMAP",t[t.ANNOTATION=1]="ANNOTATION",t[t.VECTOR=2]="VECTOR",t[t.OVERLAY=3]="OVERLAY"}(e.Kind||(e.Kind={}));var o=function(){function t(t,e,r){this.renderable=!1,this.kind=t,this.tileCoordinate=e,this.gl=r,this.tileData=new i.TileData,this.tileRenderData=new n.TileRenderData}return t.prototype.getTileData=function(){return this.tileData},t.prototype.setTileData=function(t){this.tileData=t},t.prototype.getTileRenderData=function(){return this.tileRenderData},t.prototype.hasData=function(t){return null!=this.tileData&&null!=this.tileData.getTileLayer(t)},t.prototype.getLayerData=function(t){return this.tileRenderData.getLayerRenderData(t)},t.prototype.isRenderable=function(){return this.renderable},t.prototype.setRenderable=function(){this.renderable=!0},t.prototype.getKind=function(){return this.kind},t.prototype.getTileCoordinate=function(){return this.tileCoordinate},t.prototype.destroy=function(){this.tileRenderData.destroy()},t}();e.Tile=o},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=r(2),s=r(5),l=function(t){function e(e,r){var i=t.call(this,s.ClassType.LATLNG_BOUNDS)||this;if(e&&(r?(i.southwest=s.Map4dObject.isClassType(e,s.ClassType.LATLNG)?new o.LatLng(e.lat,e.lng):o.LatLng.convert(e),i.northeast=s.Map4dObject.isClassType(r,s.ClassType.LATLNG)?new o.LatLng(r.lat,r.lng):o.LatLng.convert(r)):4===e.length?(i.southwest=o.LatLng.convert([e[1],e[0]]),i.northeast=o.LatLng.convert([e[3],e[2]])):(i.southwest=s.Map4dObject.isClassType(e[0],s.ClassType.LATLNG)?new o.LatLng(e[0].lat,e[0].lng):o.LatLng.convert(e[0]),i.northeast=s.Map4dObject.isClassType(e[1],s.ClassType.LATLNG)?new o.LatLng(e[1].lat,e[1].lng):o.LatLng.convert(e[1]))),!i.southwest||!i.northeast)return i;if(i.southwest.lat>i.northeast.lat||i.southwest.lng>i.northeast.lng){var n=i.southwest,a=i.northeast;i.southwest=new o.LatLng(Math.min(n.lat,a.lat),Math.min(n.lng,a.lng)),i.northeast=new o.LatLng(Math.max(n.lat,a.lat),Math.max(n.lng,a.lng))}return i}return n(e,t),e.prototype.extend=function(t){var e=o.LatLng.convert(t);return this.southwest&&this.northeast?(this.southwest=new o.LatLng(Math.min(e.lat,this.southwest.lat),Math.min(this.southwest.lng,e.lng)),this.northeast=new o.LatLng(Math.max(e.lat,this.northeast.lat),Math.max(this.northeast.lng,e.lng))):(this.southwest=new o.LatLng(e.lat,e.lng),this.northeast=new o.LatLng(e.lat,e.lng)),this},e.prototype.getCenter=function(){return this.northeast&&this.southwest?new o.LatLng((this.northeast.lat+this.southwest.lat)/2,(this.northeast.lng+this.southwest.lng)/2):new o.LatLng(0,0)},e.prototype.getNortheast=function(){return this.northeast||o.LatLng.convert([a.MapConstants.maxLongitude,a.MapConstants.maxLatitude])},e.prototype.getSouthwest=function(){return this.southwest||o.LatLng.convert([a.MapConstants.minLongitude,a.MapConstants.minLatitude])},e.world=function(){return new e([a.MapConstants.minLongitude,a.MapConstants.minLatitude],[a.MapConstants.maxLongitude,a.MapConstants.maxLatitude])},e.convert=function(t){return s.Map4dObject.isClassType(t,s.ClassType.LATLNG_BOUNDS)?t:new e(t)},e}(s.Map4dObject);e.LatLngBounds=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=r(4),s=function(t){function e(e,r,i,n){void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===n&&(n=null);var s=t.call(this,o.ClassType.CAMERA_POSITION)||this;return s.target=null==e?null:a.LatLng.convert(e),s.tilt=r,s.bearing=i,s.zoom=n,s}return n(e,t),e.prototype.setTarget=function(t){this.target=a.LatLng.convert(t)},e.prototype.setTilt=function(t){this.tilt=t},e.prototype.setBearing=function(t){this.bearing=t,Math.abs(Math.abs(this.bearing)%180-90)<.1&&(this.bearing+=.2)},e.prototype.setZoom=function(t){this.zoom=t},e.prototype.getTarget=function(){return this.target},e.prototype.getTilt=function(){return this.tilt},e.prototype.getBearing=function(){return this.bearing},e.prototype.getZoom=function(){return this.zoom},e.convert=function(t){return o.Map4dObject.isClassType(t,o.ClassType.CAMERA_POSITION)?t:new e(t.target,t.tilt,t.bearing,t.zoom)},e}(o.Map4dObject);e.CameraPosition=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.LogUtils=function(){},t.logDeprecated=function(t,e,r){r?console.warn("Method `%s` is deprecated. Use `%s` method instead.",t,e):console.warn("The `%s` prop is deprecated. Use the `%s` prop instead.",t,e)},t.logNonNull=function(t){console.warn("Parameter %s can not be null",t)},t}();e.LogUtils=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.layerType=t,this.properties=null}return t.prototype.getType=function(){return this.layerType},t.prototype.getLayerProperties=function(){return this.properties},t.prototype.setLayerProperties=function(t){this.properties=t},t}();e.LayerRenderData=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.getLayer=function(){return this.layer},t}();e.LayerProperties=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(2),o=r(9),a=r(30),s=function(){function t(){}return t.calculateViewMatrix=function(t,e,r){var o=i.MapUtils.getTileSize(),s=n.CameraConstants.height*Math.tan(n.CameraConstants.fov/2)*o/r/(o/2),l=this.matrix.setRotationX(e.getTilt()),u=e.getBearing(),h=l.transform(new a.Vector3(0,0,n.CameraConstants.height),0);l.setRotationZ(-u);var c=l.transform(h,0);l.setRotationX(e.getTilt()),h=l.transform(new a.Vector3(0,1,0),0),l.setRotationZ(-u);var p=l.transform(h,0);return l.lookAt(c,new a.Vector3(0,0,0),1,p),t.setIdentity(s,s,s),t.concat(l)},t.calculateOrthoProjectionMatrix=function(t,e){return o.Matrix4.ortho(0,t,e,0)},t.calculateViewProjectionMatrix=function(e,r,i){var a=t.calculateViewMatrix(new o.Matrix4,e,i),s=o.Matrix4.perspective(n.CameraConstants.fov,r/i,n.CameraConstants.nearPlane,n.CameraConstants.farPlane);return a.concat(s)},t.calculateInverseViewProjectionMatrix=function(t,e,r){return this.calculateViewProjectionMatrix(t,e,r).inverse()},t.matrix=new o.Matrix4,t}();e.CameraUtils=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(2),a=function(t){this.geometryCoordinates=[],this.geometryCoordinates=t};e.GeometryCoordinates=a;var s=function(t){function e(e){var r=t.call(this,e)||this;return r.normalizeGeometryCoordinates(),r}return n(e,t),e.prototype.normalizeGeometryCoordinates=function(){for(var t=[],e=0;e<this.geometryCoordinates.length;++e){for(var r=[],i=0;i<this.geometryCoordinates[e].length;++i)r.push([this.geometryCoordinates[e][i][0]/o.MapConstants.tileExtend-.5,.5-this.geometryCoordinates[e][i][1]/o.MapConstants.tileExtend]);t.push(r)}this.geometryCoordinates=t},e}(a);e.GeometryCollection=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(27),a=function(t){function e(e,r,i,n,a){void 0===r&&(r=null),void 0===i&&(i=null),void 0===n&&(n=null);var s=t.call(this)||this;if(s.gl=e,s.attributeInfos=[],s._points=[],r){s.numOfVertices=r.length;for(var l=[],u=0,h=r;u<h.length;u++)for(var c=h[u],p=0,f=i;p<f.length;p++)for(var d=0,g=c[b=f[p]];d<g.length;d++){var y=g[d];l.push(y)}s.arrayBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,s.arrayBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(l),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);for(var m=r[0],v=0,_=0;_<i.length;++_){var b=i[_],w=n[_],x=m[b].length,M=new o.AttributeInfo(w,x,v,0);s.attributeInfos.push(M),v+=x}for(var T=0,A=s.attributeInfos;T<A.length;T++){(M=A[T]).stride=v}null!=a&&s.setIndices(a)}return s}return n(e,t),e.prototype.init=function(t,e,r){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===r&&(r=null),null!=this.gl&&null!=t&&null!=r&&null!=e){var i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.setIndices(r),this.arrayBuffer=i,this.numOfVertices=r.length,this.attributeInfos=e}else console.log("GL or data or dicies is missing")},e.prototype.init3dObjectFormArrayBuffer=function(t){if(void 0===t&&(t=null),null!=this.gl){var e=this.gl.createBuffer();if(null!=t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.arrayBuffer=e;this.numOfVertices=t.byteLength/4/8,this.attributeInfos=[new o.AttributeInfo("a_position",3,0,8),new o.AttributeInfo("a_uv",2,3,8),new o.AttributeInfo("a_normal",3,5,8)]}else console.log("Vertices size can not be null")}else console.log("init model Building no data")},e.prototype.init3dObject=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),null!=this.gl){var r=this.gl.createBuffer();if(null!=t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.arrayBuffer=r;null!=e?this.setIndices(e):this.numOfVertices=t.length/8,this.attributeInfos=[new o.AttributeInfo("a_position",3,0,8),new o.AttributeInfo("a_uv",2,3,8),new o.AttributeInfo("a_normal",3,5,8)]}else console.log("Vertices size can not be null")}else console.log("init model Building no data")},e.prototype.setIndices=function(t){if(t){var e=this.gl;this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Int16Array(t),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.numOfVertices=t.length}},e.prototype.bind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.arrayBuffer),this.indexBuffer&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},e.prototype.unbind=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.indexBuffer&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)},e.prototype.render=function(t){this.indexBuffer?this.gl.drawElements(t,this.numOfVertices,this.gl.UNSIGNED_SHORT,0):this.numOfVertices>0&&this.gl.drawArrays(t,0,this.numOfVertices)},e.prototype.renderPartial=function(t,e,r){this.indexBuffer?this.gl.drawElements(t,r,this.gl.UNSIGNED_SHORT,2*e):this.numOfVertices>0&&this.gl.drawArrays(t,e,r)},e.prototype.destroy=function(){this.arrayBuffer&&(this.gl.deleteBuffer(this.arrayBuffer),this.arrayBuffer=null),this.indexBuffer&&(this.gl.deleteBuffer(this.indexBuffer),this.indexBuffer=null),this.attributeInfos=[]},e.prototype.setHighestModelPosition=function(t){this.highestModelPosition=t},e.prototype.getHighestModelPosition=function(){return this.highestModelPosition},Object.defineProperty(e.prototype,"points",{get:function(){return this._points},set:function(t){this._points=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxX",{get:function(){return this._maxX},set:function(t){this._maxX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxY",{get:function(){return this._maxY},set:function(t){this._maxY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxZ",{get:function(){return this._maxZ},set:function(t){this._maxZ=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minX",{get:function(){return this._minX},set:function(t){this._minX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minY",{get:function(){return this._minY},set:function(t){this._minY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minZ",{get:function(){return this._minZ},set:function(t){this._minZ=t},enumerable:!0,configurable:!0}),e}(r(64).ResourceReference);e.Model=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.name=t,this.size=e,this.offset=r,this.stride=i};e.AttributeInfo=i;var n=function(){function t(t,e,r){this.gl=t,this.textureUnit=0,this.attributes={},this.program=t.createProgram(),this.fragmentShader=this.loadShader(t.FRAGMENT_SHADER,r),this.vertexShader=this.loadShader(t.VERTEX_SHADER,e),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)||(console.log("Error linking shader program"),console.log(t.getProgramInfoLog(this.program))),this.loadAttributes();for(var i=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),n=0;n<i;++n){var o=t.getActiveUniform(this.program,n).name,a=t.getUniformLocation(this.program,o);switch(o){case"u_mvpMatrix":this.mvpMatrixUniform=a;break;case"u_time":this.timeUniform=a;break;case"u_enableWater":this.enableWaterUniform=a;break;case"u_texture":this.textureUniform=a;break;case"u_waterDisplacement":this.waterDisplacementUniform=a;break;case"u_waterColor":this.waterColorUniform=a;break;case"u_opacity":this.opacityUniform=a;break;case"u_light_color":this.lightColorUniform=a;break;case"u_light_position":this.lightPositionUniform=a;break;case"u_fogStart":this.fogStartUniform=a;break;case"u_fogRange":this.fogRangeUniform=a;break;case"u_fogColor":this.fogColorUniform=a;break;case"u_shadowMvpMatrix":this.shadowMvpMatrixUniform=a;break;case"u_shadowMap":this.shadowMapUniform=a;break;case"u_lineWidth":this.lineWidthUniform=a;break;case"u_color":this.colorUniform=a;break;case"u_textureScale":this.textureScaleUniform=a;break;case"u_useStrokePattern":this.useStrokePatternUniform=a;break;case"u_useIcon":this.useIconUniform=a;break;case"u_radius":this.radiusUniform=a;break;case"u_strokeColor":this.strokeColorUniform=a;break;case"u_outerRadius":this.outerRadiusUniform=a;break;case"u_innerRadius":this.innerRadiusUniform=a;break;case"u_modelMatrix":this.modelMatrixUniform=a;break;case"u_camera_direction":this.cameraDirectionUniform=a;break;case"u_lowerLimit":this.lowerLimitUniform=a;break;case"u_upperLimit":this.upperLimitUniform=a;break;case"u_skyColor":this.skyColorUniform=a;break;case"u_texsize":this.texsizeUniform=a;break;case"u_pixel_scale":this.pixelScaleUniform=a;break;case"u_gamma_scale":this.gammaScaleUniform=a;break;case"u_is_halo":this.isHaloUniform=a;break;case"u_text_size":this.textSizeUniform=a;break;case"u_useMaskTexture":this.useMaskTextureUniform=a;break;case"u_spriteInfo":this.spriteInfoUniform=a;break;case"u_padding":this.paddingUniform=a}}}return t.prototype.loadAttributes=function(){for(var t=this.gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),r=0;r<e;++r){var i=t.getActiveAttrib(this.program,r).name;this.attributes[i]=t.getAttribLocation(this.program,i)}},t.prototype.loadShader=function(t,e){var r=this.gl,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS)||(console.log("Error loading shader"),console.log(e),console.log(r.getShaderInfoLog(i))),i},t.prototype.bind=function(){this.gl.useProgram(this.program),this.resetTextureUnit()},t.prototype.resetTextureUnit=function(){this.textureUnit=0},t.prototype.setAttributes=function(t){for(var e=this.gl,r=0,i=t;r<i.length;r++){var n=i[r],o=this.attributes[n.name];null!=o&&(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.size,e.FLOAT,!1,4*n.stride,4*n.offset))}},t.prototype.setTexture=function(t,e){this.gl.activeTexture(this.gl.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(t,this.textureUnit),this.textureUnit+=1},t.prototype.disableAttributes=function(){for(var t in this.attributes)this.gl.disableVertexAttribArray(this.attributes[t])},t.prototype.destroy=function(){this.attributes={},this.gl.deleteProgram(this.program),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader)},t}();e.Shader=n},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(1);!function(t){t[t.Solid=0]="Solid",t[t.Dash=1]="Dash",t[t.Dot=2]="Dot",t[t.Icon=3]="Icon"}(o=e.PatternType||(e.PatternType={}));var s=function(){function t(t){this.type=t}return t.prototype.getType=function(){return this.type},t}();e.PatternItem=s;var l=function(t){function e(){return t.call(this,o.Solid)||this}return n(e,t),e}(s);e.SolidPattern=l;var u=function(t){function e(e){var r=t.call(this,o.Dash)||this;return r.length=e.length*a.MapUtils.pixelScale,r.gap=e.gap*a.MapUtils.pixelScale,r}return n(e,t),e.prototype.getLength=function(){return this.length},e.prototype.getGap=function(){return this.gap},e}(s);e.DashPattern=u;var h=function(t){function e(r){var i=t.call(this,o.Dot)||this,n={};return a.MapUtils.extendOptions(n,e.defaultDotPatternOptions,r),i.repeat=n.repeat,i}return n(e,t),e.prototype.getRepeat=function(){return this.repeat},e.defaultDotPatternOptions={repeat:1},e}(s);e.DotPattern=h;var c=function(t){function e(e){var r=t.call(this,o.Icon)||this;return r.url=e.url,r}return n(e,t),e.prototype.getUrl=function(){return this.url},e}(s);e.IconPattern=c},function(t,e,r){"use strict";t.exports=function(t){return new s(t||g,null)};function i(t,e,r,i,n,o){this._color=t,this.key=e,this.value=r,this.left=i,this.right=n,this._count=o}function n(t){return new i(t._color,t.key,t.value,t.left,t.right,t._count)}function o(t,e){return new i(t,e.key,e.value,e.left,e.right,e._count)}function a(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function s(t,e){this._compare=t,this.root=e}var l=s.prototype;function u(t,e){var r;if(e.left&&(r=u(t,e.left)))return r;return(r=t(e.key,e.value))||(e.right?u(t,e.right):void 0)}function h(t,e,r,i){if(e(t,i.key)<=0){var n;if(i.left)if(n=h(t,e,r,i.left))return n;if(n=r(i.key,i.value))return n}if(i.right)return h(t,e,r,i.right)}function c(t,e,r,i,n){var o,a=r(t,n.key),s=r(e,n.key);if(a<=0){if(n.left&&(o=c(t,e,r,i,n.left)))return o;if(s>0&&(o=i(n.key,n.value)))return o}if(s>0&&n.right)return c(t,e,r,i,n.right)}function p(t,e){this.tree=t,this._stack=e}Object.defineProperty(l,"keys",{get:function(){var t=[];return this.forEach((function(e,r){t.push(e)})),t}}),Object.defineProperty(l,"values",{get:function(){var t=[];return this.forEach((function(e,r){t.push(r)})),t}}),Object.defineProperty(l,"length",{get:function(){return this.root?this.root._count:0}}),l.insert=function(t,e){for(var r=this._compare,n=this.root,l=[],u=[];n;){var h=r(t,n.key);l.push(n),u.push(h),n=h<=0?n.left:n.right}l.push(new i(0,t,e,null,null,1));for(var c=l.length-2;c>=0;--c){n=l[c];u[c]<=0?l[c]=new i(n._color,n.key,n.value,l[c+1],n.right,n._count+1):l[c]=new i(n._color,n.key,n.value,n.left,l[c+1],n._count+1)}for(c=l.length-1;c>1;--c){var p=l[c-1];n=l[c];if(1===p._color||1===n._color)break;var f=l[c-2];if(f.left===p)if(p.left===n){if(!(d=f.right)||0!==d._color){if(f._color=0,f.left=p.right,p._color=1,p.right=f,l[c-2]=p,l[c-1]=n,a(f),a(p),c>=3)(g=l[c-3]).left===f?g.left=p:g.right=p;break}p._color=1,f.right=o(1,d),f._color=0,c-=1}else{if(!(d=f.right)||0!==d._color){if(p.right=n.left,f._color=0,f.left=n.right,n._color=1,n.left=p,n.right=f,l[c-2]=n,l[c-1]=p,a(f),a(p),a(n),c>=3)(g=l[c-3]).left===f?g.left=n:g.right=n;break}p._color=1,f.right=o(1,d),f._color=0,c-=1}else if(p.right===n){if(!(d=f.left)||0!==d._color){if(f._color=0,f.right=p.left,p._color=1,p.left=f,l[c-2]=p,l[c-1]=n,a(f),a(p),c>=3)(g=l[c-3]).right===f?g.right=p:g.left=p;break}p._color=1,f.left=o(1,d),f._color=0,c-=1}else{var d;if(!(d=f.left)||0!==d._color){var g;if(p.left=n.right,f._color=0,f.right=n.left,n._color=1,n.right=p,n.left=f,l[c-2]=n,l[c-1]=p,a(f),a(p),a(n),c>=3)(g=l[c-3]).right===f?g.right=n:g.left=n;break}p._color=1,f.left=o(1,d),f._color=0,c-=1}}return l[0]._color=1,new s(r,l[0])},l.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return u(t,this.root);case 2:return h(e,this._compare,t,this.root);case 3:if(this._compare(e,r)>=0)return;return c(e,r,this._compare,t,this.root)}},Object.defineProperty(l,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new p(this,t)}}),Object.defineProperty(l,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new p(this,t)}}),l.at=function(t){if(t<0)return new p(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new p(this,r);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new p(this,[])},l.ge=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o<=0&&(n=i.length),r=o<=0?r.left:r.right}return i.length=n,new p(this,i)},l.gt=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o<0&&(n=i.length),r=o<0?r.left:r.right}return i.length=n,new p(this,i)},l.lt=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o>0&&(n=i.length),r=o<=0?r.left:r.right}return i.length=n,new p(this,i)},l.le=function(t){for(var e=this._compare,r=this.root,i=[],n=0;r;){var o=e(t,r.key);i.push(r),o>=0&&(n=i.length),r=o<0?r.left:r.right}return i.length=n,new p(this,i)},l.find=function(t){for(var e=this._compare,r=this.root,i=[];r;){var n=e(t,r.key);if(i.push(r),0===n)return new p(this,i);r=n<=0?r.left:r.right}return new p(this,[])},l.remove=function(t){var e=this.find(t);return e?e.remove():this},l.get=function(t){for(var e=this._compare,r=this.root;r;){var i=e(t,r.key);if(0===i)return r.value;r=i<=0?r.left:r.right}};var f=p.prototype;function d(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function g(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(f,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(f,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),f.clone=function(){return new p(this.tree,this._stack.slice())},f.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new i(r._color,r.key,r.value,r.left,r.right,r._count);for(var l=t.length-2;l>=0;--l){(r=t[l]).left===t[l+1]?e[l]=new i(r._color,r.key,r.value,e[l+1],r.right,r._count):e[l]=new i(r._color,r.key,r.value,r.left,e[l+1],r._count)}if((r=e[e.length-1]).left&&r.right){var u=e.length;for(r=r.left;r.right;)e.push(r),r=r.right;var h=e[u-1];e.push(new i(r._color,h.key,h.value,r.left,r.right,r._count)),e[u-1].key=r.key,e[u-1].value=r.value;for(l=e.length-2;l>=u;--l)r=e[l],e[l]=new i(r._color,r.key,r.value,r.left,e[l+1],r._count);e[u-1].left=e[u]}if(0===(r=e[e.length-1])._color){var c=e[e.length-2];c.left===r?c.left=null:c.right===r&&(c.right=null),e.pop();for(l=0;l<e.length;++l)e[l]._count--;return new s(this.tree._compare,e[0])}if(r.left||r.right){r.left?d(r,r.left):r.right&&d(r,r.right),r._color=1;for(l=0;l<e.length-1;++l)e[l]._count--;return new s(this.tree._compare,e[0])}if(1===e.length)return new s(this.tree._compare,null);for(l=0;l<e.length;++l)e[l]._count--;var p=e[e.length-2];return function(t){for(var e,r,i,s,l=t.length-1;l>=0;--l){if(e=t[l],0===l)return void(e._color=1);if((r=t[l-1]).left===e){if((i=r.right).right&&0===i.right._color){if(s=(i=r.right=n(i)).right=n(i.right),r.right=i.left,i.left=r,i.right=s,i._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(i),l>1)(u=t[l-2]).left===r?u.left=i:u.right=i;return void(t[l-1]=i)}if(i.left&&0===i.left._color){if(s=(i=r.right=n(i)).left=n(i.left),r.right=s.left,i.left=s.right,s.left=r,s.right=i,s._color=r._color,r._color=1,i._color=1,e._color=1,a(r),a(i),a(s),l>1)(u=t[l-2]).left===r?u.left=s:u.right=s;return void(t[l-1]=s)}if(1===i._color){if(0===r._color)return r._color=1,void(r.right=o(0,i));r.right=o(0,i);continue}i=n(i),r.right=i.left,i.left=r,i._color=r._color,r._color=0,a(r),a(i),l>1&&((u=t[l-2]).left===r?u.left=i:u.right=i),t[l-1]=i,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}else{if((i=r.left).left&&0===i.left._color){if(s=(i=r.left=n(i)).left=n(i.left),r.left=i.right,i.right=r,i.left=s,i._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(i),l>1)(u=t[l-2]).right===r?u.right=i:u.left=i;return void(t[l-1]=i)}if(i.right&&0===i.right._color){if(s=(i=r.left=n(i)).right=n(i.right),r.left=s.right,i.right=s.left,s.right=r,s.left=i,s._color=r._color,r._color=1,i._color=1,e._color=1,a(r),a(i),a(s),l>1)(u=t[l-2]).right===r?u.right=s:u.left=s;return void(t[l-1]=s)}if(1===i._color){if(0===r._color)return r._color=1,void(r.left=o(0,i));r.left=o(0,i);continue}var u;i=n(i),r.left=i.right,i.right=r,i._color=r._color,r._color=0,a(r),a(i),l>1&&((u=t[l-2]).right===r?u.right=i:u.left=i),t[l-1]=i,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}}}(e),p.left===r?p.left=null:p.right=null,new s(this.tree._compare,e[0])},Object.defineProperty(f,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(f,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(f,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var i=e.length-2;i>=0;--i)e[i+1]===e[i].right&&(++t,e[i].left&&(t+=e[i].left._count));return t},enumerable:!0}),f.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(f,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),f.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can't update empty node!");var r=new Array(e.length),n=e[e.length-1];r[r.length-1]=new i(n._color,n.key,t,n.left,n.right,n._count);for(var o=e.length-2;o>=0;--o)(n=e[o]).left===e[o+1]?r[o]=new i(n._color,n.key,n.value,r[o+1],n.right,n._count):r[o]=new i(n._color,n.key,n.value,n.left,r[o+1],n._count);return new s(this.tree._compare,r[0])},f.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(f,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=r}return t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.buffer=function(){return new Float32Array([this.x,this.y,this.z])},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var e=this.length,r=0,i=0,n=0;return e>0&&(r=this.x/e,i=this.y/e,n=this.z/e),new t(r,i,n)},t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.invert=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.rotate90=function(){return new t(this.y,-this.x,this.z)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y,e.z+this.z)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y,this.z-e.z):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y,e*this.z)},t.prototype.rotateBy=function(e){var r=Math.cos(e*Math.PI/180),i=Math.sin(e*Math.PI/180);return new t(this.x*r-this.y*i,this.x*i+this.y*r)},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y+t.z*this.z},t.perp=function(e,r){return new t(r[1]-e[1],e[0]-r[0])},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}();e.Vector3=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=r(21),s=function(t){function e(e){var r=t.call(this,e)||this;return r.id=null,r.map=null,r.zIndex=0,r.bringFrontBuilding=!1,r}return n(e,t),e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.map},e.prototype.getUserData=function(){return this.userData},e.prototype.getZIndex=function(){return this.zIndex},e.prototype.setUserData=function(t){this.userData=t},e.prototype.setZIndex=function(t){null!=t?t!=Number.MAX_SAFE_INTEGER&&t!=Number.MIN_SAFE_INTEGER?t!=this.zIndex&&(null!=this.map&&this.map.mapView.updateAnnotationZIndex(this.id,this.zIndex,t),this.zIndex=t):console.warn("zIndex value is not allowed!!!"):a.LogUtils.logNonNull("index")},e.prototype.getElevation=function(){return this.elevation},e.prototype.setElevation=function(t){null!=t?this.elevation!==t&&(this.elevation=t,null!=this.map&&this.map.mapView.updateAnnotation(this.id)):a.LogUtils.logNonNull("elevation")},e}(o.Map4dObject);e.Annotation=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(80);!function(t){t[t.Tile=0]="Tile",t[t.CustomModel=1]="CustomModel",t[t.CustomTexture=2]="CustomTexture",t[t.TileOverlay=3]="TileOverlay",t[t.POIOverlay=4]="POIOverlay",t[t.BuildingOverlay=5]="BuildingOverlay",t[t.Model=6]="Model",t[t.Texture=7]="Texture",t[t.RasterOverlay=8]="RasterOverlay",t[t.Json=9]="Json",t[t.MAX=10]="MAX"}(e.Resource||(e.Resource={}));var n=function(t){this.method="GET",this.params=null,this.id=i.UUID.generate(),this.type=t};e.RequestTask=n;var o=function(t){this.id=t,this.success=!1,this.data=null};e.ResponseTask=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n=r(26),o=r(27),a=r(137),s=r(138),l=r(2),u=r(46),h=r(3),c=r(1),p={" ":6,"!":6,'"':9,"#":15,$:13,"%":19,"&":17,"'":5,"(":7,")":7,"*":13,"+":13,",":5,"-":7,".":6,"/":8,0:13,1:13,2:13,3:13,4:13,5:13,6:13,7:13,8:13,9:13,":":6,";":6,"<":13,"=":13,">":13,"?":10,"@":21,A:15,B:15,C:17,D:17,E:15,F:14,G:18,H:17,I:6,J:13,K:16,L:12,M:21,N:18,O:18,P:16,Q:18,R:18,S:16,T:16,U:17,V:17,W:22,X:16,Y:16,Z:13,"[":7,"\\":8,"]":7,"^":13,_:10,"`":13,a:13,b:14,c:13,d:14,e:13,f:8,g:13,h:14,i:6,j:6,k:12,l:6,m:22,n:14,o:14,p:14,q:14,r:9,s:11,t:8,u:14,v:12,w:18,x:12,y:12,z:11,"{":9,"|":13,"}":9,"~":13," ":6,"¡":6,"¢":13,"£":13,"¤":13,"¥":13,"¦":13,"§":12,"¨":13,"©":19,"ª":8,"«":11,"¬":13,"­":7,"®":19,"¯":12,"°":10,"±":13,"²":8,"³":8,"´":13,"µ":14,"¶":15,"·":6,"¸":5,"¹":8,"º":9,"»":11,"¼":18,"½":18,"¾":18,"¿":10,"À":15,"Á":15,"Â":15,"Ã":15,"Ä":15,"Å":15,"Æ":20,"Ç":15,"È":13,"É":13,"Ê":16,"Ë":13,"Ì":6,"Í":6,"Î":6,"Ï":6,"Ð":17,"Ñ":18,"Ò":18,"Ó":18,"Ô":18,"Õ":18,"Ö":18,"×":13,"Ø":18,"Ù":17,"Ú":17,"Û":17,"Ü":17,"Ý":13,"Þ":14,"ß":14,"à":13,"á":13,"â":13,"ã":13,"ä":13,"å":13,"æ":20,"ç":11,"è":13,"é":13,"ê":13,"ë":13,"ì":6,"í":6,"î":6,"ï":6,"ð":14,"ñ":14,"ò":14,"ó":14,"ô":14,"õ":14,"ö":14,"÷":13,"ø":14,"ù":14,"ú":14,"û":14,"ü":14,"ý":12,"þ":14,"ÿ":12,"Ā":15,"ā":13,"Ă":15,"ă":13,"Ą":15,"ą":13,"Ć":15,"ć":11,"Ĉ":15,"ĉ":11,"Ċ":15,"ċ":11,"Č":15,"č":11,"Ď":17,"ď":14,"Đ":17,"đ":14,"Ē":13,"ē":13,"Ĕ":13,"ĕ":13,"Ė":13,"ė":13,"Ę":13,"ę":13,"Ě":13,"ě":13,"Ĝ":17,"ĝ":13,"Ğ":17,"ğ":13,"Ġ":17,"ġ":13,"Ģ":17,"ģ":13,"Ĥ":17,"ĥ":14,"Ħ":17,"ħ":14,"Ĩ":6,"ĩ":6,"Ī":6,"ī":6,"Ĭ":6,"ĭ":6,"Į":6,"į":6,"İ":6,"ı":6,"Ĳ":13,"ĳ":12,"Ĵ":6,"ĵ":6,"Ķ":14,"ķ":12,"ĸ":12,"Ĺ":12,"ĺ":6,"Ļ":12,"ļ":6,"Ľ":12,"ľ":6,"Ŀ":12,"ŀ":7,"Ł":12,"ł":6,"Ń":18,"ń":14,"Ņ":18,"ņ":14,"Ň":18,"ň":14,"ŉ":16,"Ŋ":18,"ŋ":14,"Ō":18,"ō":14,"Ŏ":18,"ŏ":14,"Ő":18,"ő":14,"Œ":22,"œ":22,"Ŕ":14,"ŕ":9,"Ŗ":14,"ŗ":9,"Ř":14,"ř":9,"Ś":13,"ś":11,"Ŝ":13,"ŝ":11,"Ş":13,"ş":11,"Š":13,"š":11,"Ţ":13,"ţ":8,"Ť":13,"ť":8,"Ŧ":13,"ŧ":8,"Ũ":17,"ũ":14,"Ū":17,"ū":14,"Ŭ":17,"ŭ":14,"Ů":17,"ů":14,"Ű":17,"ű":14,"Ų":17,"ų":14,"Ŵ":22,"ŵ":18,"Ŷ":13,"ŷ":12,"Ÿ":13,"Ź":13,"ź":11,"Ż":13,"ż":11,"Ž":13,"ž":11,"ſ":7,"ƒ":13,"Ơ":21,"ơ":14,"Ư":21,"ư":15,"ǰ":6,"Ǻ":15,"ǻ":13,"Ǽ":20,"ǽ":20,"Ǿ":18,"ǿ":14,"Ș":13,"ș":11,"Ț":13,"ț":8,"ȷ":6,"ʼ":4,"ˆ":14,"ˇ":14,"ˉ":14,"˘":14,"˙":6,"˚":13,"˛":4,"˜":14,"˝":13,"˳":8,"̀":0,"́":0,"̃":0,"̉":0,"̏":0,"̣":0,"΄":13,"΅":13,"Ά":15,"·":6,"Έ":14,"Ή":19,"Ί":8,"Ό":19,"Ύ":16,"Ώ":19,"ΐ":8,"Α":15,"Β":15,"Γ":12,"Δ":13,"Ε":13,"Ζ":13,"Η":17,"Θ":18,"Ι":6,"Κ":14,"Λ":14,"Μ":21,"Ν":18,"Ξ":13,"Ο":18,"Π":17,"Ρ":14,"Σ":13,"Τ":13,"Υ":13,"Φ":19,"Χ":13,"Ψ":19,"Ω":18,"Ϊ":6,"Ϋ":13,"ά":14,"έ":11,"ή":14,"ί":8,"ΰ":14,"α":14,"β":15,"γ":12,"δ":13,"ε":11,"ζ":11,"η":14,"θ":14,"ι":8,"κ":12,"λ":12,"μ":14,"ν":13,"ξ":11,"ο":14,"π":15,"ρ":14,"ς":11,"σ":14,"τ":11,"υ":14,"φ":17,"χ":13,"ψ":18,"ω":18,"ϊ":8,"ϋ":14,"ό":14,"ύ":14,"ώ":18,"ϑ":14,"ϒ":13,"ϖ":20,"Ѐ":13,"Ё":13,"Ђ":17,"Ѓ":12,"Є":15,"Ѕ":13,"І":6,"Ї":6,"Ј":6,"Љ":22,"Њ":22,"Ћ":17,"Ќ":14,"Ѝ":18,"Ў":14,"Џ":17,"А":15,"Б":14,"В":15,"Г":12,"Д":16,"Е":13,"Ж":20,"З":13,"И":18,"Й":18,"К":14,"Л":16,"М":21,"Н":17,"О":18,"П":17,"Р":14,"С":15,"Т":13,"У":14,"Ф":19,"Х":13,"Ц":17,"Ч":16,"Ш":24,"Щ":24,"Ъ":16,"Ы":20,"Ь":15,"Э":15,"Ю":25,"Я":15,"а":13,"б":14,"в":13,"г":10,"д":13,"е":13,"ж":17,"з":11,"и":15,"й":15,"к":12,"л":13,"м":17,"н":15,"о":14,"п":14,"р":14,"с":11,"т":11,"у":12,"ф":17,"х":12,"ц":15,"ч":14,"ш":21,"щ":21,"ъ":16,"ы":18,"ь":14,"э":11,"ю":19,"я":13,"ѐ":13,"ё":13,"ђ":14,"ѓ":10,"є":11,"ѕ":11,"і":6,"ї":6,"ј":6,"љ":20,"њ":21,"ћ":14,"ќ":12,"ѝ":15,"ў":12,"џ":14,"Ѡ":24,"ѡ":19,"Ѣ":16,"ѣ":15,"Ѥ":22,"ѥ":17,"Ѧ":16,"ѧ":13,"Ѩ":22,"ѩ":18,"Ѫ":17,"ѫ":15,"Ѭ":23,"ѭ":20,"Ѯ":13,"ѯ":11,"Ѱ":19,"ѱ":18,"Ѳ":18,"ѳ":14,"Ѵ":15,"ѵ":12,"Ѷ":15,"ѷ":12,"Ѹ":29,"ѹ":25,"Ѻ":19,"ѻ":15,"Ѽ":23,"ѽ":19,"Ѿ":23,"ѿ":19,"Ҁ":15,"ҁ":11,"҂":14,"҃":13,"҄":13,"҅":13,"҆":13,"҈":23,"҉":22,"Ҋ":18,"ҋ":15,"Ҍ":14,"ҍ":14,"Ҏ":14,"ҏ":14,"Ґ":12,"ґ":10,"Ғ":12,"ғ":10,"Ҕ":15,"ҕ":12,"Җ":21,"җ":18,"Ҙ":13,"ҙ":11,"Қ":15,"қ":13,"Ҝ":14,"ҝ":12,"Ҟ":14,"ҟ":12,"Ҡ":16,"ҡ":14,"Ң":17,"ң":15,"Ҥ":19,"ҥ":17,"Ҧ":25,"ҧ":20,"Ҩ":18,"ҩ":15,"Ҫ":15,"ҫ":11,"Ҭ":13,"ҭ":11,"Ү":13,"ү":12,"Ұ":13,"ұ":12,"Ҳ":14,"ҳ":13,"Ҵ":20,"ҵ":17,"Ҷ":16,"ҷ":14,"Ҹ":16,"ҹ":14,"Һ":16,"һ":14,"Ҽ":20,"ҽ":15,"Ҿ":20,"ҿ":15,"Ӏ":6,"Ӂ":20,"ӂ":17,"Ӄ":16,"ӄ":13,"Ӆ":16,"ӆ":13,"Ӈ":17,"ӈ":14,"Ӊ":17,"ӊ":15,"Ӌ":16,"ӌ":14,"Ӎ":21,"ӎ":17,"ӏ":6,"Ӑ":15,"ӑ":13,"Ӓ":15,"ӓ":13,"Ӕ":20,"ӕ":20,"Ӗ":13,"ӗ":13,"Ә":17,"ә":13,"Ӛ":17,"ӛ":13,"Ӝ":20,"ӝ":17,"Ӟ":13,"ӟ":11,"Ӡ":14,"ӡ":11,"Ӣ":18,"ӣ":15,"Ӥ":18,"ӥ":15,"Ӧ":18,"ӧ":14,"Ө":18,"ө":14,"Ӫ":18,"ӫ":14,"Ӭ":15,"ӭ":11,"Ӯ":14,"ӯ":12,"Ӱ":14,"ӱ":12,"Ӳ":14,"ӳ":12,"Ӵ":16,"ӵ":14,"Ӷ":12,"ӷ":10,"Ӹ":20,"ӹ":18,"Ӻ":12,"ӻ":10,"Ӽ":14,"ӽ":12,"Ӿ":13,"ӿ":12,"Ԁ":14,"ԁ":14,"Ԃ":21,"ԃ":21,"Ԅ":21,"ԅ":19,"Ԇ":15,"ԇ":12,"Ԉ":23,"ԉ":20,"Ԋ":24,"ԋ":21,"Ԍ":18,"ԍ":15,"Ԏ":17,"ԏ":15,"Ԑ":14,"ԑ":11,"Ԓ":16,"ԓ":13,"Ḁ":15,"ḁ":13,"Ḿ":21,"ḿ":22,"Ẁ":22,"ẁ":18,"Ẃ":22,"ẃ":18,"Ẅ":22,"ẅ":18,"Ạ":15,"ạ":13,"Ả":15,"ả":13,"Ấ":15,"ấ":13,"Ầ":15,"ầ":13,"Ẩ":15,"ẩ":13,"Ẫ":15,"ẫ":13,"Ậ":15,"ậ":13,"Ắ":15,"ắ":13,"Ằ":15,"ằ":13,"Ẳ":15,"ẳ":13,"Ẵ":15,"ẵ":13,"Ặ":15,"ặ":13,"Ẹ":13,"ẹ":13,"Ẻ":13,"ẻ":13,"Ẽ":13,"ẽ":13,"Ế":16,"ế":13,"Ề":16,"ề":13,"Ể":16,"ể":13,"Ễ":16,"ễ":13,"Ệ":16,"ệ":13,"Ỉ":6,"ỉ":6,"Ị":6,"ị":6,"Ọ":18,"ọ":14,"Ỏ":18,"ỏ":14,"Ố":18,"ố":14,"Ồ":18,"ồ":14,"Ổ":18,"ổ":14,"Ỗ":18,"ỗ":14,"Ộ":18,"ộ":14,"Ớ":21,"ớ":16,"Ờ":21,"ờ":16,"Ở":21,"ở":16,"Ỡ":21,"ỡ":16,"Ợ":21,"ợ":16,"Ụ":17,"ụ":14,"Ủ":17,"ủ":14,"Ứ":18,"ứ":15,"Ừ":21,"ừ":15,"Ử":21,"ử":15,"Ữ":21,"ữ":15,"Ự":21,"ự":15,"Ỳ":13,"ỳ":12,"Ỵ":13,"ỵ":12,"Ỷ":13,"ỷ":12,"Ỹ":13,"ỹ":12,"Ὅ":18," ":12," ":24," ":12," ":24," ":8," ":6," ":4," ":13," ":6," ":4," ":2,"​":0,"–":12,"—":24,"―":24,"‗":9,"‘":4,"’":4,"‚":5,"‛":4,"“":8,"”":8,"„":9,"†":12,"‡":12,"•":9,"…":18,"‰":28,"′":5,"″":9,"‹":7,"›":7,"‼":11,"⁄":3,"⁰":8,"⁴":8,"⁵":8,"⁶":8,"⁷":8,"⁸":8,"⁹":8,"ⁿ":9,"₣":13,"₤":13,"₧":18,"₫":14,"€":14,"℅":19,"ℓ":12,"№":24,"℠":19,"™":18,"Ω":18,"℮":14,"⅛":18,"⅜":18,"⅝":18,"⅞":18,"∂":13,"∆":13,"∏":17,"∑":15,"−":13,"√":13,"∞":16,"∫":9,"≈":13,"≠":13,"≤":13,"≥":13,"◊":14,"ﬀ":16,"ﬁ":14,"ﬂ":14,"ﬃ":22,"ﬄ":22,"\ufeff":0,"￼":24,"�":24};!function(t){t[t.center=0]="center",t[t.left=1]="left",t[t.right=2]="right",t[t.top=3]="top",t[t.bottom=4]="bottom"}(i=e.TextAlign||(e.TextAlign={}));var f=function(){function t(t){this.gl=t,this._font=new Map,this.init()}return t.getInstance=function(t){var e=t.id;null==this.instances&&(this.instances=new Map);var r=this.instances.get(e);return r||(r=new this(t),this.instances.set(e,r)),r},t.releaseInstance=function(t){var e=t.id;if(null!=this.instances){var r=this.instances.get(e);r&&(r._font.forEach((function(t){return t.destroy()})),r._font.clear(),this.instances.delete(e))}},t.prototype.init=function(){var t=new s.FontSDF(this.gl,l.FontConstant.fontSize,.18,"Arial",400);this._font.set("normal",t);var e=new s.FontSDF(this.gl,l.FontConstant.fontSize,.18,"Arial",600);this._font.set("bold",e)},t.prototype.createCurvedText=function(e,r,s,p,f,d){if(void 0===f&&(f=!1),void 0===d&&(d=i.center),null==p||p.length<2)return this.createText(e,r,s,200,1);var g=this._font.get(s);if(!g)return console.error("Can not find this Font to create text: "+r.text),null;var y=[];if(f)for(var m=p[p.length-1],v=p.length-1;v>=0;--v)y.push(new u(p[v].x-m.x,p[v].y-m.y));else{var _=p[0];p.forEach((function(t){y.push(new u(t.x-_.x,t.y-_.y))}))}p=y,y=[];var b=this.gl,w=[],x=r.text,M=r.size,T=t.measureTextLabelLength(r),A=0,L=9999,S=0;for(v=0;v<p.length-1;++v){if(S=p[v+1].angleTo(p[v]),L<9998&&Math.abs(L-S)>l.LabelConstant.maxCurvedTextAngle*l.MathConstants.deg2Rad)return null;L=S,A+=p[v].dist(p[v+1])}if(A<T)return null;var E,P,C=f?1:-1;switch(d){case i.center:P=.5,E=0;break;case i.left:P=0,E=0;break;case i.right:P=1,E=0;break;case i.top:P=.5,E=C*M;break;case i.bottom:P=.5,E=-C*M}var I=(A-T)*P,O=E,R={x:0-T/2,y:0},k=[],D=[],B=null;for(v=0;v<x.length;v++){var U=this.normalizeCharacter(x[v]);if(H=this.drawGlyph(U,R,g,M,0,null,!1)){var j=H.centerX;0!=v&&B||(B=j),D.push(H),k.push(j-B)}}var N=g.tinySDFGenerator.buffer*c.MapUtils.pixelScale,V=[];for(v=0;v<k.length;v++){for(var F=0,z=0,Z=0,G=p[0],W=p[0],Y=k[v]+I+2*N;F+z<=Y;){if(++Z>=p.length)return null;W=G,G=p[Z],F+=z,z=W.dist(G)}var H,X=(Y-F)/z,q=G.sub(W).mult(X)._add(W),J=Math.atan2(G.y-W.y,G.x-W.x);if(H=D[v]){var Q=H.width/2,K=H.height/2,$=new h.Vector2(0,O);$=$.rotateByRadian(J);var tt=new u(q.x+$.x,q.y+$.y),et=new u(tt.x-Q,tt.y-K),rt=new u(tt.x+Q,tt.y-K),it=new u(tt.x-Q,tt.y+K),nt=new u(tt.x+Q,tt.y+K),ot=(et.x-tt.x)*Math.cos(J)-(et.y-tt.y)*Math.sin(J)+tt.x,at=(et.x-tt.x)*Math.sin(J)+(et.y-tt.y)*Math.cos(J)+tt.y,st=(rt.x-tt.x)*Math.cos(J)-(rt.y-tt.y)*Math.sin(J)+tt.x,lt=(rt.x-tt.x)*Math.sin(J)+(rt.y-tt.y)*Math.cos(J)+tt.y,ut=(it.x-tt.x)*Math.cos(J)-(it.y-tt.y)*Math.sin(J)+tt.x,ht=(it.x-tt.x)*Math.sin(J)+(it.y-tt.y)*Math.cos(J)+tt.y,ct=(nt.x-tt.x)*Math.cos(J)-(nt.y-tt.y)*Math.sin(J)+tt.x,pt=(nt.x-tt.x)*Math.sin(J)+(nt.y-tt.y)*Math.cos(J)+tt.y;w.push(ot,at,H.textureX,H.textureY,st,lt,H.textureX+H.textureWidth,H.textureY,ut,ht,H.textureX,H.textureY+H.textureHeight,st,lt,H.textureX+H.textureWidth,H.textureY,ut,ht,H.textureX,H.textureY+H.textureHeight,ct,pt,H.textureX+H.textureWidth,H.textureY+H.textureHeight),et.x-=N,rt.x-=N,it.x-=N,nt.x-=N,ot=(et.x-tt.x)*Math.cos(J)-(et.y-tt.y)*Math.sin(J)+tt.x,at=(et.x-tt.x)*Math.sin(J)+(et.y-tt.y)*Math.cos(J)+tt.y,st=(rt.x-tt.x)*Math.cos(J)-(rt.y-tt.y)*Math.sin(J)+tt.x,lt=(rt.x-tt.x)*Math.sin(J)+(rt.y-tt.y)*Math.cos(J)+tt.y,ut=(it.x-tt.x)*Math.cos(J)-(it.y-tt.y)*Math.sin(J)+tt.x,ht=(it.x-tt.x)*Math.sin(J)+(it.y-tt.y)*Math.cos(J)+tt.y,ct=(nt.x-tt.x)*Math.cos(J)-(nt.y-tt.y)*Math.sin(J)+tt.x,pt=(nt.x-tt.x)*Math.sin(J)+(nt.y-tt.y)*Math.cos(J)+tt.y,V.push(new h.Vector2(ot,at)),V.push(new h.Vector2(st,lt)),V.push(new h.Vector2(ut,ht)),V.push(new h.Vector2(ct,pt))}}var ft=new n.Model(b),dt=b.createBuffer();return b.bindBuffer(b.ARRAY_BUFFER,dt),b.bufferData(b.ARRAY_BUFFER,new Float32Array(w),b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,null),ft.arrayBuffer=dt,ft.numOfVertices=w.length/4,ft.attributeInfos=[new o.AttributeInfo("a_position",2,0,4),new o.AttributeInfo("a_uv",2,2,4)],ft.retain(),new a.TextLabelData(this.gl,e,r.text,g,M,T,M,l.MapConstants.none,ft,V)},t.prototype.createText=function(e,r,i,s,l){var u=this._font.get(i);if(!u)return console.error("Can not find this Font to create text: "+r.text),null;var h=this.gl,c=[],p=r.text,f=r.size,d=t.measureTextLabelLength(r),g=!1,y=!0,m=Math.ceil(d/s),v=!1;!p.includes(" ")&&m>1&&(l=1,v=!0),(0==l||l>m)&&(l>0&&(1!=m&&(y=!1),g=!0),l=m);var _=s,b=s;1==l&&d<s&&(b=d,y&&(_=d),g=!0),v&&d>s&&(b=d);for(var w={x:0-_/2,y:f/2-f*l/2},x="",M=1,T=0;T<p.length;T++){var A=p[T];x+=A;var L=!1;if(" "==A){for(var S="",E=T+1;" "!=p[E]&&E<p.length;)S+=p[E],++E;var P=t.measureTextLength(x+S,f);if(M==l&&_<P&&_-P<3*t.measureTextLength(".",f)&&!g){this.drawGlyph(".",w,u,f,_,c,!1),this.drawGlyph(".",w,u,f,_,c,!1),this.drawGlyph(".",w,u,f,_,c,!1);break}P>_&&(x="",L=!0,++M)}this.drawGlyph(A,w,u,f,_,c,L)}var C=new n.Model(h),I=h.createBuffer();return h.bindBuffer(h.ARRAY_BUFFER,I),h.bufferData(h.ARRAY_BUFFER,new Float32Array(c),h.STATIC_DRAW),h.bindBuffer(h.ARRAY_BUFFER,null),C.arrayBuffer=I,C.numOfVertices=c.length/4,C.attributeInfos=[new o.AttributeInfo("a_position",2,0,4),new o.AttributeInfo("a_uv",2,2,4)],C.retain(),new a.TextLabelData(this.gl,e,r.text,u,f,b,M*f,_,C)},t.prototype.drawGlyph=function(t,e,r,i,n,o,a){var s=r.metrics[t];if(!s)return null;var l,u,h,c,f=r.fontSize,d=i/f,g=r.tinySDFGenerator.buffer,y=f+2*g,m=f+2*g,v=f/2+g,_=p[t],b=s.x,w=s.y,x=!1;return y>0&&m>0&&(l=e.x+(0-g)*d,u=e.x+(0-g+y)*d,h=e.y-v*d,c=e.y+(m-v)*d,o&&o.push(l,h,b,w,u,h,b+y,w,l,c,b,w+m,u,h,b+y,w,l,c,b,w+m,u,c,b+y,w+m),x=!0),e.x=e.x+_*d,a&&(e.y+=i,e.x=0-n/2),x?{centerX:(l+u)/2,centerY:(h+c)/2,width:u-l,height:c-h,textureX:b,textureY:w,textureWidth:y,textureHeight:m}:null},t.measureTextLabelLength=function(t){for(var e=0,r=t.size,i=t.text,n=r/l.FontConstant.fontSize,o=0;o<i.length;o++){var a=p[i[o]];a&&(e+=a*n)}return e},t.measureTextLength=function(t,e){for(var r=0,i=e/l.FontConstant.fontSize,n=0;n<t.length;n++){var o=p[t[n]];o&&(r+=o*i)}return r},t.prototype.normalizeCharacter=function(t){return 208==t.charCodeAt(0)&&(t=String.fromCodePoint(272)),t},t.instances=null,t}();e.TextLabelFactory=f},function(t,e,r){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TILE=0]="TILE",t[t.GROUND=1]="GROUND",t[t.BUILDING=2]="BUILDING",t[t.POI=3]="POI",t[t.IMAGE=4]="IMAGE"}(i=e.OverlayType||(e.OverlayType={}));var n=function(){function t(t){this.id=0,this.map=null,this.type=t,this.isValid=!0}return t.prototype.getType=function(){return this.type},t.prototype.getProperties=function(){return this.properties},t.prototype.setMap=function(t){this.map===t||!this.isValid||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeOverlay(this.id),this.id=0),this.map=t,null!=this.map&&(this.id=this.map.mapView.addOverlay(this)))},t.prototype.setVisible=function(t){this.properties.setVisible(t),null!=this.map&&this.map.mapView.requestRender()},t.prototype.isVisible=function(){return this.properties.isVisible()},t.prototype.setOpacity=function(t){this.properties.setOpacity(t)},t.prototype.getOpacity=function(){return this.properties.getOpacity()},t.prototype.setZIndex=function(t){this.type!=i.TILE&&this.type!=i.GROUND||(this.properties.setZIndex(t),null!=this.map&&(this.map.mapView.overlayManager.dirtyRasterOverlays(),this.map.mapView.requestRender()))},t}();e.Overlay=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return Object.defineProperty(t,"apiPrefix",{get:function(){return"https://api.map4d.vn/sdk"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isDebug",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isTileDebug",{get:function(){return this.isDebug&&!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isCollisionDebug",{get:function(){return this.isDebug&&!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"sdkVersion",{get:function(){return"2.4.6"},enumerable:!0,configurable:!0}),t}();e.Env=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.create=function(t,e,r){var i=window.document.createElement(t);return e&&(i.className=e),r&&r.appendChild(i),i},t.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)},t}();e.DOMUtils=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.cameraWillChange=0]="cameraWillChange",t[t.cameraChanging=1]="cameraChanging",t[t.idle=2]="idle",t[t.hover=3]="hover",t[t.click=4]="click",t[t.dblClick=5]="dblClick",t[t.drag=6]="drag",t[t.dragEnd=7]="dragEnd",t[t.dragStart=8]="dragStart",t[t.mouseMove=9]="mouseMove",t[t.mouseOut=10]="mouseOut",t[t.mouseOver=11]="mouseOver",t[t.rightClick=12]="rightClick",t[t.tilesLoaded=13]="tilesLoaded",t[t.modeChanged=14]="modeChanged",t[t.longClick=15]="longClick",t[t.boundsChanged=16]="boundsChanged",t[t.limitedZoom=17]="limitedZoom",t[t.tiltChanged=18]="tiltChanged",t[t.zoomChanged=19]="zoomChanged",t[t.bearingChanged=20]="bearingChanged",t[t.targetChanged=21]="targetChanged"}(e.MapEvent||(e.MapEvent={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(82),n=r(0),o=r(60),a=r(62),s=r(59),l=r(127),u=r(8),h=r(3),c=r(6),p=r(1),f=r(49),d=r(128),g=r(129),y=r(12),m=r(130),v=r(131),_=r(133),b=r(50),w=r(2),x=r(18),M=r(61),T=r(15),A=r(78),L=r(134),S=r(135),E=r(63),P=r(86),C=r(140),I=r(141),O=r(142),R=r(143),k=r(144),D=r(19),B=r(17),U=r(5),j=function(){function t(t,e){var r=this;this.idCounter=1,this._symbolVisibleIds=[],this.frontBuildingVisiableAnnotations=[],this.belowBuildingVisiableAnnotations=[],this.map=t,this.tileManager=e,this.circleTree=i(),this.symbolTree=i(),this.userPOITree=i(),this.userBuildingTree=i(),this.circleAnnotations=new Map,this.symbolAnnotations=new Map,this.shapeAnnotations=new Map,this.userPOIAnnotations=new Map,this.userBuildingAnnotations=new Map,this._iconViewMarkerManager=new _.IconViewMarkerManager(this.map),this.infoWindowManager=new v.InfoWindowManager(this.map,this.symbolAnnotations,this._iconViewMarkerManager),this.dirty=!1,this.updateBuildingBounds=!1;this.tilePyramid=new M.TilePyramid(this.map,0,(function(t){return r.createTile(t)}),(function(t){r.removeTile(t)})),this.lastZoom=this.map.mapState.getZoom(),this.visibleAnnotationIds=new Set}return t.prototype.setDirty=function(){this.dirty=!0},t.prototype.update=function(){var t=this,e=this.map.tileManager.getVisibleTiles();this._iconViewMarkerManager.update(),this.dirty&&(this._symbolVisibleIds=[],this._iconViewMarkerManager.getIconViewMarkers().forEach((function(e){e.isVisible()&&t._symbolVisibleIds.push(e.getId())})),e.forEach((function(e){var r=t.tilePyramid.getTile(e.tileCoordinate);if(null!=r){var i=t.getTileData(e.tileCoordinate);t.updateRenderTile(i,r),r.setTileData(i)}})),this.dirty=!1),this.infoWindowManager.render(this._symbolVisibleIds),this.map.mapState.isZoomIn()||this.map.mapState.isZoomOut()||(this.tilePyramid.update(e,this.map.mapState,this.lastZoom),this.createTileLayerRenderDatas(e),this.lastZoom=this.map.mapState.getZoom(),this.updateBuildingBounds&&(this.setDirty(),this.updateBuildingBounds=!1))},t.prototype.createTileLayerRenderDatas=function(t){var e=this,r=this.map.getMapStyle(B.MapType.roadmap);t.forEach((function(t){var i=e.tilePyramid.getTile(t.tileCoordinate);if(i){var o=i.getTileRenderData(),a=i.getTileData();if(a)for(var s=a.getLayerIds(),l=function(t){var i=s[t];if(o.hasLayerRenderData(i))return"continue";var l=a.getTileLayer(i);if(null==l)return console.warn("getLayerData not reachable"),"continue";var u=null;if(l.featureCount()>0){var h=l.getType();switch(h){case n.LayerType.LINE:u=new P.LineLayerRenderData(l,e.map.gl,(function(){var t=l.getFeature(0).getProperties();e.updateAnnotation(t.getId(),!0)})),o.setLayerRenderData(i,u);break;case n.LayerType.FILL:u=new C.FillLayerRenderData(l,e.map.gl),o.setLayerRenderData(i,u);break;case n.LayerType.CIRCLE:u=new I.CircleLayerRenderData(l,e.map.gl),o.setLayerRenderData(i,u);break;case n.LayerType.SYMBOL:u=new O.SymbolLayerRenderData(l,e.map.gl),o.setLayerRenderData(i,u);break;default:u=null}var c=l.getFeatures();if(h==n.LayerType.USERPOI)c.forEach((function(t){var i=t.getProperties(),n=i.getId();if(!o.hasLayerRenderData(n)){i.iconColor=i.getColor();var a=r.build("pois","points",w.MapConstants.defaultMaxNativeZoom,i.getType(),null);if(a?(i.setFontSize(a.size),i.textureName=a.texture,i.iconIndex=a.iconIndex):(i.setFontSize(w.MapConstants.placeFontSize*p.MapUtils.pixelScale),i.textureName="pois",i.iconIndex=0),u=new R.UserPOILayerRenderData){var s=[];s.push(t),u.init(s),u.upload(e.map.gl,e.map.mapState),o.setLayerRenderData(n,u)}}}));else if(h==n.LayerType.USERBUILDING)c.forEach((function(t){var r=t.getProperties(),i=r.getId();if(!o.hasLayerRenderData(i)&&e.map.mapState.is3dMode()&&(u=new k.UserBuildingLayerRenderData)){var n=u,a=[];a.push(t);var s=r.updateExtrudeModel;n.init(a),n.upload(e.map.gl,e.map.mapState,(function(){var t=n.getModel();if(t||s){if(r.setCoverPoints(t.points),s){var i=new D.LatLngBounds;r.getCoordinates().forEach((function(t){i.extend(t)})),r.updateBoundsFromLatLngBounds(i)}else r.updateBounds(new E.BoundingBox(t.minX,t.minY,t.maxX,t.maxY));r.onModelLoaded&&r.onModelLoaded(),r.onModelLoaded=null,e.setDirty()}})),o.setLayerRenderData(i,n)}}));else if(u){var f=l.getFeatures();u.init(f)}}},u=0;u<s.length;++u)l(u);i.setRenderable()}}))},t.prototype.reload=function(){this.clearAllLayerRenderTiles(),this.tilePyramid.clear()},t.prototype.clearAllLayerRenderTiles=function(){var t=this,e=this.map.getLayer(w.LayerConstants.userPOILayerId);e&&e.clearRenderTiles();var r=this.map.getLayer(w.LayerConstants.userBuildingLayerId);r&&r.clearRenderTiles(),this.shapeAnnotations.forEach((function(e){U.Map4dObject.isClassType(e,U.ClassType.POLYGON_DATA)?t.map.getLayer(e.getLayerId()).clearRenderTiles():t.map.getLayer(e.getLayerId()).clearRenderTiles()})),this.circleAnnotations.forEach((function(e){t.map.getLayer(e.getLayerId()).clearRenderTiles()})),this.symbolAnnotations.forEach((function(e){t.map.getLayer(e.getLayerId()).clearRenderTiles()}))},t.prototype.createTile=function(t){var e=new x.Tile(x.Kind.ANNOTATION,t,this.map.gl),r=this.getTileData(t);return this.updateRenderTile(r,e),e.setTileData(r),e},t.prototype.removeTile=function(e){var r=this,i=e.getTileData(),o=e.getTileCoordinate().toString(),a=this.map.getLayer(w.LayerConstants.userPOILayerId);a&&a.removeRenderTile(o);var s=this.map.getLayer(w.LayerConstants.userBuildingLayerId);(s&&s.removeRenderTile(o),null!=i)&&i.getLayerIds().forEach((function(e){var i=r.map.getLayer(e);if(null!=i){var a=i.getLayerType();if(a==n.LayerType.LINE)i.removeRenderTile(o);else if(a==n.LayerType.FILL){i.removeRenderTile(o)}else if(a==n.LayerType.CIRCLE){i.removeRenderTile(o)}else if(a==n.LayerType.SYMBOL){var s=i,l=r._symbolVisibleIds.findIndex((function(r){return t.pointLayerId+r==e}));-1!=l&&r._symbolVisibleIds.splice(l,1),s.removeRenderTile(o)}}}));e.destroy()},t.prototype.getTileData=function(t){var e=this;if(0==this.symbolAnnotations.size&&0==this.shapeAnnotations.size&&0==this.circleAnnotations.size&&0==this.userPOIAnnotations.size&&0==this.userBuildingAnnotations.size)return null;var r=new A.TileData;this.shapeAnnotations.forEach((function(i){i.updateTileData(t,r,e.map.mapState.getMaxNativeZoom())}));var i=u.GeometryUtils.tileCoordinateToLatLngBounds(t),n={minX:i.getSouthwest().lng,minY:i.getSouthwest().lat,maxX:i.getNortheast().lng,maxY:i.getNortheast().lat};return this.circleTree.search(n).forEach((function(e){e.updateTileData(t,r)})),this.symbolTree.search(n).forEach((function(i){i.symbolAnnotation.isVisible()&&(i.updateTileData(t,r),e._symbolVisibleIds.push(i.id))})),this.userPOITree.search(n).forEach((function(e){e.getUserPOIAnnotation().isVisible()&&e.updateTileData(t,r)})),this.userBuildingTree.search(n).forEach((function(i){if(i.getUserBuildingAnnotation().isVisible()){var n=i.getUserBuildingAnnotation().getProperties();n.hasBounds&&!i.boundsUpdated&&(e.userBuildingTree.remove(i),i.updateBounds(new E.BoundingBox(n.minX,n.minY,n.maxX,n.maxY)),e.userBuildingTree.insert(i),e.updateBuildingBounds=!0),i.updateTileData(t,r)}})),r},t.prototype.addAnnotation=function(t){this.setDirty();var e=this.idCounter++;return this.idCounter<0&&(this.idCounter=0),this.addAnnotationInternal(e,t),e},t.prototype.addAnnotationInternal=function(e,r){if(U.Map4dObject.isClassType(r,U.ClassType.MARKER)){var i=r;if(i.getIconView()){this._iconViewMarkerManager.add(e,i);var o=t.pointLayerId+e;this.map.createLayer(o,n.LayerType.SYMBOL,w.MapConstants.buildingLayerOrder+i.getZIndex())}else{var a=new m.SymbolAnnotationData(this.map.gl,e,i);this.symbolTree.insert(a),this.symbolAnnotations.set(e,a),a.createLayer(this.map)}}else if(U.Map4dObject.isClassType(r,U.ClassType.POLYLINE)){var s=new g.PolylineAnnotationData(e,r);s.createLayer(this.map),this.shapeAnnotations.set(e,s)}else if(U.Map4dObject.isClassType(r,U.ClassType.POLYGON)){var u=new d.PolygonAnnotationData(e,r);u.createLayer(this.map),this.shapeAnnotations.set(e,u)}else if(U.Map4dObject.isClassType(r,U.ClassType.CIRCLE)){var h=new l.CircleAnnotationData(e,r);h.createLayer(this.map),this.circleAnnotations.set(e,h),this.circleTree.insert(h)}else if(U.Map4dObject.isClassType(r,U.ClassType.POI)){var c=new L.UserPOIAnnotationData(e,r);this.userPOIAnnotations.set(e,c),this.userPOITree.insert(c)}else if(U.Map4dObject.isClassType(r,U.ClassType.BUILDING)){var p=new S.UserBuildingAnnotationData(e,r);this.userBuildingAnnotations.set(e,p),this.userBuildingTree.insert(p)}},t.prototype.hideInfoWindow=function(t){this.infoWindowManager.hideInfoWindow(t)},t.prototype.isInfoWindowShown=function(t){return this.infoWindowManager.isInfoWindowShown(t)},t.prototype.showInfoWindow=function(t){this.infoWindowManager.showInfoWindow(t)},t.prototype.updateInfoContents=function(t){this.infoWindowManager.updateInfoContents(t)},t.prototype.updateAnnotationZIndex=function(e,r,i){var n=this.symbolAnnotations.get(e);if(n){var o=t.pointLayerId+n.id,a=this.map.getLayer(o);if(!a)return void console.warn("Symbol layer should not be null");this.map.mapRenderer.removeLayer(o,r),a.setOrder(i),this.map.mapRenderer.addLayer(a)}else if(this.shapeAnnotations.has(e)){o=t.annotationLayerId+e.toString();var s=this.map.getLayer(o);if(!s)return void console.warn("Shape layer should not be null");this.map.mapRenderer.removeLayer(o,r),s.setOrder(i),this.map.mapRenderer.addLayer(s)}else if(this.circleAnnotations.has(e)){o=t.annotationLayerId+e.toString();var l=this.map.getLayer(o);if(!l)return void console.warn("Circle layer should not be null");this.map.mapRenderer.removeLayer(o,r),l.setOrder(i),this.map.mapRenderer.addLayer(l)}},t.prototype.updateAnnotation=function(e,r){var i=this.symbolAnnotations.get(e);if(this._iconViewMarkerManager.getIconViewMarkers().get(e)&&this._iconViewMarkerManager.updateIconView(e),i){if(r&&(this.symbolTree.remove(i),i.updateAnnotationData(),this.symbolTree.insert(i)),!i.symbolAnnotation.isVisible()||r){var n=i.getLayerId(),o=this.map.getLayer(n);if(o)o.renderTiles.forEach((function(t){t.tile.getTileRenderData().getLayerRenderDatas().delete(n)})),this.map.removeLayer(n,i.symbolAnnotation.getZIndex()),i.createLayer(this.map)}this.setDirty()}else if(this.shapeAnnotations.has(e)){var a=this.shapeAnnotations.get(e);if(r){var s=t.annotationLayerId+e.toString();a.reloadLayout(),this.tilePyramid.getTiles().forEach((function(t){var e=t.tile.getTileData(),r=t.tile.getTileRenderData();e&&e.removeTileLayer(s),r&&r.removeLayerRenderData(s)})),this.setDirty()}a.createLayer(this.map)}else if(this.circleAnnotations.has(e)){var l=this.circleAnnotations.get(e);l.createLayer(this.map),r&&(l.updateBounds(),this.circleTree.remove(l),this.circleTree.insert(l),this.setDirty())}else if(this.userPOIAnnotations.has(e)){var u=this.userPOIAnnotations.get(e);r&&(this.userPOITree.remove(u),u.updateBounds(),this.userPOITree.insert(u),this.tilePyramid.getTiles().forEach((function(t){var r=w.LayerConstants.userPOILayerId+e,i=t.tile.getTileData(),n=t.tile.getTileRenderData();i&&i.removeTileLayer(r),n&&n.removeLayerRenderData(r)})),this.setDirty())}else if(this.userBuildingAnnotations.has(e)){var h=this.userBuildingAnnotations.get(e);r&&(this.map.userBuildingLayer.renderTiles.forEach((function(t){t.tile.getTileRenderData().getLayerRenderDatas().delete(w.LayerConstants.userBuildingLayerId+e)})),this.userBuildingTree.remove(h),h.updateBounds(),h.boundsUpdated=!1,this.userBuildingTree.insert(h)),this.setDirty()}},t.prototype.removeAnnotation=function(e){this.setDirty();var r=this.symbolAnnotations.get(e),i=this._iconViewMarkerManager.getIconViewMarkers().get(e);if(r||i){var n=w.MapConstants.buildingLayerOrder;i?(n+=i.getZIndex(),this._iconViewMarkerManager.remove(e)):(n+=r.symbolAnnotation.getZIndex(),this.symbolTree.remove(r),this.symbolAnnotations.delete(e)),this.map.removeLayer(t.pointLayerId+e.toString(),n)}else if(this.shapeAnnotations.has(e)){var o=this.shapeAnnotations.get(e).getAnnotation().getZIndex();this.shapeAnnotations.delete(e),this.map.removeLayer(t.annotationLayerId+e.toString(),o)}else if(this.circleAnnotations.has(e)){var a=this.circleAnnotations.get(e).getAnnotation().getZIndex();this.circleTree.remove(this.circleAnnotations.get(e)),this.circleAnnotations.delete(e),this.map.removeLayer(t.annotationLayerId+e.toString(),a)}else if(this.userPOIAnnotations.has(e)){this.userPOITree.remove(this.userPOIAnnotations.get(e)),this.userPOIAnnotations.delete(e);var s=this.map.getLayer(w.LayerConstants.userPOILayerId);s&&s.clearRenderTiles()}else if(this.userBuildingAnnotations.has(e)){this.userBuildingTree.remove(this.userBuildingAnnotations.get(e)),this.userBuildingAnnotations.delete(e);var l=this.map.getLayer(w.LayerConstants.userBuildingLayerId);l&&l.clearRenderTiles()}},t.prototype.updateRenderTile=function(t,e){var r=this;if(null!=t&&t.getLayerIds().length>0){var i=e.getTileCoordinate(),o=i.toString();t.getLayerIds().forEach((function(t){var l=r.map.getLayer(t);if(null!=l){var u=l.getLayerType(),h=new a.RenderTile(s.UnwrappedTileCoordinate.createWithXYZoom(i.getX(),i.getY(),i.getZoom()),e);if(u==n.LayerType.LINE)l.addRenderTile(o,h);else if(u==n.LayerType.FILL){l.addRenderTile(o,h)}else if(u==n.LayerType.CIRCLE){l.addRenderTile(o,h)}else if(u==n.LayerType.SYMBOL){l.addRenderTile(o,h)}else if(u==n.LayerType.USERPOI){l.addRenderTile(o,h)}else if(u==n.LayerType.USERBUILDING){l.addRenderTile(o,h)}}}))}else e.setRenderable()},t.prototype.queryBuildingAndAnnotation=function(e){var r=this,i=this.map.mapState,n=u.GeometryUtils.screenCoordinateToLatLng(e,i.cameraPosition,i.getScreenSize()),a={frontBuildingAnnotations:this.frontBuildingVisiableAnnotations,belowBuildingAnnotations:this.belowBuildingVisiableAnnotations},s=null,l=null,f=null,d=new b.Box(new y.Point(e.x-p.MapUtils.touchBoxSize/2,e.y-p.MapUtils.touchBoxSize/2),new y.Point(e.x+p.MapUtils.touchBoxSize/2,e.y+p.MapUtils.touchBoxSize/2));if(n.valid()){var g=i.getZoom(),m=o.TileCoordinate.fromLatLng(n,Math.floor(g),i.is3dMode()),v=1,_=i.getMaxNativeZoom();g>_?(m=o.TileCoordinate.fromLatLng(n,i.getMaxNativeZoom(),i.is3dMode()),v=Math.pow(2,Math.round(g)-_)):v=Math.pow(2,g-Math.floor(g));var w=this.tilePyramid.getTile(m);if(w&&null!=(s=w.getTileData())&&0!=s.getLayerIds().length){var x=i.scale,M=m.getX(),T=m.getY(),A=u.GeometryUtils.screenCoordinateToLatLng(new h.Vector2(d.min.x,d.min.y),i.cameraPosition,i.getScreenSize()),L=u.GeometryUtils.screenCoordinateToLatLng(new h.Vector2(d.max.x,d.max.y),i.cameraPosition,i.getScreenSize());l=u.GeometryUtils.pixelCoordinateToVectorTileCoordinate(c.ProjectionMercator.projectScale(A,x),M,T,v),f=u.GeometryUtils.pixelCoordinateToVectorTileCoordinate(c.ProjectionMercator.projectScale(L,x),M,T,v)}}a.frontBuildingAnnotations.sort((function(e,r){var i=U.Map4dObject.isClassType(e,U.ClassType.MARKER)?t.pointLayerId+e.getId():t.annotationLayerId+e.getId(),n=U.Map4dObject.isClassType(r,U.ClassType.MARKER)?t.pointLayerId+r.getId():t.annotationLayerId+r.getId();if(e.getZIndex()==r.getZIndex()){if(i>n)return-1;if(n>i)return 1}else{if(e.getZIndex()>r.getZIndex())return-1;if(r.getZIndex()>e.getZIndex())return 1}return 0}));var S=this.checkCollisionAnnotations(d,l,f,n,a.frontBuildingAnnotations,s);if(S)return S;var E=this._iconViewMarkerManager.getIconViewMarkers(),P=[];if(E.forEach((function(t){t.isClickable()&&r.checkCollisionIconViewMarker(d,t)&&P.push(t)})),0!=P.length){if(P.length>1){for(var C=0,I=P[0].getZIndex(),O=1;O<P.length;++O)P[O].getZIndex()>I&&(I=P[O].getZIndex(),C=O);return P[C]}return P[0]}if(i.is3dMode()){var R=this.map.queryBuildingAndAnnotationInfo(d);if(U.Map4dObject.isClassType(R,U.ClassType.BUILDING_QUERY_RESULT))return R;if(null!=R){var k=R;if(this.shapeAnnotations.has(k))return this.shapeAnnotations.get(k).getAnnotation()}}return a.belowBuildingAnnotations.sort((function(e,r){var i=U.Map4dObject.isClassType(e,U.ClassType.MARKER)?t.pointLayerId+e.getId():t.annotationLayerId+e.getId(),n=U.Map4dObject.isClassType(r,U.ClassType.MARKER)?t.pointLayerId+r.getId():t.annotationLayerId+r.getId();if(e.getZIndex()==r.getZIndex()){if(i>n)return-1;if(n>i)return 1}else{if(e.getZIndex()>r.getZIndex())return-1;if(r.getZIndex()>e.getZIndex())return 1}return 0})),this.checkCollisionAnnotations(d,l,f,n,a.belowBuildingAnnotations,s)},t.prototype.queryAnnotations=function(t,e){var r=this,i=[],n=[];if(null==t)return{frontBuildingAnnotations:i,belowBuildingAnnotations:n};this.tileManager.getVisibleTiles().forEach((function(t){var e=t.getTileCoordinate(),o=u.GeometryUtils.tileCoordinateToLatLngBounds(e),a={minX:o.getSouthwest().lng,minY:o.getSouthwest().lat,maxX:o.getNortheast().lng,maxY:o.getNortheast().lat};r.symbolTree.search(a).forEach((function(t){var e=t.symbolAnnotation;e.isVisible()&&(e.getZIndex()>w.MapConstants.buildingLayerOrder?i.push(e):n.push(e))}))}));var a=this.map.mapState;if(e.valid()){var s=a.getMaxNativeZoom(),l=a.getZoom(),h=o.TileCoordinate.fromLatLng(e,l>s?s:Math.floor(l),a.is3dMode()),c=this.tilePyramid.getTile(h);if(c){var p=c.getTileData();if(null!=p&&0!=p.getLayerIds().length)for(var f=p.getLayerIds(),d=p.getLayerIds().length,g=0;g<d;++g){var y=f[g],m=p.getTileLayer(y);if(null!=m)for(var v=0;v<m.featureCount();++v){var _=m.getFeature(v);if(_){if(!U.Map4dObject.isClassType(_,U.ClassType.TILE_FEATURE)||_.getType()==T.GeometryType.Point)continue;var b=Number(_.id);if(this.shapeAnnotations.has(b)){var x=this.shapeAnnotations.get(b).getAnnotation();x&&x.getZIndex()>w.MapConstants.buildingLayerOrder?i.push(x):x&&n.push(x)}}}}var M=u.GeometryUtils.tileCoordinateToLatLngBounds(h),A={minX:M.getSouthwest().lng,minY:M.getSouthwest().lat,maxX:M.getNortheast().lng,maxY:M.getNortheast().lat},L=this.circleTree.search(A);for(g=0;g<L.length;++g){var S=L[g].getAnnotation();S.isVisible()&&(S.getZIndex()>w.MapConstants.buildingLayerOrder?i.push(S):n.push(S))}}}return{frontBuildingAnnotations:i.filter((function(t){return t.isClickable()})),belowBuildingAnnotations:n.filter((function(t){return t.isClickable()}))}},t.prototype.getBuilding=function(t){return this.userBuildingAnnotations.has(t)?this.userBuildingAnnotations.get(t).getUserBuildingAnnotation():null},t.prototype.getPOI=function(t){return this.userPOIAnnotations.has(t)?this.userPOIAnnotations.get(t).getUserPOIAnnotation():null},t.prototype.clearShapeIndexer=function(){this.shapeAnnotations.forEach((function(t){t.clearIndex()}))},t.prototype.checkCollisionAnnotations=function(e,r,i,n,o,a){for(var s=p.MapUtils.getTileSize(),l=this.map.mapState,d=0;d<o.length;++d){if(U.Map4dObject.isClassType(o[d],U.ClassType.MARKER)){var g=o[d];if(null==g.getId())continue;var m=this.symbolAnnotations.get(g.getId());if(null==m)continue;var v=m.symbolAnnotation.getProperties();if(f.CollisionUtils.boxIntersectsSymbol(e,g.getPosition(),g.getElevation(),v.getWidth(),v.getHeight(),g.getAnchor(),l))return o[d]}if(n.valid())if(U.Map4dObject.isClassType(o[d],U.ClassType.POLYLINE)){if(null==r||null==i||null==a)continue;var _=[new y.Point(r.x,i.y),new y.Point(i.x,i.y),new y.Point(i.x,r.y),new y.Point(r.x,r.y)],b=t.annotationLayerId+o[d].getId();if(null==(A=a.getTileLayer(b)))continue;for(var w=function(t){var e=A.getFeature(t).getGeometries().geometryCoordinates;if(null==x.map.getLayer(b))return"continue";var r=o[d].getStrokeWidth()/2;l.getZoom()>l.getMaxNativeZoom()&&(r/=Math.pow(2,Math.round(l.getZoom())-l.getMaxNativeZoom()));var i=[];return e.forEach((function(t){var e=[];t.forEach((function(t){return e.push(new y.Point(t[0],t[1]))})),i.push(e)})),f.CollisionUtils.polygonIntersectsBufferedMultiLine(_,i,r/s)?{value:o[d]}:void 0},x=this,M=0;M<A.featureCount();++M){var T=w(M);if("object"==typeof T)return T.value}}else if(U.Map4dObject.isClassType(o[d],U.ClassType.POLYGON)){if(null==r||null==i||null==a)continue;var A;_=[new y.Point(r.x,i.y),new y.Point(i.x,i.y),new y.Point(i.x,r.y),new y.Point(r.x,r.y)],b=t.annotationLayerId+o[d].getId();if(null==(A=a.getTileLayer(b)))continue;for(M=0;M<A.featureCount();++M){for(var L=A.getFeature(M).getGeometries().geometryCoordinates,S=!1,E=function(t){var e=L[t],r=[];if(e.forEach((function(t){return r.push(new y.Point(t[0],t[1]))})),0==t){if(!(S=f.CollisionUtils.polygonIntersectsPolygon(_,r)))return"break"}else if(f.CollisionUtils.polygonIntersectsPolygon(_,r)&&!f.CollisionUtils.polygonIntersectsBufferedMultiLine(_,[r],0))return S=!1,"break"},P=0;P<L.length;++P){if("break"===E(P))break}if(S)return o[d]}}else if(U.Map4dObject.isClassType(o[d],U.ClassType.CIRCLE)){var C=o[d],I=C.getCenter(),O=C.getRadius(),R=l.getScale(),k=O/c.ProjectionMercator.getMetersPerPixelAtLatitude(l.getCamera().getTarget().lat,l.getZoom()),D=c.ProjectionMercator.projectScale(I,R),B=u.GeometryUtils.screenCoordinateToLatLng(new h.Vector2(e.min.x,e.min.y),l.cameraPosition,l.getScreenSize()),j=u.GeometryUtils.screenCoordinateToLatLng(new h.Vector2(e.max.x,e.max.y),l.cameraPosition,l.getScreenSize()),N=c.ProjectionMercator.projectScale(B,R),V=c.ProjectionMercator.projectScale(j,R);if(f.CollisionUtils.boxIntersectsCircle(N,V,new y.Point(D.x,D.y),k))return o[d]}}return null},t.prototype.checkCollisionIconViewMarker=function(t,e){var r=this.map.latLngToScreenCoordinate(e.getPosition(),e.getElevation()),i=this._iconViewMarkerManager.getIconViewsHTML().get(e.getId());if(null==i)return!1;var n=document.getElementById(""+i.id),o=n.clientWidth*p.MapUtils.pixelScale,a=n.clientHeight*p.MapUtils.pixelScale;o=o%2?o+1:o,a=a%2?a+1:a;var s=r.x-e.getAnchor().x*o,l=r.y-e.getAnchor().y*a,u=new b.Box(new y.Point(s,l),new y.Point(s+o,l+a));return f.CollisionUtils.boxIntersectsBox(t,u)},t.prototype.clearVisibleAnnotations=function(){this.visibleAnnotationIds.clear(),this.frontBuildingVisiableAnnotations=[],this.belowBuildingVisiableAnnotations=[]},t.prototype.addVisibleAnnotation=function(t){if(!this.visibleAnnotationIds.has(t)){this.visibleAnnotationIds.add(t);var e=null;this.symbolAnnotations.has(t)?e=this.symbolAnnotations.get(t).symbolAnnotation:this._iconViewMarkerManager.getIconViewMarkers().has(t)?e=this._iconViewMarkerManager.getIconViewMarkers().get(t):this.circleAnnotations.has(t)?e=this.circleAnnotations.get(t).getAnnotation():this.shapeAnnotations.has(t)&&(e=this.shapeAnnotations.get(t).getAnnotation()),e&&e.isClickable()&&(e.getZIndex()>w.MapConstants.buildingLayerOrder?this.frontBuildingVisiableAnnotations.push(e):this.belowBuildingVisiableAnnotations.push(e))}},t.annotationLayerId="1.maplink.annotation.layer.",t.pointLayerId="3.maplink.annotation.points.",t}();e.AnnotationManager=j},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n,o,a,s=r(3),l=[[1,0],[0,1]],u=[],h=[],c=function(){function t(t,e,r,i,n){this.dimension=[i/2,n/2],this.angle=r,this.centroid=[t,e],this.quad=null,this.axis0=null,this.axis1=null,this.update()}return t.prototype.update=function(){var t=this.centroid,e=this.dimension[0],r=this.dimension[1];if(0===this.angle)this.quad=[t[0]-e,t[1]-r,t[0]+e,t[1]-r,t[0]+e,t[1]+r,t[0]-e,t[1]+r],this.axis0=new s.Vector2(l[0][0],l[0][1]),this.axis1=new s.Vector2(l[1][0],l[1][1]);else{var i=Math.cos(this.angle)*e,n=Math.sin(this.angle)*e,o=-Math.sin(this.angle)*r,a=Math.cos(this.angle)*r;this.quad=[t[0]-i-o,t[1]-n-a,t[0]+i-o,t[1]+n-a,t[0]+i+o,t[1]+n+a,t[0]-i+o,t[1]-n+a],this.updateAxes()}},t.prototype.updateAxes=function(){var t=new s.Vector2(this.quad[4]-this.quad[6],this.quad[5]-this.quad[7]);this.axis0=t.normalize();var e=new s.Vector2(this.quad[4]-this.quad[2],this.quad[5]-this.quad[3]);this.axis1=e.normalize()},t.prototype.getQuad=function(){return this.quad},t.prototype.getExtent=function(){return 0===this.angle?new p(this.quad[0],this.quad[1],this.quad[4],this.quad[5]):new p(Math.min(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.min(this.quad[1],this.quad[3],this.quad[5],this.quad[7]),Math.max(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.max(this.quad[1],this.quad[3],this.quad[5],this.quad[7]))},t.projectToAxis=function(t,e,r){var s=t.quad;i=s[0]*e.x+s[1]*e.y,n=s[2]*e.x+s[3]*e.y,o=s[4]*e.x+s[5]*e.y,a=s[6]*e.x+s[7]*e.y,r[0]=Math.min(i,n,o,a),r[1]=Math.max(i,n,o,a)},t.axisCollide=function(e,r,i,n){return t.projectToAxis(e,i,u),t.projectToAxis(r,i,h),!(h[0]>u[1]||h[1]<u[0])&&(t.projectToAxis(e,n,u),t.projectToAxis(r,n,h),!(h[0]>u[1]||h[1]<u[0]))},t.intersect=function(e,r){return t.axisCollide(e,r,e.axis0,e.axis1)&&t.axisCollide(e,r,r.axis0,r.axis1)},t}();e.OBB=c;var p=function(){function t(t,e,r,i){this.min=new s.Vector2(t,e),this.max=new s.Vector2(r,i)}return t.prototype.intersect=function(t){return t.max.x>=this.min.x&&t.max.y>=this.min.y&&t.min.x<=this.max.x&&t.min.y<=this.max.y},t.prototype.getMin=function(){return this.min},t.prototype.getMax=function(){return this.max},t.prototype.getCentroid=function(){return new s.Vector2((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)},t}();e.AABB=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a,s,l=r(4),u=r(31),h=r(1),c=r(136),p=r(28),f=r(5),d=r(21);!function(t){t.Solid="solid",t.Dotted="dotted"}(o=e.PolylineStyle||(e.PolylineStyle={})),function(t){t[t.Butt=0]="Butt",t[t.Square=1]="Square",t[t.Round=2]="Round"}(a=e.LineCapType||(e.LineCapType={})),function(t){t[t.Miter=0]="Miter",t[t.Bevel=1]="Bevel",t[t.Round=2]="Round"}(s=e.LineJoinType||(e.LineJoinType={}));var g=function(t){function e(r){var i=t.call(this,f.ClassType.POLYLINE)||this,n={};h.MapUtils.extendOptions(n,e.defaultPolylineOptions,r);for(var a=0,s=n;a<s.length;a++){if(null==s[a])throw Error("Parameters can not be null")}if((!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(d.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled),i.path=n.path.map((function(t){return l.LatLng.convert(t)})),i.elevation=n.elevation,i.zIndex=n.zIndex,i.properties=new c.LineLayerProperties(n.strokeWidth,n.strokeColor,n.strokeOpacity,n.elevation,n.closed,n.visible,n.draggable,n.style,n.strokePattern,n.clickable,n.lineCapType,n.lineJoinType),n.style!=o.Dotted&&n.style!=o.Solid&&(console.warn("Wrong style options for Polyline. Only use 'dotted' or 'solid'."),n.style=o.Solid),!n.strokePattern){if(n.style==o.Dotted){var u=n.strokeWidth;n.strokePattern=new p.DashPattern({length:u,gap:u})}else n.strokePattern=new p.SolidPattern;i.properties.setStrokePattern(n.strokePattern)}return i}return n(e,t),e.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.id=-1),this.map=t,null!=this.map&&(this.id=this.map.mapView.addAnnotation(this)),this.properties.setId(this.id))},e.prototype.setClosed=function(t){null!=t?this.properties.isClosed()!=t&&(this.properties.setClosed(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):d.LogUtils.logNonNull("closed")},e.prototype.setPath=function(t){null==t||t.length<2?console.warn("Parameter path size must be greater than 1"):(this.path=t.map((function(t){return l.LatLng.convert(t)})),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0))},e.prototype.setStrokeWidth=function(t){null!=t?this.properties.getStrokeWidth()!=t&&(this.properties.setStrokeWidth(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):d.LogUtils.logNonNull("strokeWidth")},e.prototype.setStrokeColor=function(t){null!=t?this.properties.getStrokeColor().code!=t&&(this.properties.setStrokeColor(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):d.LogUtils.logNonNull("strokeColor")},e.prototype.setStrokeOpacity=function(t){null!=t?this.properties.getStrokeOpacity()!=t&&(this.properties.setStrokeOpacity(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):d.LogUtils.logNonNull("strokeOpacity")},e.prototype.setVisible=function(t){null!=t?this.properties.isVisible()!=t&&(this.properties.setVisible(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):d.LogUtils.logNonNull("visible")},e.prototype.setDraggable=function(t){null!=t?this.properties.isDraggable()!=t&&this.properties.setDraggable(t):d.LogUtils.logNonNull("draggable")},e.prototype.setStyle=function(t){if(null!=t){if(t!=o.Dotted&&t!=o.Solid&&(console.warn("Wrong style options for Polyline. Only use 'dotted' or 'solid'."),t=o.Solid),this.properties.getStyle()!=t){if(this.properties.setStyle(t),t==o.Dotted){var e=this.properties.getStrokeWidth();this.properties.setStrokePattern(new p.DashPattern({length:e,gap:e}))}else this.properties.setStrokePattern(new p.SolidPattern);null!=this.map&&this.map.mapView.updateAnnotation(this.id)}}else d.LogUtils.logNonNull("style")},e.prototype.setStrokePattern=function(t){null!=t?(this.properties.setStrokePattern(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):d.LogUtils.logNonNull("style")},e.prototype.getPath=function(){return(this.path||[]).slice()},e.prototype.getStrokeWidth=function(){return this.properties.getStrokeWidth()},e.prototype.getStrokeColor=function(){return this.properties.getStrokeColor().code},e.prototype.getStrokeOpacity=function(){return this.properties.getStrokeOpacity()},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.isClosed=function(){return this.properties.isClosed()},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.getStyle=function(){return this.properties.getStyle()},e.prototype.getStrokePattern=function(){return this.properties.getStrokePattern()},e.prototype.getProperties=function(){return this.properties},e.prototype.isUserInteractionEnabled=function(){return d.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){d.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){this.properties.setClickable(t)},e.defaultPolylineOptions={strokeWidth:0,strokeColor:"#0000ff",strokeOpacity:1,visible:!0,closed:!1,draggable:!1,zIndex:0,elevation:0,style:"solid",strokePattern:null,userInteractionEnabled:!0,lineCapType:a.Butt,lineJoinType:s.Round,clickable:!0},e}(u.Annotation);e.Polyline=g},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(64),a=r(11),s=function(t,e){this.min=t,this.mag=e};e.TextureFiltering=s;var l=function(t,e){this.wraps=t,this.wrapt=e};e.TextureWrapping=l;var u=function(t,e,r,i,n,o){this.target=t,this.internalFormat=e,this.format=r,this.type=i,this.filtering=n,this.wrapping=o};e.TextureOptions=u;var h=function(t){function e(e,r){void 0===r&&(r=null);var i=t.call(this)||this;return i.gl=e,i.options=r,null==r&&i.initDefaultTextureOptions(),i.isLoaded=!1,i.init(),i}return n(e,t),e.prototype.initDefaultTextureOptions=function(){var t=this.gl,e=new s(t.LINEAR_MIPMAP_LINEAR,t.LINEAR),r=new l(t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE);this.options=new u(t.TEXTURE_2D,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e,r)},e.prototype.init=function(){var t=this.gl;this.textureId=t.createTexture(),this.loadColor(a.Color.fromHex("FFFFFF"))},e.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.textureId)},e.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)},e.prototype.loadColor=function(t){var e=this.gl;if(this.width=1,this.height=1,null!=this.textureId){e.bindTexture(e.TEXTURE_2D,this.textureId);var r=new Uint8Array([255*t.red,255*t.green,255*t.blue,255*t.alpha]);e.texImage2D(this.options.target,0,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,r),e.texParameteri(this.options.target,e.TEXTURE_WRAP_S,this.options.wrapping.wraps),e.texParameteri(this.options.target,e.TEXTURE_WRAP_T,this.options.wrapping.wrapt),this.applyFilter(),e.bindTexture(e.TEXTURE_2D,null)}},e.prototype.loadImageFromArrayBuffer=function(t,e,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);var o=this.gl;if(this.width=e,this.height=r,null!=this.textureId){o.bindTexture(o.TEXTURE_2D,this.textureId);var a=new ImageData(new Uint8ClampedArray(t),e,r);o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i?1:0),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a),this.applyFilter(),o.bindTexture(o.TEXTURE_2D,null),this.isLoaded=!0,n&&n()}},e.prototype.loadImage=function(t,e,r){var i=this;if(void 0===e&&(e=null),void 0===r&&(r=!0),null==t)return console.warn("loadImageFromUrl: URL is null"),void(e&&e());var n=this.gl,o=new Image;o.crossOrigin="anonymous",o.src=t,o.onload=function(){i.width=o.width,i.height=o.height,null!=i.textureId&&(n.bindTexture(n.TEXTURE_2D,i.textureId),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r?1:0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,o),i.applyFilter(),n.bindTexture(n.TEXTURE_2D,null),i.isLoaded=!0),e&&e()}},e.prototype.loadImageDataArray=function(t,e,r,i,n){void 0===n&&(n=null);var o=this.gl;this.width=e,this.height=r,null!=this.textureId&&(o.bindTexture(o.TEXTURE_2D,this.textureId),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,e,r,0,o.RGBA,o.UNSIGNED_BYTE,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,i),o.bindTexture(o.TEXTURE_2D,null),this.isLoaded=!0),n&&n()},e.prototype.destroy=function(){this.textureId&&(this.gl.deleteTexture(this.textureId),this.textureId=null)},e.prototype.applyFilter=function(t){void 0===t&&(t=!0);var e=this.gl;if(e.texParameteri(this.options.target,e.TEXTURE_MAG_FILTER,this.options.filtering.mag),this.isPowerOf2(this.width)&&this.isPowerOf2(this.height)&&t)e.texParameteri(this.options.target,e.TEXTURE_MIN_FILTER,this.options.filtering.min),e.generateMipmap(this.options.target);else{var r=this.options.filtering.min;r==e.LINEAR_MIPMAP_LINEAR||r==e.LINEAR_MIPMAP_NEAREST?r=e.LINEAR:r!=e.NEAREST_MIPMAP_LINEAR&&r!=e.NEAREST_MIPMAP_NEAREST||(r=e.NEAREST),e.texParameteri(this.options.target,e.TEXTURE_MIN_FILTER,r)}},e.prototype.initFrameBufferTexture=function(t,e){var r=this.gl;this.width=t,this.height=e,this.textureId=r.createTexture(),r.bindTexture(this.options.target,this.textureId),r.texImage2D(this.options.target,0,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,null),r.texParameteri(this.options.target,r.TEXTURE_WRAP_S,this.options.wrapping.wraps),r.texParameteri(this.options.target,r.TEXTURE_WRAP_T,this.options.wrapping.wrapt),this.applyFilter(!1),r.bindTexture(r.TEXTURE_2D,null),this.isLoaded=!0},e.prototype.isPowerOf2=function(t){return 0==(t&t-1)},e}(o.ResourceReference);e.Texture=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(4),s=r(11),l=r(95),u=r(33);!function(t){t[t.PLACE=0]="PLACE",t[t.ROAD=1]="ROAD",t[t.BOUNDARY=2]="BOUNDARY"}(o=e.LabelType||(e.LabelType={}));var h=function(t){function e(e,r,i,n,l){void 0===l&&(l=u.TextAlign.center);var h=t.call(this,"",e,i,n)||this;h.id="label|"+h.osmId,h.type=r,h.fontSize=i.size,h.haloColor="string"==typeof i.haloColor?s.Color.fromHex(i.haloColor):i.haloColor,h.reverse=!1,h._align=l,h.position=[];var c=i.coordinates||[];if(r==o.PLACE)2==c.length&&h.position.push(new a.LatLng(c[1],c[0]));else if(c.length>=2){var p=c[0]||[],f=c[c.length-1]||[];2==p.length&&2==f.length&&(h.position.push(new a.LatLng(p[1],p[0])),h.position.push(new a.LatLng(f[1],f[0])))}return h}return n(e,t),e.prototype.setReverse=function(t){this.reverse=t},e.prototype.getLabelType=function(){return this.type},e.prototype.getFontSize=function(){return this.fontSize},e.prototype.hasHalo=function(){return null!=this.haloColor},e.prototype.getHaloColor=function(){return this.haloColor},e.prototype.isReverse=function(){return this.reverse},e.prototype.getZoom=function(){return this.zoom},e.prototype.setZoom=function(t){this.zoom=t},e.prototype.getPosition=function(){return this.position},e.prototype.setVisible=function(t){this.visible=t},Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t},enumerable:!0,configurable:!0}),e}(l.VectorLayerProperties);e.LabelLayerProperties=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.USERPOI=0]="USERPOI",t[t.USERPOITEXT=1]="USERPOITEXT",t[t.PLACE_LABEL=2]="PLACE_LABEL",t[t.POI=3]="POI",t[t.POITEXT=4]="POITEXT",t[t.VECTOR_LABEL=5]="VECTOR_LABEL",t[t.BOUNDARY_LABEL=6]="BOUNDARY_LABEL",t[t.QUERYBOX=7]="QUERYBOX"}(e.CollisionType||(e.CollisionType={}));var i=function(){function t(t,e,r,i){this.rank=0,this.hash=0,this.obb=t,this.renderData=i,this.type=e,this.direction=r}return t.prototype.setVisible=function(t){},t.prototype.isVisible=function(){return!1},t.prototype.getId=function(){return this.hash},t.prototype.getRank=function(){return this.rank},t.prototype.getZoom=function(){return this.zoom},t}();e.CollisionItem=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(16),n=r(13),o=function(){function t(t,e,r){this.visible=t,this.zIndex=null!=e?e:0,this.opacity=null!=r?n.MathUtils.clamp(r,0,1):1}return t.prototype.setLayerId=function(t){this.layerId=t},t.prototype.getLayerId=function(){return this.layerId},t.prototype.setVisible=function(t){this.visible=t},t.prototype.isVisible=function(){return this.visible},t.prototype.setZIndex=function(t){this.zIndex=t},t.prototype.getZIndex=function(){return this.zIndex},t.prototype.setOpacity=function(t){this.opacity=n.MathUtils.clamp(t,0,1)},t.prototype.getOpacity=function(){return this.opacity},t.prototype.getOrder=function(){return this.order||(this.order=new i.Order(this.layerId,this.zIndex)),this.order},t}();e.OverlayProperties=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),n=r(17),o=r(105),a=r(57),s=function(){function t(){this.mapType=n.MapType.roadmap,this.language=a.MapLanguage.vi,this.vectorFormat=o.VectorFormat.mvt,this.minZoom=i.MapConstants.defaultMinZoom,this.maxZoom=i.MapConstants.defaultMaxZoom,this.maxNativeZoom=i.MapConstants.defaultMaxNativeZoom,this._3dMode=!1,this._objectsEnabled=!0,this._placesEnabled=!0,this._filterPOITypes=[],this._dataLayerMinZoom=i.MapConstants.defaultMinZoom,this._dataLayerMaxZoom=i.MapConstants.defaultMaxZoom}return Object.defineProperty(t,"getSignature",{get:function(){return this.signature},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getResourseBaseUrl",{get:function(){return this.resourseBaseUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getRoadmapStyle",{get:function(){return this.roadmapStyle},enumerable:!0,configurable:!0}),t.prototype.setMapType=function(t){this.mapType=t},t.prototype.getMapType=function(){return this.mapType},t.prototype.getZoomStep=function(){return i.MapConstants.zoomStep},t.prototype.getVectorFormat=function(){return this.vectorFormat},t.prototype.setMapLanguage=function(t){this.language=t},t.prototype.getMapLanguage=function(){return this.language},t.prototype.setMinZoom=function(t){this.minZoom=t,this.minZoom>this.maxZoom&&(this.minZoom+=this.maxZoom,this.maxZoom=this.minZoom-this.maxZoom,this.minZoom-=this.maxZoom)},t.prototype.setMaxZoom=function(t){this.maxZoom=t,this.minZoom>this.maxZoom&&(this.minZoom+=this.maxZoom,this.maxZoom=this.minZoom-this.maxZoom,this.minZoom-=this.maxZoom)},t.prototype.getMapUrl=function(){if(this.is3dMode())return i.ServerConstants.baseMapUrl+"?mode=3d&type=raster&key="+t.accessKey;var e=i.ServerConstants.baseMapUrl+"?mode=2d&type="+this.mapType+"&key="+t.accessKey;return this.mapType==n.MapType.roadmap||this.mapType==n.MapType.satellite?e+"&format="+this.vectorFormat:e},t.prototype.getPreferMaxTilt=function(){return this.is3dMode()?i.MapConstants.maxTilt3D:i.MapConstants.maxTilt2D},t.prototype.getPreferMinZoom=function(){var t=this.minZoom,e=this.is3dMode()?i.MapConstants.defaultMinZoom3d:i.MapConstants.defaultMinZoom;return t=t>e?t:e},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinTilt=function(){return i.MapConstants.minTilt},t.prototype.getMaxTilt=function(){return this._3dMode?i.MapConstants.maxTilt3D:i.MapConstants.maxTilt2D},t.prototype.getMaxNativeZoom=function(){return this.maxNativeZoom},t.prototype.setDate=function(t){this.date=t},t.prototype.getDate=function(){return this.date||new Date},t.prototype.setMaxNativeZoom=function(t){this.maxNativeZoom=t},t.getAccessKey=function(){return this.accessKey},t.prototype.enable3dMode=function(t){return t!=this._3dMode&&(this._3dMode=t,!0)},t.prototype.is3dMode=function(){return this._3dMode},t.prototype.setRestrictionBounds=function(t){this.restrictionBounds=t},t.prototype.getRestrictionBounds=function(){return this.restrictionBounds},Object.defineProperty(t.prototype,"objectsEnabled",{get:function(){return this._objectsEnabled},set:function(t){this._objectsEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placesEnabled",{get:function(){return this._placesEnabled},set:function(t){this._placesEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterPOITypes",{get:function(){return this._filterPOITypes},set:function(t){this._filterPOITypes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLayerMinZoom",{get:function(){return this._dataLayerMinZoom},set:function(t){this._dataLayerMinZoom=t,this._dataLayerMinZoom>this._dataLayerMaxZoom&&(this._dataLayerMinZoom+=this._dataLayerMaxZoom,this._dataLayerMaxZoom=this._dataLayerMinZoom-this._dataLayerMaxZoom,this._dataLayerMinZoom-=this._dataLayerMaxZoom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLayerMaxZoom",{get:function(){return this._dataLayerMaxZoom},set:function(t){this._dataLayerMaxZoom=t,this._dataLayerMinZoom>this._dataLayerMaxZoom&&(this._dataLayerMinZoom+=this._dataLayerMaxZoom,this._dataLayerMaxZoom=this._dataLayerMinZoom-this._dataLayerMaxZoom,this._dataLayerMinZoom-=this._dataLayerMaxZoom)},enumerable:!0,configurable:!0}),t.accessKey="847bd3a139a982d07c03ba07e4ca443c",t.resourseBaseUrl="https://hcm03.vstorage.vngcloud.vn/v1/AUTH_b32b6bc102c44269ab7b55e7820e7116",t.signature="8DBF117709BDF8081D4082AD9F51FD1AA016E38B108D1469497C8A92059735251362CF1A2188B397BE582A5746308E83",t.roadmapStyle={"sources":{"textures":{"pois":{"url":["https://hcm03.vstorage.vngcloud.vn/v1/AUTH_b32b6bc102c44269ab7b55e7820e7116/data/images/627cd15e9c4fa69f92878f59.png","https://hcm03.vstorage.vngcloud.vn/v1/AUTH_b32b6bc102c44269ab7b55e7820e7116/data/images/627cd15e9c4fa69f92878f5a.png","https://hcm03.vstorage.vngcloud.vn/v1/AUTH_b32b6bc102c44269ab7b55e7820e7116/data/images/627cd15e9c4fa69f92878f5b.png"],"sprites":{"width":26,"height":32}}},"patterns":{"dashdash":{"type":"dash","length":3,"gap":3,"repeat":2},"dotdot":{"type":"dot","repeat":2}}},"layers":{"earth":{"draw":{"polygons":{"color":[[2,"#f8f9faff"]]}}},"water":{"draw":{"polygons":{"color":"#94c0f2ff"},"lines":{"width":[[12,1],[14,2]],"color":"#94c0f2ff"}}},"roads":{"roads_highway_line":{"filter":{"kind":["highway"]},"draw":{"lines":{"width":[[7,1],[10,2],[14,3],[15,5],[16,8],[17,13],[18,20],[19,36]],"outline":{"width":[[8,1]],"color":"#daa130ff"},"color":"#fddc7fff"}}},"roads_highway_label":{"filter":{"kind":["highway"]},"draw":{"text":{"size":[[7,12]],"halo":{"color":"#FFF"},"color":"#783b03ff"}}},"roads_major_road_line":{"filter":{"kind":["major_road"]},"draw":{"lines":{"width":[[10,1],[15,4],[16,8],[17,13],[18,20],[19,36]],"outline":{"width":[[10,1]],"color":"#dfe0e4ff"},"color":"#ffffffff"}}},"roads_major_road_label":{"filter":{"kind":["major_road"]},"draw":{"text":{"size":[[5,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_primary_line":{"filter":{"kind":["major_road"],"kind_detail":["primary","primary_link"]},"draw":{"lines":{"width":[[8,1],[14,3],[15,5],[16,8],[17,13],[18,20],[19,36]],"outline":{"width":[[8,1]],"color":"#dfe0e4ff"},"color":"#ffffffff"}}},"roads_primary_label":{"filter":{"kind":["major_road"],"kind_detail":["primary","primary_link"]},"draw":{"text":{"size":12,"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_trunk_line":{"filter":{"kind":["major_road"],"kind_detail":["trunk","trunk_link"]},"draw":{"lines":{"width":[[7,1],[10,2],[14,3],[15,5],[16,8],[17,13],[18,20],[19,36]],"outline":{"width":[[8,1]],"color":"#f8ae0aff"},"color":[[7,"#fdeec1ff"],[13,"#fde293ff"]]}}},"roads_trunk_label":{"filter":{"kind":["major_road"],"kind_detail":["trunk","trunk_link"]},"draw":{"text":{"size":12,"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_minor_road_line":{"filter":{"kind":["minor_road","path"]},"draw":{"lines":{"width":[[16,2],[18,5],[19,10]],"outline":{"width":[[16,1]],"color":"#dfe0e4ff"},"color":"#FFF"}}},"roads_minor_road_label":{"filter":{"kind":["minor_road","path"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#70757aff"}}},"roads_unclassified_line":{"filter":{"kind":["minor_road","path"],"kind_detail":["unclassified"]},"draw":{"lines":{"width":[[14,1],[15,2],[16,4],[17,7],[18,10],[19,20]],"outline":{"width":[[15,1]],"color":[[7,"#dfe0e4ff"],[15,"#dfe0e4ff"]]},"color":[[14,"#e8e8e8ff"],[15,"#ffffffff"]]}}},"roads_unclassified_label":{"filter":{"kind":["minor_road","path"],"kind_detail":["unclassified"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_residential_line":{"filter":{"kind":["minor_road","path"],"kind_detail":["residential"]},"draw":{"lines":{"width":[[14,1],[15,2],[16,4],[17,7],[18,10],[19,20]],"outline":{"width":[[15,1]],"color":[[7,"#dfe0e4ff"],[15,"#dfe0e4ff"]]},"color":[[14,"#e8e8e8ff"],[15,"#ffffffff"]]}}},"roads_residential_label":{"filter":{"kind":["minor_road","path"],"kind_detail":["residential"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_footway_line":{"filter":{"kind":["minor_road","path"],"kind_detail":["footway","pedestrian"]},"draw":{"lines":{"width":[[16,2]],"outline":{"width":[[16,1]],"color":"#f8f9faff"},"color":"#5bb974ff"}}},"roads_footway_label":{"filter":{"kind":["minor_road","path"],"kind_detail":["footway","pedestrian"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_construction_line":{"filter":{"kind":["construction"]},"draw":{"lines":{"width":[[14,1],[15,2]],"outline":{"width":[[14,1]],"color":[[7,"#dfe0e4ff"],[15,"#dfe0e4ff"]]},"color":"#DDDFE3"}}},"roads_construction_label":{"filter":{"kind":["construction"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_rail_line":{"filter":{"kind":["rail"]},"draw":{"lines":{"width":[[10,2]],"outline":{"width":[[13,1]],"color":"#e4a421ff"},"color":[[10,"#b9c0c5ff"]]}}},"roads_rail_label":{"filter":{"kind":["rail"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_aeroway_line":{"filter":{"kind":["aeroway"]},"draw":{"lines":{"width":[[13,2],[15,6]],"outline":{"width":[[10,1]],"color":"#dfe0e4ff"},"color":"#f8f9faff"}}},"roads_aeroway_label":{"filter":{"kind":["aeroway"]},"draw":{"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"roads_ferry_line":{"filter":{"kind":["ferry"]},"draw":{"lines":{"width":[[5,1]],"outline":{"width":1,"color":[[7,"#dfe0e4ff"],[15,"#dfe0e4ff"]]},"color":"#206cb7ff"}}},"roads_ferry_label":{"filter":{"kind":["ferry"]},"draw":{"text":{"size":12,"halo":{"color":"#FFF"},"color":"#185abcff"}}},"draw":{"lines":{"width":[[10,1]],"outline":{"width":[[13,1]],"color":[[7,"#dfe0e4ff"],[15,"#dfe0e4ff"]]},"color":"#FFF"},"text":{"size":[[8,10],[17,12]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"boundaries":{"draw":{"lines":{"width":[[2,0]]},"text":{"size":10,"halo":{"color":"#FFF"},"color":"#798083"}},"boundaries_country_line":{"filter":{"kind_detail":["2"]},"draw":{"lines":{"width":[[2,1]],"color":"#7f7f7ffc"}}},"boundaries_country_label":{"filter":{"kind_detail":["2"]},"draw":{"text":{"size":10,"halo":{"color":"#ffffffff"},"color":"#000000ff"}}},"boundaries_province_line":{"filter":{"kind":["province","province_sf"]},"draw":{"lines":{"width":[[5,1],[11,0]],"color":[[7,"#BDBDBD"],[8,"#8a8a8aff"]]}}},"boundaries_province_label":{"filter":{"kind":["province","province_sf"]},"draw":{"text":{"size":10,"halo":{"color":"#FFF"},"color":"#798083"}}},"boundaries_district_line":{"filter":{"kind":["district"]},"draw":{"lines":{"width":[[11,1]],"color":"#8a8a8aff"}}},"boundaries_district_label":{"filter":{"kind":["district"]},"draw":{"text":{"size":10,"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"boundaries_ward_line":{"filter":{"kind":["ward"]},"draw":{"lines":{"width":[[14,0]],"color":"#8a8a8aff"}}},"boundaries_ward_label":{"filter":{"kind":["ward"]},"draw":{"text":{"size":10,"halo":{"color":"#FFF"},"color":"#4e5256ff"}}}},"places":{"draw":{"text":{"size":0,"halo":{"color":"#FFF"},"color":"#505050"}},"places_country_label":{"filter":{"kind":["country","country_sf"]},"draw":{"text":{"size":[[2,9],[5,12],[6,18],[9,0]],"halo":{"color":"#ffffffff"},"color":"#232323ff"}}},"places_archipelago_label":{"filter":{"kind":["archipelago"]},"draw":{"text":{"size":[[5,9],[6,12],[8,14]],"halo":{"color":"#ffffffff"},"color":"#181818ff"}}},"places_sea_label":{"filter":{"kind":["sea"]},"draw":{"text":{"size":[[4,7],[5,9],[6,12],[7,12],[8,12],[10,12]],"halo":{"color":"#ffffffff"},"color":"#232323ff"}}},"places_island_label":{"filter":{"kind":["island"]},"draw":{"text":{"size":[[6,9]],"halo":{"color":"#FFF"},"color":"#232323ff"}}},"places_islet_label":{"filter":{"kind":["islet"]},"draw":{"text":{"size":[[12,10]],"halo":{"color":"#FFF"},"color":"#121212ff"}}},"places_province_label":{"filter":{"kind":["province"]},"draw":{"text":{"size":[[7,9],[8,16],[10,20],[14,0]],"halo":{"color":"#FFF"},"color":"#565D67"}}},"places_city_label":{"filter":{"kind":["province"],"kind_detail":["city"]},"draw":{"text":{"size":[[5,12],[8,18],[10,20],[14,0]],"halo":{"color":"#ffffffff"},"color":"#1d1f20ff"}}},"places_district_label":{"filter":{"kind":["district"]},"draw":{"text":{"size":[[11,12],[13,13],[14,0]],"halo":{"color":"#FFF"},"color":"#4e5256ff"}}},"places_ward_label":{"filter":{"kind":["ward"]},"draw":{"text":{"size":[[14,10],[15,11],[17,0]],"halo":{"color":"#FFF"},"color":"#414448ff"}}},"places_hamlet_label":{"filter":{"kind":"hamlet"},"draw":{"text":{"size":[[15,9]],"halo":{"color":"#FFF"},"color":"#505050"}}}},"pois":{"draw":{"points":{"texture":"pois","iconIndex":1,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}},"pois_cafe_symbol":{"filter":{"kind":["cafe","milk_tea","drink"]},"draw":{"points":{"texture":"pois","iconIndex":19,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f19800ff"}}},"pois_store_symbol":{"filter":{"kind":["car_dealer","motorcycle_dealer","bicycle_store","car_rental","motorcycle_rental","cosmetic_store","mommy_store","clothing_store","glasses_store","shoe_store","electronics_store","cellphone_store","computer_store","store","fruit_shop","florist","sports_store","toy_store","furniture_store","home_goods_store","jewelry_store","book_store","pet_store","liquor_store","gift_shop","building_materials_store","musical_instrument_store","electrical_supply_store","second_hand_store","fuel_store"]},"draw":{"points":{"texture":"pois","iconIndex":2,"size":12,"halo":{"color":"#fdfdfdff"},"color":"#5491f5ff"}}},"pois_market_symbol":{"filter":{"kind":["food_store","convenience_store","local_market","supermarket","grocery_store","shopping_mall"]},"draw":{"points":{"texture":"pois","iconIndex":3,"size":12,"halo":{"color":"#fdfdfd"},"color":"#5491f5ff"}}},"pois_atm_symbol":{"filter":{"kind":["atm"]},"draw":{"points":{"texture":"pois","iconIndex":4,"size":12,"halo":{"color":"#fdfdfdff"},"color":"#7985caff"}}},"pois_bank_symbol":{"filter":{"kind":["bank","treasury"]},"draw":{"points":{"texture":"pois","iconIndex":5,"size":12,"halo":{"color":"#fdfdfdff"},"color":"#7985caff"}}},"pois_pharmacy_symbol":{"filter":{"kind":["pharmacy"]},"draw":{"points":{"texture":"pois","iconIndex":6,"size":12,"halo":{"color":"#fdfdfdff"},"color":"#ec685cff"}}},"pois_hospital_symbol":{"filter":{"kind":["health","hospital","doctor","physiotherapist"]},"draw":{"points":{"texture":"pois","iconIndex":7,"size":12,"halo":{"color":"#fdfdfdff"},"color":"#ec685cff"}}},"pois_dentist_symbol":{"filter":{"kind":["dentist"]},"draw":{"points":{"texture":"pois","iconIndex":8,"size":12,"halo":{"color":"#fdfdfd"},"color":"#ec685cff"}}},"pois_bus_station_symbol":{"filter":{"kind":["bus_station","transit_station"]},"draw":{"points":{"texture":"pois","iconIndex":10,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_airport_symbol":{"filter":{"kind":["airport"]},"draw":{"points":{"texture":"pois","iconIndex":11,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_train_station_symbol":{"filter":{"kind":["train_station","subway_station"]},"draw":{"points":{"texture":"pois","iconIndex":12,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_bus_stop_symbol":{"filter":{"kind":["bus_stop"]},"draw":{"points":{"texture":"pois","iconIndex":54,"size":12,"halo":{"color":"#fdfdfd"},"color":"#2e7dfeff"}}},"pois_charging_station_symbol":{"filter":{"kind":["charging_station"]},"draw":{"points":{"texture":"pois","iconIndex":13,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_gas_station_symbol":{"filter":{"kind":["gas_station"]},"draw":{"points":{"texture":"pois","iconIndex":14,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_parking_symbol":{"filter":{"kind":["parking"]},"draw":{"points":{"texture":"pois","iconIndex":15,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_school_symbol":{"filter":{"kind":["preschool","primary_school","secondary_school","high_school","university","college","driving_school","language_center"]},"draw":{"points":{"texture":"pois","iconIndex":16,"size":12,"halo":{"color":"#fdfdfd"},"color":"#78909cff"}}},"pois_hotel_symbol":{"filter":{"kind":["lodging","hotel","apartment","guest_house"]},"draw":{"points":{"texture":"pois","iconIndex":17,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f06292ff"}}},"pois_pagoda_symbol":{"filter":{"kind":["pagoda"]},"draw":{"points":{"texture":"pois","iconIndex":22,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_temple_symbol":{"filter":{"kind":["temple","worship"]},"draw":{"points":{"texture":"pois","iconIndex":23,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_church_symbol":{"filter":{"kind":["church"]},"draw":{"points":{"texture":"pois","iconIndex":24,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_storage_symbol":{"filter":{"kind":["storage"]},"draw":{"points":{"texture":"pois","iconIndex":25,"size":12,"halo":{"color":"#fdfdfd"},"color":"#00bcfcff"}}},"pois_industrial_zone_symbol":{"filter":{"kind":["industrial_zone"]},"draw":{"points":{"texture":"pois","iconIndex":26,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_campground_symbol":{"filter":{"kind":["campground"]},"draw":{"points":{"texture":"pois","iconIndex":27,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_museum_symbol":{"filter":{"kind":["museum","art_gallery"]},"draw":{"points":{"texture":"pois","iconIndex":28,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_public_beach_symbol":{"filter":{"kind":["public_beach"]},"draw":{"points":{"texture":"pois","iconIndex":52,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_gym_symbol":{"filter":{"kind":["gym"]},"draw":{"points":{"texture":"pois","iconIndex":29,"size":12,"halo":{"color":"#fdfdfd"},"color":"#8d70d5ff"}}},"pois_sports_center_symbol":{"filter":{"kind":["sports_center"]},"draw":{"points":{"texture":"pois","iconIndex":30,"size":12,"halo":{"color":"#fdfdfd"},"color":"#8d70d5ff"}}},"pois_stadium_symbol":{"filter":{"kind":["stadium"]},"draw":{"points":{"texture":"pois","iconIndex":31,"size":12,"halo":{"color":"#fdfdfd"},"color":"#8d70d5ff"}}},"pois_park_symbol":{"filter":{"kind":["park","zoo"]},"draw":{"points":{"texture":"pois","iconIndex":32,"size":12,"halo":{"color":"#fdfdfd"},"color":"#34a853ff"}}},"pois_golf_symbol":{"filter":{"kind":["golf"]},"draw":{"points":{"texture":"pois","iconIndex":33,"size":12,"halo":{"color":"#fdfdfd"},"color":"#8d70d5ff"}}},"pois_amusement_park_symbol":{"filter":{"kind":["amusement_park"]},"draw":{"points":{"texture":"pois","iconIndex":34,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_cinema_symbol":{"filter":{"kind":["cinema"]},"draw":{"points":{"texture":"pois","iconIndex":34,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_library_symbol":{"filter":{"kind":["library"]},"draw":{"points":{"texture":"pois","iconIndex":36,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_theater_symbol":{"filter":{"kind":["theater"]},"draw":{"points":{"texture":"pois","iconIndex":37,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_spa_symbol":{"filter":{"kind":["spa","hair_care","beauty_salon"]},"draw":{"points":{"texture":"pois","iconIndex":38,"size":12,"halo":{"color":"#fdfdfd"},"color":"#8d70d5ff"}}},"pois_casino_symbol":{"filter":{"kind":["casino"]},"draw":{"points":{"texture":"pois","iconIndex":39,"size":12,"halo":{"color":"#fdfdfd"},"color":"#12b5cbff"}}},"pois_courthouse_symbol":{"filter":{"kind":["courthouse","lawyer"]},"draw":{"points":{"texture":"pois","iconIndex":40,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_police_symbol":{"filter":{"kind":["police"]},"draw":{"points":{"texture":"pois","iconIndex":41,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_committee_symbol":{"filter":{"kind":["committee"]},"draw":{"points":{"texture":"pois","iconIndex":42,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_political_symbol":{"filter":{"kind":["political"]},"draw":{"points":{"texture":"pois","iconIndex":43,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_community_center_symbol":{"filter":{"kind":["community_center"]},"draw":{"points":{"texture":"pois","iconIndex":44,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_fire_station_symbol":{"filter":{"kind":["fire_station"]},"draw":{"points":{"texture":"pois","iconIndex":45,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_post_office_symbol":{"filter":{"kind":["post_office"]},"draw":{"points":{"texture":"pois","iconIndex":46,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_veterinary_care_symbol":{"filter":{"kind":["veterinary_care"]},"draw":{"points":{"texture":"pois","iconIndex":9,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f56357ff"}}},"pois_public_restroom_symbol":{"filter":{"kind":["public_restroom"]},"draw":{"points":{"texture":"pois","iconIndex":47,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_cemetery_symbol":{"filter":{"kind":["cemetery"]},"draw":{"points":{"texture":"pois","iconIndex":48,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_bridge_symbol":{"filter":{"kind":["bridge"]},"draw":{"points":{"texture":"pois","iconIndex":49,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_power_station_symbol":{"filter":{"kind":["power_station"]},"draw":{"points":{"texture":"pois","iconIndex":51,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}},"pois_resort_symbol":{"filter":{"kind":["resort"]},"draw":{"points":{"texture":"pois","iconIndex":18,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f06292ff"}}},"pois_food_service_symbol":{"filter":{"kind":["food_service","bakery","eatery","fast_food","sweet_soup","ice_cream_shop","take_away","restaurant","beer_bar"]},"draw":{"points":{"texture":"pois","iconIndex":20,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f19800ff"}}},"pois_tourist_attraction_symbol":{"filter":{"kind":["tourist_attraction"]},"draw":{"points":{"texture":"pois","iconIndex":53,"size":12,"halo":{"color":"#fdfdfd"},"color":"#00bcfcff"}}},"pois_bar_symbol":{"filter":{"kind":["bar","pub","karaoke"]},"draw":{"points":{"texture":"pois","iconIndex":21,"size":12,"halo":{"color":"#fdfdfd"},"color":"#f19800ff"}}},"pois_harbour_symbol":{"filter":{"kind":["harbour"]},"draw":{"points":{"texture":"pois","iconIndex":50,"size":12,"halo":{"color":"#fdfdfd"},"color":"#678899ff"}}}},"landuse":{"draw":{"polygons":{}},"landuse_aerodrome_fill":{"filter":{"kind":["aerodrome","apron"]},"draw":{"polygons":{"color":"#e8eaedff"}}},"landuse_grass_fill":{"filter":{"kind":["grass","forest","park","theme_park","grassland","natural_wood","garden","cemetery","attraction","golf_course"]},"draw":{"polygons":{"color":"#ceead6ff"}}},"landuse_hospital_fill":{"filter":{"kind":["hospital"]},"draw":{"polygons":{"color":"#FCE8E6"}}},"landuse_university_fill":{"filter":{"kind":["university","school","college"]},"draw":{"polygons":{"color":"#F6F7F9"}}},"landuse_stadium_fill":{"filter":{"kind":["stadium","pitch","sports_centre"]},"draw":{"polygons":{"color":"#ceead6ff"}}},"landuse_beach_fill":{"filter":{"kind":["beach"]},"draw":{"polygons":{"color":"#f1e9d7ff"}}},"landuse_pedestrian_fill":{"filter":{"kind":["pedestrian"]},"draw":{"polygons":{"color":"#ebf7edff"}}},"landuse_substation_fill":{"filter":{"kind":["substation","power_line"]},"draw":{"polygons":{"color":"#e6e8eaff"}}},"landuse_urban_area_fill":{"filter":{"kind":["urban_area"]},"draw":{"polygons":{"color":"#E2E4E6"}}}},"buildings":{"draw":{"polygons":{"color":"#fef7e0ff"}},"buildings_building_fill":{"filter":{"kind":["building","building_part"]},"draw":{"polygons":{"color":"#e6e8eaff"}}},"buildings_roof_fill":{"filter":{"kind":["building","building_part"],"kind_detail":["roof"]},"draw":{"polygons":{"color":"#fef7e0ff"}}},"buildings_entrance_exit_fill":{"filter":{"kind":["entrance","exit"]},"draw":{"polygons":{"color":"#fef7e0ff"}}}}},"tool-version":"2.0.1","web-version":"2.2.0","mobile-version":"2.1.0","version":1},t}();e.MapSettings=s},function(t,e,r){"use strict";function i(t,e){this.x=t,this.y=e}t.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_LEFT=2]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=3]="BOTTOM_RIGHT"}(e.ControlOptions||(e.ControlOptions={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.getTileUrl=function(t,e,r,i){for(var n=0,o=0,a="";o<t.length;)if("{"==t[o]){switch(a+=t.substring(n,o),t[o+1]){case"x":a+=e.toString();break;case"y":a+=r.toString();break;case"z":a+=i.toString();break;default:console.log("Invalid map url pattern: "+t)}n=o+=3}else++o;return a+=t.substr(n)},t.getBuildingDataUrl=function(t,e,r){for(var i=0,n=0,o="";n<t.length;)if("{"==t[n]){switch(o+=t.substring(i,n),t[n+1]){case"s":o+=e;break;case"k":o+=r;break;default:console.log("Invalid Model url pattern: "+t)}i=n+=3}else++n;return o+=t.substr(i)},t.isUrlRequest=function(t){return null!=t&&(t.startsWith("http")||t.startsWith("./")||t.startsWith("/")||t.startsWith("blob:"))},t}();e.UrlUtils=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(50),n=r(12),o=r(8),a=r(3),s=r(39),l=function(){function t(){}return t.boxIntersectsSymbol=function(e,r,s,l,u,h,c){s=c.is3dMode()?s:0;var p=o.GeometryUtils.latLngToScreenCoordinate(r,s,c.cameraPosition,c.getScreenSize()),f=new a.Vector2(p.x+(.5-h.x)*l,p.y+(.5-h.y)*u),d=new i.Box(new n.Point(f.x-l/2,f.y-u/2),new n.Point(f.x+l/2,f.y+u/2));return t.boxIntersectsBox(e,d)},t.pointIntersectsBox=function(t,e){return t.x<=e.max.x&&t.y<=e.max.y&&t.x>=e.min.x&&t.y>=e.min.y},t.boxIntersectsBox=function(t,e){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)},t.polygonIntersectsPolygon=function(e,r){for(var i=0;i<e.length;i++)if(t.polygonContainsPoint(r,e[i]))return!0;for(i=0;i<r.length;i++)if(t.polygonContainsPoint(e,r[i]))return!0;return!!t.lineIntersectsLine(e,r)},t.multiPolygonIntersectsBufferedPoint=function(e,r,i){for(var n=0;n<e.length;n++){var o=e[n];if(t.polygonContainsPoint(o,r))return!0;if(t.pointIntersectsBufferedLine(r,o,i))return!0}return!1},t.multiPolygonIntersectsBufferedMultiPoint=function(e,r,i){for(var n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++)if(t.multiPolygonIntersectsBufferedPoint(e,o[a],i))return!0;return!1},t.multiPolygonIntersectsMultiPolygon=function(e,r){if(1===e.length&&1===e[0].length)return t.multiPolygonContainsPoint(r,e[0][0]);for(var i=0;i<r.length;i++)for(var n=r[i],o=0;o<n.length;o++)if(t.multiPolygonContainsPoint(e,n[o]))return!0;for(var a=0;a<e.length;a++){for(var s=e[a],l=0;l<s.length;l++)if(t.multiPolygonContainsPoint(r,s[l]))return!0;for(var u=0;u<r.length;u++)if(t.lineIntersectsLine(s,r[u]))return!0}return!1},t.multiPolygonIntersectsBufferedMultiLine=function(e,r,i){for(var n=0;n<r.length;n++)for(var o=r[n],a=0;a<e.length;a++){var s=e[a];if(s.length>=3)for(var l=0;l<o.length;l++)if(t.polygonContainsPoint(s,o[l]))return!0;if(t.lineIntersectsBufferedLine(s,o,i))return!0}return!1},t.lineIntersectsBufferedLine=function(e,r,i){if(e.length>1){if(t.lineIntersectsLine(e,r))return!0;for(var n=0;n<r.length;n++)if(t.pointIntersectsBufferedLine(r[n],e,i))return!0}for(var o=0;o<e.length;o++)if(t.pointIntersectsBufferedLine(e[o],r,i))return!0;return!1},t.lineIntersectsLine=function(e,r){if(0===e.length||0===r.length)return!1;for(var i=0;i<e.length-1;i++)for(var n=e[i],o=e[i+1],a=0;a<r.length-1;a++){var s=r[a],l=r[a+1];if(t.lineSegmentIntersectsLineSegment(n,o,s,l))return!0}return!1},t.lineSegmentIntersectsLineSegment=function(e,r,i,n){return t.isCounterClockwise(e,i,n)!==t.isCounterClockwise(r,i,n)&&t.isCounterClockwise(e,r,i)!==t.isCounterClockwise(e,r,n)},t.pointIntersectsBufferedMultiLine=function(e,r,i){return r.some((function(r){return t.pointIntersectsBufferedLine(e,r,i)}))},t.polygonIntersectsBufferedMultiLine=function(t,e,r){var i=this,n=!1;return e.forEach((function(e){t.length>=3&&e.forEach((function(e){i.polygonContainsPoint(t,e)&&(n=!0)})),i.lineIntersectsBufferedLine(t,e,r)&&(n=!0)})),n},t.pointIntersectsBufferedLine=function(e,r,i){var o=i*i,a=n.Point.convertPointToMBPoint(e);if(1===r.length)return a.distSqr(r[0])<o;for(var s=1;s<r.length;s++){var l=r[s-1],u=r[s];if(t.distToSegmentSquared(e,l,u)<o)return!0}return!1},t.boxIntersectsCircle=function(t,e,r,i){var n=r.x-Math.max(t.x,Math.min(r.x,t.x+(e.x-t.x))),o=r.y-Math.max(t.y,Math.min(r.y,t.y+(e.y-t.y)));return n*n+o*o<i*i},t.multiPolygonContainsPoint=function(t,e){for(var r,i,n,o=!1,a=0;a<t.length;a++)for(var s=0,l=(r=t[a]).length-1;s<r.length;l=s++)i=r[s],n=r[l],i.y>e.y!=n.y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x&&(o=!o);return o},t.polygonContainsPoint=function(t,e){for(var r=!1,i=0,n=t.length-1;i<t.length;n=i++){var o=t[i],a=t[n];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r},t.isCounterClockwise=function(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)},t.distToSegmentSquared=function(t,e,r){var i=n.Point.convertPointToMBPoint(e),o=n.Point.convertPointToMBPoint(r),a=n.Point.convertPointToMBPoint(t),s=i.distSqr(o);if(0===s)return a.distSqr(i);var l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/s;return l<0?a.distSqr(i):l>1?a.distSqr(o):a.distSqr(o.sub(i)._mult(l)._add(i))},t.createCollisionBox=function(t,e){var r=4*e,i=t.x-r,n=t.y-r,o=t.x+r,a=t.y+r;return new s.OBB((i+o)/2,(n+a)/2,0,o-i,a-n)},t}();e.CollisionUtils=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(46),n=function(){function t(t,e){this._min=new i(t.x,t.y),this._max=new i(e.x,e.y)}return Object.defineProperty(t.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),t}();e.Box=n},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(1),a=r(12),s=r(5),l=function(t){function e(r){var i=t.call(this,s.ClassType.MARKER_LABEL)||this,n={};o.MapUtils.extendOptions(n,e.defaultMarkerLabelOptions,r);for(var l=0,u=n;l<u.length;l++){if(null==u[l])throw Error("Parameters can not be null")}i.fontWeight="normal"!=n.fontWeight&&"bold"!=n.fontWeight?"normal":n.fontWeight,i.color=n.color,i.fontSize=n.fontSize,i.maxWidth=n.maxWidth,i.line=n.line,i.text=n.text,i.halo=n.halo,i.haloColor=n.haloColor,i.anchor=a.Point.convert(n.anchor);var h={};return o.MapUtils.extendOptions(h,e.defaultMarginOptions,n.margin),i.marginOptions=h,i}return n(e,t),e.prototype.getColor=function(){return this.color},e.prototype.getFontWeight=function(){return this.fontWeight},e.prototype.getFontSize=function(){return this.fontSize},e.prototype.getMaxWidth=function(){return this.maxWidth},e.prototype.getLine=function(){return this.line},e.prototype.getText=function(){return this.text},e.prototype.hasHalo=function(){return this.halo},e.prototype.getHaloColor=function(){return this.haloColor},e.prototype.getAnchor=function(){return this.anchor},e.prototype.getMargin=function(){return this.marginOptions},e.defaultMarkerLabelOptions={text:"",color:"#000000",fontWeight:"normal",fontSize:13,maxWidth:200,line:1,halo:!0,haloColor:"#ffffff",anchor:new a.Point(.5,.5),margin:{top:0,bottom:0,left:0,right:0}},e.defaultMarginOptions={top:0,bottom:0,left:0,right:0},e}(s.Map4dObject);e.MarkerLabel=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BOUNCE="bounce",t.DROP="drop"}(e.Animation||(e.Animation={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(2),o=r(87),a=r(13),s=r(40),l=function(t){void 0===t&&(t=function(t){}),this.indices=[],this.addVertex=t};e.CircleBuilderContext=l,e.buildCircle=function(t){var e=n.PolyConstants.numTrianglesPerCircle,r=2*Math.PI;t.addVertex(new i.Vector2(0,0));for(var o=0;o<e;++o)t.addVertex(new i.Vector2(Math.cos(o*r/e),Math.sin(o*r/e)).normalize()),0!=o&&(t.indices.push(0),t.indices.push(0+o),t.indices.push(0+o+1));t.indices.push(0),t.indices.push(e),t.indices.push(1)};var u=function(){function t(t){void 0===t&&(t=function(t){}),this.indices=[],this.addVertex=t}return t.prototype.clear=function(){this.indices=[]},t}();e.PolygonBuilderContext=u,e.buildPolygon=function(t,e){var r=[],i=[];t.forEach((function(t,o){0!=o&&i.push(r.length/2),t.forEach((function(t){r.push((t.x+.5)*n.MapConstants.tileExtend),r.push((.5-t.y)*n.MapConstants.tileExtend),e.addVertex(t)}))})),e.indices=o.default(r,i)};var h=function(){function t(t,e,r,i,n){void 0===t&&(t=function(t,e){}),void 0===e&&(e=s.LineCapType.Butt),void 0===r&&(r=s.LineJoinType.Bevel),void 0===i&&(i=!1),void 0===n&&(n=3),this.indices=[],this.addVertex=t,this.lineCapType=e,this.lineJoinType=r,this.closedPolyline=i,this.miterLimit=n,this.numVertices=0,this.textureWidth=1,this.textureHeight=1}return t.prototype.buildPolyLine=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null),this.buildPolyLineSegment(t,e,r)},t.prototype.clear=function(){this.indices=[],this.numVertices=0},t.prototype.buildPolyLineSegment=function(t,e,r){void 0===r&&(r=null);var o=0,l=this.closedPolyline?t.length+2:t.length,u=t.length,h=l-0;if(!(h<2)){var c,p,f,d=t[0],g=t[1];p=new i.Vector2(g.y-d.y,d.x-g.x).normalize(),this.closedPolyline||this.addCap(d,p,!0),this.addPolyLineVertex(d,p,new i.Vector2(0,1)),this.addPolyLineVertex(d,p.multiply(-1),new i.Vector2(0,0));for(var y=1;y<h-1;++y){var m=(y+0+1)%u;if(o+=a.MathUtils.distance(d,g),(d=g)!=(g=t[m])){c=p,p=new i.Vector2(g.y-d.y,d.x-g.x).normalize();var v=1;0==(f=c.add(p)).x&&0==f.y?f=new i.Vector2(c.y-p.y,p.x-c.x):v=2/f.dot(f),f=f.multiply(v);var _=this.lineJoinType==s.LineJoinType.Bevel;f.length>this.miterLimit&&(_=!0,f=f.multiply(this.miterLimit/f.length));var b=o;if(this.lineJoinType!=s.LineJoinType.Miter||_){var w=_||this.lineJoinType==s.LineJoinType.Bevel?1:n.PolyConstants.numTrianglesOnRoundJoin;p.x*c.y-p.y*c.x>0?(this.addPolyLineVertex(d,f,new i.Vector2(b,1)),this.addPolyLineVertex(d,c.multiply(-1),new i.Vector2(b,0)),this.addIndices(),this.addFan(d,c.multiply(-1),p.multiply(-1),f,new i.Vector2(b,0),new i.Vector2(b,0),new i.Vector2(b,1),w),this.addPolyLineVertex(d,f,new i.Vector2(b,1)),this.addPolyLineVertex(d,p.multiply(-1),new i.Vector2(b,0))):(this.addPolyLineVertex(d,c,new i.Vector2(b,1)),this.addPolyLineVertex(d,f.multiply(-1),new i.Vector2(b,0)),this.addIndices(),this.addFan(d,c,p,f.multiply(-1),new i.Vector2(b,1),new i.Vector2(b,1),new i.Vector2(b,0),w),this.addPolyLineVertex(d,p,new i.Vector2(b,1)),this.addPolyLineVertex(d,f.multiply(-1),new i.Vector2(b,0)))}else this.addPolyLineVertex(d,f,new i.Vector2(b,1)),this.addPolyLineVertex(d,f.multiply(-1),new i.Vector2(b,0)),this.addIndices()}}o+=a.MathUtils.distance(d,g),r||(r=1);var x=r*(this.textureWidth/this.textureHeight);o=Math.round(o/x)*x,this.addPolyLineVertex(g,p,new i.Vector2(o,1)),this.addPolyLineVertex(g,p.multiply(-1),new i.Vector2(o,0)),this.addIndices(),this.closedPolyline||this.addCap(g,p,!1),e&&e()}},t.prototype.addCap=function(t,e,r){var o=r?0:1;switch(this.lineCapType){case s.LineCapType.Butt:break;case s.LineCapType.Square:var a=new i.Vector2(-e.y,e.x);this.addPolyLineVertex(t,e.add(a),new i.Vector2(o,0)),this.addPolyLineVertex(t,e.multiply(-1).add(a),new i.Vector2(o,0)),r||this.addIndices();break;case s.LineCapType.Round:var l=e,u=e.multiply(-1),h=new i.Vector2(0,0),c=new i.Vector2(o,1),p=new i.Vector2(o,0),f=new i.Vector2(o,.5);r&&(l=l.multiply(-1),u=u.multiply(-1),c.y=0,p.y=1),this.addFan(t,l,u,h,c,p,f,n.PolyConstants.numTrianglesOnRoundCap);break;default:console.log("Invalid line cap type")}},t.prototype.addPolyLineVertex=function(t,e,r){++this.numVertices,this.addVertex(t,e,r)},t.prototype.addIndices=function(){this.indices.push(this.numVertices-4),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-1)},t.prototype.addFan=function(t,e,r,n,o,a,s,l){var u=e.x*r.y-e.y*r.x,h=Math.atan2(u,e.dot(r)),c=this.numVertices;this.addPolyLineVertex(t,n,s),this.addPolyLineVertex(t,e,o);for(var p=e,f=0;f<l;f++){var d=(f+1)/l;p=e.rotateByRadian(h*d);var g=new i.Vector2(0,0);g=o.multiply(1-d).add(a.multiply(d)),this.addPolyLineVertex(t,p,g),this.indices.push(c),this.indices.push(c+f+(h>0?1:2)),this.indices.push(c+f+(h>0?2:1))}},t}();e.PolylineBuilderContext=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Texture=0]="Texture",t[t.Extrude=1]="Extrude",t[t.External=2]="External",t[t.ExternalExtrude=3]="ExternalExtrude",t[t.Polygon=4]="Polygon"}(e.BuildingType||(e.BuildingType={}))},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=r(31),s=r(1),l=r(12),u=r(2),h=r(198),c=r(5),p=r(21),f=r(100),d=function(t){function e(r){var i=t.call(this,c.ClassType.MARKER)||this,n={};if(s.MapUtils.extendOptions(n,e.defaultMarkerOptions,r),i.elevation=n.elevation,i.zIndex=n.zIndex,null==n.position||null==n.anchor||null==n.visible||null==i.elevation||null==i.zIndex||null==n.draggable)throw Error("Parameters can not be null");return(!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(p.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled),i.properties=new h.SymbolLayerProperties(n.title,n.snippet,n.windowAnchor,o.LatLng.convert(n.position),l.Point.convert(n.anchor),0,0,"",n.iconView,n.icon,n.elevation,n.rotation,n.label,l.Point.convert(n.labelAnchor),n.visible,n.draggable,n.clickable,f.IConverter.convertAnimation(n.animation)),i}return n(e,t),e.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.map.mapView.hideInfoWindow(this.id),this.id=-1),this.map=t,null!=this.map&&(this.id=this.map.mapView.addAnnotation(this)),this.properties.annotationId=this.id)},e.prototype.setInfoWindow=function(t){t!==this.properties.getInfoWindow()&&this.properties.setInfoWindow(t)},e.prototype.setInfoContents=function(t){t!==this.properties.getInfoContents()&&this.properties.setInfoContents(t)},e.prototype.setIcon=function(t){this.getIconView()?console.warn("Icon view markers has the priority over other markers"):(null==t&&(t=u.SymbolConstants.defaultSymbol),t!==this.properties.getIcon()&&(this.properties.setIcon(t),this.properties.setTextureDirty(!0),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)))},e.prototype.setTitle=function(t){this.properties.getTitle()!==t&&(this.properties.setTitle(t),null!=this.map&&this.map.mapView.updateInfoContents(this.id))},e.prototype.setSnippet=function(t){this.properties.getSnippet()!==t&&(this.properties.setSnippet(t),null!=this.map&&this.map.mapView.updateInfoContents(this.id))},e.prototype.setLabel=function(t){this.properties.getMarkerLabel()!==t&&(this.properties.setMarkerLabel(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.setWindowAnchor=function(t){if(null!=t){var e=l.Point.convert(t);this.properties.getWindowAnchor().equals(e)||this.properties.setWindowAnchor(e)}else p.LogUtils.logNonNull("anchor")},e.prototype.setPosition=function(t){if(null!=t){var e=o.LatLng.convert(t);this.properties.getPosition().equals(e)||(this.properties.setPosition(e),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0))}else p.LogUtils.logNonNull("position")},e.prototype.setVisible=function(t){null!=t?this.properties.isVisible()!==t&&(this.properties.setVisible(t),null!=this.map&&(t||this.isInfoWindowShown()&&this.map.mapView.hideInfoWindow(this.id),this.map.mapView.updateAnnotation(this.id))):p.LogUtils.logNonNull("visible")},e.prototype.setAnchor=function(t){if(null!=t){var e=l.Point.convert(t);this.properties.getAnchor().equals(e)||(this.properties.setAnchor(e),null!=this.map&&this.map.mapView.updateAnnotation(this.id))}else p.LogUtils.logNonNull("anchor")},e.prototype.setLabelAnchor=function(t){if(null!=t){var e=l.Point.convert(t);this.properties.getLabelAnchor().equals(e)||(this.properties.setLabelAnchor(e),null!=this.map&&this.map.mapView.updateAnnotation(this.id))}else p.LogUtils.logNonNull("labelAnchor")},e.prototype.setDraggable=function(t){null!=t?this.properties.setDraggable(t):p.LogUtils.logNonNull("draggable")},e.prototype.getTitle=function(){return this.properties.getTitle()},e.prototype.getSnippet=function(){return this.properties.getSnippet()},e.prototype.getWindowAnchor=function(){var t=this.properties.getWindowAnchor();return null==t?null:new l.Point(t.x,t.y)},e.prototype.getPosition=function(){return this.properties.getPosition()},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.getAnchor=function(){var t=this.properties.getAnchor();return null==t?null:new l.Point(t.x,t.y)},e.prototype.getLabelAnchor=function(){var t=this.properties.getLabelAnchor();return null==t?null:new l.Point(t.x,t.y)},e.prototype.getIcon=function(){return this.properties.getIcon()},e.prototype.getLabel=function(){return this.properties.getMarkerLabel()},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.getInfoWindow=function(){return this.properties.getInfoWindow()},e.prototype.getInfoContents=function(){return this.properties.getInfoContents()},e.prototype.isInfoWindowShown=function(){return null!=this.map&&this.map.mapView.isInfoWindowShown(this.id)},e.prototype.showInfoWindow=function(){null!=this.map&&this.properties.isVisible()&&!this.isInfoWindowShown()&&this.map.mapView.showInfoWindow(this.id)},e.prototype.hideInfoWindow=function(){null!=this.map&&this.isInfoWindowShown()&&this.map.mapView.hideInfoWindow(this.id)},e.prototype.getIconView=function(){return this.properties.getIconView()},e.prototype.setIconView=function(t){this.properties.getIconView()!==t&&(this.properties.setIconView(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.getRotation=function(){return this.properties.getRotation()},e.prototype.setRotation=function(t){null!=t?this.properties.getRotation()!==t&&(this.properties.setRotation(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):p.LogUtils.logNonNull("rotation")},e.prototype.getProperties=function(){return this.properties},e.prototype.isUserInteractionEnabled=function(){return p.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){p.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){return this.properties.setClickable(t)},e.prototype.getAnimation=function(){return this.properties.getAnimation()},e.prototype.setAnimation=function(t){this.properties.setAnimation(f.IConverter.convertAnimation(t)),this.map.mapView.requestRender()},e.defaultMarkerOptions={visible:!0,anchor:new l.Point(.5,1),labelAnchor:new l.Point(.5,.5),icon:u.SymbolConstants.defaultSymbol,elevation:0,rotation:0,windowAnchor:null,zIndex:0,draggable:!1,iconView:null,userInteractionEnabled:!0,clickable:!0,animation:null},e}(a.Annotation);e.Marker=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(20);e.CameraPosition=i.CameraPosition;var n=r(106);e.Circle=n.Circle;var o=r(58);e.Icon=o.Icon;var a=r(4);e.LatLng=a.LatLng;var s=r(19);e.LatLngBounds=s.LatLngBounds;var l=r(108);e.Map=l.Map4D;var u=r(37);e.MapEvent=u.MapEvent;var h=r(239);e.MapObjectData=h.MapObjectData;var c=r(240);e.MapsEventListener=c.MapsEventListener;var p=r(55);e.Marker=p.Marker;var f=r(241);e.MarkerClusterer=f.MarkerClusterer;var d=r(51);e.MarkerLabel=d.MarkerLabel;var g=r(12);e.Point=g.Point;var y=r(103);e.Polygon=y.Polygon;var m=r(40);e.Polyline=m.Polyline;var v=r(242);e.Projection=v.Projection;var _=r(75);e.TimeEffect=_.TimeEffect;var b=r(74);e.Weather=b.Weather;var w=r(76);e.Data=w.Data,e.MapData=w.MapData;var x=r(243);e.Measure=x.Measure;var M=r(245);e.CoordinateTransformer=M.CoordinateTransformer;var T=r(246);e.POI=T.POI;var A=r(248);e.Building=A.Building;var L=r(253);e.BuildingOverlay=L.BuildingOverlay;var S=r(254);e.TileOverlay=S.TileOverlay;var E=r(255);e.GroundOverlay=E.GroundOverlay;var P=r(256);e.POIOverlay=P.POIOverlay;var C=r(257);e.ImageOverlay=C.ImageOverlay;var I=r(17);e.MapType=I.MapType;var O=r(259);e.DirectionsRenderer=O.DirectionsRenderer;var R=r(261);e.AnimationOptions=R.AnimationOptions;var k=r(262);e.CircleOptions=k.CircleOptions;var D=r(47);e.ControlOptions=D.ControlOptions;var B=r(263);e.EventOptions=B.EventOptions;var U=r(264);e.MapOptions=U.MapOptions;var j=r(265);e.MarkerClusterOptions=j.MarkerClusterOptions;var N=r(266);e.MarkerLabelOptions=N.MarkerLabelOptions;var V=r(52);e.MarkerOptions=V.MarkerOptions,e.Animation=V.Animation;var F=r(267);e.PaddingOptions=F.PaddingOptions;var z=r(268);e.PolygonOptions=z.PolygonOptions;var Z=r(269);e.PolylineOptions=Z.PolylineOptions;var G=r(270);e.POIOptions=G.POIOptions;var W=r(271);e.BuildingOptions=W.BuildingOptions;var Y=r(272);e.TileOverlayOptions=Y.TileOverlayOptions,e.GroundOverlayOptions=Y.GroundOverlayOptions,e.POIOverlayOptions=Y.POIOverlayOptions,e.BuildingOverlayOptions=Y.BuildingOverlayOptions,e.ImageOverlayOptions=Y.ImageOverlayOptions;var H=r(273);e.DirectionsRendererOptions=H.DirectionsRendererOptions;var X=r(274);e.DashPatternOptions=X.DashPatternOptions,e.DotPatternOptions=X.DotPatternOptions;var q=r(275);e.POIData=q.POIData,e.BuildingData=q.BuildingData;var J=r(28);e.SolidPattern=J.SolidPattern,e.DashPattern=J.DashPattern,e.DotPattern=J.DotPattern,e.IconPattern=J.IconPattern},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.en="en",t.vi="vi"}(e.MapLanguage||(e.MapLanguage={}))},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=r(1),s=function(t){function e(e,r,i){var n=t.call(this,o.ClassType.ICON)||this;return n.width=e,n.height=r,n.url=i,n}return n(e,t),e.prototype.clone=function(){return new e(this.width,this.height,this.url)},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.getUrl=function(){return null==this.url?null:this.url.replace("@1x","@"+a.MapUtils.resourceScale+"x")},e}(o.Map4dObject);e.Icon=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(60),n=r(6),o=r(3),a=r(1),s=function(){function t(){}return t.createWithXYZoom=function(e,r,n,o){void 0===o&&(o=!1);var a=new t;return a.wrap=(e<0?e-(1<<n)+1:e)/(1<<n)>>0,a.tileCoordinate=new i.TileCoordinate(e&(1<<n)-1,r<0?0:Math.min(r,(1<<n)-1),n,o),a},t.createWithWrapAndTileCoordinate=function(e,r){var i=new t;return i.wrap=e,i.tileCoordinate=r,i},t.fromLatLng=function(e,r){var i=n.ProjectionMercator.projectScale(e,Math.pow(2,r)).multiply(1/a.MapUtils.getTileSize());return t.createWithXYZoom(Math.floor(i.x),Math.floor(i.y),r)},t.prototype.toVec2=function(){var t=this.tileCoordinate.getX()+this.wrap*(1<<this.tileCoordinate.getZoom());return new o.Vector2(t,this.tileCoordinate.getY())},t.prototype.parent=function(){var e=this.tileCoordinate.zoom-1,r=this.tileCoordinate.x/2>>0,n=this.tileCoordinate.y/2>>0;return t.createWithWrapAndTileCoordinate(this.wrap,new i.TileCoordinate(r,n,e,this.tileCoordinate.is3DMode()))},t.prototype.children=function(){var e=this.tileCoordinate.zoom+1,r=2*this.tileCoordinate.x,n=2*this.tileCoordinate.y;return[t.createWithWrapAndTileCoordinate(this.wrap,new i.TileCoordinate(r,n,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new i.TileCoordinate(r,n+1,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new i.TileCoordinate(r+1,n,e,this.tileCoordinate.is3DMode())),t.createWithWrapAndTileCoordinate(this.wrap,new i.TileCoordinate(r+1,n+1,e,this.tileCoordinate.is3DMode()))]},t.prototype.getWrap=function(){return this.wrap},t.prototype.getTileCoordinate=function(){return this.tileCoordinate},t.prototype.equal=function(t){return this.wrap==t.getWrap()&&this.tileCoordinate.equal(t.getTileCoordinate())},t.prototype.notEqual=function(t){return this.wrap!=t.getWrap()},t.prototype.lessThan=function(t){return this.wrap==t.getWrap()?this.tileCoordinate.lessThan(t.getTileCoordinate()):this.wrap<t.getWrap()},t}();e.UnwrappedTileCoordinate=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),n=r(1),o=r(2),a=function(){function t(t,e,r,i){void 0===i&&(i=!1),this.x=t,this.y=e,this.zoom=r,this.mode3D=i&&this.getZoom()>=o.MapConstants.defaultMinZoom3d}return t.fromLatLng=function(e,r,o){var a=i.ProjectionMercator.projectScale(e,Math.pow(2,r)).multiply(1/n.MapUtils.getTileSize());return new t(Math.floor(a.x),Math.floor(a.y),r,o)},t.prototype.parent=function(){return new t(this.x/2,this.y/2,this.zoom-1,this.mode3D)},t.prototype.children=function(){var e=this.zoom+1,r=2*this.x,i=2*this.y;return[new t(r,i,e,this.mode3D),new t(r,i+1,e,this.mode3D),new t(r+1,i,e,this.mode3D),new t(r+1,i+1,e,this.mode3D)]},t.prototype.set3DMode=function(t){this.mode3D=t&&this.getZoom()>=o.MapConstants.defaultMinZoom3d},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getZoom=function(){return this.zoom},t.prototype.is3DMode=function(){return this.mode3D},t.prototype.equal=function(t){return null!=t&&(this.x==t.x&&this.y==t.y&&this.zoom==t.zoom&&this.mode3D==t.mode3D)},t.prototype.notEqual=function(t){return null!=t&&(this.x!=t.x||this.y!=t.y||this.zoom!=t.zoom||this.mode3D!=t.mode3D)},t.prototype.lessThan=function(t){return null!=t&&(this.x==t.x?this.y==t.y?this.zoom==t.zoom?this.mode3D<t.mode3D:this.zoom<t.zoom:this.y<t.y:this.x<t.x)},t.prototype.isChildOf=function(t){return this.mode3D==t.mode3D&&null!=t&&(0==t.zoom||t.zoom<this.zoom&&t.x==this.x>>this.zoom-t.zoom&&t.y==this.y>>this.zoom-t.zoom)},t.prototype.toString=function(){return this.getZoom()+"/"+this.getX()+"/"+this.getY()+"/"+(this.mode3D?"1":"0")},t}();e.TileCoordinate=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(124),n=r(62),o=r(81),a=function(){function t(t,e,r,n,o){void 0===o&&(o=null),this.renderTiles=[],this.mapView=t,this.tileCache=e>0?new i.TileCache(e):null,this.tiles=new Map,this.createTileFn=r,this.removeTileCallBackFn=n,this.updateTileCacheFn=o}return t.prototype.updateRenderableTiles=function(t,e,r){var i=this,a=[],s=[],l=[];if(e.getZoom()<r&&0!=t.length){var u=t[0].getTileCoordinate().getZoom();this.renderTiles.forEach((function(t){t.getUnwrappedTileCoordinate().getTileCoordinate().getZoom()>u&&l.push(t)}))}this.renderTiles=[],t.forEach((function(t){var u=t.getTileCoordinate();u.set3DMode(e.is3dMode());var h=i.getTile(u);if(h||(h=i.createTileOrGetFromCacheIfExist(u),i.mapView.getGeoJsonManager().addTile(new o.VectorTile(u,i.mapView.gl))),h.isRenderable())i.renderTiles.push(new n.RenderTile(t,h)),a.push(u);else if(a.push(u),e.getZoom()>r)for(var c=t.parent();c.getTileCoordinate().getZoom()>=r;){if(u=c.getTileCoordinate(),null!=(h=i.getTile(u))&&h.isRenderable()){a.some((function(t){return t.equal(u)}))||(a.push(u),s.push(new n.RenderTile(c,h)));break}c=c.parent()}else e.getZoom()<r&&l.forEach((function(e){var r=e.getUnwrappedTileCoordinate();r.getTileCoordinate().isChildOf(t.getTileCoordinate())&&(u=r.getTileCoordinate(),null!=(h=i.getTile(u))&&h.isRenderable()&&(a.some((function(t){return t.equal(u)}))||(a.push(u),i.renderTiles.push(new n.RenderTile(r,h)))))}))})),0!=s.length&&(this.renderTiles.forEach((function(t){s.push(t)})),this.renderTiles=s),a.sort((function(t,e){return t.lessThan(e)?-1:t.lessThan(e)?0:1}));for(var h=[],c=0;c<a.length;++c)a[c]!==a[c+1]&&h.push(a[c]);a=h;var p=Array.from(this.tiles);p.sort((function(t,e){return t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?-1:t[1].tileCoordinate.lessThan(e[1].tileCoordinate)?0:1}));for(var f=0,d=0;f<p.length;)if(d==a.length||p[f][1].tileCoordinate.lessThan(a[d])){var g=p[f][1].tile;this.removeTileCallBackFn(g),this.mapView.getGeoJsonManager().removeTile(g.tileCoordinate),this.tileCache&&p[f][1].tile.isRenderable()&&this.tileCache.add(p[f][0],p[f][1].tile),this.tiles.delete(p[f][0].toString()),++f}else a[d].lessThan(p[f][1].tileCoordinate)||++f,++d},t.prototype.createTileOrGetFromCacheIfExist=function(t){var e=null;return this.tileCache&&(e=this.tileCache.pop(t.toString()))&&this.updateTileCacheFn&&this.updateTileCacheFn(e),e||(e=this.createTileFn(t)),this.tiles.set(t.toString(),{tileCoordinate:t,tile:e}),e},t.prototype.getTile=function(t){return this.tiles.has(t.toString())?this.tiles.get(t.toString()).tile:null},t.prototype.update=function(t,e,r){this.updateRenderableTiles(t,e,Math.floor(r))},t.prototype.clear=function(){this.tiles.clear(),this.clearTileCache(),this.renderTiles=[]},t.prototype.clearTileCache=function(){this.tileCache&&this.tileCache.clear()},t.prototype.getTileCache=function(){return this.tileCache},t.prototype.getTiles=function(){return this.tiles},t.prototype.getRenderTiles=function(){return this.renderTiles},t}();e.TilePyramid=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.unwrappedTileCoordinate=t,this.tile=e}return t.prototype.clone=function(){return new t(this.unwrappedTileCoordinate,this.tile)},t.prototype.getTile=function(){return this.tile},t.prototype.getUnwrappedTileCoordinate=function(){return this.unwrappedTileCoordinate},t}();e.RenderTile=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,r,i){this._minX=t,this._minY=e,this._maxX=r,this._maxY=i}return Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t}();e.BoundingBox=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._reference=0}return t.prototype.retain=function(){++this._reference},t.prototype.release=function(){--this._reference,this._reference<=0&&this.destroy()},Object.defineProperty(t.prototype,"reference",{get:function(){return this._reference},enumerable:!0,configurable:!0}),t}();e.ResourceReference=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(13),o=function(){function t(){}return t.get=function(t){return(this.images[t]||[null,null,null])[n.MathUtils.clamp(i.MapUtils.resourceScale,1,3)-1]},t.markerDefault="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA9hAAAPYQGoP6dpAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTAxLTIyVDE3OjI0OjUzKzA3OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTAxLTIyVDE3OjI0OjUzKzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wMS0yMlQxNzoyNDo1MyswNzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxZDg1NGY4Yi1lYzEzLTQzZjktOWEwMC02OGYwYzRkNWYyODUiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiODVkZWE1ZC0yYWNlLWExNDktYmI5MS01NjVjNGY5ZDdkZTAiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4M2MwZmJlYS1iODZjLTQwMDItYjcxOC1iYTI3M2MzMmY5NTgiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjgzYzBmYmVhLWI4NmMtNDAwMi1iNzE4LWJhMjczYzMyZjk1OCIgc3RFdnQ6d2hlbj0iMjAxOS0wMS0yMlQxNzoyNDo1MyswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxZDg1NGY4Yi1lYzEzLTQzZjktOWEwMC02OGYwYzRkNWYyODUiIHN0RXZ0OndoZW49IjIwMTktMDEtMjJUMTc6MjQ6NTMrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6UtMbgAAAC9UlEQVRYhcWXTYtcRRSGn7equ5OQheDCqBBcmJWoIEIMBoKMI6Kg/gFxI8YvBDWgLiKJ+UAiYsCFro0LxY2I4EdiJgYC0Y0wGDELESMEiVmIMmqc7qrXRZvEHqu67+0W5kAt+pzT5336nqrTt2Sb1bSwqupApxY4f+dmDCQlQgANAkEiw5zQPZJvN94EWgP+A8IZQjqBwxGZw9ngmMkZZOg7s3Hhq+YABbsV2C8xD47DxumfkK4AX0MOW4AdwDFgJ3ByUtGmLXiaoOMWdwNxQq4Mc4gjwDP/B8BzMceDgvVNSC9RwPqYw2vA87MAzHWIL017Tgx0iHuBO6YB6EnsB9ZOqX8RoxvQAWBdKVrdhClwXzRbqmXRr8BHOH8vsQl0F3BlKVfS5rXuzAMfNgaQfe/lXb4ihk8NiA9G8uJFX8Y3Cb0ruKEILO4vAVRbEOGWSmiQc3gcWFzh/zo6PQL8WaG+reSuAhhtrIQWbX0RknEaPqFOyvRSJmROYp8q63NtyT9uEJVj5pfQzQOl4QcHkQiAGPT6Dsvxt3Lj6Jac407Bz0WvuBmoPZ2rJW6sxH5qBWD720roKjL7+O8v6sV+91VgQ7Ee+qbkr7bADguSH6iEHzJcL3gdOA9sMDwMzFfrZZ1oBRCUDkP4ndoIFluNtmKwKl2/bEvgj4s6Y750WvbxSZWbmK0F4HQrgBxEChwE0qwAcn4zkIuxMXMADEcNn82o/6VD+NyhLDXp39BZPjCDeN/k3cCFWkKT94Fjtg5NJW/eAj4Zl1IF6CZfWtHpRSqDpK6tc3/lNfuW0zqWU4/l1GsHsMJ+NH6hJcAe4MykvDav5YfA7zUStz4A3miSO+YYji4Nz8Wz4B8m1PwO9KQMvdAfWa0AKnZWicds1Xb1hZzDU8DZpgWnuRl9atg7nBSjZrSLCbu+MUDOsbiSApiXbb09Im7eAV5pIw7tbkajejk8oZCvQ2yzOZpz3P4vmMY2y+V0KZvthvdNeBRYmqaIVvt6/je+DyExBbNQBQAAAABJRU5ErkJggg==",t.markerDefault2x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTAxLTIyVDE3OjI1OjQ1KzA3OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTAxLTIyVDE3OjI1OjQ1KzA3OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wMS0yMlQxNzoyNTo0NSswNzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM2MyYjNmMC00NTM4LTRhM2YtOTNhMC1hNDEyNmZjNGNjMTQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0MDZjOWM2Yy1jZDdjLWIyNDQtYTU3Mi0zNjQzOTllOWJkMTkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpiMDNkZGZjNC1kNTE4LTQxN2YtYjUzNi0zZDJjOGUyZjY3ODEiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmIwM2RkZmM0LWQ1MTgtNDE3Zi1iNTM2LTNkMmM4ZTJmNjc4MSIgc3RFdnQ6d2hlbj0iMjAxOS0wMS0yMlQxNzoyNTo0NSswNzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDozM2MyYjNmMC00NTM4LTRhM2YtOTNhMC1hNDEyNmZjNGNjMTQiIHN0RXZ0OndoZW49IjIwMTktMDEtMjJUMTc6MjU6NDUrMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5Dm+KFAAAHV0lEQVR4nOWbXYxdVRXHf/91zp1pwUpDiDHSgKjBD2wVqdaPxAcVAkF84MUYCn4gNBGMogajoIEoMSRWsUpiLdqYEE0UtGnqR9FGCkUxRopofbCxEFpREpT2QdqZe87++3DbMm1n7pmz77lTE/6TlcmcWWvtdf77c+29j2zzQkbZ1uBfl5x/zN9FLSKVWEaIKfcpXFLPIDYEBQWCsyrqVYEukPRqo3OEXwK86LDqAeA/wBOyd1naqUgPW9pb9YEiEYi6hokiqMo+0Z8gDEbUqjlYV2hGfC//zc5uCcjAEsGlkt9veEtJvOwINeKE1rcEWAassPQ+AKf4h8QjwhsN2xkQ1BnGSUBZSKslXRew8sirZnS4M23OLEKXQbHL9jrw94CqiyCjCyezYFUZsTWkjZrx8iPDnCe0vhexzfitXbjsmACrVHwixDbBu7r1fQzeiXWfUnycEVtxlwQssrUhXNwBOrVDv3NhSdTFOg26w6JcJx2NAV4MbDBc0Y2/VriSQUVeAxxsazw6ASJA6+2T8vIAWL4CSMCHgbqN7chdwNZn0qAWTiqEr8Tc0NZuJAKiKt+uVHxxFB9dwUAh3bY4ehe2sRuFgKWyvgEsxIA3X0yEWCtYLIHUbJBNgOpiDbAy135cECxf1Cs+ODkJk5PN+pkE6KWRYk2e7fihFDdMT7N0aqpZtzUBURVEVVwEnJMR22x4DtgPPAv8twuHgnN7lJf35jHJtSagrwDrQzmBzYRhh/A1dV28se/eMuFlJFaAr7X181H9l9LqSauRgdYE9Or0esEFeWEB5gBmjeX3GO4CdjOo+eeAPaANti7FfBSPlPm9qRKvalJqTUCJVwIvzonI5pmUdDHwHWBoDzV8N6V4by4JgtP61G9u0mtNQKVYnhMQgMWXQQ+3MPmd8S1ZZQGTxPlNeu1nASuPALMzkr8dJJSMhuTIlklhXCRSsN7wx6wypfOaVFoTIHFWTiyGnyKmCOMAmGOVYhNORDr6e1r25pwyEWc3qbRPhswZc8U+DCEf0/SFCXw0czGQZJBP4Mb495FTKJzRpNCeADGP9dUJSHVV/PP4h/XAH+FETUGCWffMBPtCKdG+xTbGmtMC+jmVocKLjzczg8o2CYav3U/BWU2g36TQfhAUBzICCVMvr6g5IoOfCqtGEgJk47qmJFHMFPt1zDloDEXjFNqaAMO+tjYCElxyKNUcSjVTqaafEiBOPJcxqaypi4Gksobw5W3LPBzr0006GdOgd2cEQqniwkUTeoMxiyaCU4renPrldI9qShycAietUoqLWscJCP+tSad9C3DxWE4w4NOKVNxZKua9f1BKpxZ18S0yNz2dikebdDLSYT8CTLe3A1nvWBzlDwMNzSQNFGjZ4ijvEcrdc6gs/7lJKSMX6D8me29eTABcFnX8GrgaOH2W/58OXt2L4lfAxfnFaB/okSat1tNg4P21/FvQK/MCA8MrjO8qFF8AHgU/CfRDOjeiWG7UuIJrLMN+wEn7m/RaEzClSWRvCnnknWDB2TBjuerDTzuArXuHJhyH0T4XMGAeAEbpBuPG45Ie0jxerzUBk55i0tPPREr3ZoU2ZgionDYf9PS/p4ZvOQA5+wERVBHUwQ/o6Ii6YxzCxcbCBeGiUbn9nmAE/QiS9Afjn2WFOEYY7g/iTz2V9Jq3BDPGAJ4fpgzfZHAm9/8CG92pSByRJrQmoEg6KmE9aPNQVqhjgM0OYGsbm1EPR6cFa0f00R2krzKPFHgmurggsQWzrQM/o8HcD7Qek1oTkOTjpU7yLbRkvmNUlm+HVA+GpJkyHDn7AbPJDsymtr66gq3v2/zShuOlCa2XwmU9+1LV8q2Id4NmS3DGiQO2vmbnXXbJyQZnlZ6rXUrekBXFCEjWOlt/zbXP6AIaJrcDjTl4h9gN+vooDtovhSnnFKxnSb6ZhVkc9VOK65307ChOWnecXtNgbzZPU94tdFVuUPOB8d3I980n5R2GsVyVlf058N/H4RvA8HhCN/voSdIQacBYCJhI9VPYNzrrbnQjbPNZ6uIp1QVN0oRxXZYmnH4ip41d+60dGyv3flxTUM1DmjCW6/IGSpta6fOV4m0yr+3I8V/6aeJTfXqzfWuQhbG1AACjp22voeE2yDxR2fokcGDoRHycNKH9pmiLw2EnATzoSF+R8m56HEGyvmTHth59yg43osbaAp6vhXQbpC25fgxbGCyyjvF7UlrAZE5rTlSJuK4KrZDc7oaJ2ZMcHwN10Y1OwFhbwEwYPWl8Le2O1Q4aXY+1dywTKt3nAkMF2Aq+qUVxNxn9om2MbTDWQfAEJKhhbah+jYKrh6na2pBS3JFf2PywYF1gBoz5tGHO+4KWH07WjYxnJXkMMrbFR+kER0fmA+CrwLPdNtljxweM9o9eUvM548LMArOhZnelYnUKbRIsHTz0/qm06CN9957oaqXXhJPRBYDDn81a26l1zdGHSWtsbV/IOBbi2+E5Mbgixz3Gt4YF5kcLHsML/fP5/wG9iVkz0V9YmwAAAABJRU5ErkJggg==",t.myPosition="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkbBDgFfaxCbgAAB0JJREFUWMOV122MHVd5B/DfOTNz7+7e3bUNduzYKDgkJqYiNkENsopaAYKELwiVEkAExIcWaBWpVUVIQFQJQhWUpIX2Q5F4kxAKLyIIVMGHBiMECFAgQHCCxOaNoCQOcbxgx3vv7r1zZ+b0w8yudzc0kEe6Gs3c8zz/55z/83aC7XJ9okbAguCVkl8IHlPom1cayMxL+shAUGGCNbkVpaFcJWiMBHOSgAYfCVvg2rdrEi/pTBSYYoSv4W3mlHZhN/qCptNN21wPm55TwRks+wsjP+5WZyixEz/D7aFT+uAmWxNBKUl6ggv0PVdjtnMrbQL6Y5J3cE+KTgkqsfu6LjeH7vU8frAgqfWtuVhtUaPpDIVnAa5zOGK/ZEHmNxpjE0EjdeQJ3p/aZaE7/hWLCgc7juvtoHkUFmfEXibkUQiok7Q2lYalZlo/jRqIoqnKQ3ZYUQtIGnJF52eDYEbhBZJ848u6hcBcT6xKze9/5JyHlU6qVdgrOmomHDY7NyMbTzXNVjcajVzmYmP3S8YqLJOrNqByled34BvqAVkmNBPN8KfOXf5yO275L3+zf9FF8z27Y5CNK2fvO+3em467857vOxMu1s9nZHUtbfIjSfpqBy16SG5qluAfU8vJvAOS/ZuiXAgMcnF4Wnn5IYPb3+7dz9vhVbOFvTEoNm8xJZPVqdP3LfvaO2/3lZ//ysr8BfqjSrPJiyTIBY9b8JgkBO9LMI9DHRkbMl+Iwwet/sd1rnjXlW4a9BwKpEklnDyneWqiidg5K+6bF/u5lJKwOvXAp+/yoX/+b3fPX2puOD2/KYQuIx7AKPizxOs9X7Kvi9wARSZMTyv/8x2O/v3LfLSfuxDNN5f4/N3C8YeEs2fa2Ni7mz8/IL35CNcelRAnld9+8idu/KfPO1Hs1tsUnAk9yaPmnAxuTH28SFhPjPbo00Rz5CKDH/6DT8/3HEZz4x3ird8lleiTdRp1ZaNKvPc13PJaDeKwtPSyT/jbX500DoWwOSAElcxSVJizjc+5QvQbk8+9yTWDogW/4X/FW+4gRIpB+6yb9hcz8lmKOW79Fjfe0ebVoHD4f671LvcYDXpb6G0DsjKIaoubo77IhNFY/eK/tOvS5/jrELjthHDrcXqDlqBpbUt4N4mqoU5ks/z7d/nGkhAC+xa9YvfL7RyVmjxuKdeNrHVgdkvg9URL1v71KscW+i4YV3z1nlal6cD+P2kSIaMp+eLdTBsW+g584S1ene42WpzZGuSmFmLL5vkTmC0EJ4wv2+Ny9E8NNXedbEl6JvB1qZvW4rceEh49q0F+4aKLPGzay7ZU1STTi+KW9iALglOamdxOOLumeXyZLP/THEiJPOP3Z3hq0qbffN9uJ1WbKNhwIW6v3AlasJr22KVn14VSx/L6eQcy1R+2EbUNZ0OqRnJANiwtw2Jf3LWLqm7T849JDG1a7t/TFigYV87aK9Zp23aDKgomNjlX1pKL9Z445xFUF+0Ur75EMiGLf5oDply5X9o7L2Jy32n3OmpmbWp7JZhEteFmA+fGmnCFwbVf9u2ViZNF5K1XEHukugN4BvDYcfDGI8zkDEtP/stxd7rM7LDcUpLJrEXBSBLXqasaadATl3/o7BPnfC8lXndYuv4V1GtkgTxudSQEiqy1UI7aavi2o1JKPPg7X//l950ZzMq2zQoBK1E7/W2hYVRqHDF4/W0+NZpaQvzo1Zr3XsV0lWqNpm4pySKpYTpqnzdcfb4Uj6aW3vFVX3FQf3W6bfdBKRplXvXBWi0X7LJpAioK8dSj1i7c44GXXOhYHi2+5lLNoX1MAyulMDxHM2XnIq97sfRvr5WuO3a+GX32Ljd/7rhHih2K+jx80s5ey+70u+ADCQYah7YPI+vt+OPXueKdV7pprnAohLYdPzHUnF3TNNjRFw8sdu2YsFo+Yzumze4HMAxu7gaSVc+T29/N+GGd20EuDp80eelhC595sze98LneMFfYE4L+FovJdG3q1GNP+c41t/nkvfcbze/R2zaQEETR48ZOthDvSTrIwoxLsNB5uBEpWSbUY3X6tcmRv7LrQ1c5dtkel8/kdjZJPSwt/3bFIzd8yfF7fuCpeNQg9sVtIxlEjRWFBwWVmuDvUnvlaAvyjNoLJT3bLh4xMFOIa2N1WrLmhLFTGjkOyBzUm3mpQd4TV8unDaXre6+sWZIbQzsTXt/V2SjIJGMLCpd0M8J27hSZMN8TZwshC0LqUrespXNjTdU8bSxfvxNNNB42Y0Xdfd0o8R9I7ZKmc6I2o3ZQ2qDj2dyINgNHRMmKsV+rTfS6i0nEx9ZvRr1OJZNUqI3xoMwFanu7FdWzAA7oaYyxrO9JPaUoKLZRC37ZqZXO35IylWMeF9yPJ7rsWP/3D53G+vdcUmk8qnS/fR5TKq1iJDndrTpxXmmrvH9T7y07SpKokKvMyyxIZtV6oqJzvZYpVYaSEYYmpk5LLhOMpQ1CPrwV8v8Ate8QCQydph8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDktMjdUMDQ6NTY6MDUtMDQ6MDCDT2HeAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTA5LTI3VDA0OjU2OjA1LTA0OjAw8hLZYgAAAABJRU5ErkJggg==",t.myPosition2x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAACxLAAAsSwGlPZapAAAAB3RJTUUH4gkUBQweFUICFAAAD9RJREFUeNrVm3twXNV5wH/fuXd19ykJS3bAGNvIBhsD5U0gODhuHm1pSwLptBATpsFkOpOhbcqAY3AypdO4Ce6YtgmZTFsa2gKFdlJC0pLQhkDBuJDyKAzG2MYP2RgDlmTL2l3trvbec/rHOXd3ZWTprmwX8s1odHV1zznf63znex1hunCHgQgoAhVgBiAIeQwjQAfgIYwSIGSBHIY0kELhAx4G5WYzQIQhRKghVDGMIoyiqQEGATSgEARDCAiQcj93yLTImN6oWw34gGqgLngYUu5Zk8fQjSEPpLFfx2AO+304Lq04hUAVQxHDIdKUMBiKQICgHCNwDF/bPjntjbjdWClo97eHoB0hHaQYowehB8g69rR+HRM81ZqHf6da5ioDBxAGEUI0VjcUpjFKAX+WnKzkX95iLFnaySVeDHwMJ2LodXIw7ivTNoMnZ4q0MKMK7EcxgCEkxOpYBagDvcCfJFt66q/uMFDD7nfBSr2EoQNQzEQxG6vmkSP8WBE9GTMU4DlG7CNikAKGIkLgtCECDgB/Mzk6/lSrUXO/PUAjgCFHGsM8oMsRXXeEH2/icWsYt2YK6MOjhwr9KKqECL6zR7OSTTYxrDHNpSzf7V6L6HHE+9Cwxe8nGMBHCIHd5BmichhmBvjmxGiqI06raSp1DTgfQ8gpGBa4cR8E4nE4hBgEwwJGmMM8rD1QNC3HJIPHwx8Zq1jxwK3ARxCGOBXDTJrq/kEEA6QQBgjYxZA7iGOIgHXjUX8vbwLsfo9lfDYwRN8vAPE43OoYeqnSRw/CGLHxtmfUBAOacKuxnl3B/bwLFOiDY0e8pyClEE8h4mYzBiKNqWtMpI9ufgdNTZjFTg5gpR8f0i1HZPPpdmMlngfKDfM3B+HkoyFegMBHsilUXWPKFSJ9kJAiETXnJKVR5PHUCfi5DJ6vkEodXQsxZjqLjmfCPmq8iYcwG8OA+69zlprHoAYyQNW5tZpeYPZ0iRegEKA0UNpLdWwbNd2Fmn0hnb9yMSf2nUChENAhAsMVaruGKf10E4NvPc+IKqH1QoL8HNICFGtMRy/i7XASaSpEDPI2wqBz2cZpwBpj1aNC7MpkEM6g6e23xfdcgBKg/DIlo+HGG+j7wnlcuqCXSzoDFnZ49HiKXAtjdaQpj0UMjVTZvvMAz9/zEhu/94/sVArJnE3OaBitT5MRgsbjdYQKGtgL9AB3CdLw9ADeAeYCNRYDnbR51Ckgl8Ub3cFoVER/bw1Lrzid356ZY6kSgonZ1SKIFtCG6kCZjd/fxAM33clz/gz8zDwy5QrtmgnrJ8AhtrKV24CHsL5rCMIaYw3eQbfvhVnA/LaIN+D7SN5Hhp/m0C03s/jWj/HlWXmWt3wSARiDGBBjxs8tglG409wu7MVDB8o8fecT3LX+LrZ0L6OrFGLCENPGxoydpX6E/YBwIoa3QFhl7FKW/BSGJVhPIJnqG0ilkHQdU3yF8hPf4drLT+UWT8iaZlCktEYQ8KZAOjJ2hFI2qBLnkUSa0oZ+7lr+JR4snEuumkLq9baYYG2CYjPWNoAHwq3GBjgW0dnAnMTSd8R7VXTtIPU31nHbghlcC2gDRsCLNCiB+Mg7VIVtg9A/bJ8ButMwpwuWzILOoCkyre2xaSAS59e9McQDZ6xmXaobP0qj2mBCvBX2IezF2MSKcFtD0D6GM9uRvuchfogJh6jvXs83T+7k12JkjUE0VuK1EP59C/zzq/B0P+wvgqnTDKt9u+qsAiybD9edC796OnR4ViMUdosYqxHeWyP8ZN7NrPZ7SYU+EkWJDbW4VTcDY/bFahNL/0RgHgmPPQHyAar4PxTfuI81C3u4zhhCEXzt0FECP9oCa/4TNu0BMWBSVvW8Fq0wxql+BFIHo+DsubD2k/Cbi606xfPFa+wY4oGF1/P1wkUUSrXGJ8m0QNiD8A4gCh9DgGCzeonj+UIGr/gUhzbczTULe7jOQBQTrwTqEdz4CHz672DTXvAy4GVBfLtAZCDU9idygaf49hsVwKtvwpX3wI0/sBqkxDJCBN9AtKCHFRu+zTXFpxnpzOIl1IFY2D3kEDowHkvvAE0nhpMg2TmbSaHKe6jetpLTPn8R65QQCIg2iBIYKMMV/wA/fBH8jJW4NiQSkzYWQ88HLwUvvgFP7oErz4B8h/2/Esuv2V1c6M/k6cc2sD/TS0eYbCsYoIMxRggZUy7s7SSh0yNOFRkh+vLH+ENf0ek0WJRANYSr7oONWyBVgDAh4YdDrCGpAvz3Vrj6fqhFbhvY3RT5ivzvLeMmKug2sjFxRqkbQDEKCAUSqn82QJU3Ub73Vi6emeeXcdY+dtr/4EewcatFvB61T/jhUI/sXM9sgd//oaPANPwE86E8n3joKywdfYVSLpgs8h8nQw3k+Q9QpElj/aIp1V/c4gBXnMkKt6F0fNQ9shn+9lnwcseG+FYmeDk79w8227Uiu1U0wPJF/BamrSysjXw+RUahyJIkN4iN6kbfonrTdZzam+My91p5CsYi+PrPLAZHEcEdEWL38E8ft2s5h0oB9Ob46E2/S195L9XAT+waeRiyCkOudY3JIJNCsZ3a5y7gMiVkDETaJkp5dCu8uAe8junt+alAG/AC+N89VgsAtLa2QAnpa87jUrZRy6YSbQOLoZBVMGGQMiHUNYYCasEMLmy8dPx+8BVAN8/24wHiUH940/i1AU7r5cN0443pthQwrZBGnmRS1D0FpQpR94V0FgIWOj6KJ9alfaofSDmH5jhBZFMcPNVv1/SsYyQAhYAF3RdQKFWIvKl1IA78UspOOTWkFMJBwqvPorfDsykF7Zi2ZcC6t9YuHz8GxAHMu0UbT7hXAtDh0fvZs+jlIGFKJbYDflxhmRJtTyGUiOZ1k/eUzbXG3H/zEFB3Ejne9NuYjv5h987h4CkK82dQoEjkJWOAscMSnhwiQBXdnSFgfMmE4So2ufD/kC8WF87EkWQLMRQ66KCGbgMPlcRijl9pAhEfT6m3zZw2IS47JyM8QBXHbBhJi+Z0uw6Ao0nhJgXjovru9HjaATNcoUYa1QYeRtGs+04KkT0Cvf4DFCNNEWyMDjC/m8YJcDx3QRxFkoJTutw7h0OkKe0+SIk8XpTsKBQgUq6oOCXUNYYT8P91E4NjEYNuBgNwei98qJCUlUfLAZs4WTzTvlIOh7GIwYdfY5Bu/HpyX6Cu0I0EyKSDIg35DN7wixSLNXbE3I8MdKVtJic+CY4XxCfAsvl2zch6LwZgpMr24RcYyWdtGm4KiP2eMYVQnfJzBx0KYZjojSF+Pm4q4OqzOG5xQGMpF8hee874tQF2HOAFiug2fAAw1BSaUffnlANH62hOJ3joJZ7VhqqA57K3XLUEzpsLUc3lC44xKIFoDM6fC7++yL1TNhTXhsqDL7GRhQSVZMWTGMOyIkU5qR2ohZjcHNJ3/z07B8tscK91ZGwC82ufoOmaHWOI44CvfdwlSy2ZGmCwxMa772dX9mTStTCxEoYYRhU+VQxVmDqKagQMAk9u5fvuUXkuX3fVEvjipRCVIeVNNVtySHl2zi9eCp9Z4iJDZdc2wI9f45/A+gEJqbeNVnWqypXFSiRMiZVr6Ow55K+5k2feLfE4Lj0VOyHf/jQsXQz14rFhQsqzc31kEXzrSvvOERoBMlDiiS/8OT/PnUVuNFkR1VoSoUhgH0AxTMKUmIm5lEH99VPcHWpKruBjtIHAg4evswjXizbamI5NUAK+2DkuWwyPfB7SvssMuzRcqBn5y//ir+jCi5OpCcCmxAyHEFDUgTFKwCgJtgFApYbuWkj2j9ez5bl+1jvG6Dh1PTMHj6+ElZdDWAE95ghSVnpyBKzEfeMpOyaswcpl8LOVds445R6nwp7r5y++sZ4tnfPJJDR+OBrLBJRQINzuCiMRJyLMJWFZrFEYeZ7i9vv46oIZrJioMPJvW2DNT+HVPSA6YWFE4Ky5sPZTcOURCiPbh7j/tOtZO43CSAphN8YWRoTVjaEdwBJsfrCt0lg0RL2/WRoLXZa4URobi+CxbXD/yzaZsb+IrT+1lMbElcYunw+/80vwG4sg8Ccuje0b4SfzbmG1N2NapbE6wmvx6rY8HrkObMMcbIG07eJofZjw9TtZddoMVjih6kZxVDUnG6nB5v2w95ALo7Fe3bxuWNRrn2OtiK29qzcKoHYc4MHTVvGN4ARS0yyO7gX2YX1II3zVtPrwKfRRlMdfpvzkd7n2o/O42SVNYts07fK4FT4qMpQ39LN++Zd4sHDOUZTHhc2IK49HsRG0RTFBU0fzNu20xgjU65iKj3RfQmH5DTzwlUdZMVDmKYe8JyBKESkhMgYdGUxcF2ypDxpt0EqIlLISd2PV/jJPrn6Uzy1fyQPdH6ZQ8dsmPj763sZQRyN0WTHbBgkf23b8GeBbwEIWYfuA22+RyeBVdlMJDxB+ZzWXfPZMVszMcZkS0hMMmaxFpjZQ5pkfb+NfbljLM14BlV1Atjw67RaZEU5iCw8DS51uBfHCNxsYxnYDWpQyqGk2SQHZFEoEKq9S1gZzw/X03XgBl/XN4KLDmqQaN0YaTVI1tu8Y4rl7X+LZe+5lpwjkziVvsE7YNPxse+4rXsdQAccODayVlulWuU6xyIXGml6Evna1oBUKgXVVS3upqu3UdB518sV0fvJMek/tJt+dITAGimOM7TpA8bFNDO57gRF1CK1Pt21yCtsmN80o00rfsBMYBNdJbmj0CY5vlKxjGyUr7lTQnIJMv1cwXiDwkUwKFWpMeZRIDxNSIqLqnJcARQFPdePnsngphYweq0ZJeIuQvSiEHgzDjOsZfm+rbAnbNZbGPnf8wrbK+sAgPrug5W7RYVdq3kvQ6vjgAoaAUxDK9GEvonzQm6Vj4lMYBonYQQ7bBxkHZoddrHqv7x+HRAY4AesuVNnpumyT+wfvL/EDjLCTc8GZPUvX6HsHHFmacfeYwdqFV4H5zHE2Ib4N9kHRhlhnFfA2r/Mm52CP9hjDOydG1Z90yljWRaAPEPaiqcAH8MqMzfDsAoZYjFBx2Lt64pFgauRXmVZvwN4bgjSG+dh+4vdLG1qlfgjFbqDaOMbjL9ZNjtbU8f8wzVZacf2VEVV8tiLsonl7a8rU+jEkXLB7vY5hFz7bON8RH2AISNjz0u7FyTzNS3Ka+FKSj2Ym9pJa3Gt0PC9OCrbLcxDhHRThOIc6boFKeHu0PQRXmfHdBLG6NS9f9GKYAQ0391hfnR3FMITHECnq7labje2k5at17YWI7cMaQ6NE6jskahiy2MbrMfJAl2u/O/rL09YlG6ZGiarravIblzhj2w93Ty9QmB7c4VznOk07bFxa5SD2+o0gpAjwyAJZd30+QBp3z2MbZNs1DSGGOh5VNKNoygg199amaorYC9vxTbB4/Tak3gr/B00sppUy/FK+AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTA5LTIwVDA1OjEyOjMwLTA0OjAwxqW7kgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wOS0yMFQwNToxMjozMC0wNDowMLf4Ay4AAAAASUVORK5CYII=",t.logoIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAACdCAYAAABCWoqsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAFxZJREFUeNrsnU1y20iWgNOK2rd6PxFNn6DoE5iKmL2lE4g6gaTFrCWtZ0HpBKRPYHo/EaJPINYJzI6Y/bBP0IMnPZRZFAECifwFvi9CoZ4ai8xMAPnh5c9LYwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgV3ygCfzzH//1P+Pi16j4kd9/099Gf58e+fOV/t4WP38UPxv5+d///s8VLQsAAAjdn7xF0JPi57MKe+Lx6zYq/B/yu5D8hisAAIDQwV7iEn2fFz9fPAu8qeC/F3JfcmUAABA6NIvEp8XPpfk1hJ4SMkQvUn8q5L7migEAIHT4q8gnKvFpRsWWyP1BBF/IfctVBABA6EMWeRmNTzKuhsj8qfh5ROwAAAh9aCKXufGZeVul3jVKlp8f+n+vSslWDYnr6vhyFXz5IvFZy9KlPIgdAAChD0bkItC7DhH52vx1BfrWcfl2V9PLb5t5/FexF2W754oDACD0von8VCPyqcWfyyK07ybCXLWWu1xpf24xenDF3nYAAITeF5mLCOfmeLKX/Uj8ySS04GxH7tctI/elip1heAAAhJ5tVD5vGdkuTAZbwnQe/rrFiIPI/IJoHQAAoecmcxHeN9N8kZmI/CG3rGya/OauhdhlwdwtjwgAAELPQXI35m2+vLci7yh2GX04YwgeAAChpyy2eQup3fZtCFpX8cvLzLE59q1KnWxzAAAIPSmRyXy5DLFPGohMIvLHnrfHjUbsp0fa4or88AAACD0lmT83iEpXKrDNQNplpC85x9pF2mTBYwMAgNBzkPnDUBOtFG10r9E6UgcAQOjZypxhZdN4Lz5SBwBA6EnKfK2SYuGX+XMr3/xImyF1AACEnpzM2Zpl13ZIHQAgEU56Xr9j27KQeQXaJmfaRlXM9VhZAABA6N4izHtTv898hcyROgBAX+jlkLsu7PpGZO6sPRl+BwBA6MHlMyp+vZjqVdrIHKkDAPSOPg6512252iBzO3aG3zd1bc/wOwAAEbqLKPLeVCdGSSYnuW4Lk5eOSU1ZpZyb1LLVadmfTf0+9du+p8wFAEDo/kQzKn79rPknUYaDdahaxP3FvA1Xjy0+ZqWC/57CITEahc+P/LNFUdYrHjEAAITeVjLPNRFv8LO9VXoi8XPHHy3Ru2Sz+xpT7kX9ZEvgDVIHAEDooSLGYIvgNBoXyV0WP6MAVZe6PUUceWiSGx+pAwAg9MZikaH2qjndTyHmzXX+/trUzy37YmPephRWgdteZP7S4J8idYAeov3vS4cA5iyFacS+8FsP6nBTI9EH3zIvbuiJjg6MIraBfPdzURYZir8NtZBO2rb4zgdz/IS2afHvTF+kXtSly/XexGgHnSIZd7jWZ3SXcIC7GH2fTrH64sdOoLTJ6YUj6wj9SHS+0eh86/H77xvILDRBT41r+Ybei0j9yHqNJnwKuduiwYLRJkIfzFHL0Pi+OpbAy1uEXnz3vwNXd6WiX6Z8iFfu+9DrovNbXzIXiWmnfpdgm0h7fNMoMkSULm3cdMHhNFS5Euc68PdNaXLw8CI/pGd5ov39S1H3nxLM6YsyQnd4Q1V1jCtfEerOvPEk8SYSeT5rO/mW+lLfYJF68zYIudbiEgWBY+oSePWdkcpdxD5PSew5R+i1c+ceZf5s4s6Xt32rfA4kjzZtjtQDRc26A2RkANzdU9L3ntMSfz7HLzr9itA9RB0rH4sYGmZIS5FxCKlrm7dp96FL/TrycwJg0w+W0Sn8QvrWu6JtXtQTCL3lTXVeE3U8ePi+13lpk+8QU/kyklKUPnSpj3SHhO/Od2IA3JFzPxgqeJoidDdRx9rTFoOchtkrbzbf8tS2b7sCdMhS9x09XxsAdy+I96bD1scBRevRDqk6yfCmkgarmr958vB9sx7dxNMAN9qTZbmGKHXfi+OmBsBNPyh9IEPtzYki9Rwj9CqZb12nQNUh0Zue3Wgzn6sy9RrYbBccrNQ9dcBTw9AouAuivtESVlIPungwx0xxVcOUPrap9VEw5f5Rn5m/lpaimmokMKQz62VY/DHgc5Ji5Hd64MVw1XNJTiqCkhSTlkTJBtcjqa9DZe/8LbOHoO4M8SfH33Xf45t4IhGcx0NdnjpEnuXCkqFI/XVxnEuBpbwYTssmUcuXujJKqmDzlu1R2qXyZEHLKbGvx+59fdGYta1fVYpc/bxLrfP4SL2lrt/NW1ayTeTrJdeqL6OUcs3/eeC//77zUjly3O+XoxufEPoBEVX8943LN9sjSWv6gmyzWPqQpuZ433R4MIYm9WvTbstfk89LMRK/bvmiN9J/P9X76eGAiMcWLy8/GnbEEwf1nmiE2+azJvoj02MrrfcqwjXrWza4RkdO7wSO5fHXXaeuZEHyTfHdj74rmNsc+peK/+56uP3GhJ9/DC2ukec3767XJMj++UQ4d7yuYZpKxTRNskS6Lx3LJe0zD5X90GG9u+b9n+hz8C1CvQeZDU6CCMl+KedOFD9/N2+prbv2z3chrl9uQp90eONOPTpfRfhOn/OsLq7JkKQ+dXT/TlPphHeSMd047gN+xk7g0aAPcV3v85D1tswG99DHB1Mj648dg5RTE2DqIhuh60MyqmjwpeMHJ0aH+CPCd458ba1weE2GIvXLxD7Hlcx9COhU74nkpL4jc5/1PvdcB+ln225Rk4Vf9z2P2i/M2zy8Lde++7GcIvRxoMg21vyjrAHYRPjeLxmMOgxB6qOuHXUqi+ECpUku53dTuye+Gb95K8rTFMee69C2Xa/MANDjnxcdrp3Xl7GchD7xHdlqhxjrrX8TSejnHveluxx1GILUu0bX0RfDBU6TPDbpJX0K9UL17OO5tcwG95DyGeEeuDXtM2KGCKCyEvrvNZFtbg/joTe/WEL3WW/XD3nfpd715WqaQB0kah4Z8I3zZC+W2eB6PdRe0VdvVeq2z7i3/usksxvYtzS+RKpbWYd/Rvr+L57rhdQ9SzmFxXA6ZcCxmuEY6+I1F9fO9gXhaogNb3G6ZJDAMfshd8eJF2JF6FuPAoxWb49JMfos9cvAf+eSmYHQuNoOZZMNbmhD7fvYJjP7jNA9R4D6UMQSxI89sYfm1OM8uq8Hvq9Sb73zIIXFcFrmkYHgz67puB3KMhvc4IbaDwQstjt5vK37yELoNedGuxRgzMU1sSN047Ez9vmSkpPU27RD22j7LoHr4WpBnnSSsp9Ztgid6f9emvypqpeL62E9OtMhG9wgh9oPsErJNb9l3pguBTiOXQ9ZbKG5nGMwMX6S26w9R4+5pIltc2CN5NofNZmyOHKccNdyNJWCi9Xmkrzj4cA1XO3U88bkd4RniHq9bnm0jBhttv4Nfah9lx8W/RuL4ir4l8PPihnlbTq+8Q3lGtVJPensYeZtwWObTrBpxNsmEZJI5buHunWZv5cyycvYbd0LmSb2uDdvh1zkkN8/dL1aL2y1zAY3+KH2mr67TduPhiz0USbllA5bhtJkS8OiqZwtFo9t9bMfd75r07HsnzN/sJLNHrZDm0U0TaPoNkPdroZ4340odPjbszYHj2hkeJbB/Whbr22Ia2CZDU5gqN2B0H05LXehbxIrZ7mPU96W5WQfeag/6Nv3hcp+tVfu/ahtPxnLSoX9oA/83/XAgAuNfssTrEY9u+G7SD3VtmgzJHp6bHGcxVD3d4/3vQ1WQ7f6NynnDe9SL1thjlre9zbJfxhqT5zc59BdyuIfjiOWyd7Rh+vdDl3nzsYHHqpVKf1Dkbue4nSvIj8d2DVq+n1JDsnqGolFi+j70tSnmWwTncv9tKxZYGpFh8/bdBm6lb8tvvsywRfZrvWSa7S2fEkaN3neLLPBMdSO0LPCR1KXQ2L/s3M3B4bkq4bpdhbP5CLyGLwOWya+OO67cbA4znIxnA9sheqiPEsT4ASrCPWSqRmblefjY99vmQ3OGIbas8DLkLt0QsXP/xU/P11HBJkibfCsZzlPWrZlGZH/1AcRmecr83LvaptRi6oovO2pgE+eqmQr9K+OXo5SfGHryspTv2ybDY6h9mqS6o99z6GPVGTzjnuFNz25+I3Fri9F84Ai33i8B5C5fRQ3rXh22gy3rz1m7bN9sVk7+IxVahfWRZn0Wtncy8cWttpkg2OovZ5xSvfuiaebWm7I3RWbU/O2rcg2z/OmRpCuCCmDUux1N8OLtluoN0BfeeR9Cz03mbeNlt8NrVsshntKrP6bRD8rpbI4jYgts8EJDLXX83tKhfE2hy5v4JLsw/w6F7k8x1eik6sEO+DQQ0qrI1HKkwmbRCPHUZAcZf76wtty4ZNE4wvL6LztiEBb/paA0EeJXNokn6EO2eDkHj3vEIg1inArkmltUhtVchhUrnwVxuuiOJW6vOHtztvIzSGLfWRe5nHAQn/Yj7r2BP9owi6Ay03oWcp874WtaSc7Lu8Pi8VwiwTb6DTRz+pTWXa5sSxbiPPmZzX9433KD7C+6Ni0q7e+1vs+dF0EdHXgxp/pXPKowWdUvdH8w2E5twGlttitk+43fil+z/bKcxvq5vQ4H+ljSCp3mdtEzdc7L8RtOhHfC8dsMgG6lERKiYRclmVkIHVsj53+ka3QVRYLc3guZqIiu0nkpg8VpT/sybyM1G52k4lou4V4yfBZ71MPZc1d5uUL26LFn5xrdN5muH3b4UQo39HN2MFnjBKs18jBZ5xa9m2sRA97naeWf+4reAqXKa5G6mW0/nLkIV8HEHqIbTCP5dzQnsxL5nsZwkJkxFp5/GyXUUsvZG55v8lzcteyPRcB6hAkVanHz3BNzHr9y0Ao5pZ/53VtQNDUrzVSLzv+F91zfbAhAgh95bkJtqWgK2T+TuqBovSvPj7U8RnzfZO5zZ70mxSuq6Oo8NLBd18meFlj1osIPUx0ft/hpcvrMxk8l/sRqQt3Gq3vN9gfFY07cVi2jWepP2n6z2mDN7zdSN1nlL7xmDTC1bXpncx38DUkvg6UDMT2O8ZdVk/rc59khN6lT9JRStfbe8GdzKVP7rL7aNEroTeUennG9WwnqUZVx+E6Svf1BiUyetQHdtbwb16l7jlK9znH6mK4vc8y93m/fQ30LHdZTGqVcEr/ZpbwNe1SL9uh3C3Z3LzLfNbh+rzK3PdWvGinrTWQuiBDjGW0XnWzfvZQLh/yuNWXj3JffpvOYWz8rXj3mXSk67Xpu8zLjGk+OuJFwGqsLP+uPB2vrfxmJq3V7YeCjFb12nlJGQe+BnD82sioy0/T/dwA7+uhoh6f2lDqpQSrhjkmGUhuo512W5mXPOtnuH5ofb8xdrk2vZe5x2h6GbjduiwmLUfjjt4rmg65zKCYOmW9xk3qpc/4NNI1gPfXRKaEblTkz6b7SPAiRKKc6KetidQ1U9CxoYyqm31UdSJVB1wndVl2kPmfkYy+4bl8gXnw+EAg83bRtMsh5O+Bn2E58nPb4f4u5bfUl5tVee01cpV76UsmIt+v14semfvdY722xu/UWV+4PNIv/a738Ni43W4bLKdIEsentpB6FecqYVflkYVrD4462a1xk5O93La0dXSzpRqdD03m5f22NPaLof5yv+nIV2hcpCo+L9ugIh1orkxLaXuq13JIz0vH6xCDYKnOkzkPvaPUL10KXcsjC9guTfe5uhTTXG6N//kcmyxKg5P5Dl8dCT1WpBY6VTH84uFIX3ZvAqRRLfrLf1v82VmKp+a5fC5CJnc6SanmGlnYRBdjT1mj+nrS0IPP6FyHE9u+CA1Z5uWedBd1f4pU/q1J71S3IfCYySEmQ0RGQW9DfuFJai1QNMCVpdTPPZRlbcJkagvJKsChOFNkbtcBdPz7TeStS3JfIZdwbHrYP/VJ5sEDwpMUW8JS6teeynJv+rMlRIR5EeB72mS6Qua/6Lra/Snycxvq/oI3rnhukHnyQreU+shl1rg9Lkz+aRW3IcSp16DpcDsy/+s933VP+jKROlwFvKc3CT5noWS+4qlJ7tpfxZJ50kK3lPqlp3KUkUfO4rkNNBzb9Bogc7dR+iqVudSG+SWc3NMJCj3ECMUi0k4GqHn+tD+Lel1OUm+lllKf+jpSUTvLs0ylfhXiRmtxpCAyr+msA78I5Cr1qxSlplHzlcd+ImoECO/Y6DU5SyH17kkOLdZS6tcey7FWqec0/B6y42uyDxmZ199jNklCkkwsovfdJ8dR9DaFSKhBvc8c13uTer0Hxlr71o8pXZOTXFqvhdSnNgcj9FDq0vF9CnWzNYzOkXkz2mZ6SzaxiD4vIvUHB1Gr3Msfc5g7dljvMmfEJ+bMk5D4o16LTym+XP2WU2uK1DX5TJ04yoxqtx7LIZm9ROozk2Y6SrnxLgLPqc4blAmZN4zw9GSnpi+mXxOvj1zz+6JOj/q8tEnYtNHRh6fc9lt3rPdar+uCZyY4G/2Rdv9Dr8Uqh+vwIcfWLh6QeQORfgzRATQsS0iCb5nQle3PyBxa3DNl8qFJzT2zjiXxBvd0lcQ/HPnckda7SuwrrTfPCgxD6A1FKm9UZwm9YPRS5lr/l5oOCplDjv2LF6ED+OQk14KruFY1/0TOsD0PWJbbyE1yFUnmN8gcAAChd+VYwpeZzwVye1KXebIY20nKZAaLCDIfmeqV7cgcAAChN5bo6xaWGqmLcGYBy7MILPXYW3hkquEUmQMAIPQQUp+GGnrfkfon4z8BTSnNKNvndKh9gswBABB6SKnPfWWQqyhPuVfdl9Riy1zmzO+QOQAAQg8tdRkW/hZqPt2z1JcxpalteGioHZkDACD0IFKXqHIWuDxSjo/GXVY52ZZ2EVmac/N+VTsyBwBA6EGlPtUMXKmUpw23sQ9lKNruvvh1jswBABB6ChK9KcQ0jVSeleVHXOm2uJgylza7Q+YAAAg9JanPY0hdM9ctWvxZ0ANWjsh8jswBABA6Uv9VpqanxpV7zKOe6qYr2pE5AABCR+oVUj82hP6UiMyfkTkAAEJH6tVlktzvdYvc7mKU64DMT5E5AABCR+r1ZVockfpcxYrMAQAAoWcgdTlkpkqUzyGz3CFzAACE3hepjyOUaWmqs8oFy3KHzAEAEHqOUr+qEOhzJKnXpYqV8nxD5gAAgNCbC/Q0stQ/VYweTIoyzT3J/FRfGJA5AECmfBh6A1REpsZE3Aeugn0273OmC7cus8ZVfBcyh6H3C6cVz9+xl/IVrQcIHam3kfqVi+xxyBwAoD+c0ATJDr+Xi/cOiXvWtUzIHACACJ1IPXy5ZO58eqBMkud9g8wBAIAIPfFIXct1KP+71XY2ZA4AgNCRenyp72eVa7WdDZkDACB0pJ6G1BcHpN5mO9sMmQMAIHSknq7Up8fS1h6Yh0fmAAA9gkVxRziyUO5jLCFWlOtC08gicwAAInRoGamfJlSud7nokTkAABE6NIvUowpSyyUL40b6nzbmbTvbFpkDACB0yEvq+6vX1/qDzAEAEDpkLvVkygYAAAgdqbeX+k/DqWkAAIODRXEW1CyUexV9rIVy5m2fOTIHACBCh1wjdRbAAQAQoYOfSP1bqHIgcwAAQOj+pN4mJSsyBwCATjDk7k6sVcPvCz1YxfX3yfeIzM+ROQAAIPQMpc6paQAAgND9S32isjU+pI7MAQDgEMyhO6aQ6sq8Pw1NmHadU0fmAACA0MNKfVEj9SkyBwAAhJ6/1Odtpa5z8y/IHAAAqmAO3TMq70ND7Vcq/SYy319oh8wBAACh5yJ1ZA4AAAg9H6lfFHJeInMAAOgCc+iBODKnPj4gf2QOAABE6JlF6luV9bri/4/MAQAAoWck9afi5w6ZAwAAQs9b6gaZAwAAQu+X1JE5AAAg9MyljswBAAChZy51ZA4AAAg9c6lfI3MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMP8vwADhq0/mGNStUgAAAABJRU5ErkJggg==",t.rainTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAACACAYAAAAhzrj3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFZSURBVHgBrVNBbsNACATiQ2+2f5D+pP8/tS9JD5UaKTZTYCG2ayenrKJ4BMMA4zXRi87l9/bhT6mAdNRhG5lo4v+pjNCTSJflNJXOVDqWugBDtBiI+qVq1SuroF0fYMZt3A7mf9cCb7tUA1pAdik7P9fpfYmcCsx0RH4AJJYwoLbTM/KUAMKD2AFBh/WobVaxB2/KOyeLMERVl5TOyg96yckLvEUIKsZGdtfl1IuLzdCxkY3XGYeJU9DcQmtBFhHi1CFwjLLp5TMd2sJIMorD/htCh8H9SpnNOony9BAoQU7AbaBMSUXunEjRLlUAcL/nUZhtUZY+dGxtIwebkyzlIaWgbu0FzgdjKK3LXVEbOS5IRMzhc7iRNG6XwQdzY9rdiE35PnPtnqEgr/bSSsX9xr3qbNH2mqyAWwvADLew2TD63XPkE8bqbUKmdRVRpkzs27F/lJ9G/PoD4CKlP3uMsAAAAAAASUVORK5CYII=",t.snowTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAH1SURBVHgBpVPtbtswDDxSst0m6pqkzZphzSPs9x6/L7CH2I8NSLAldmAj8ZfEUW6dtR3WPxUgWCbE4/GOAt656HVARGIsLQpcWoskxvoe3WyGWo8NEcl/ATTZVhXmkjTz4NkxJZmmI1jbcEBFGXIH5ArSjzl2PHwTSY7AkjOsuja7BftrIX+hVwS9bwLLAUe52lGSaqHtCGJH2iVw3XVYSefviXDHoLkPYcocRM/H4JHrN7PSYVM1reb8ju2MDFI0WFDfL0H0USD3Aloy0VUQAQMlQSYBGhVqp0mi9RB3PQBEwSiFA9MHrbIIgqXyWuu+4YEi7UAsCDgJSyGcuQK4OANEtQMpC0I20NbKGl4QeB0GVySqXZChS41nyjSjxg4ODQWc0xrooyPE4Gc2KX0VhF9aR13/9+ephaJP01nTwddMqvVjf7tHCOUm2Ks2pfhwAofaGGr7Ft1zgPrm06zS64fhcpCJJmgtOtAAoiYRtrr3YD4wbLkrvtfnQYo2avatP2LNxn8OPqxAZmEIF0EZkPBRtcjZYGPY/Cyb6sedc7/ONsbDw4PkX76eUus1ZKhRFkVQwYIXUgNqa+TQe9kZbzaavB9H+p9R3lbVYpK4mWE4r2rHRo1IyyYpqaty59yLUX7zMTW2Sqdw8vSYThpvXz+md68/1R4Na0qbii0AAAAASUVORK5CYII=",t.waterColor="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAxgDGAAD/4QBuRXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAEAAAExAAIAAAAHAAAAModpAAQAAAABAAAAOgAAAABHb29nbGUAAAADkAAABwAAAAQwMjIwoAIABAAAAAEAAAQAoAMABAAAAAEAAAQAAAAAAAAA/9sAQwACAQECAQECAgICAgICAgMFAwMDAwMGBAQDBQcGBwcHBgcHCAkLCQgICggHBwoNCgoLDAwMDAcJDg8NDA4LDAwM/9sAQwECAgIDAwMGAwMGDAgHCAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAQABAAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8Aq281jqSlrqOa1DKJHmRjI0an5WfD4G0ttwS4wTjpxTrcrDaJGguVi2b0mdHeNASR/q1KbEYbScsSR3YYqmVXSruCY2ptZGlKxho0Jcgf8888/exvbjBIAO0ip/ESx3UtvdKIRdTO6qqxSLgL8xYBWbIAYDOThQByBkf18fxH1stv6/r9CebTbGC1t4YZFuLqVg0ciRFVQcAKxJBAY55J3DGeRUOn3sdzA1uEhuNvDPEGWSMZAVw3VlySCACcEZU4wLFnZODcK+nrJJnDtHJ+72PlVJ54YMQu7pkjjjBbFpD6ld/ZoIJmuP3hlMcpjZZPulScn5mIGGK5LOEx0Id0tQUujf5EMd/NbakzNaO8rgedDLKfmGCVKkDdwMnOScEc96Lu1gin2wxuzOVZ0d2lXJOEX7rAE9cqME5HAGKdYn7RZwq0dvapasoZjt3oT/y0OeFVs7WPzYKrwOtOsGs7S9bzI4boRXCNloVhwd3O9wB8rZ+6NxcEcEDNGtrD21Q9fJnna3m+xWrx4fzLeIt9nJPIIUEE4GAQcAEE7jVS71a1uLzdawW0iqRjbuXcW4Gec5GMgKdoJGfaRPssQaE26zPMXWM20pK7mOVBQKoTAP3VJBIXg4wZrqNJbXc9wblFkZXlS2+WPpgfMqkcZIU9xnAJJpavQa0d9f6/r+mNtEkS5VYZptPkkDOss0iqjx43EluobpgA88DHI3Mi1JZrRbVZJIYZDh3Cny5SF4+UdZCQTlRtBJwDkkM0+4gtpfIuLGZZ5Sku+3mO5ScbcADqDztIIbG35eadJPbWkLNH5izSFYjunCKqMPm5H3GODlPmBDE4ANF+ouXW1iCW4ivNLhuPscz3VvKEnu1UsHyMopPIViFcjdjdhucCnw/6AY5Iri5juLoNJsUld43fxc5PIYcgY6nA5Fprm61pY0+0SXU74MK53CIg4wGPAjx2LBRk9Qc1XxapaiO6sZIZJGLLcrKGRiu4MiEgAg4+7kkFV6cgzsVvp/X/AAwX7/Y9f8pbO03eZh5xKyKCSMkMv3QMYAxgAYHHJmSQNb/YIreFZlTEcaqXXBJYsrMSMkYJKgEgDGTkEs57ePT7e4WXNwrmBCkMTxFivdgfm4OChRg316Nmt7fUIGnjaOaZCu9J43lIbgZUbSGDAHA6oMkYIxVegvJ/ruR6hLuZG+d7iNRvmWLll+YljlQQOoO4lsngkcmS5DWcj7FtY0uASoB+ZF64U5IU9QVPzAcdzkgaXTokvIlikjUAbvMSdixxgEMfmwVBGSMEjAOKdp4uYA0PzSLICcMnyudrESDbjoMNu/3s7sEUblaWC8VrhZv7SurmSS5k3Exnc2Hzk5wynjsxU4AAIUg0W8IaRIbdtTby9hBkjEi7Rgb0A5CEhuMFs9Bxmi1bT3smVoFkvLeIgbAd1yqg5yAcbfmALHOAgxnoIWFzZyrELKS3hG4kSKVVIz7sAzAryGUrxnvzVGS10CK7WRXRXWbadvmwptSNc53Daudo+XuGwQOSCKkljhdFkktYWh2gq0VvIinJwVIHLYH93nPBBzgRyqbQpCtm11DIjbFWVgznnEgAySgBIDAkhlPXoVlWO1eOaS4kaFZGxdGItsAwCDvUFsdQxIOT0DEipNdOg6WW1v8AVXjd5LWOQDPzmcqPu7wpxtU+xJ4wSBwGLfRm2+ymaR/ulQS8aqWyDtKnCgqRwuQccgdDJLHZ2yW/ltZhY5iqkrtkGACMxKd2CCBuIGSD3BFPnsobuBplt5vKt9zP5SNthGWbcx6BiflBJYngHnhlp0C68xi6e0tii/uZAp3FvPLB04BztIHqeNuBkn2ih0+Z08na1ywZTEUQlUAZSHz/ABk9cqSMY4PGRtNE4guBE1xHdYa2iuEeGSUM7KzDa2BhgRsBwTk+9T3Wn3F5rEkMPmIsm9LiCC4iaTduIwxADZI28MvLMR1OQ+aK3JlJ7EeqJNPqreY1rIHmzKd0eUcAZUbOdu0bQM4AHUHmnO7fZ/OQLC0OIgFZ2LxnJXB65yOhAXkEgnJqbRNQmE6ltgkLeXvlgMnyspB35+XI4wpBB/DDRyfZgsjx2truRQjPcAAwMMDiNc8cZCcgYyNmBVdCbO/KDztLazLaySSqjqzXJyDFKFYqyfvApDjA+cEDHAHBZwnub2OeWxa1t7iSM+dHC58yYKWz1Ax8vcllIB5wTTY4fssKKq2txbqm1wshX58DOR1yDyQDt5I44IZawtLdrCkf7vcxUPg2zNtbBG0g45XqSmfUDFSVyrcfBNeXDru8+5jaQLGdm7yT2K91c5A5IU89jVeT7Qlj+8VbOYqrpIy/Z2dScDGQpG3155HHAyJtMlvNKXzI47tbgNuX7K/mJxwEC8o3zZJBB4AxtojuPKkDFb5VlKglTlpFOS3y8KT7ZyO2RwDUfXSwx5Xm8PSNbLdQrGwkmldT5cOQwKIWJK7sZw3zEISNoOKfa2VxBZoiFcybjGBIFWQZB3Bmf7pcH5QuSSfmA5qS6kuryJZZWWWHIFsCqyIxAxjy88ALnG7GCGxu6mO6sVm+YxwzRxj5pElUyBAGOEy2CMdzub5RjPOTXdi6WP/Z",t.waterDisplacement="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QB6RXhpZgAATU0AKgAAAAgABgEyAAIAAAAUAAAAVgMBAAUAAAABAAAAagMDAAEAAAABAAAAAFEQAAEAAAABAQAAAFERAAQAAAABAAAOxFESAAQAAAABAAAOxAAAAAAyMDE2OjAzOjAxIDE0OjQ4OjQxAAABhqAAALGP/9sAQwACAQECAQECAgICAgICAgMFAwMDAwMGBAQDBQcGBwcHBgcHCAkLCQgICggHBwoNCgoLDAwMDAcJDg8NDA4LDAwM/9sAQwECAgIDAwMGAwMGDAgHCAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgAQABAAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+ydT1KC9mSN9Jjjk2bSxtBD8wPIDF2Y9fUH2rodP0a1k0f8Ad587y8YlYNIy4+6fMIL49CCO1Z2paPJpitHOtky9YUjkyW9cAkCT1+Vgw9DWeNfXRr2F5FnhaSQBDI6D8NoB/nnHrX9McvtIpUn/AME8aNRu7vf5/wBfkVLzw3dRMscl1Z2cbr+6keMwxnHQEFyrfQfl2rQ1Dwk+u6VHILuZY3UK5t38xVcdwrsY3U9f4SMfdFXvEsFjqlzHdLb6bHNMMsY4ysjYPXCBg30wD3zRNd2B0rao/eSSBZYtzxEt6lWXn9fr6V7eo1GSvf0X9f15kLmkm7trvZW9NfxZR8Lx6boj/Ym1SG+mRdqtMu1g3qoV+pzztYfSs/xX4SaWcTDazLysRhYoM84BYl1z7fhUN3eNDen7LZ26wg4VwUkAbjsGYj6HA4rodLsbl0F1qFvulHR0lXao9D+8GPxzW8pSpS9tzb+mr9P6sT7r91PT5GZpMkcnkx3H2hWVdokLkSwt2+ZArkc/xDmrF1oraa63NpZ+bau20kRRyLv94nw34ghvwqwfCx8RagsxeObqmDgSoByCrgHocdd3tWtcwXGoab9nW5jWbdtkMtyhSTB/i4B/z2rnqVknp810NFZaX09dP0+/qY+pmPXNNjt1t5rD7LIGimgKjGOuRIBuHP8As1NqvmwWNvPdW9tewSKAZHdtrYPVtudv5/XFZtvpdnp2tXQvNOjhlU7mUKC2f72NxyPqMcde1aen+Jb0XaxpJpqqoOFa58uYn0KkgFSB/CO/cU5KyXJqt9+/ncmXL119P87sl8S+KNL07QLf/iW2MawrxKk4AUZ65GMdQTuGOh3VH4VtZNTg2rCjq6FljRkmZl6gjEh+vANVbiFb3VJJLTdDcW4LbYZHbcMfdYfMGA54VWwOlc/a6iNLLzG3hgulbCidTGjk85+XC4PuqGqp4e9Nxhvvrd7/AD/EKmrXMtF6v8G7GzrFhqWu6r9nj0+MfYmBDkxqwGeQ5BLL19wav+K9P1LU9IjhhhbdGpUMkat5R77mZiMfX8jTdC063uLb7ZHY2slwoLgWkqzNF6nGTlDnOBgjuDVW43Sah532aG4kYhGikmETk/7Oflz6dQfapU25JRt7vl1/8Ct/XYOa/vO1vT81zWKfhqDXLfTFiZlSOE8mJmGD3xsK49Ry34U3VdRmTWLVbpTOZn28rJ+8PY55DN6gjPsa2oLv7FdyI26wmUHcrzLD5v1AA/MA9OtSaHfz6lDNHDJp14khMbKt0sgmPbO8jOOxySOme1VKs+Z1Gl+W4dLN/JO1vnr/AF1JNLum0tI/Ml+2KYynmSSmNw3+6Cef90kVJd6Ot7b+Y0eG/hD2fAz6Oxzn35PoKoyeM7mXUJFkgdfMBEVwqhot3+8SQPpwaRPGV74ft/Nn1WxluPMEbQEgOB7MDjB/2tv41z+xq35o2u/x/Cy/AvbRL5L/AIb/ACLyeHppLH9z9neSFAQZGPmJ6cqFk/At+HamHwt/b2lb/ssPXafnilUnrxHKoP5HPvWH4k8aJrUESxR+TOTyh/duuOePmG78WGap6XfPqAVpYlV921pHk3K3cEgjJ6f3m7810Rw1bl5m7O/9dVch2UrP/NfddEd74eW31TyRY6bDNGNqPJbC1DEHPyPgluvQPmtS1F9ZTxySWyyLsz88K3Bx3G5trH6HcK0b6aK40+SOzvNLiuM/JAJzAWb1UOAGJ/unJPY1Ssn1C1tWN9Da2824ZdZwytj64I/E/nVe2c42dvnv62K95SXfzf4tP/IsXlgviqIQhrRWVMxyFcLxyPlY7W+gAx6Vinw+kl2rtNrEbY2b7S3dFhcf7zMrqfQ4x2IrVLNqlttt4fJmk+WRY+VcjvuCDr2OMD1pbHxG9nKqtqVjbSsceXMwfLj+FsYYN6EKQaIyqRTUfu/pP+vVk8zfW/6+S0b+46BfB0msbpoNPaFYCAokRQvP8LH5yp9OMe4rM8T+CJL2D/VrFMybVUw/cYdjk5H549DV/QL++0e1ulhhije3BwIZ9zYxzjqdvP3T05qnpfiDUNSka5m06SZN2wGQeWc+m4NjB91I9cV59OdaMnJSVlt3/MJSWza9E/8AgmLB4Vvr/RltZF+xx2WAxilaRV5zz91k9QfnpsjXekCGGFpLpJTtkZFyJT2b5WZS3qAAT/dNdVpelwnXHvPtf9nzxo37hpY8zZ/hKHn8VIz71kNqB82Z7X7OI5H8p1ZolMh7HbMAD7Ec9t3auqOJlJtaNb+V356+ofZsmv0Xz1uLqevx3NhDBJbzWgjxgrC4UnPcMoQg56EKR61V1GWe8s2WztWn4A2OHj49yMlf0HvT2mNhbTedbI0ajLRuNxX/AGsAkbc+gI96XTNej0uNZhb2csgH3FkjBIP+yWDAe2PwFXFcqvBfiGm1799Vb7x2jaOraHH5mmafCY1wrxyNJIh+of8A9COP5VDBpF01/Gps/PyQzQiEM8g9Rlto9emfbvWx4cuo5L6a6Vpo7iNGbajGRDx3wx4B7YPtik0Vv7eguGa0to5geNw8kyHruxv2t9NqmsXWlFyb/q/q/wBRylzW5vz/AM2f/9k=",t.markerClusterIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RUU4OTlGRUY0QUMyMTFFOUFCNTE4NjMzMDg3QUZCNkMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUU4OTlGRjA0QUMyMTFFOUFCNTE4NjMzMDg3QUZCNkMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFRTg5OUZFRDRBQzIxMUU5QUI1MTg2MzMwODdBRkI2QyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFRTg5OUZFRTRBQzIxMUU5QUI1MTg2MzMwODdBRkI2QyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvdO35oAABUCSURBVHjaxFsLlF1Ved773MfcmcmdSTJ5kBd5kRfkAUHBpBY0gIAVTYtWpFSgqVjsaqkKtFhIkaWyWqWlXW21rtJW0FopSwTkoRhFJUAxII9AjCTkSTLMTF7zvO/d77//t+fsuZnJTJJJPGv9c88995x99v/6/n///x5jRuFoAjXw/FugPwPV89qDIAeqGGPLIHwm8D0FqgPV43sW1xtxniYlKnqfled2g+aDMqDloPWgqaAEaBzIHufcj+v5MaAC6K9AvwLdDzoNdCNoKcYugs4wJtkCxsBQ0ipFRoViB5mE458KrpXxWcT4xVeMKeVxrQc/3YnfnwXN4Hv/GtQL6v5NCOBvQFtATxnlag3GuwSn0Fga2qnDpTR/kvdYz7QNuT18Eo73OqGo34AM5GnyGyDzHRDOzbiewoUkhXAT6K2TJQDRfAl0Cmf7EYxzJcx6AZhuUMaTLmbcDcNw7eHCW2qecXx1YROE8SI+b4BwzseFD9Py9pxIAdTT7z4JetMop58C4/Pg7mQ8UWva7nCNu31gog8TT+j3ivg7pGUngNKKD9YOIpFAGN4q8g8Z0/dxCOIyXHs/LqwF7QcdGG0BjCHj14DuAWGy0WcAXvUqlwQ1Ltp2oamLP3fAfBsxWQipAPW5T+Da0/i5kfyJbePc3ofzBbQc3JfEc+nxEGxaxw8FKe/xMikDf/IvAAYewfmNxCNxidbREMAYOjGkbOaCvqEmX/en+KlZUdvaQDkuVloe1/uA8EUR3GoM8wGAOdTWtBkWcwhjJGNfF1S3i1RIMA7TtRfYhmhS/hJ+n6+u3uDUyqLACvp5wJcCrKHni3j+THx/J+gvGS32HasAhPnP0KT+C3Q77n8PND4HoWucasXZGNEdLUACQze+lK2GuvEAyomIBGPHx6AYDfFuEYaYdgVWUdpqTOdMY9pgYh0iUN7TaNXqbChwq2G2vBFCAEj2/AWuwUoNFGU+dwRsOKIArgedrYyb38WkId3GbNVaTeQGakDCVh4X+hjCZJLTnOJkhuYauUFwwdSY9SBAWXFqTSKE3Tg/RO2LRWS8RZiBbtH7TSgBkaIs4LiM7ls+WgE0U4LX4j4kH2Ma1ChsEKrkKFoNwxK3m0HT8X0yMTIE8gHvtTFzfhJeo26QUOm/SgQQQeyiZVuFjwHv8mP3bocFIWxWbjiCBSSHi0dlTToSdYrOEdHXT6gXJz1OTXI2aDpuqCdTjsxE1Iwwm8NJL8bM7YRWYaIuq6brYLYWUks3qFbrmfwlbJwY+flOwfdx+N7qVBCdOM+4QDmYYIR5pGbh8wWNMkMeiSMJYA0zLqBr5RzIIqMTSFE2XUzAJuGti5ihpikgMceIJt0HTbTifAee3yUTz0GLnzbm4DTcBx8vdkIY0FL7QlyfqhpuBwbs34brkEQKL01bxZwKx5c5jKWRinDEGgpW358A80Xc1I20vPAzXPgY6PGhTPFIAsgGeb3YHoClbqxezjkFpVNBc8QfbQxgCQ7cIz4L7bZeh8eBIeM+oPdPw02TYZIpAUWMHYmV7VWLKEFIe/FsG77vwrvbGQUm4paZnJLleywtK09L2EpmxmBiPY9C8ML0StBtR8gShw2Ddcy5WzkDAGME7SQwowVOzd6DoAc6iQKi6R2c7Hw8ey5mPqNRzVq0mQrCl7M14UxwBUIpvA1hQCgbMIeNsJocLGIapD27Tt2sQjCMOEYbGH+lHffB4twd+OEK0K0q3ONLhLJc9Py5OCCoDaaHGLt0rGqmGGR/B5mHiF8uw/ULxIusuo4NQl347v48IowEdiAMdSDz/ClQ/bm7wfB0uJzTd/tUW1Lv7m8b8ypWi62/hYufIIjsH4a3xEgEUOAsACjmTHX0AvLw3iVA4IyGPPl5JybxulV5/R5IMtNJNdlsCO4lq0mPAGnBrx14QxTcJ1jSDIQ7fRVcCAO+jR/foFdmra40e7AS3fwkmH8XnpFsEIlWdfBRXwzV0adeBp0FLdxizDx5H/1wgaQMDIUSuwX5E0Rz8dV2hrEurmIPErzEQsY6LSGM0Uy7quH6QFgRwe8gLnwfn7+wKuAp+LLtQeDNebj3lmFMflRWg41U7R+bqo1nToMmkOmtwNdVTpG5wBQ5RQa30jXeklBIyxPglLyhRdYuOEcwqIZU0azUDSbjHIHBzLMqlCLBL03lPoMv6/4Hpv93ILinW3sMq8HksQighwCTVQHkvgyEv14toYWTi+iXb+HzaacmK4Ujcc9zaCHjnQ4h4ayTIfUAFfgifvu5RuBqRnke7p9jCbJ0s/mQ6jMIn3sl67p5BP4+qgWRDBcbRY5zMYAJafNqWMdCavEFfD5uVdMfc4oJc2ni1g4Rl3n0WcWUdfhEVluNKIAA89s0wB3Ao4dfwjsAeqX36LK8qpiTeoj5IE6buzirz0IIEMitmPiVQMVx+FwN+kVFExPnyY2QKppevwn6JExk7HPGXITz27HqW1mvRRjzACPTMR9L+DmXC5+jPRK0hLW0f2R4Y9vUfz9VUZ93AfOVEQqgUvNd8vovgOEZ/4jxkS1Gl+NdXw3CzDEf1/HzMhYR5Fh0lMJYRE28T+07WmfMnZIC12i84o5C+zWWIJ9lrB8eeAfkLKDxPdCHRqEqXHUqOJdFCLEXMKFfzRRYjnkjEMYtDPyIXYknkINgwm1e48fK9BBUQKz9EsJN9lRaQP0I+ZQs9rxB0UYTnQw+m+C/GUg2CVCxlxJ1vqDL4f7jnUyG/LGCQhI//IExl2CSW45X4zXar9RYwgGEujVQXDROo1AVkAc7ZlDBcghQ/i0FJpZ6EXi8UAzI6SpLAEvCjfhuC3Lu9CaMCyCbgPQyi+wqfZkWLc3VoMtp9ovo/yKoO/TZB0bL7IcSAMd+5nlkhoJbd9cIYBrnI8diWslqzdCqkefzUDD4qkOYyhbFYyuaSk7AoFMrKoQpYCp1ua67L8S1d2ORsVSu34t7ofHMeyG0u4gbciA3Nz825hrc03q0SH+UAvAgKjXDm1Zp0VS02X/Mi5lOQPsNN2qGORW4NOkmzSNE2ac45W9yknl3MkgKSqcjbI3XtHSs5OlpTUszfwggQgI0H+ld09eR+iJrOQBzasUyuRlCOd8dnvuP6hGUzBpPgXLuNOa7wJ6t72e5HinmOOTYaaScXQ9oRjqDCVgGwtqzStNwwyp2dY5JRrIEl5ciodLH4ypsOajs9EjlJaWYeBZWW4U1SEhw7X5IcKKrdsPMMPnNqByOafZiAPY84NHu12Dh90GrUNTcsvLxE3aUJvmSvdVljFApqFzbsFfnl6Ml5tv1Jq7xy7VOp/nOeK7/kwmV8CQGjwk19b7R5ZpLZW8FsnCC6019RN32ukiNQJotsuB6Gde2M1EV5v0aQuoIfSauO9rIxXX26rp8I7T+jFpF2samLJYgy9YMFyYVZmlSBc6z+ttsYxNwJ8L8a/J3UdACqyWwXvWA6oLJ1wf7qLgwZ0vxWn9dM6o1WayuKnfpjXXBb2Vag9T5k8GE8qwFVJeybpDJnsBDmjITqYBDrt+Iq4rMkOFy4DbVtnztINEg+b1Nxb03f4i200z5Ezaubhxgw6LOnPyjQtOWue33JXaW4cQ6UvbwfqwbdjlsB5NKTV/ODaycO2d+s4etYczW7D8wg6Cz/36YAOBIrjuQA0dJ/FArY73vCyzDKSAKLuRq2uDuJLiBxy8x9fEBmDsWXQru8DrkYBY/oAgpFQs7hz14rt2rAtilaJoP/YqgkuRSPE83OdHM+8hUZAElyVjvtV7hfEq+5knmKyEoep6Tga/LwNLBTZL5XFCDT6xRv8pLwwEPNtm4RFjHStQBX7c/8RavXSnQZmbCyaBJmmMHqoE5gH+mRAUmgmZuf4x0AYAkqeW8b31blWSW5e62wJ9SLAN01LTjTxgsBL1DKfzuZB6SDt4rgLiPUSl08SIbOil2rfqbCmUXx8VqjV3KTI9p5hfe1+S0btdm4l6fvED2RbWzan4y4p9PtF5hqUyKpnU2btWLYA6w3pgMkp68iQuy/S39KPANP/fEd0D/FCcXvhWe5eceZlO+oXEqLUR2sO11gyDw6BpA9ZCsdB3PZ7nY1MXM29lr6K89ipVvwJz/TQdIesCW62IKZRsDW9XfscpLX6va7qKbyO/iU9KV3W7V59N0lay2CKoW8PQQEx4t7r1gN+oC1JyOCy1E/og49Gsyn7Xx9Rx89UB3nA32p/7Ro+oCpVBlWF7WfRRSdNqESHKhJCnnVGSK+79nzCYbg6e4wnLZtQH6KmibHYjWo31I1vcvRsH4LPp0JdLGw9tfMWZLTjvWGb/Ag6/0vQ5c+Cz4iuJeYjXFj76jai/68ObilNdyE0KOJi73tMgeH4SDDdykIEzLBglxD6kGvWq0Htgd7B1yxwn5/fuIKHSsxM0TOL/A6SKs5EMxTHQD5z05eG/lWSjy85hnUSNG/2ZMeTZq0KdLfuUU5M3y0376VIrVndSV8LlOSPq7xjxv9ZkksULaYh90ujv2NjY7qpsj3TEKomYbjpz/K06+AlqBL+d4pYmWN8H07zfmxZuwQs2oC5Rp7j0roaxb4LIJ5inkU1w/H8ky7lt6c9EGqSXXz7K62su9AAnmB6dAdNMx0nNE4joXh5l3gy6WZgboNqcRw4fXEdcKXM2uM6tWeLf0BEAzQZdS8GXOcw++PI4JZnJa/yx798NcO5bAba7WBo0NurSll8BPQlBjG+gqvZ7iYscFq6leAl0T9+8mF+P7fN2w1MqtMS1BP/A0Tu4HRl1C4vRMTmiktQIbtJJljC+CvoExFtvqfq3q0luUIeFPsOohTOC1FcYsTWrJy/cXe9iTLDN586tFMf/edSKAWTg7X3dQuKUKKCkXL2lFGL2MDi1WfxdNZ7jikqZnF67N8g1MH5rY85MO7k+4QUNePMkGKGyHDhki+BdB/w36e6OYI9Z1idUyXY5RSBj9EehnzAdmkPmIEUB0K/3JJrqxT/6KMN8ePFhJXslE+j/x0qt04Log9qfIaIfVpuVMlpdKbF9LYfYlWs5qDpVju3u51AhBz7OP8bDRHe8SMmdbFVKKzHrr2FnRrS6vi/CYeU7gNp95QQrsQ/BP8fuTTqvyswLXiZiw7WSqXBeU0kSZOUn2ZGJ2CcvcwtFCaPwPlIn6Gm0ctFoLWOy09FQOzHnzP+BF8IOVq7VZ08zVmHcpMVWpHW6BebTebcwbyDMaF6oAkjW7zt5ii1xWd1K1necbqnZge1ymu47RQOZ7BneRlhmx+hiR2q26RCoolhR+CX6+iTHEN5OvslHwXhVzGU/nrtBymN/YKAM23gMgwRu2XxVvWS1T0vNPxT1Q0/8R+T/EzVN5Mh9Re4sw+93fhoYfAcEMtubC6ka8H+nM6dAJy2z+pwLnkuY7nsD39WRukRk4nxI1L8w3eub9Vr3XwN/v4x5p6HzE1wM8Wkna96gKIMWlsDeEDECv+M9wA9hT/YehFf7XR/Wll/OfOpxmaBI2L2YDKcOJCSWkYAmwKojT/nwI9LsGv0/XOoMPr1EAzLL6ewwnv2a367TAjaoLHABHK3Kb7bfrDrSGmtCTf1Zb79XmyW1+YdBGNPsgHRQOWH6HAl6SSYiFvabnYHJf1z18qaUKclHgw+NIYsYbrX4mKEgpmkin6cf/AVnvHCQcZtjlgeQKKZ3GBGpfMGU3sq51a6Er/NCaVa3PtSqYEj9lDq1YpGyC6ZXh2s2JGMvE9EsAvu4noEjpbt1H9EzUTkJ6f7vxYsBn5Wy6AtPdaBpumapb3ztmxaHFm1+F4XIyv2+lxnZww0MRL1uPmbevN3GHIjwma0SyyMCmMFpIyv0UPp+CXW9BLt+IELwsE2d6ZYY7x+03v4LpFJbBgiLlrX/bLfyzB8LvOx3n/wt6cqgdIkv4lKjgXs0Gm4ItshFfdpD1glMJUln/fz4mBpxDzBMOMrES+bYhie+7w8QZ0oAyr5pw4gwkWk5jfCebMw1s+7Ww+FGkaQvzeWRjO/7dmDeRLFSyWqFO+UIPLaMbK8Hux3HtxqBhOug2OZnYu4zmmXCF4vIYfEIh+Crwfm5uyhCpo6DsJNvnJHcQRJeosgcT7PocsWaoA8tMdx5CXVbBVhieyfjexFDmTT7JqvTmkm7MjCC4sUligo1Day+03/VDzP0idoh3DbdH6BxCuCANzCa6Qv24kXl9xcb9hByzrRS7y7Mj1VbJxbmOTFa2w/4S5r1t/Qj2HiE+N8ASz3aKA75E74IN00XysY15QQNL9r5Q47fR9iKZ6LpHMU16Hv1FhCPuEnuemYds6fojDAgJd1+lozfagf8r0EBzE6VKAtNe1p2hQumgztAJwXQ3jiAHrldXKLEXOT5eumtDE5LYGymudFDDzcF6xG/Srm59QMjrQl5TliXtlkGYH9QFQn+U1O9ctWmHAQrL9QUpO3AnZ4IoLybZdSuEcAiuAbDJlXRiGdy8T6IC8trilmGqnUVFTjHX+jHa+RHrKWKMvVD3ppsR4jCnrqyGOJ/i9vcNOac+MfuvgXnJn4H81X/yMkcjgL0s9UZcK0hwh/8WYWuVJcpsIuw3ECfq5b+/gIqdsN19WJq2S1EFwboDz3bKNtaDzFIGO8Th72Resor7DjCHPZ9G9ggT3o0Y2yX/nYakozmteUdtnbAMrfd8FNYmQpRdIY+ReXe0AghBUbDgUlZHsDIpgqHSGfrSpI33AFfX2UiJ0xN0ckn4c34BogGe6RaE3k/HPTTEu8rEgBvUXyWc7cdYh2AJBaSSGai7CczXpwM3tHHhpYB5diNJ64WQHVy3+n9OPxpmDT7iktVCAsa5zHbAWOJq3S/QYOIVpPNF0WBifS9A+9eCv1dH+C5B6z+RpR/Gb4iru75Y44LwVvUaCK4PK7I+IHzpGiLml7lEHMk2vxEdHbQG8dELNVly8MciEKi4hDXDAFQdY381LGKlmYcmXKGm4zqURt5UaJfdpw1jFGjD/0C1Ns5Aezap1nMvY+jfwYWHjO6vffpEFublX0S+xq1xYg0PYlKIhSkw2AgGWzCzKficKstUAOGYlfh9LRddwx0TucdnnpaZJX+YXNH9S54mYfwsUt7UGxj3TBYf7uWOsZN2zKYQJLRczxT6YTX/RFn/QbK6ExyfGdnDs4ypnBlBHrCCTL2uriWRQMpw4yoqkOQO3eJWxSXR9ve5De5Yjv8XYAA3ZoF+5F8SWQAAAABJRU5ErkJggg==",t.circleBlueIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAICAYAAADwdn+XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIdJREFUeNpiZMAC7L0XGACpeiAOgAptAOLGg1sTLqCrZcShef8HXXmBT2pSYDG+W88YBC4//ABkOqIbwoTFAfUgzR905Bj+sbGAMYgNEoO6ioGQAQEwm5EBVCyAGANIAtgM2ADyMzqAim0gxoBGUIAJXHnEwPTrDxiD2NBAbCQYC6RGI0CAAQDXEjYOjbjUPQAAAABJRU5ErkJggg==",t.images={markerDefault:[t.markerDefault,t.markerDefault2x,t.markerDefault2x],myPosition:[t.myPosition,t.myPosition2x,t.myPosition2x],logoIcon:[t.logoIcon,t.logoIcon,t.logoIcon],rainTexture:[t.rainTexture,t.rainTexture,t.rainTexture],snowTexture:[t.snowTexture,t.snowTexture,t.snowTexture],markerClusterIcon:[t.markerClusterIcon,t.markerClusterIcon,t.markerClusterIcon]},t}();e.Images=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(15),n=r(1),o=r(3),a=r(13),s=r(28),l=r(89),u=function(){function t(){}return t.getLongestSegmentLength=function(t){var e=n.MapUtils.getTileSize(),r=0;return t.forEach((function(t){if(t.getType()==i.GeometryType.LineString){for(var n=t.getGeometries().geometryCoordinates,s=0,l=0;l<n.length;++l){for(var u=[],h=0;h<n[l].length;++h){var c=new o.Vector2(n[l][h][0],n[l][h][1]);c.x=c.x*e,c.y=c.y*e,u.push(c)}for(h=0;h<u.length-1;++h)s+=a.MathUtils.distance(u[h],u[h+1])}s>r&&(r=s)}else console.warn("Invalid geometry type: "+t.getType())})),r},t.getLongestSegmentLengthForCollections=function(t,e){var r=0;return t.forEach((function(t){for(var i=t.geometryCoordinates,n=0,s=0;s<i.length;++s){for(var l=[],u=0;u<i[s].length;++u){var h=new o.Vector2(i[s][u][0],i[s][u][1]);h.x=h.x*e,h.y=h.y*e,l.push(h)}for(u=0;u<l.length-1;++u)n+=a.MathUtils.distance(l[u],l[u+1])}n>r&&(r=n)})),r},t.calculateDashTextureSize=function(t,e,r){t=t?Math.round(t):1,r.getType()==s.PatternType.Dot&&t<8&&(t=8);var i,n,o=a.MathUtils.findNextPowerOf2(t);if(r.getType()==s.PatternType.Dot)i=(i=o*(r.getRepeat()+1))>e?o:a.MathUtils.findNextPowerOf2(i),n=o;else if(r.getType()==s.PatternType.Dash){var l=r,u=l.getLength()+l.getGap();for(u>e&&(u=a.MathUtils.findPreviousPowerOf2(e)),i=o;i<u;)i+=o;i=a.MathUtils.findNextPowerOf2(i),n=o}return{width:i,height:n}},t.buildPatternItem=function(t){return!t||t.isSolid()?new s.SolidPattern:t.isDash()?new s.DashPattern({length:t.length,gap:t.gap}):t.isDot()?new s.DotPattern({repeat:t.repeat}):new s.IconPattern({url:t.texture})},t.createPatternTexture=function(e,r,i){var n=r.getPatternStyle(e.pattern),o=t.buildPatternItem(n);if(o.getType()!=s.PatternType.Dash&&o.getType()!=s.PatternType.Dot)return null;var a=e.patternTextureSize||{},u=a.width||1,h=a.height||1,c=o.getType()+"|"+u+"|"+h,p=i.getTexture(c);if(!p){var f=l.ImageUtils.createPolylineDashTextureImageData(u,h,o);p=i.createPolylineDashTexture(c,u,h,f)}return{texture:p,textureId:c}},t}();e.PolylineUtils=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(0),s=r(26),l=r(15),u=r(22),h=r(27),c=r(66),p=r(7),f=r(16);!function(t){t[t.LINE=0]="LINE",t[t.POLYGON=1]="POLYGON"}(o=e.SurfaceType||(e.SurfaceType={}));var d=function(t){function e(e,r){var i=t.call(this,e)||this;return i.gl=r,console.assert(e==a.LayerType.SURFACE||e==a.LayerType.BOUNDARY,"Invalid surface layer type"),i}return n(e,t),e.prototype.init=function(t){},e.prototype.upload=function(t,e){},e.prototype.destroy=function(){this.model&&this.model.destroy(),this.texture&&(this.texture.release(),this.texture=null,p.MapResourceManager.getInstance(this.gl).releaseTexture(this.textureId))},e.prototype.build=function(t,e,r,i,n){if(this.properties=r,i==l.GeometryType.LineString){this.surfaceType=o.LINE,this.model=new s.Model(this.gl),this.model.init(t,[new h.AttributeInfo("a_position",2,0,6),new h.AttributeInfo("a_extrude",2,2,6),new h.AttributeInfo("a_uv",2,4,6)],e);var a=c.PolylineUtils.createPatternTexture(r,n,p.MapResourceManager.getInstance(this.gl));a&&(this.textureId=a.textureId,this.texture=a.texture,this.texture.retain())}else i==l.GeometryType.Polygon&&(this.surfaceType=o.POLYGON,this.model=new s.Model(this.gl),this.model.init(t,[new h.AttributeInfo("a_position",2,0,2)],e))},e.prototype.getSurfaceType=function(){return this.surfaceType},e.prototype.getModel=function(){return this.model},e.prototype.getTexture=function(){return this.texture},e.prototype.getOrder=function(){return this.order},e.prototype.createOrder=function(t){var e=this.getLayerProperties();return this.order=new f.Order(t,e.getSortRank()),this.order},e}(u.LayerRenderData);e.SurfaceLayerRenderData=d},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(14),s=r(0),l=r(10),u=r(11),h=r(2),c=r(9);!function(t){t[t.Building=0]="Building",t[t.Selection=1]="Selection",t[t.Shadow=2]="Shadow"}(o=e.BuildingRenderType||(e.BuildingRenderType={}));var p=function(t){function e(e,r,i){var n=t.call(this,r,i)||this;return n.gl=e,n.fogStartUniformValue=Number.POSITIVE_INFINITY,n.fogRangeUniformValue=Number.POSITIVE_INFINITY,n.shadowMvpMatrix=new c.Matrix4,n}return n(e,t),e.prototype.render=function(){if(this.mapState.is3dMode()&&this.layer.mapView.isBuildingsEnabled())if(this.layer.getLayerType()==s.LayerType.BUILDING){var t=this.layer;this.renderInternal(o.Building,t)}else console.warn("This layer is not building !")},e.prototype.renderSelection=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==s.LayerType.BUILDING){var t=this.layer;this.renderInternal(o.Selection,t)}else console.warn("This layer is not building !")},e.prototype.renderShadowMapping=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==s.LayerType.BUILDING){var t=this.layer;this.renderInternal(o.Shadow,t)}else console.warn("This layer is not building !")},e.prototype.renderOutlining=function(t){var e=this;if(t&&0!=t.size){var r=l.ResourceManager.getInstance(this.gl).getShader(l.ShaderEnum.BUILDING_OUTLINING);r.bind(),this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilFunc(this.gl.NOTEQUAL,1,255),this.gl.stencilMask(0),t.forEach((function(t){var i=t.getModel();null!=i&&0!=i.attributeInfos.length&&(i.bind(),r.setAttributes(i.attributeInfos),e.gl.uniformMatrix4fv(r.modelMatrixUniform,!1,t.getScaledModelMatrix().buffer()),e.gl.uniformMatrix4fv(r.mvpMatrixUniform,!1,t.getScaledMvpMatrix().buffer()),i.render(e.gl.TRIANGLES),i.unbind())})),this.gl.disable(this.gl.STENCIL_TEST),r.disableAttributes()}},e.prototype.renderInternal=function(t,e){if(0!=e.textureBuildingGroups.size||0!=e.extrudeBuildings.length){var r=l.ResourceManager.getInstance(this.gl);this.gl.enable(this.gl.DEPTH_TEST);var i=null;if(this.fogStartUniformValue=Number.POSITIVE_INFINITY,this.fogRangeUniformValue=Number.POSITIVE_INFINITY,t===o.Building){if(this.mapState.getTilt()>h.MapConstants.maxTiltIntersectWithScreen){var n=h.MapConstants.defaultMaxNativeZoom,a=1.5*this.mapState.getScreenSize().y,s=Math.pow(2,Math.max(this.mapState.getZoom()-n,0));this.fogStartUniformValue=a*s+256}else this.fogStartUniformValue=99999999999,this.fogRangeUniformValue=99999999999;(i=e.effectManager.enableShadowEffect?r.getShader(l.ShaderEnum.BUILDING_WITH_SHADOW_SHADER):r.getShader(l.ShaderEnum.BUILDING_SHADER)).bind();var u=e.lightManager.sunLight,c=u.lightPosition,p=e.timeEffectManager.getFogColor();this.gl.uniform3f(i.lightPositionUniform,c.x,c.y,c.z),this.gl.uniform3fv(i.lightColorUniform,u.lightColor.rgbBuffer()),this.gl.uniform1f(i.fogStartUniform,this.fogStartUniformValue),this.gl.uniform1f(i.fogRangeUniform,this.fogRangeUniformValue),this.gl.uniform3fv(i.fogColorUniform,p.rgbBuffer())}else t===o.Selection?(i=r.getShader(l.ShaderEnum.BUILDING_SELECTION_SHADER)).bind():t===o.Shadow&&(e.effectManager.shadowMap.bind(),(i=r.getShader(l.ShaderEnum.SHADOW_MAPPING_SHADER)).bind());var f=new Set;this.renderTextureBuildings(t,e,i,f),this.renderExtrudeBuildings(t,e,i,f),this.gl.disable(this.gl.DEPTH_TEST),t==o.Shadow&&e.effectManager.shadowMap.unbind(),i.disableAttributes(),this.renderOutlining(f),f.clear()}},e.prototype.renderTextureBuildings=function(t,e,r,i){var n=this;if(0!=e.textureBuildingGroups.size){var c=l.ResourceManager.getInstance(this.gl).getTexture(l.TextureEnum.WHITE_TEXTURE);e.textureBuildingGroups.forEach((function(l){var p=l.getModel();null!=p&&0!=p.attributeInfos.length&&l.buildings.forEach((function(l){var f=l.getLayerProperties(),d=f.getId(),g=n.layer.mapView,y=l.getType();if((y==s.LayerType.USERBUILDING||!g.hasVisibleBuildings()||g.isVisibleBuilding(d))&&(y==s.LayerType.USERBUILDING||g.isVisibleBuilding(d)||!g.isHiddenBuilding(d))&&(y!=s.LayerType.USERBUILDING||f.isVisible())){if(l.finishedGrowUp()||(l.updateMatrices(n.mapState,!0),n.layer.mapView.requestRender()),t===o.Building){f.isSelected()&&(n.gl.enable(n.gl.STENCIL_TEST),n.gl.stencilFunc(n.gl.ALWAYS,1,255),n.gl.stencilMask(255),i.add(l));var m=l.getTexture();if(null!=m&&m.isLoaded||(m=c),(x=e.effectManager).enableShadowEffect){var v=x.shadowMap;n.shadowMvpMatrix.copy(l.getModelMatrix()),n.shadowMvpMatrix.concat(v.getLightViewProjectionMatrix()).concat(h.MapConstants.biasMatrix),r.setTexture(r.shadowMapUniform,v.getShadowMapTexture().textureId),n.gl.uniformMatrix4fv(r.shadowMvpMatrixUniform,!1,n.shadowMvpMatrix.buffer())}var _=n.mapState.cameraPositionVector;n.gl.uniform3f(r.cameraDirectionUniform,_.x,_.y,_.z),n.gl.uniformMatrix4fv(r.modelMatrixUniform,!1,l.getModelMatrix().buffer()),n.gl.uniformMatrix4fv(r.mvpMatrixUniform,!1,l.getMvpMatrix().buffer()),r.setTexture(r.textureUniform,m.textureId)}else if(t===o.Selection){var b=a.LayerRenderer.getSelectionCode();l.setSelectionCode(b);var w=u.Color.fromInt(b);n.gl.uniform3f(r.colorUniform,w.red,w.green,w.blue),n.gl.uniformMatrix4fv(r.mvpMatrixUniform,!1,l.getMvpMatrix().buffer())}else if(t===o.Shadow){var x;v=(x=e.effectManager).shadowMap;n.shadowMvpMatrix.copy(l.getModelMatrix()),n.shadowMvpMatrix.concat(v.getLightViewProjectionMatrix()),n.gl.uniformMatrix4fv(r.shadowMvpMatrixUniform,!1,n.shadowMvpMatrix.buffer())}p.bind(),r.setAttributes(p.attributeInfos),p.render(n.gl.TRIANGLES),p.unbind(),r.resetTextureUnit(),t===o.Building&&f.isSelected()&&n.gl.disable(n.gl.STENCIL_TEST)}}))}))}},e.prototype.renderExtrudeBuildings=function(t,e,r,i){var n=this;if(0!=e.extrudeBuildings.length){var c=l.ResourceManager.getInstance(this.gl).getTexture(l.TextureEnum.WHITE_TEXTURE);if(t===o.Building){var p=e.effectManager;if(p.enableShadowEffect){var f=p.shadowMap;r.setTexture(r.shadowMapUniform,f.getShadowMapTexture().textureId)}}e.extrudeBuildings.forEach((function(l){if(t!==o.Shadow){var p=l.getLayerProperties(),f=p.getId(),d=n.layer.mapView,g=l.getType();if((g==s.LayerType.USERBUILDING||!d.hasVisibleBuildings()||d.isVisibleBuilding(f))&&(g==s.LayerType.USERBUILDING||d.isVisibleBuilding(f)||!d.isHiddenBuilding(f))&&(g!=s.LayerType.USERBUILDING||p.isVisible())){var y=l.getModel();if(null!=y&&0!=y.attributeInfos.length){if(l.finishedGrowUp()||(l.updateMatrices(n.mapState,!0),n.layer.mapView.requestRender()),t===o.Building){p.isSelected()&&(n.gl.enable(n.gl.STENCIL_TEST),n.gl.stencilFunc(n.gl.ALWAYS,1,255),n.gl.stencilMask(255),i.add(l));var m=l.getTexture();if(null!=m&&m.isLoaded||(m=c),(x=e.effectManager).enableShadowEffect){var v=x.shadowMap;n.shadowMvpMatrix.copy(l.getModelMatrix()),n.shadowMvpMatrix.concat(v.getLightViewProjectionMatrix()).concat(h.MapConstants.biasMatrix),n.gl.uniformMatrix4fv(r.shadowMvpMatrixUniform,!1,n.shadowMvpMatrix.buffer())}var _=n.mapState.cameraPositionVector;r.setTexture(r.textureUniform,m.textureId),n.gl.uniform3f(r.cameraDirectionUniform,_.x,_.y,_.z),n.gl.uniformMatrix4fv(r.modelMatrixUniform,!1,l.getModelMatrix().buffer()),n.gl.uniformMatrix4fv(r.mvpMatrixUniform,!1,l.getMvpMatrix().buffer())}else if(t===o.Selection){var b=a.LayerRenderer.getSelectionCode();l.setSelectionCode(b);var w=u.Color.fromInt(b);n.gl.uniform3f(r.colorUniform,w.red,w.green,w.blue),n.gl.uniformMatrix4fv(r.mvpMatrixUniform,!1,l.getMvpMatrix().buffer())}else if(t===o.Shadow){var x;v=(x=e.effectManager).shadowMap;n.shadowMvpMatrix.copy(l.getModelMatrix()),n.shadowMvpMatrix.concat(v.getLightViewProjectionMatrix()),n.gl.uniformMatrix4fv(r.shadowMvpMatrixUniform,!1,n.shadowMvpMatrix.buffer())}y.bind(),r.setAttributes(y.attributeInfos),y.render(n.gl.TRIANGLES),y.unbind(),r.resetTextureUnit(),t===o.Building&&p.isSelected()&&n.gl.disable(n.gl.STENCIL_TEST)}}}}))}},e}(a.LayerRenderer);e.BuildingLayerRenderer=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=r(0),s=r(14),l=r(10),u=r(1),h=r(2),c=r(56),p=r(96),f=r(7),d=function(t){function e(e,r){var i=t.call(this,e,r)||this,n=l.ResourceManager.getInstance(i.layer.mapView.gl);return i.shader=n.getShader(l.ShaderEnum.SYMBOL_SHADER),i.model=n.getModel(l.ModelEnum.SYMBOL_MODEL),i.mvpMatrix=new o.Matrix4,i}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==a.LayerType.POI){if(!this.mapState.is3dMode()&&this.layer.mapView.isPOIsEnabled()){var t=this.layer;null!=t.poiRenderDatas&&0!=t.poiRenderDatas.length&&this.renderPOIs(t.poiRenderDatas)}}else console.error("Invalid layer type")},e.prototype.renderPOIs=function(t){var e=this,r=this.layer.mapView.gl;r.enable(r.BLEND),this.shader.bind(),this.model.bind(),this.shader.setAttributes(this.model.attributeInfos);for(var i=this.mapState.getOrthoProjectionMatrix(),n=[],o=f.MapResourceManager.getInstance(r),s=this.layer.layerType==a.LayerType.USERPOI,l=this.layer.mapView.getMapStyle(c.MapType.roadmap),d=this.mapState.mapSettings.getMapType()==c.MapType.satellite,g=t.end;g.valid;){var y=g.value,m=y.getLayerProperties();if(null!=m&&y.isVisible()){var v=null,_=0;s&&(v=y.getTexture());var b=void 0;if(!v){var w=l.getTextureStyle(m.textureName||"pois");if(null==w){g.prev();continue}if((v=o.getTexture(w.id))&&w.isSprites()){var x=m.iconIndex||0;_=x>0?1:2;var M=w.getSpritesInfo(),T=M.width,A=M.height,L=Math.floor((v.width+h.MapConstants.spritePadding)/(T+h.MapConstants.spritePadding));b={width:T/v.width,height:A/v.height,row:Math.floor(x/L),col:x%L}}}if(null!=v&&v.isLoaded){var S=h.MapConstants.placeWidth*u.MapUtils.pixelScale,E=h.MapConstants.placeHeight*u.MapUtils.pixelScale,P=y.getScreenCoordinate(),C=h.MapConstants.poiAnchor,I=m.iconColor?m.iconColor:h.MapConstants.poiDefaultColor;this.mvpMatrix.setIdentity(S/2,E/2,1),this.mvpMatrix.translate((.5-C.x)*S,(.5-C.y)*E,0),this.mvpMatrix.translate(P.x,P.y,0),this.mvpMatrix.concat(i),r.uniformMatrix4fv(this.shader.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),r.uniform4fv(this.shader.colorUniform,I.buffer()),r.uniform1i(this.shader.useMaskTextureUniform,_),_&&(r.uniform4f(this.shader.spriteInfoUniform,b.width,b.height,b.col,b.row),r.uniform2f(this.shader.paddingUniform,h.MapConstants.spritePadding/v.width,h.MapConstants.spritePadding/v.height)),this.shader.setTexture(this.shader.textureUniform,v.textureId),this.model.render(r.TRIANGLES),this.shader.resetTextureUnit(),y.isTextVisible()&&y.getTextData()&&n.push({textData:y.getTextData(),textDirection:y.getTextDirection(),color:d?h.MapConstants.satellitePOIColor:I,halo:d?h.MapConstants.satellitePOIHalo:m.getHaloColor(),coordinate:y.getTextCoordinate(),symbolWidth:S,symbolHeight:E,anchor:C}),g.prev()}else g.prev()}else g.prev()}n.length>0&&n.forEach((function(t){p.TextLabelRenderer.render(e.layer.mapView.gl,e.mapState,t.textData,t.coordinate,t.color,null!=t.halo,t.halo)})),this.model.unbind(),r.disable(r.BLEND)},e}(s.LayerRenderer);e.POILayerRenderer=d},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(184),s=r(54),l=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.BUILDING,i)||this;return n.extrudeBuildings=[],n.dirty=!0,n.textureBuildingGroups=new Map,n.buildingIds=new Set,n}return n(e,t),e.prototype.update=function(t){if(t.is3dMode())if(this.getLayerType()==o.LayerType.BUILDING){if(this.dirty&&(this.dirty=!1,this.mapView.isBuildingsEnabled())){this.clear();var e=this.mapView.tileManager.getTilePyramid().getRenderTiles();this.updateInternal(t,e)}}else console.warn("This layer is not building !")},e.prototype.updateInternal=function(t,e){var r=this,i=new Set(this.mapView.getSelectedBuildings());e.forEach((function(e){e.getTile().getTileRenderData().getLayerRenderDatas().forEach((function(e,n){if(e.getType()==r.getLayerType()){var l=e,u=e.getLayerProperties();if(r.isInFilterBuildingTypes(u.getTypes())){var h=u.getId();if(!r.buildingIds.has(h))if(r.buildingIds.add(h),l.updateMatrices(t),r.layerType!=o.LayerType.USERBUILDING&&u.setSelected(i.has(h)),l.getBuildingType()==s.BuildingType.Polygon)r.extrudeBuildings.push(l);else{var c=u.getModelName(),p=r.textureBuildingGroups.get(c);if(null==p){var f=new a.BuildingGroup(c);f.addBuilding(l),r.textureBuildingGroups.set(c,f)}else p.addBuilding(l)}}}}))})),this.lightManager.update(t.getCamera().getTarget())},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.setLightingManager=function(t){this.lightManager=t},Object.defineProperty(e.prototype,"effectManager",{get:function(){return this._effectManager},set:function(t){this._effectManager=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeEffectManager",{get:function(){return this._timeEffectManager},set:function(t){this._timeEffectManager=t},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.textureBuildingGroups.clear(),this.extrudeBuildings=[],this.buildingIds.clear()},Object.defineProperty(e.prototype,"filterBuildingTypes",{get:function(){return this._filterBuildingTypes},set:function(t){this._filterBuildingTypes=t,this.dirty=!0},enumerable:!0,configurable:!0}),e.prototype.isInFilterBuildingTypes=function(t){return!this._filterBuildingTypes||!this._filterBuildingTypes.length||this._filterBuildingTypes.length<1||!!t&&this._filterBuildingTypes.some((function(e){return-1!==t.indexOf(e)}))},e}(o.Layer);e.BuildingLayer=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e,r,i,n,o){this.annotationId=t,this.placeId=e,this.name=r,this.address=i,this.location=n,this.type=o};e.PlaceQueryResult=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(43);function a(t){var e,r=0;if(0==t.length)return r;for(e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return r}var s=function(t){function e(e,r,i,n){var o=t.call(this,e,r,i,n)||this,s=n.getLayerProperties();return o.rank=s.getRank(),o.hash=a(s.getId()),o.zoom=0,o}return n(e,t),e.prototype.setVisible=function(t){var e=this.renderData;e.setVisible(t),t||(e.setHideTextOnly(!1),e.setTextVisible(t))},e.prototype.isVisible=function(){return this.renderData.isVisible()},e}(o.CollisionItem);e.POICollisionIconRenderData=s;var l=function(t){function e(e,r,i,n){return t.call(this,e,r,i,n)||this}return n(e,t),e.prototype.setVisible=function(t){var e=this.renderData;e.setHideTextOnly(!0),e.setTextVisible(t)},e.prototype.isVisible=function(){return this.renderData.isTextVisible()},e}(s);e.POICollisionTextRenderData=l;var u=function(t){function e(e,r,i){var n=t.call(this,e,r,null,i)||this,o=i.getLayerProperties();return n.rank=o.getCollisionRank(),n.hash=a(o.getId()),n.zoom=o.getZoom(),n}return n(e,t),e.prototype.setVisible=function(t){this.renderData.getLayerProperties().setVisible(t)},e.prototype.isVisible=function(){return this.renderData.getLayerProperties().isVisible()},e}(o.CollisionItem);e.LabelCollisionRenderData=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.RIGHT=0]="RIGHT",t[t.LEFT=1]="LEFT",t[t.TOP=2]="TOP",t[t.BOTTOM=3]="BOTTOM"}(e.TextDirection||(e.TextDirection={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Rainy=0]="Rainy",t[t.Snowy=1]="Snowy",t[t.Sunny=2]="Sunny",t[t.Cloudy=3]="Cloudy",t[t.Live=4]="Live",t[t.None=5]="None"}(e.Weather||(e.Weather={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Live=0]="Live",t[t.Morning=1]="Morning",t[t.Noon=2]="Noon",t[t.AfterNoon=3]="AfterNoon",t[t.Evening=4]="Evening",t[t.None=5]="None"}(e.TimeEffect||(e.TimeEffect={}))},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=r(5);!function(t){var e=function(){function t(t){if(null==t)throw new Error("Parameter coordinate can not be null");this._coordinate=o.LatLng.convert(t)}return t.prototype.get=function(){return this._coordinate},t.prototype.forEachLatLng=function(t){this._coordinate&&t(this._coordinate)},t.prototype.getType=function(){return"Point"},t}();t.Point=e;var r=function(){function t(t){if(null==t)throw new Error("Parameter coordinates can not be null");this._coordinates=t.map((function(t){return o.LatLng.convert(t)}))}return t.prototype.forEachLatLng=function(t){this._coordinates&&this._coordinates.forEach((function(e){return t(e)}))},t.prototype.getType=function(){return"MultiPoint"},t.prototype.getArray=function(){return this._coordinates},t.prototype.getAt=function(t){return this._coordinates[t]},t.prototype.getLength=function(){return this._coordinates.length},t}();t.MultiPoint=r;var i=function(){function t(t){if(null==t)throw new Error("Parameter elements can not be null");this._elements=t.map((function(t){return o.LatLng.convert(t)}))}return t.prototype.forEachLatLng=function(t){this._elements&&this._elements.forEach((function(e){return t(e)}))},t.prototype.getType=function(){return"LineString"},t}();t.LineString=i;var s=function(){function t(t){if(null==t)throw new Error("Parameter elements can not be null");this._elements=t.map((function(t){return o.LatLng.convert(t)}))}return Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),t}();t.LinearRing=s;var l=function(){function t(t){if(null==t)throw new Error("Parameter element can not be null");this._elements=t}return t.prototype.forEachLatLng=function(t){this._elements.forEach((function(e){e.elements.forEach((function(e){return t(e)}))}))},t.prototype.getArray=function(){return this._elements},t.prototype.getAt=function(t){return this._elements[t]},t.prototype.getLength=function(){return this._elements.length},t.prototype.getType=function(){return"Polygon"},t}();t.Polygon=l;var u=function(){function t(t){if(null==t)throw new Error("Parameter elements can not be null");this._elements=t}return t.prototype.forEachLatLng=function(t){this._elements.forEach((function(e){return e.forEachLatLng(t)}))},t.prototype.getAt=function(t){if(t<0||t>=this._elements.length)throw new Error("Index out of size");return this._elements[t]},t.prototype.getLength=function(){return this._elements.length},t.prototype.getType=function(){return"MultiPolygon"},t}();t.MultiPolygon=u;var h=function(){function t(t){if(null==t)throw new Error("Parameter elements can not be null");this._elements=t}return t.prototype.forEachLatLng=function(t){this._elements.forEach((function(e){return e.forEachLatLng(t)}))},t.prototype.getAt=function(t){if(t<0||t>=this._elements.length)throw new Error("Index out of size");return this._elements[t]},t.prototype.getLength=function(){return this._elements.length},t.prototype.getType=function(){return"MultiLineString"},t}();t.MultiLineString=h;var c=function(t){function e(e,r,i){var n=t.call(this,a.ClassType.FEATURE)||this;return n._id=e,n._geometry=r,n._properties=i,n}return n(e,t),e.prototype.getId=function(){return this._id},e.prototype.getGeometry=function(){return this._geometry},e.prototype.getProperties=function(){return this._properties},e}(a.Map4dObject);t.Feature=c}(e.Data||(e.Data={}));var s=function(){function t(t){this._mapView=t}return t.prototype.addGeoJson=function(t){return this._mapView.getGeoJsonManager().addGeoJson(t)},t.prototype.add=function(t){return this._mapView.getGeoJsonManager().addFeature(t)},t.prototype.remove=function(t){return this._mapView.getGeoJsonManager().removeFeature(t)},t.prototype.clear=function(){return this._mapView.getGeoJsonManager().removeAllFeatures()},t.prototype.addListener=function(t,e){return this._mapView.addGeoJsonListener(t,e)},t.prototype.setMinZoom=function(t){if(null==t)throw Error("Parameter can not be null");this._mapView.setDataLayerMinZoom(t)},t.prototype.setMaxZoom=function(t){if(null==t)throw Error("Parameter can not be null");this._mapView.setDataLayerMaxZoom(t)},t.prototype.getMinZoom=function(){return this._mapView.getDataLayerMinZoom()},t.prototype.getMaxZoom=function(){return this._mapView.getDataLayerMaxZoom()},t}();e.MapData=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(4),o=r(113),a=r(6),s=r(8),l=r(13),u=r(2),h=r(114),c=r(12),p=r(1),f=function(){};e.CameraAnimationOptions=f;var d=function(){this.anchor=null,this.target=null,this.zoom=null,this.tilt=null,this.bearing=null};function g(t,e,r,i){var n=new o.UnitBezier(t,e,r,i);return function(t){return n.solve(t,u.MathConstants.epsilon)}}e.CameraOptions=d,e.bezier=g,e.defaultEasing=g(0,0,.25,1);var y=function(){function t(t,e,r){this.onUpdateTransitions=null,this.mapState=t,this.cameraAnimationObserver=e,this.mapSettings=r,this.flingTracker=new h.FlingTracker(u.MapConstants.flingTimeConstant,e,t)}return t.prototype.moveBy=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1);var n=new d,o=this.mapState.getTarget(),s=a.ProjectionMercator.getMetersPerPixelAtLatitude(u.MapConstants.metersPerPixelAtLatitude,this.mapState.getZoom()),l=new i.Vector2(t.x,t.y).multiply(s);l=l.rotateBy(-this.mapState.cameraPosition.getBearing()),n.target=a.ProjectionMercator.convertToLatLngFromMeter(a.ProjectionMercator.convertToMeterFromLatLng(o).add(l)),null==e?e=new f:null==e.duration&&(e.duration=p.MapUtils.getTimePanTo(this.mapState.getTarget(),n.target,this.mapState.getZoom())),e.gesture=r,this.mapState.gesture=r,this.mapState.movingTo=!0,this.easeTo(n,e)},t.prototype.moveTo=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1),null==e&&(e=new f),e.gesture=r,this.mapState.gesture=r,this.mapState.movingTo=!0,this.easeTo(t,e)},t.prototype.zoom=function(t,e,r){this.mapState.startedZoom=!0,this.flingTracker.stopFling(),r.duration||(r.duration=u.MapConstants.defaultAnimationDuration);var i=new d;i.zoom=t,i.anchor=e,this.easeTo(i,r)},t.prototype.isAnimated=function(){return this.mapState.panning||this.mapState.zoomIn||this.mapState.zoomOut||this.mapState.flyingTo},t.prototype.moveByVelocity=function(t){this.flingTracker.startFling(t.x,t.y)},t.prototype.setTilt=function(t,e){void 0===e&&(e=!1);var r=new d,i=new f;i.gesture=e,this.mapState.gesture=e,t=l.MathUtils.clamp(t,this.mapSettings.getMinTilt(),this.mapSettings.getMaxTilt()),r.tilt=t,this.mapState.tilting=!0,this.easeTo(r,i)},t.prototype.setBearing=function(t,e,r){void 0===r&&(r=!1);var i=new d,n=new f;n.gesture=r,this.mapState.gesture=r,i.bearing=t,e&&e>0&&(n.duration=1e3*e),this.mapState.bearing=!0,this.easeTo(i,n)},t.prototype.easeTo=function(t,e){var r=this,i=this.mapState.getZoom(),o=null!=t.zoom?t.zoom:this.mapState.getZoom(),l=this.mapState.getBearing(),h=this.mapState.getTilt(),c=this.mapState.getTarget(),p=t.bearing,f=t.tilt,d=null!=t.target?t.target:this.mapState.getTarget(),g=t.anchor,y=new n.LatLng(0,0);g&&((y=s.GeometryUtils.screenCoordinateToLatLng(g,this.mapState.cameraPosition,this.mapState.getScreenSize())).valid()||(y=this.mapState.getCamera().getTarget())),this.mapState.zoomIn=o>i&&o-i>u.MathConstants.epsilon,this.mapState.zoomOut=i>o&&i-o>u.MathConstants.epsilon,this.mapState.panning=c!=d;this.startTransition(e,(function(t){var e=+(i*(1-t)+o*t).toFixed(4);if(null!=p){var u=(l+(p-l)*t)%360;r.mapState.setBearing(u)}if(null!=f){var m=h+(f-h)*t;r.mapState.setTilt(m)}var v=c.lat*(1-t)+d.lat*t,_=c.lng*(1-t)+d.lng*t,b=new n.LatLng(v,_);if(r.mapState.setZoom(e),r.mapState.setTarget(b),g){var w=Math.pow(2,e),x=a.ProjectionMercator.projectScale(r.mapState.getTarget(),w),M=a.ProjectionMercator.projectScale(y,w),T=s.GeometryUtils.screenCoordinateToLatLng(g,r.mapState.cameraPosition,r.mapState.getScreenSize());T.valid()||(T=r.mapState.getTarget());var A=a.ProjectionMercator.projectScale(T,Math.pow(2,e));r.mapState.setTarget(a.ProjectionMercator.unproject(x.add(M).subtract(A),w))}}))},t.prototype.startTransition=function(t,r){var i=this,n=t.duration?t.duration:0,o=t.easing?t.easing:e.defaultEasing,a=0!=n;this.transitionStart=Date.now(),this.transitionDuration=n,this.mapState.isWillChange()||(this.mapState.willChange=!0,this.cameraAnimationObserver.notifyCameraWillChange(t.gesture)),this.onUpdateTransitions=function(e){var n=a?(e-i.transitionStart)/i.transitionDuration:1;return r(n>=1?1:o(n)),i.cameraAnimationObserver.notifyCameraIsChanging(),!(n<1)&&((i.mapState.isZoomIn()||i.mapState.isZoomOut()||(i.mapState.isMoving()||i.mapState.isBearing()||i.mapState.isTilting())&&!i.mapState.isGesture()||i.mapState.isFlyingTo()||i.mapState.isBearing()&&null!=t.duration)&&i.cameraAnimationObserver.notifyCameraDidChange(),!0)},a||(this.updateTransitions(),this.onUpdateTransitions=null)},t.prototype.stopAnimation=function(){this.mapState.isBearing()&&(this.mapState.bearing=!1,this.onUpdateTransitions=null,this.mapState.isWillChange()&&this.cameraAnimationObserver.notifyCameraDidChange()),this.mapState.gesture=!1},t.prototype.updateTransitions=function(){if(null!=this.onUpdateTransitions){var t=Date.now(),e=this.onUpdateTransitions;this.onUpdateTransitions=null,e&&e(t)?(this.mapState.zoomIn=!1,this.mapState.zoomOut=!1,this.mapState.panning=!1,this.mapState.flyingTo=!1,this.mapState.movingTo=!1,this.mapState.bearing=!1,this.mapState.tilting=!1,e=null,this.onUpdateTransitions=null):null==this.onUpdateTransitions&&(this.onUpdateTransitions=e)}else this.flingTracker.isFlingInProgress()&&this.flingTracker.trackMovement()&&this.moveBy(new c.Point(this.flingTracker.dx,this.flingTracker.dy),null,!0)},t.prototype.flyTo=function(t,e){var r=this;if(this.flingTracker.stopFling(),!this.isAnimated()){var n=this.mapState.getZoom(),o=t.target,s=n;null!=t.zoom&&(s=l.MathUtils.clamp(+t.zoom,this.mapSettings.getMinZoom(),this.mapSettings.getMaxZoom()));var h=this.mapState.getTarget(),c=a.ProjectionMercator.projectScale(h,this.mapState.getScale()),p=a.ProjectionMercator.projectScale(o,this.mapState.getScale()),f=Math.max(this.mapState.getScreenSize().x,this.mapState.getScreenSize().y),d=f/Math.pow(2,s-n),g=Math.hypot(p.x-c.x,p.y-c.y),y=1.42;if(null!=e.minZoom){var m=l.MathUtils.clamp(Math.min(e.minZoom,n,s),this.mapSettings.getMinZoom(),this.mapSettings.getMaxZoom()),v=f/Math.pow(2,m-n);y=Math.sqrt(v/g*2)}var _=y*y,b=function(t){var e=(d*d-f*f+(t?-1:1)*_*_*g*g)/(2*(t?d:f)*_*g);return Math.log(Math.sqrt(e*e+1)-e)},w=b(0),x=b(1),M=function(t){return k(w)/k(w+y*t)},T=function(t){return f*(k(w)*(R(e=w+y*t)/k(e))-R(w))/_/g;var e},A=(x-w)/y;if(Math.abs(g)<u.MathConstants.epsilon||!isFinite(A)){if(Math.abs(f-d)<u.MathConstants.epsilon)return this.easeTo(t,e);var L=d<f?-1:1;A=Math.abs(Math.log(d/f))/y,T=function(){return 0},M=function(t){return Math.exp(L*y*t)}}if(null!=e.duration)e.duration=+e.duration;else{var S=null!=e.velocity?+e.velocity/y:1.2;e.duration=1e3*A/S}e.duration>u.MapConstants.maxDurationFlyTo&&(e.duration=u.MapConstants.maxDurationFlyTo);var E=this.mapState.getScale(),P=this.mapState.getBearing(),C=this.mapState.getTilt(),I=t.bearing,O=t.tilt;this.mapState.flyingTo=!0,this.startTransition(e,(function(t){var e=function(t){var e=t*A,o=1===t?1:T(e),h=new i.Vector2(c.x*(1-o)+p.x*o,c.y*(1-o)+p.y*o),f=1/M(e),d=1===t?s:n+Math.log(f)/Math.LN2;return d=l.MathUtils.clamp(d,r.mapSettings.getPreferMinZoom(),r.mapSettings.getMaxZoom()),Math.abs(t-1)<u.MathConstants.epsilon&&(d=s),d!=d&&(d=s),{target:a.ProjectionMercator.unproject(h,E),zoom:d}}(t);if(r.mapState.setZoom(e.zoom),r.mapState.setTarget(e.target),null!=I){var o=(P+(I-P)*t)%360;r.mapState.setBearing(o)}if(null!=O){var h=C+(O-C)*t;r.mapState.setTilt(h)}}))}function R(t){return(Math.exp(t)-Math.exp(-t))/2}function k(t){return(Math.exp(t)+Math.exp(-t))/2}},t}();e.CameraAnimation=y},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(79),n=function(){function t(){this.layerIds=[],this.layers=new Map}return t.prototype.setTileLayers=function(t){this.layers=t},t.prototype.setTileLayer=function(t,e){this.layers.has(t)&&console.warn("TileLayer exist!!!",t),-1==this.layerIds.indexOf(t)&&this.layerIds.push(t),this.layers.set(t,e)},t.prototype.addTileLayer=function(t,e){return this.layers.has(t)||(this.layerIds.push(t),this.layers.set(t,new i.TileLayer(t,e))),this.layers.get(t)},t.prototype.removeTileLayer=function(t){this.layers.delete(t);var e=this.layerIds.indexOf(t);e>=0&&this.layerIds.splice(e,1)},t.prototype.getTileLayer=function(t){return this.layers.get(t)},t.prototype.getLayerIds=function(){return this.layerIds},t.prototype.hasLayerType=function(t){var e=!1;return this.layers.forEach((function(r){e||r.getType()===t&&(e=!0)})),e},t}();e.TileData=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(15),n=function(){function t(t,e){this.features=[],this.name=t,this.layerType=e}return t.prototype.getType=function(){return this.layerType},t.prototype.getName=function(){return this.name},t.prototype.featureCount=function(){return this.features.length},t.prototype.getFeatures=function(){return this.features},t.prototype.getFeature=function(t){return t>=0&&t<this.features.length?this.features[t]:null},t.prototype.addFeature=function(t,e,r,n){var o=new i.TileFeature(t,e,r,n);this.features.push(o)},t}();e.TileLayer=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.generate=function(){return Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)+this.count++},t.count=0,t}();e.UUID=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(18),a=function(t){function e(e,r){return t.call(this,o.Kind.VECTOR,e,r)||this}return n(e,t),e.prototype.destroy=function(){this.layerDatas.forEach((function(t){return t.destroy()}))},e}(r(125).GeometryTile);e.VectorTile=a},function(t,e,r){"use strict";t.exports=n,t.exports.default=n;var i=r(126);function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,r){if(!r)return e.indexOf(t);for(var i=0;i<e.length;i++)if(r(t,e[i]))return i;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,i,n){n||(n=g(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],l(n,t.leaf?i(o):o);return n}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,r,n,o){for(var a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=n||(a=e+Math.ceil((r-e)/n/2)*n,i(t,a,e,r,o),s.push(e,a,a,r))}n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],i=this.toBBox;if(!d(t,e))return r;for(var n,o,a,s,l=[];e;){for(n=0,o=e.children.length;n<o;n++)a=e.children[n],d(t,s=e.leaf?i(a):a)&&(e.leaf?r.push(a):f(t,s)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!d(t,e))return!1;for(var i,n,o,a,s=[];e;){for(i=0,n=e.children.length;i<n;i++)if(o=e.children[i],d(t,a=e.leaf?r(o):o)){if(e.leaf||f(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(t,e){if(!t)return this;for(var r,i,n,a,s=this.data,l=this.toBBox(t),u=[],h=[];s||u.length;){if(s||(s=u.pop(),i=u[u.length-1],r=h.pop(),a=!0),s.leaf&&-1!==(n=o(t,s.children,e)))return s.children.splice(n,1),u.push(s),this._condense(u),this;a||s.leaf||!f(s,l)?i?(r++,s=i.children[r],a=!1):s=null:(u.push(s),h.push(r),r=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:h,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,i){var n,o=r-e+1,s=this._maxEntries;if(o<=s)return a(n=g(t.slice(e,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(n=g([])).leaf=!1,n.height=i;var l,u,h,c,p=Math.ceil(o/s),f=p*Math.ceil(Math.sqrt(s));for(y(t,e,r,f,this.compareMinX),l=e;l<=r;l+=f)for(y(t,l,h=Math.min(l+f-1,r),p,this.compareMinY),u=l;u<=h;u+=p)c=Math.min(u+p-1,h),n.children.push(this._build(t,u,c,i-1));return a(n,this.toBBox),n},_chooseSubtree:function(t,e,r,i){for(var n,o,a,s,l,u,h,p,f,d;i.push(e),!e.leaf&&i.length-1!==r;){for(h=p=1/0,n=0,o=e.children.length;n<o;n++)l=c(a=e.children[n]),f=t,d=a,(u=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l)<p?(p=u,h=l<h?l:h,s=a):u===p&&l<h&&(h=l,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var i=this.toBBox,n=r?t:i(t),o=[],a=this._chooseSubtree(n,this.data,e,o);for(a.children.push(t),l(a,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)},_split:function(t,e){var r=t[e],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var o=this._chooseSplitIndex(r,n,i),s=g(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var i,n,o,a,l,u,h,p,f,d,g,y,m,v;for(u=h=1/0,i=e;i<=r-e;i++)n=s(t,0,i,this.toBBox),o=s(t,i,r,this.toBBox),f=n,d=o,g=void 0,y=void 0,m=void 0,v=void 0,g=Math.max(f.minX,d.minX),y=Math.max(f.minY,d.minY),m=Math.min(f.maxX,d.maxX),v=Math.min(f.maxY,d.maxY),a=Math.max(0,m-g)*Math.max(0,v-y),l=c(n)+c(o),a<u?(u=a,p=i,h=l<h?l:h):a===u&&l<h&&(h=l,p=i);return p},_chooseSplitAxis:function(t,e,r){var i=t.leaf?this.compareMinX:u,n=t.leaf?this.compareMinY:h;this._allDistMargin(t,e,r,i)<this._allDistMargin(t,e,r,n)&&t.children.sort(i)},_allDistMargin:function(t,e,r,i){t.children.sort(i);var n,o,a=this.toBBox,u=s(t,0,e,a),h=s(t,r-e,r,a),c=p(u)+p(h);for(n=e;n<r-e;n++)o=t.children[n],l(u,t.leaf?a(o):o),c+=p(u);for(n=r-e-1;n>=e;n--)o=t.children[n],l(h,t.leaf?a(o):o),c+=p(h);return c},_adjustParentBBoxes:function(t,e,r){for(var i=r;i>=0;i--)l(e[i],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(104),a=r(2),s=r(25),l=r(38),u=function(t){function e(e,r){var i=t.call(this,e)||this;return i.id=r,i.layerId=l.AnnotationManager.annotationLayerId+r.toString(),i}return n(e,t),e.prototype.reloadLayout=function(){this.geoJsonIndexer=null},e.prototype.updateTileData=function(t,e,r){var i=this;if(!this.geoJsonIndexer){var n={maxZoom:r,buffer:0,extent:a.MapConstants.tileExtend,tolerance:4};this.geoJsonIndexer=o.default(this.getFeatures(),n)}var l=this.geoJsonIndexer.getTile(t.getZoom(),t.getX(),t.getY());if(null!=l&&0!==l.features.length){var u=this.addTileLayer(e,this.layerId);l.features.forEach((function(t){var e=t.type,r=new s.GeometryCollection(t.geometry);u.addFeature(i.id.toString(),e,r,i.getProperties())}))}},e.prototype.getLayerId=function(){return this.layerId},e.prototype.clearIndex=function(){this.geoJsonIndexer=null},e}(r(5).Map4dObject);e.ShapeAnnotationData=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.TOP="top",t.BOTTOM="bottom",t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right"}(e.AnchorDirections||(e.AnchorDirections={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.easeOutBounce=function(t){if(t<0)return 0;if(t>1)return 1;var e=7.5625,r=2.75;return t<1/r?e*t*t:t<2/r?e*(t-=1.5/r)*t+.75:t<2.5/r?e*(t-=2.25/r)*t+.9375:e*(t-=2.625/r)*t+.984375},t}();e.Easing=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(26),a=r(15),s=r(0),l=r(53),u=r(1),h=r(3),c=r(27),p=r(22),f=r(28),d=r(7),g=r(66),y=r(89),m=function(t){function e(e,r,i){var n=t.call(this,s.LayerType.LINE)||this;return n.gl=r,n.createDashTexture(e,i),n.buildPolyline(e),n}return n(e,t),e.prototype.getModel=function(){return this.lineModel},e.prototype.getTexture=function(){return this.texture},e.prototype.getSelectionCode=function(){return this.selectionCode},e.prototype.setSelectionCode=function(t){this.selectionCode=t},e.prototype.createDashTexture=function(t,e){var r=this,i=t.getFeature(0).getProperties(),n=i.getStrokePattern();if(n&&n.getType()!=f.PatternType.Solid){var o=d.MapResourceManager.getInstance(this.gl);if(n.getType()==f.PatternType.Icon){var a=n.getUrl(),s=function(){var t=i.getStrokeWidth();r.texture.height>1&&(!t||t<1)&&i.setStrokeWidth(r.texture.height)};return this.texture=o.getTexture(a),void(this.texture?s():this.texture=o.createPolylineIconTexture(a,a,(function(){s(),e&&e()})))}var l=g.PolylineUtils.getLongestSegmentLength(t.features),u=g.PolylineUtils.calculateDashTextureSize(i.getStrokeWidth(),l,n),h=u.width||1,c=u.height||1,p=n.getType()+"|"+h+"|"+c;if(this.texture=o.getTexture(p),!this.texture){var m=y.ImageUtils.createPolylineDashTextureImageData(h,c,n);this.texture=o.createPolylineDashTexture(p,h,c,m)}}},e.prototype.buildPolyline=function(t){var e=t.getFeature(0).getProperties(),r=[],i=new l.PolylineBuilderContext;i.addVertex=function(t,e,i){r.push(t.x,t.y,e.x,e.y,i.x,i.y)},i.lineCapType=e.getLineCapType(),i.lineJoinType=e.getLineJoinType(),i.textureWidth=this.texture?this.texture.width:1,i.textureHeight=this.texture?this.texture.height:1;for(var n=u.MapUtils.getTileSize(),s=t.featureCount(),p=0;p<s;++p){var f=t.getFeature(p);if(f.getType()!=a.GeometryType.LineString)return void console.warn("Invalid geometry type: "+f.getType());for(var d=f.getGeometries().geometryCoordinates,g=0;g<d.length;++g){for(var y=[],m=0;m<d[g].length;++m){var v=new h.Vector2(d[g][m][0],d[g][m][1]);v.x=v.x*n,v.y=v.y*n,y.push(v)}i.buildPolyLine(y,null,e.getStrokeWidth())}}this.lineModel=new o.Model(this.gl),this.lineModel.init(r,[new c.AttributeInfo("a_position",2,0,6),new c.AttributeInfo("a_extrude",2,2,6),new c.AttributeInfo("a_uv",2,4,6)],i.indices)},e.prototype.destroy=function(){this.lineModel&&this.lineModel.destroy(),this.texture&&(this.texture=null)},e.prototype.init=function(t){var e=t[0].getProperties();this.setLayerProperties(e)},e.prototype.upload=function(t,e){},e.defaultStrokeWidth=5,e}(p.LayerRenderData);e.LineLayerRenderData=m},function(t,e,r){"use strict";function i(t,e,r){r=r||2;var i,s,l,u,h,f,d,y=e&&e.length,m=y?e[0]*r:t.length,v=n(t,0,m,r,!0),_=[];if(!v||v.next===v.prev)return _;if(y&&(v=function(t,e,r,i){var a,s,l,u,h,f=[];for(a=0,s=e.length;a<s;a++)l=e[a]*i,u=a<s-1?e[a+1]*i:t.length,(h=n(t,l,u,i,!1))===h.next&&(h.steiner=!0),f.push(g(h));for(f.sort(c),a=0;a<f.length;a++)p(f[a],r),r=o(r,r.next);return r}(t,e,v,r)),t.length>80*r){i=l=t[0],s=u=t[1];for(var b=r;b<m;b+=r)(h=t[b])<i&&(i=h),(f=t[b+1])<s&&(s=f),h>l&&(l=h),f>u&&(u=f);d=0!==(d=Math.max(l-i,u-s))?1/d:0}return a(v,_,r,i,s,d),_}function n(t,e,r,i,n){var o,a;if(n===E(t,e,r,i)>0)for(o=e;o<r;o+=i)a=A(o,t[o],t[o+1],a);else for(o=r-i;o>=e;o-=i)a=A(o,t[o],t[o+1],a);return a&&_(a,a.next)&&(L(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!_(i,i.next)&&0!==v(i.prev,i,i.next))i=i.next;else{if(L(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function a(t,e,r,i,n,c,p){if(t){!p&&c&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=d(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,i=r,s=0,e=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,u*=2}while(a>1)}(n)}(t,i,n,c);for(var f,g,y=t;t.prev!==t.next;)if(f=t.prev,g=t.next,c?l(t,i,n,c):s(t))e.push(f.i/r),e.push(t.i/r),e.push(g.i/r),L(t),t=g.next,y=g.next;else if((t=g)===y){p?1===p?a(t=u(o(t),e,r),e,r,i,n,c,2):2===p&&h(t,e,r,i,n,c):a(o(t),e,r,i,n,c,1);break}}}function s(t){var e=t.prev,r=t,i=t.next;if(v(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(y(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(t,e,r,i){var n=t.prev,o=t,a=t.next;if(v(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,h=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,c=d(s,l,e,r,i),p=d(u,h,e,r,i),f=t.prevZ,g=t.nextZ;f&&f.z>=c&&g&&g.z<=p;){if(f!==t.prev&&f!==t.next&&y(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==t.prev&&g!==t.next&&y(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&y(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==t.prev&&g!==t.next&&y(n.x,n.y,o.x,o.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function u(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!_(n,a)&&b(n,i,i.next,a)&&M(n,a)&&M(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),L(i),L(i.next),i=t=a),i=i.next}while(i!==t);return o(i)}function h(t,e,r,i,n,s){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(l,u)){var h=T(l,u);return l=o(l,l.next),h=o(h,h.next),a(l,e,r,i,n,s),void a(h,e,r,i,n,s)}u=u.next}l=l.next}while(l!==t)}function c(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r;var l,u=r,h=r.x,c=r.y,p=1/0;i=r;do{n>=i.x&&i.x>=h&&n!==i.x&&y(o<c?n:a,o,h,c,o<c?a:n,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(n-i.x),M(i,t)&&(l<p||l===p&&(i.x>r.x||i.x===r.x&&f(r,i)))&&(r=i,p=l)),i=i.next}while(i!==u);return r}(t,e)){var r=T(e,t);o(e,e.next),o(r,r.next)}}function f(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function d(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function y(t,e,r,i,n,o,a,s){return(n-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&b(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(M(t,e)&&M(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||_(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,r,i){var n=x(v(t,e,r)),o=x(v(t,e,i)),a=x(v(r,i,t)),s=x(v(r,i,e));return n!==o&&a!==s||(!(0!==n||!w(t,r,e))||(!(0!==o||!w(t,i,e))||(!(0!==a||!w(r,t,i))||!(0!==s||!w(r,e,i)))))}function w(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function x(t){return t>0?1:t<0?-1:0}function M(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function T(t,e){var r=new S(t.i,t.x,t.y),i=new S(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function A(t,e,r,i){var n=new S(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function L(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,r,i){for(var n=0,o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}t.exports=i,t.exports.default=i,i.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,a=Math.abs(E(t,0,o,r));if(n)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,h=s<l-1?e[s+1]*r:t.length;a-=Math.abs(E(t,u,h,r))}var c=0;for(s=0;s<i.length;s+=3){var p=i[s]*r,f=i[s+1]*r,d=i[s+2]*r;c+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[n][o][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this._text=t,this._size=e}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"text: "+this._text+" size: "+this._size},t}();e.TextLabel=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(13),o=r(28),a=function(){function t(){}return t.createPolylineDashImageData=function(t,e,r){for(var i=new Array(t*e*4).fill(0),n=0,o=0;o<e;++o)for(var a=0;a<t;++a)i[n]=255,i[n+1]=0,i[n+2]=0,i[n+3]=a<t*r?(t-a)/t:255,n+=4;return i},t.createPolylineCircleImageData=function(t,e){for(var r=new Array(t*e*4).fill(0),o=0,a=new i.Vector2(t/2,e/2),s=e/2,l=0;l<e;++l)for(var u=0;u<t;++u){r[o]=0,r[o+1]=0,r[o+2]=0;var h=n.MathUtils.distance(new i.Vector2(u,l),a);r[o+3]=h>s?0:n.MathUtils.clamp((s-h)/s*255*t/2,0,255),o+=4}return r},t.createPolylineDashTextureImageData=function(e,r,i){var n=null;if(i.getType()==o.PatternType.Dot)n=new Uint8Array(t.createPolylineCircleImageData(e,r));else if(i.getType()==o.PatternType.Dash){var a=i,s=a.getLength(),l=a.getGap(),u=l/(s+l);n=new Uint8Array(t.createPolylineDashImageData(e,r,u))}return n},t}();e.ImageUtils=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(22),s=r(16),l=function(t){function e(e){var r=t.call(this,e||o.LayerType.POI)||this;return r.textData=null,r}return n(e,t),e.prototype.destroy=function(){this.textData&&this.textData.destroy()},e.prototype.init=function(t){var e=this;t&&t.forEach((function(t){e.properties=t.getProperties()}))},e.prototype.upload=function(t,e){},e.prototype.getOrder=function(){if(!this.order){var t=this.getLayerProperties();this.order=new s.Order(t.getId(),t.getRank())}return this.order},e.prototype.isVisible=function(){return this.visible},e.prototype.setVisible=function(t){this.visible=t},e.prototype.isTextVisible=function(){return this.textVisible},e.prototype.setTextVisible=function(t){this.textVisible=t},e.prototype.isHideTextOnly=function(){return this.hideTextOnly},e.prototype.setHideTextOnly=function(t){this.hideTextOnly=t},e.prototype.getTextData=function(){return this.textData},e.prototype.setTextData=function(t){this.textData=t},e.prototype.getTextDirection=function(){return this.textDirection},e.prototype.setTextDirection=function(t){this.textDirection=t},e.prototype.getLineNumber=function(){return this.textData.width/this.textData.size},e.prototype.getScreenCoordinate=function(){return this.screenCoordinate},e.prototype.setScreenCoordinate=function(t){this.screenCoordinate=t},e.prototype.getTextCoordinate=function(){return this.textCoordinate},e.prototype.setTextCoordinate=function(t){this.textCoordinate=t},e}(a.LayerRenderData);e.POILayerRenderData=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(22),a=r(15),s=r(54),l=r(9),u=r(0),h=r(3),c=r(2),p=r(6),f=r(8),d=r(7),g=r(145),y=r(12),m=function(t){function e(e){var r=t.call(this,e)||this;return r.model=null,r.texture=null,r.extrudeData=null,r.growUpscale=0,r.isGrowing=!0,r.modelMatrix=new l.Matrix4,r.mvpMatrix=new l.Matrix4,r.scaledModelMatrix=new l.Matrix4,r.scaledMvpMatrix=new l.Matrix4,r}return n(e,t),e.prototype.destroy=function(){var t=this.properties,e=d.MapResourceManager.getInstance(this.gl);this.model&&(this.model.release(),this.model=null,e.releaseModel(t.getModelName())),this.texture&&this.type==s.BuildingType.Texture&&(this.texture.release(),this.texture=null,e.releaseTexture(t.getTextureName()))},e.prototype.getId=function(){return this.properties.getId()},e.prototype.getModel=function(){return this.model||this.bind(),this.model},e.prototype.getTexture=function(){return this.texture||this.bind(),this.texture},e.prototype.getBuildingType=function(){return this.type},e.prototype.getSelectionCode=function(){return this.selectionCode},e.prototype.setSelectionCode=function(t){this.selectionCode=t},e.prototype.getModelMatrix=function(){return this.modelMatrix},e.prototype.getMvpMatrix=function(){return this.mvpMatrix},e.prototype.getScaledModelMatrix=function(){return this.scaledModelMatrix},e.prototype.getScaledMvpMatrix=function(){return this.scaledMvpMatrix},e.prototype.finishedGrowUp=function(){return!this.isGrowing},e.prototype.resetScaleZ=function(){this.growUpscale=0,this.isGrowing=!0},e.prototype.init=function(t){var e=this;t.forEach((function(t){var r=t.getProperties();if(e.properties=r,t.getType()==a.GeometryType.Polygon){e.type=s.BuildingType.Polygon;for(var i=[],n=[],o=r.getCoordinates(),l=p.ProjectionMercator.convertToMeterFromLatLng(r.getLocation()),u=0;u<o.length;u++){var h=p.ProjectionMercator.convertToMeterFromLatLng(o[u]);n.push(new y.Point(h.x-l.x,l.y-h.y))}i.push(n),e.extrudeData=g.BuildingExtrudeUtils.extrudePolygon(i,1)}else e.type=s.BuildingType.Texture}))},e.prototype.bind=function(t){void 0===t&&(t=null);var e=this.properties,r=d.MapResourceManager.getInstance(this.gl);if(this.model=r.getModel(e.getModelName()),this.type==s.BuildingType.Polygon){if(null==this.model&&null!=this.extrudeData){this.model=r.createExtrudeModel(e.getModelName());var i=[].concat.apply([],this.extrudeData.vertices);this.model.init3dObject(i,this.extrudeData.indices),this.model.retain(),t&&t()}this.extrudeData=null}else this.model||(this.model=r.createModel(e.getModelName(),e.getModelUrl(),t)),this.texture=r.getTexture(e.getTextureName()),this.texture||(this.texture=r.createBuildingTexture(e.getTextureName(),e.getTextureUrl())),this.model&&this.model.retain(),this.texture&&this.texture.retain()},e.prototype.upload=function(t,e,r){void 0===r&&(r=null),this.gl=t;var i=this.properties,n=d.MapResourceManager.getInstance(this.gl);n.hasVisibleBuildingId(i.getId())&&(this.growUpscale=1),n.retainVisibleBuildingId(i.getId()),(null==e||e.mapSettings.objectsEnabled||this.layerType!=u.LayerType.BUILDING)&&this.bind(r)},e.prototype.updateMatrices=function(t,r){void 0===r&&(r=!1);var i=this.properties,n=1/p.ProjectionMercator.getMetersPerPixelAtLatitude(c.MapConstants.metersPerPixelAtLatitude,t.getZoom()),o=p.ProjectionMercator.projectScale(i.getLocation(),t.getScale()),a=f.GeometryUtils.pixelCoordinateToCameraCoordinate(new h.Vector2(o.x,o.y),t.cameraPosition),l=t.is3dMode()?f.GeometryUtils.getElevationPixelFromMeter(i.getElevation(),t.cameraPosition):0;r&&this.isGrowing&&(this.growUpscale+=.05,this.growUpscale>1&&(this.growUpscale=1,this.isGrowing=!1));var u=i.getScale()*n,d=this.growUpscale*i.getScale()*n;this.type!=s.BuildingType.Extrude&&this.type!=s.BuildingType.Polygon||(d*=i.getHeight()),this.modelMatrix.setRotationX(e.buildingRotationX),this.modelMatrix.rotateZ(i.getBearing()),this.modelMatrix.scale(u,u,d),this.modelMatrix.translate(a.x,a.y,l),this.mvpMatrix.copy(this.modelMatrix),this.mvpMatrix.concat(t.getViewProjectionMatrix());var g=.1,y=.1,m=.015;if(this.model&&this.model.minX&&this.model.minY&&this.model.maxX&&this.model.maxY){var v=5/(this.model.maxX-this.model.minX);v=v==1/0?.1:v,g=Math.max(g,v),v=(v=5/(this.model.maxY-this.model.minY))==1/0?.1:v,y=Math.max(y,v),v=(v=.5/(this.model.maxZ-this.model.minZ))==1/0?.1:v,m=Math.max(m,v)}this.scaledModelMatrix.setRotationX(e.buildingRotationX),this.scaledModelMatrix.rotateZ(i.getBearing()),this.scaledModelMatrix.scale(u+g,u+y,d+m),this.scaledModelMatrix.translate(a.x,a.y,l),this.scaledMvpMatrix.copy(this.scaledModelMatrix),this.scaledMvpMatrix.concat(t.getViewProjectionMatrix())},e.buildingRotationX=90,e}(o.LayerRenderData);e.BuildingLayerRenderData=m},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(93),n=r(94),o=r(149),a=r(0),s=r(91),l=r(90),u=r(150),h=r(32),c=r(25),p=r(15),f=r(79),d=r(11),g=r(56),y=r(2),m=r(54),v=r(6),_=r(1),b=r(151),w=r(17),x=function(){function t(t,e,r,i){this.mapView=t,this.taskManager=e,this.requestRender=r,this.requestsMap=i}return t.prototype.update=function(){},t.prototype.isAllRequestFinished=function(){return 0==this.requestsMap.size},t.prototype.requestData=function(t,e,r,i,n,o){switch(e){case h.Resource.Tile:this.requestTileData(t,r);break;case h.Resource.RasterOverlay:this.requestRasterOverlayData(t,r,i);break;case h.Resource.POIOverlay:this.requestPOIOverlayData(t,r,i,n,o);break;case h.Resource.BuildingOverlay:this.requestBuildingOverlayData(t,r,i,n,o);break;default:console.warn("Unsupport request data for type:",e)}},t.prototype.requestRasterOverlayData=function(t,e,r){var i=this,n=t.getTileCoordinate(),s=new h.RequestTask(h.Resource.Texture),l=n.toString()+"_RasterOverlay:"+r;s.url=e,s.completion=function(e){if(e.success&&null!=e.data){var n=i.mapView.gl,s=i.mapView.mapState,h=t.getTileData(),d=t.getTileRenderData(),g=new f.TileLayer(r,a.LayerType.RASTER_OVERLAY),y=new o.RasterLayerProperties(e.data),m=new c.GeometryCollection([]);g.addFeature(r,p.GeometryType.Raster,m,y),h.setTileLayer(r,g);var v=new u.RasterLayerRenderData;v.init(g.getFeatures()),v.upload(n,s),d.setLayerRenderData(r,v),t.setRenderable(),i.requestRender(),i.requestsMap.delete(l)}},this.requestsMap.set(l,s),this.taskManager.postTask(s)},t.prototype.requestPOIOverlayData=function(t,e,r,i,o){var s=this,u=t.getTileCoordinate(),m=new h.RequestTask(h.Resource.POIOverlay),v=u.toString()+"_POIOverlay:"+r;m.url=e,m.completion=function(e){if(e.success&&null!=e.data){var h=s.mapView.gl,m=s.mapView.mapState,b=t.getTileData(),x=t.getTileRenderData(),M=s.mapView.getMapStyle(w.MapType.roadmap),T=o(e.data)||[];if(T.length>0){var A=new f.TileLayer(r,a.LayerType.POI_OVERLAY);T.forEach((function(t){if(null!=t){var e=t.type,r=M.build("pois","points",u.getZoom(),e,null);if(null!=r){var o=new n.POILayerProperties;o.setId(i+t.id||""),o.setTitle(t.title||""),o.setPosition(g.LatLng.convert(t.position||{lat:0,lng:0})),o.setRank(t.zIndex||0),o.setType(e),o.setTypes([e]),o.iconColor=r.color,o.textureName=r.texture,o.iconIndex=r.iconIndex,o.setFontSize(null!=r.size?r.size:y.MapConstants.placeFontSize*_.MapUtils.pixelScale),o.setHaloColor(r.halo.color?r.halo.color:d.Color.fromInt(16777215));var a=new c.GeometryCollection([]);A.addFeature(o.getId(),p.GeometryType.Point,a,o)}}})),b.setTileLayer(r,A),A.getFeatures().forEach((function(t){var e=new l.POILayerRenderData(a.LayerType.POI_OVERLAY);e.init([t]),e.upload(h,m),x.setLayerRenderData(t.getId(),e)}))}t.setRenderable(),s.requestRender(),s.requestsMap.delete(v)}},this.requestsMap.set(v,m),this.taskManager.postTask(m)},t.prototype.requestBuildingOverlayData=function(t,e,r,n,o){var l=this,u=t.getTileCoordinate(),d=new h.RequestTask(h.Resource.BuildingOverlay),y=u.toString()+"_BuildingOverlay:"+r;d.url=e,d.completion=function(e){if(e.success&&null!=e.data){var u=l.mapView.gl,h=l.mapView.mapState,d=t.getTileData(),_=t.getTileRenderData(),b=o(e.data)||[];if(b.length>0){for(var w=l.mapView.mapSettings.getDate().getTime(),x=b.length;x--;){var M=b[x],T=null!=M.startDate?M.startDate:Number.NEGATIVE_INFINITY,A=null!=M.endDate?M.endDate:Number.POSITIVE_INFINITY;(T>w||A<w)&&b.splice(x,1)}var L=new f.TileLayer(r,a.LayerType.BUILDING_OVERLAY);b.forEach((function(t){if(null!=t){var e=new i.BuildingLayerProperties;e.setId(n+t.id),e.setName(t.name||"Unknown name"),e.setHeight(t.height||1),e.setScale(t.scale||1),e.setBearing(t.bearing),e.setLocation(g.LatLng.convert(t.position||{lat:0,lng:0})),e.setElevation(t.elevation||0),e.setTypes([]),e.setStartDate(t.startDate||Number.NEGATIVE_INFINITY),e.setEndDate(t.endDate||Number.POSITIVE_INFINITY),e.setModelName(l.getNameFromUrl(t.model)),e.setModelUrl(t.model||""),e.setTextureName(l.getNameFromUrl(t.texture)),e.setTextureUrl(t.texture||""),null!=t.model?e.setModelType("Object"):e.setModelType("Polygon");var r=l.getBuildingType(e.getModelType()),o=new c.GeometryCollection([]);if(r==m.BuildingType.Extrude){for(var a=v.ProjectionMercator.convertToMeterFromLatLng(e.getLocation()),s=[],u=[],h=0;h<t.coordinates.length;++h){var f=t.coordinates[h],d=g.LatLng.convert(f);u.push(d);var y=v.ProjectionMercator.convertToMeterFromLatLng(d);s.push(new g.Point(y.x-a.x,a.y-y.y))}e.setCoordinates(u),o.geometryCoordinates.push(s),e.setModelName(e.getId()),L.addFeature(e.getId(),p.GeometryType.Polygon,o,e)}else L.addFeature(e.getId(),p.GeometryType.Building,o,e)}})),d.setTileLayer(r,L),L.getFeatures().forEach((function(t){var e=new s.BuildingLayerRenderData(L.getType());e.init([t]),e.upload(u,h),_.setLayerRenderData(t.getId(),e)})),l.mapView.overlayManager.dirtyBuildingOverlay()}t.setRenderable(),l.requestRender(),l.requestsMap.delete(y)}},this.requestsMap.set(y,d),this.taskManager.postTask(d)},t.prototype.requestTileData=function(t,e){var r=this,x=this.mapView.getMapStyle(),M=t.getTileCoordinate(),T=new h.RequestTask(h.Resource.Tile);T.url=e,T.tile={zoom:M.getZoom(),x:M.getX(),y:M.getY()},T.config={scale:_.MapUtils.pixelScale,format:this.mapView.mapSettings.getVectorFormat(),language:this.mapView.mapSettings.getMapLanguage(),style:x.json},T.completion=function(e){if(e.success&&null!=e.data){var h=r.mapView.gl,T=r.mapView.mapState,A=t.getTileData(),L=t.getTileRenderData(),S=e.data.result||{};if(null!=S.rasterTile){var E=new f.TileLayer(y.LayerConstants.rasterTileLayerId,a.LayerType.RASTER),P=new o.RasterLayerProperties(S.rasterTile),C=new c.GeometryCollection([]);E.addFeature(y.LayerConstants.rasterTileLayerId,p.GeometryType.Raster,C,P),A.setTileLayer(y.LayerConstants.rasterTileLayerId,E);var I=new u.RasterLayerRenderData;I.init(E.getFeatures()),I.upload(h,T),L.setLayerRenderData(y.LayerConstants.rasterTileLayerId,I)}var O=S.places||[];if(O.length>0){O.sort((function(t,e){var r=(t.rank||{}).value||0;return((e.rank||{}).value||0)-r}));for(var R=r.mapView.getMapStyle(w.MapType.roadmap),k=new f.TileLayer(y.LayerConstants.pointTileLayerId,a.LayerType.POI),D=0,B=O;D<B.length;D++){var U=B[D];if(null!=U){var j=U.types||[],N=R.build("pois","points",M.getZoom(),j.length>0?j[0]:null,null);if(null!=N){var V=new n.POILayerProperties;V.setId(U.id),V.setTitle(U.name),V.setPosition(g.LatLng.convert(U.location)),V.setSubtitle(U.address),V.setTypes(j),V.setRank((U.rank||{}).value||0),V.setType(j.length>0?j[0]:"point"),V.iconColor=N.color,V.textureName=N.texture,V.iconIndex=N.iconIndex,V.setFontSize(null!=N.size?N.size:y.MapConstants.placeFontSize*_.MapUtils.pixelScale),V.setHaloColor(N.halo.color?N.halo.color:d.Color.fromInt(16777215));C=new c.GeometryCollection([]);if(k.addFeature(V.getId(),p.GeometryType.Point,C,V),k.featureCount()>=y.MapConstants.maxPlacePerTile)break}}}A.setTileLayer(y.LayerConstants.pointTileLayerId,k),k.getFeatures().forEach((function(t){var e=new l.POILayerRenderData;e.init([t]),e.upload(h,T),L.setLayerRenderData(t.getId(),e)}))}var F=S.objects||[];if(F.length>0){for(var z=r.mapView.mapSettings.getDate().getTime(),Z=F.length;Z--;){var G=F[Z],W=null!=G.startDate?G.startDate:Number.NEGATIVE_INFINITY,Y=null!=G.endDate?G.endDate:Number.POSITIVE_INFINITY;(W>z||Y<z)&&F.splice(Z,1)}for(var H=new f.TileLayer(y.LayerConstants.buildingTileLayerId,a.LayerType.BUILDING),X=0,q=F;X<q.length;X++){var J=q[X];if(null!=J){var Q=new i.BuildingLayerProperties;Q.setId(J.id||""),Q.setName(J.name||"Unknown name"),Q.setHeight(J.model.height||1),Q.setScale(J.scale||1),Q.setBearing(J.bearing),Q.setLocation(g.LatLng.convert(J.location||{lat:0,lng:0})),Q.setElevation(J.elevation||0),Q.setCamera(J.camera),Q.setTypes(J.types||[]),Q.setMinZoom(J.minZoom||0),Q.setMaxZoom(J.maxZoom||0),Q.setStartDate(J.startDate||Number.NEGATIVE_INFINITY),Q.setEndDate(J.endDate||Number.POSITIVE_INFINITY);var K=J.model.objName||"";Q.setModelName(K),Q.setModelUrl(y.ServerConstants.getModelObjUrl(K));var $=J.model.textureName||"";Q.setTextureName($),Q.setTextureUrl(y.ServerConstants.getModelTextureUrl($));var tt=J.model.type||"Object";Q.setModelType(tt);var et=r.getBuildingType(J.model.type),rt=new c.GeometryCollection([]);if(et==m.BuildingType.Extrude||et==m.BuildingType.ExternalExtrude){for(var it=v.ProjectionMercator.convertToMeterFromLatLng(Q.getLocation()),nt=[],ot=[],at=0;at<J.model.coordinates.length;++at){var st=J.model.coordinates[at],lt=g.LatLng.convert(st);ot.push(lt);var ut=v.ProjectionMercator.convertToMeterFromLatLng(lt);nt.push(new g.Point(ut.x-it.x,it.y-ut.y))}Q.setCoordinates(ot),rt.geometryCoordinates.push(nt),Q.setModelName(Q.getId()),H.addFeature(Q.getId(),p.GeometryType.Polygon,rt,Q)}else H.addFeature(Q.getId(),p.GeometryType.Building,rt,Q)}}A.setTileLayer(y.LayerConstants.buildingTileLayerId,H),H.getFeatures().forEach((function(t){var e=new s.BuildingLayerRenderData(H.getType());e.init([t]),e.upload(h,T),L.setLayerRenderData(t.getId(),e)})),r.mapView.dirtyLayer(a.LayerType.BUILDING)}null!=S.vectorTile&&(b.VectorTileParserBuilder.build(t,S.vectorTile,h,r.mapView.mapSettings.getMapLanguage(),x),r.mapView.dirtyLayer(a.LayerType.SURFACE),r.mapView.dirtyLayer(a.LayerType.ROADS)),t.setRenderable(),r.requestRender(),r.requestsMap.delete(M.toString())}},this.requestsMap.set(M.toString(),T),this.taskManager.postTask(T)},t.prototype.reload=function(){var t=this;this.requestsMap.forEach((function(e){t.taskManager.cancelTask(e)})),this.requestsMap.clear()},t.prototype.cancelOutdatedTasks=function(t){var e=this;this.requestsMap.forEach((function(r,i,n){t.some((function(t){return i.startsWith(t.getTileCoordinate().toString())}))||(n.delete(i),e.taskManager.cancelTask(r))}))},t.prototype.removeTaskResult=function(t,e){void 0===e&&(e=!1);var r=t.toString();if(e){var i=this.requestsMap.get(r);null!=i&&this.taskManager.cancelTask(i)}this.requestsMap.delete(r)},t.prototype.removeOverlayTaskResult=function(t,e){var r=this;void 0===e&&(e=!1);var i=t.toString()+"_";this.requestsMap.forEach((function(t,n,o){n.startsWith(i)&&(e&&r.taskManager.cancelTask(t),o.delete(n))}))},t.prototype.getBuildingType=function(t){return"Object"==t?m.BuildingType.Texture:"Polygon"==t?m.BuildingType.Extrude:"External"==t?m.BuildingType.External:"ExternalExtrude"==t?m.BuildingType.ExternalExtrude:void console.warn("Invalid building type: ",t)},t.prototype.getNameFromUrl=function(t){if(!t)return null;var e=t.split("/");return e[e.length-1]},t}();e.TaskDataManager=x},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(23),a=r(4),s=function(t){function e(){var e=t.call(this)||this;return e.modelType="Object",e.location=new a.LatLng(0,0),e.scale=1,e.bearing=0,e.elevation=0,e.height=0,e.minZoom=0,e.maxZoom=0,e.startDate=0,e.endDate=0,e.selected=!1,e.location=new a.LatLng(0,0),e.scale=1,e.bearing=0,e.name="Unknown name",e.elevation=0,e.objData=null,e.textureData=null,e.selected=!1,e}return n(e,t),e.prototype.getColor=function(){return this.color},e.prototype.setColor=function(t){this.color=t},e.prototype.getModelType=function(){return this.modelType},e.prototype.setModelType=function(t){this.modelType=t},e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getName=function(){return this.name},e.prototype.setName=function(t){this.name=t},e.prototype.setPlaces=function(t){this.places=t},e.prototype.getPlaces=function(){return this.places},e.prototype.getScale=function(){return this.scale},e.prototype.setScale=function(t){this.scale=t},e.prototype.setBearing=function(t){this.bearing=t},e.prototype.getBearing=function(){return this.bearing},e.prototype.setLocation=function(t){this.location=a.LatLng.convert(t)},e.prototype.getLocation=function(){return this.location},e.prototype.getElevation=function(){return this.elevation},e.prototype.setElevation=function(t){this.elevation=t},e.prototype.setCoordinates=function(t){this.coordinates=t},e.prototype.getCoordinates=function(){return this.coordinates},e.prototype.setCamera=function(t){this.camera=t},e.prototype.getCamera=function(){return this.camera},e.prototype.setTypes=function(t){this.types=t},e.prototype.getTypes=function(){return this.types},e.prototype.setVerified=function(t){this._isVerified=t},e.prototype.isVerified=function(){return this._isVerified},e.prototype.setMinZoom=function(t){this.minZoom=t},e.prototype.getMinZoom=function(){return this.minZoom},e.prototype.setMaxZoom=function(t){this.maxZoom=t},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.setStartDate=function(t){this.startDate=t},e.prototype.getStartDate=function(){return this.startDate},e.prototype.setEndDate=function(t){this.endDate=t},e.prototype.getEndDate=function(){return this.endDate},e.prototype.getTextureName=function(){return this.textureName},e.prototype.setTextureName=function(t){this.textureName=t},e.prototype.getTextureUrl=function(){return this.textureUrl},e.prototype.setTextureUrl=function(t){this.textureUrl=t},e.prototype.getTextureData=function(){return this.textureData},e.prototype.setTextureData=function(t){this.textureData=t},e.prototype.getModelName=function(){return this.modelName},e.prototype.setModelName=function(t){this.modelName=t},e.prototype.getModelUrl=function(){return this.modelUrl},e.prototype.setModelUrl=function(t){this.modelUrl=t},e.prototype.getObjData=function(){return this.objData},e.prototype.setObjData=function(t){this.objData=t},e.prototype.getBuildingType=function(){return this.buildingType},e.prototype.setBuildingType=function(t){this.buildingType=t},e.prototype.setHighestPosition=function(t){this.highestPosition=t},e.prototype.getHighestPosition=function(){return this.highestPosition},e.prototype.setHeight=function(t){this.height=t},e.prototype.getHeight=function(){return this.height},e.prototype.setSelected=function(t){this.selected=t},e.prototype.isSelected=function(){return this.selected},e}(o.LayerProperties);e.BuildingLayerProperties=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=function(t){function e(){var e=t.call(this)||this;return e.rank=0,e.position=new o.LatLng(0,0),e}return n(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){this.position=t},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(t){this.title=t},e.prototype.getSubtitle=function(){return this.subtitle},e.prototype.setSubtitle=function(t){this.subtitle=t},e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){this.type=t},e.prototype.getTypes=function(){return this.types},e.prototype.setTypes=function(t){this.types=t},e.prototype.getRank=function(){return this.rank},e.prototype.setRank=function(t){this.rank=t},e.prototype.getFontSize=function(){return this.fontSize},e.prototype.setFontSize=function(t){this.fontSize=t},e.prototype.hasHalo=function(){return null!=this.haloColor},e.prototype.getHaloColor=function(){return this.haloColor},e.prototype.setHaloColor=function(t){this.haloColor=t},e}(r(23).LayerProperties);e.POILayerProperties=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(57),a=r(11),s=function(t){function e(e,r,i,n){var s=t.call(this)||this;s.id=e,s.layer=r;var l=i||{};switch(s.osmId=l.id||0,n){case o.MapLanguage.en:s.name=l["name:en"]||l.name;break;default:s.name=l["name:vi"]||l.name}return s.operator=l.operator,s.kind=l.kind,s.kindDetail=l.kind_detail,s.sortRank=l.sort_rank||0,s.minZoom=l.min_zoom||0,s.collisionRank=l.collision_rank||0,s.visible=!0,s.color="string"==typeof l.color?a.Color.fromHex(l.color):l.color||a.Color.fromInt(0),s.width=l.width||0,s.outlineWidth=l.outlineWidth||0,s.outlineColor="string"==typeof l.outlineColor?a.Color.fromHex(l.outlineColor):l.outlineColor||a.Color.fromInt(0),s.pattern=l.pattern,s.patternTextureSize=l.patternTextureSize,s}return n(e,t),e.prototype.isVisible=function(){return this.visible},e.prototype.getId=function(){return this.id},e.prototype.getOsmId=function(){return this.osmId},e.prototype.getName=function(){return this.name},e.prototype.getOperator=function(){return this.operator},e.prototype.getKind=function(){return this.kind},e.prototype.getKindDetail=function(){return this.kindDetail},e.prototype.getSortRank=function(){return this.sortRank},e.prototype.getMinZoom=function(){return this.minZoom},e.prototype.getCollisionRank=function(){return this.collisionRank},e.prototype.getColor=function(){return this.color},e.prototype.getWidth=function(){return this.width},e.prototype.hasOutline=function(){return this.outlineWidth>0},e.prototype.getOutlineWidth=function(){return this.outlineWidth},e.prototype.getOutlineColor=function(){return this.outlineColor},e}(r(23).LayerProperties);e.VectorLayerProperties=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(10),n=r(9),o=r(11),a=r(1),s=function(){function t(){}return t.render=function(t,e,r,n,s,l,u){void 0===s&&(s=o.Color.fromHex("#000000")),void 0===l&&(l=!0),void 0===u&&(u=o.Color.fromHex("#FFFFFF"));var h=i.ResourceManager.getInstance(t).getShader(i.ShaderEnum.TEXT_LABEL_SHADER);t.enable(t.BLEND),h.bind();var c=r.font.texture;r.model.bind(),h.setAttributes(r.model.attributeInfos),this.mvpMatrix.setIdentity(),this.mvpMatrix.translate(n.x,n.y,0),this.mvpMatrix.concat(e.getOrthoProjectionMatrix()),t.uniformMatrix4fv(h.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),h.setTexture(h.textureUniform,c.textureId),t.uniform1f(h.pixelScaleUniform,a.MapUtils.pixelScale),t.uniform1f(h.textSizeUniform,r.size),t.uniform2fv(h.texsizeUniform,new Float32Array([c.width,c.height])),l&&(t.uniform4fv(h.colorUniform,u.buffer()),t.uniform1i(h.isHaloUniform,1),r.model.render(t.TRIANGLES)),t.uniform4fv(h.colorUniform,s.buffer()),t.uniform1f(h.gammaScaleUniform,1),t.uniform1i(h.isHaloUniform,0),r.model.render(t.TRIANGLES)},t.mvpMatrix=new n.Matrix4,t}();e.TextLabelRenderer=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(0),s=r(7),l=r(3),u=r(2),h=r(1),c=r(8),p=r(71),f=r(16),d=r(24),g=r(39),y=r(72),m=r(43),v=r(17),_=r(73),b=function(t){function e(e,r,i,n){var o=t.call(this,e,r,n||a.LayerType.POI,i)||this;return o.poiRenderDatas=null,o}return n(e,t),e.prototype.destroy=function(){this.poiRenderDatas=null},e.prototype.queryFeature=function(t){var e=null;if(null!=this.poiRenderDatas&&this.poiRenderDatas.length>0){var r=this.poiRenderDatas.get(t);if(null!=r){var i=r.getLayerProperties();e=new p.PlaceQueryResult(0,i.getId(),i.getTitle(),i.getSubtitle(),i.getPosition(),i.getType())}}return e},e.prototype.placePOIRenderData=function(t,e,r,i){e.setVisible(!1),e.setTextVisible(!1);var n=e.getLayerProperties(),o=this.mapView.getMapStyle(v.MapType.roadmap).getTextureStyle(n.textureName||"pois");if(null!=o){var a=s.MapResourceManager.getInstance(this.mapView.gl),p=a.getTexture(o.id);if(null!=p&&p.isLoaded&&this.isInFilterPOITypes(n.getTypes())){var f=c.GeometryUtils.latLngToScreenCoordinate(n.getPosition(),0,r.cameraPosition,r.getScreenSize(),i);e.setScreenCoordinate(f);var d=u.MapConstants.placeWidth*h.MapUtils.pixelScale,b=u.MapConstants.placeHeight*h.MapUtils.pixelScale,w=f.x-d/2,x=f.x+d/2,M=f.y-b,T=f.y,A=new l.Vector2((w+x)/2,(M+T)/2),L=this.mapView.getCollision2DManager(),S=new g.OBB(A.x,A.y,0,x-w,T-M);if(L.insert(new y.POICollisionIconRenderData(S,m.CollisionType.POI,null,e)),e.setVisible(!0),n.getTitle()&&!(n.getFontSize()<=0)){null==e.getTextData()&&e.setTextData(a.acquireText(n.getTitle(),n.getFontSize()));var E=e.getTextData(),P=E.width,C=E.height,I=new l.Vector2(f.x+d/2+P/2,f.y-b/2);if(L.insert(new y.POICollisionTextRenderData(new g.OBB(I.x+10+1,I.y,0,P+20,C+20),m.CollisionType.POITEXT,_.TextDirection.RIGHT,e)),e.getLineNumber()<2){var O=new l.Vector2(f.x-d/2-P/2,f.y-b/2);L.insert(new y.POICollisionTextRenderData(new g.OBB(O.x-10-1,O.y,0,P+20,C+20),m.CollisionType.POITEXT,_.TextDirection.LEFT,e))}var R=new l.Vector2(f.x,f.y-b-C/2);L.insert(new y.POICollisionTextRenderData(new g.OBB(R.x,R.y-5-1,0,P+20,C+10),m.CollisionType.POITEXT,_.TextDirection.TOP,e));var k=new l.Vector2(f.x,f.y+C/2);L.insert(new y.POICollisionTextRenderData(new g.OBB(k.x,k.y+5+1,0,P+20,C+10),m.CollisionType.POITEXT,_.TextDirection.BOTTOM,e)),e.setTextVisible(!0),e.getTextDirection()||e.setTextDirection(_.TextDirection.RIGHT)}}}},e.prototype.update=function(t){var e=this;if(this.poiRenderDatas=o(f.compareOrderDESC),this.mapView.isPOIsEnabled()&&!t.is3dMode()){this.mapView.tileManager.getTilePyramid().getRenderTiles().forEach((function(t){t.getTile().getTileRenderData().getLayerRenderDatas().forEach((function(t){if(t.getType()==a.LayerType.POI){var r=t;e.poiRenderDatas=e.poiRenderDatas.insert(r.getOrder(),r)}}))}));var r=t.getScreenSize(),i=d.CameraUtils.calculateViewProjectionMatrix(t.cameraPosition,r.x,r.y);this.poiRenderDatas.forEach((function(r,n){e.placePOIRenderData(r,n,t,i)}))}},e.prototype.isInFilterPOITypes=function(t){var e=this.mapView.mapSettings.filterPOITypes;return null==e||null==e.length||e.length<1||!(null==t||t.length<=0)&&e.some((function(e){return-1!==t.indexOf(e)}))},e}(a.Layer);e.POILayer=b},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(17),s=r(9),l=r(6),u=r(0),h=r(3),c=r(8),p=r(1),f=r(16),d=function(t,e){this.layerRenderData=t,this.matrixIndex=e};e.SurfaceRenderData=d;var g=function(t){function e(e,r,i,n){var o=t.call(this,e,r,n||u.LayerType.SURFACE,i)||this;return o.dirty=!0,o.surfaceIdCounter=0,o.renderDatas=null,o.mvpMatrixs=[],o}return n(e,t),e.prototype.destroy=function(){this.renderDatas=null},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.update=function(t){this.updateLayer(t,u.LayerType.SURFACE)},e.prototype.updateLayer=function(t,e){var r=this;if(this.dirty){this.dirty=!1,this.renderDatas=o(f.compareOrderASC);var i=t.mapSettings.getMapType();if(i==a.MapType.roadmap||i==a.MapType.satellite){var n=p.MapUtils.getTileSize(),u=l.ProjectionMercator.worldSize(t.getScale()),g=t.cameraPosition,y=t.getViewProjectionMatrix(),m=this.mapView.tileManager.getTilePyramid().getRenderTiles();m.forEach((function(t,i){var o=t.getTile(),a=1<<o.getTileCoordinate().getZoom(),l=u/a,p=t.getUnwrappedTileCoordinate().toVec2(),f=p.x*l+l/2,m=p.y*l+l/2,v=c.GeometryUtils.pixelCoordinateToCameraCoordinate(new h.Vector2(f,m),g),_=void 0;i<r.mvpMatrixs.length?_=r.mvpMatrixs[i]:(_=new s.Matrix4,r.mvpMatrixs.push(_));var b=l/n;_.setIdentity(b,b,1),_.translate(v.x,v.y,0),_.concat(y),o.getTileRenderData().getLayerRenderDatas().forEach((function(t,n){if(t.getType()==e&&t.getLayerProperties().isVisible()){var o=t,a=o.getOrder();a||(a=o.createOrder(r.surfaceIdCounter++));var s=new d(o,i);r.renderDatas=r.renderDatas.insert(a,s)}}))})),this.mvpMatrixs.length>m.length&&(this.mvpMatrixs.length=m.length)}}},e}(u.Layer);e.SurfaceLayer=g},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(6),n=r(13),o=function(){function t(t,e,r,i,n,o){this.minX=t,this.maxX=e,this.minY=r,this.maxY=i,this.minZoom=n,this.maxZoom=o}return t.fromLatLngBounds=function(e,r,o){var a=i.ProjectionMercator.projectZoom(e.getSouthwest(),o),s=i.ProjectionMercator.projectZoom(e.getNortheast(),o),l=Math.pow(2,o);return new t(Math.floor(a.x),Math.floor(s.x),n.MathUtils.clamp(Math.floor(s.y),0,l),n.MathUtils.clamp(Math.floor(a.y),0,l),r,o)},t.prototype.contains=function(t){var e=t.getX(),r=t.getY(),i=t.getZoom();if(i<=this.maxZoom&&i>=this.minZoom){if(0==i)return!0;var n=this.maxZoom-i,o=this.minX>>n,a=this.maxX>>n,s=this.minY>>n,l=this.maxY>>n;return(this.minX>this.maxX?e>=o||e<=a:e<=a&&e>=o)&&r<=l&&r>=s}return!1},t}();e.TileRange=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(17),n=r(47),o=r(52),a=function(){function t(){}return t.convertControlOptions=function(t){if("string"==typeof t)switch(t.toUpperCase()){case"TOP_LEFT":return n.ControlOptions.TOP_LEFT;case"TOP_RIGHT":return n.ControlOptions.TOP_RIGHT;case"BOTTOM_LEFT":return n.ControlOptions.BOTTOM_LEFT;default:return n.ControlOptions.BOTTOM_RIGHT}return t},t.convertMapType=function(t){if("string"==typeof t)switch(t.toLowerCase()){case"raster":return i.MapType.raster;case"satellite":return i.MapType.satellite;case"map3d":return i.MapType.map3d;default:return i.MapType.roadmap}return t},t.convertAnimation=function(t){if("string"==typeof t)switch(t.toUpperCase()){case"BOUNCE":return o.Animation.BOUNCE;case"DROP":return o.Animation.DROP;default:return null}return t},t}();e.IConverter=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(41),n=function(){function t(t,e,r){this.gl=t,this.width=e,this.height=r,this.isReady=!1,this.init()}return t.prototype.init=function(){var t=this.gl,e=new i.TextureFiltering(t.NEAREST,t.NEAREST),r=new i.TextureWrapping(t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE),n=new i.TextureOptions(t.TEXTURE_2D,t.RGB,t.RGB,t.UNSIGNED_BYTE,e,r);this.colorTexture=new i.Texture(t,n),this.colorTexture.initFrameBufferTexture(this.width||1,this.height||1),this.depthBuffer=this.gl.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width||1,this.height||1),t.bindRenderbuffer(t.RENDERBUFFER,null),this.frameBufferId=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBufferId),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.colorTexture.textureId,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(o!=t.FRAMEBUFFER_COMPLETE){switch(o){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case t.FRAMEBUFFER_UNSUPPORTED:console.warn("FRAMEBUFFER_UNSUPPORTED");break;default:console.warn("Unknown framebuffer issue")}return t.bindFramebuffer(t.FRAMEBUFFER,null),!1}return this.isReady=!0,t.bindFramebuffer(t.FRAMEBUFFER,null),!0},t.prototype.bind=function(){this.isReady&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBufferId)},t.prototype.unbind=function(){this.isReady&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},t.prototype.drawDebug=function(){},t.prototype.destroy=function(){this.gl&&(this.colorTexture&&this.colorTexture.destroy(),this.gl.deleteRenderbuffer(this.depthBuffer),this.gl.deleteFramebuffer(this.frameBufferId),this.colorTexture=null,this.depthBuffer=null,this.frameBufferId=null)},t}();e.FrameBuffer=n},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(202),a=r(10),s=r(9),l=function(t){function e(e,r,i,n){var o=t.call(this,n)||this;return o.transformMatrix=new s.Matrix4,o._shader=r,o._particleTexture=i,o._gl=e,o}return n(e,t),e.prototype.render=function(t){var e=a.ResourceManager.getInstance(this._gl).getModel(a.ModelEnum.PARTICLE_QUAD_MODEL),r=t.getOrthoProjectionMatrix();this._shader.bind(),e.bind(),this._shader.setAttributes(e.attributeInfos),this._shader.setTexture(this._shader.textureUniform,this._particleTexture.textureId);for(var i=this._activeParticlesFirst;i;i=i.next){var n=i.position;this.transformMatrix.setIdentity(this._particleTexture.width*i.scale,this._particleTexture.height*i.scale,1),this.transformMatrix.rotateZ(i.rotation),this.transformMatrix.translate(n.x,n.y,0),this.transformMatrix.concat(r),this._gl.uniformMatrix4fv(this._shader.mvpMatrixUniform,!1,this.transformMatrix.buffer()),e.render(this._gl.TRIANGLES)}e.unbind()},e}(o.ParticleSystem);e.ParticleSystemQuad=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=r(31),s=r(1),l=r(220),u=r(221),h=r(12),c=r(49),p=r(5),f=r(21),d=function(t){function e(r){var i=t.call(this,p.ClassType.POLYGON)||this,n={};s.MapUtils.extendOptions(n,e.defaultPolygonOptions,r);for(var a=0,u=n;a<u.length;a++){if(null==u[a])throw Error("Parameters can not be null")}return(!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(f.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled),i.paths=n.paths.map((function(t){return t.map((function(t){return o.LatLng.convert(t)}))})),e.normalizePaths(i.paths),i.properties=new l.FillLayerProperties(n.fillColor,n.fillOpacity,n.strokeColor,n.strokeWidth,n.elevation,n.visible,n.draggable,n.clickable),i.zIndex=n.zIndex,i.elevation=n.elevation,i}return n(e,t),e.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.id=-1),this.map=t,null!=this.map&&(this.id=this.map.mapView.addAnnotation(this)),this.properties.annotationId=this.id)},e.prototype.setPaths=function(t){null!=t?(this.paths=t.map((function(t){return t.map((function(t){return o.LatLng.convert(t)}))})),e.normalizePaths(this.paths),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):f.LogUtils.logNonNull("paths")},e.prototype.setFillColor=function(t){null!=t?this.properties.getFillColor().code!=t&&(this.properties.setFillColor(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):f.LogUtils.logNonNull("fillColor")},e.prototype.setFillOpacity=function(t){null!=t?this.properties.getFillOpacity()!=t&&(this.properties.setFillOpacity(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):f.LogUtils.logNonNull("fillOpacity")},e.prototype.setStrokeColor=function(t){this.properties.getStrokeColor().code!=t&&(this.properties.setStrokeColor(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.setStrokeWidth=function(t){this.properties.getStrokeWidth()!=t&&(this.properties.setStrokeWidth(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.setVisible=function(t){null!=t?this.properties.isVisible()!==t&&(this.properties.setVisible(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):f.LogUtils.logNonNull("visible")},e.prototype.setDraggable=function(t){null!=t?this.properties.isDraggable()!==t&&this.properties.setDraggable(t):f.LogUtils.logNonNull("draggable")},e.prototype.getPaths=function(){return(this.paths||[]).slice()},e.prototype.getFillColor=function(){return this.properties.getFillColor().code},e.prototype.getFillOpacity=function(){return this.properties.getFillOpacity()},e.prototype.getStrokeColor=function(){return this.properties.getStrokeColor().code},e.prototype.getStrokeWidth=function(){return this.properties.getStrokeWidth()},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.getProperties=function(){return this.properties},e.prototype.isUserInteractionEnabled=function(){return f.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){f.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){this.properties.setClickable(t)},e.normalizePaths=function(t){if(t.length>1)for(var e=function(e){var r=t[0],i=!1,n=t[e];if(n.forEach((function(t){var e=h.Point.convert([t.lat,t.lng]),n=r.map((function(t){return h.Point.convert([t.lat,t.lng])}));c.CollisionUtils.polygonContainsPoint(n,e)||(i=!0)})),i){var a=!1,s=!1;r[0].equals(r[r.length-1])&&(r.pop(),a=!0),n[0].equals(n[n.length-1])&&(s=!0,n.pop());var l=r.map((function(t){return[t.lat,t.lng]})),p=n.map((function(t){return[t.lat,t.lng]})),f=u.intersection(l,p),d=u.union(l,p);if(null==f)s&&n.push(n[0]);else if(Array.isArray(f)){var g=f[0].map((function(t){return new o.LatLng(t[0],t[1])}));s&&!g[0].equals(g[g.length-1])&&g.push(g[0]),t[e]=g}if(null!=d&&Array.isArray(d)){var y=d[0].map((function(t){return new o.LatLng(t[0],t[1])}));a&&!y[0].equals(y[y.length-1])&&y.push(y[0]),t[0]=y}}},r=1;r<t.length;++r)e(r)},e.defaultPolygonOptions={fillColor:"#0000ff",fillOpacity:1,visible:!0,strokeColor:"#ff0000",strokeWidth:1,draggable:!1,zIndex:0,elevation:0,userInteractionEnabled:!0,clickable:!0},e}(a.Annotation);e.Polygon=d},function(t,e,r){"use strict";function i(t,e,r,i,n,o){var a=n-r,s=o-i;if(0!==a||0!==s){var l=((t-r)*a+(e-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return(a=t-r)*a+(s=e-i)*s}function n(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)o(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<e.length;i++)o(t,e[i]);else if("MultiPolygon"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)o(t,e[i][n])}(n),n}function o(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function a(t,e,r,i){if(e.geometry){var o=e.geometry.coordinates,h=e.geometry.type,c=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),p=[],f=e.id;if(r.promoteId?f=e.properties[r.promoteId]:r.generateId&&(f=i||0),"Point"===h)s(o,p);else if("MultiPoint"===h)for(var d=0;d<o.length;d++)s(o[d],p);else if("LineString"===h)l(o,p,c,!1);else if("MultiLineString"===h){if(r.lineMetrics){for(d=0;d<o.length;d++)p=[],l(o[d],p,c,!1),t.push(n(f,"LineString",p,e.properties));return}u(o,p,c,!1)}else if("Polygon"===h)u(o,p,c,!0);else{if("MultiPolygon"!==h){if("GeometryCollection"===h){for(d=0;d<e.geometry.geometries.length;d++)a(t,{id:f,geometry:e.geometry.geometries[d],properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(d=0;d<o.length;d++){var g=[];u(o[d],g,c,!0),p.push(g)}}t.push(n(f,h,p,e.properties))}}function s(t,e){e.push(h(t[0])),e.push(c(t[1])),e.push(0)}function l(t,e,r,n){for(var o,a,s=0,l=0;l<t.length;l++){var u=h(t[l][0]),p=c(t[l][1]);e.push(u),e.push(p),e.push(0),l>0&&(s+=n?(o*p-u*a)/2:Math.sqrt(Math.pow(u-o,2)+Math.pow(p-a,2))),o=u,a=p}var f=e.length-3;e[2]=1,function t(e,r,n,o){for(var a,s=o,l=n-r>>1,u=n-r,h=e[r],c=e[r+1],p=e[n],f=e[n+1],d=r+3;d<n;d+=3){var g=i(e[d],e[d+1],h,c,p,f);if(g>s)a=d,s=g;else if(g===s){var y=Math.abs(d-l);y<u&&(a=d,u=y)}}s>o&&(a-r>3&&t(e,r,a,o),e[a+2]=s,n-a>3&&t(e,a,n,o))}(e,0,f,r),e[f+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function u(t,e,r,i){for(var n=0;n<t.length;n++){var o=[];l(t[n],o,r,i),e.push(o)}}function h(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function p(t,e,r,i,o,a,s,l){if(i/=e,a>=(r/=e)&&s<i)return t;if(s<r||a>=i)return null;for(var u=[],h=0;h<t.length;h++){var c=t[h],p=c.geometry,g=c.type,m=0===o?c.minX:c.minY,v=0===o?c.maxX:c.maxY;if(m>=r&&v<i)u.push(c);else if(!(v<r||m>=i)){var _=[];if("Point"===g||"MultiPoint"===g)f(p,_,r,i,o);else if("LineString"===g)d(p,_,r,i,o,!1,l.lineMetrics);else if("MultiLineString"===g)y(p,_,r,i,o,!1);else if("Polygon"===g)y(p,_,r,i,o,!0);else if("MultiPolygon"===g)for(var b=0;b<p.length;b++){var w=[];y(p[b],w,r,i,o,!0),w.length&&_.push(w)}if(_.length){if(l.lineMetrics&&"LineString"===g){for(b=0;b<_.length;b++)u.push(n(c.id,g,_[b],c.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===_.length?(g="LineString",_=_[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===_.length?"Point":"MultiPoint"),u.push(n(c.id,g,_,c.tags))}}}return u.length?u:null}function f(t,e,r,i,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];a>=r&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function d(t,e,r,i,n,o,a){for(var s,l,u=g(t),h=0===n?v:_,c=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],y=t[p+2],b=t[p+3],w=t[p+4],x=0===n?f:d,M=0===n?b:w,T=!1;a&&(s=Math.sqrt(Math.pow(f-b,2)+Math.pow(d-w,2))),x<r?M>r&&(l=h(u,f,d,b,w,r),a&&(u.start=c+s*l)):x>i?M<i&&(l=h(u,f,d,b,w,i),a&&(u.start=c+s*l)):m(u,f,d,y),M<r&&x>=r&&(l=h(u,f,d,b,w,r),T=!0),M>i&&x<=i&&(l=h(u,f,d,b,w,i),T=!0),!o&&T&&(a&&(u.end=c+s*l),e.push(u),u=g(t)),a&&(c+=s)}var A=t.length-3;f=t[A],d=t[A+1],y=t[A+2],(x=0===n?f:d)>=r&&x<=i&&m(u,f,d,y),A=u.length-3,o&&A>=3&&(u[A]!==u[0]||u[A+1]!==u[1])&&m(u,u[0],u[1],u[2]),u.length&&e.push(u)}function g(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function y(t,e,r,i,n,o){for(var a=0;a<t.length;a++)d(t[a],e,r,i,n,o,!1)}function m(t,e,r,i){t.push(e),t.push(r),t.push(i)}function v(t,e,r,i,n,o){var a=(o-e)/(i-e);return t.push(o),t.push(r+(n-r)*a),t.push(1),a}function _(t,e,r,i,n,o){var a=(o-r)/(n-r);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function b(t,e){for(var r=[],i=0;i<t.length;i++){var o,a=t[i],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=w(a.geometry,e);else if("MultiLineString"===s||"Polygon"===s){o=[];for(var l=0;l<a.geometry.length;l++)o.push(w(a.geometry[l],e))}else if("MultiPolygon"===s)for(o=[],l=0;l<a.geometry.length;l++){for(var u=[],h=0;h<a.geometry[l].length;h++)u.push(w(a.geometry[l][h],e));o.push(u)}r.push(n(a.id,s,o,a.tags))}return r}function w(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function x(t,e){if(t.transformed)return t;var r,i,n,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(i=0;i<u.length;i+=2)l.geometry.push(M(u[i],u[i+1],e,o,a,s));else for(i=0;i<u.length;i++){var c=[];for(n=0;n<u[i].length;n+=2)c.push(M(u[i][n],u[i][n+1],e,o,a,s));l.geometry.push(c)}}return t.transformed=!0,t}function M(t,e,r,i,n,o){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-o))]}function T(t,e,r,i,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,A(a,t[s],o,n);var l=t[s].minX,u=t[s].minY,h=t[s].maxX,c=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),h>a.maxX&&(a.maxX=h),c>a.maxY&&(a.maxY=c)}return a}function A(t,e,r,i){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)L(a,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)L(a,n[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)L(a,u[s],t,r,!0,0===s)}if(a.length){var h=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var c in h={},e.tags)h[c]=e.tags[c];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:h};null!==e.id&&(p.id=e.id),t.features.push(p)}}function L(t,e,r,i,n,o){var a=i*i;if(i>0&&e.size<(n?a:i))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;n&&function(t,e){for(var r=0,i=0,n=t.length,o=n-2;i<n;o=i,i+=2)r+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=a,t[n-1-i]=s}}(s,o),t.push(s)}}function S(t,e){return new E(t,e)}function E(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)a(r,t.features[i],e,i);else"Feature"===t.type?a(r,t,e):a(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var r=e.buffer/e.extent,i=t,n=p(t,1,-1-r,r,0,-1,2,e),o=p(t,1,1-r,2+r,0,-1,2,e);return(n||o)&&(i=p(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=b(n,1).concat(i)),o&&(i=i.concat(b(o,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function P(t,e,r){return 32*((1<<t)*r+e)+t}r.r(e),r.d(e,"default",(function(){return S})),E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,u=l.debug;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var h=1<<e,c=P(e,r,i),f=this.tiles[c];if(!f&&(u>1&&console.time("creation"),f=this.tiles[c]=T(t,e,r,i,l),this.tileCoords.push({z:e,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=t,n){if(e===l.maxZoom||e===n)continue;var g=1<<n-e;if(r!==Math.floor(o/g)||i!==Math.floor(a/g))continue}else if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==t.length){u>1&&console.time("clipping");var y,m,v,_,b,w,x=.5*l.buffer/l.extent,M=.5-x,A=.5+x,L=1+x;y=m=v=_=null,b=p(t,h,r-x,r+A,0,f.minX,f.maxX,l),w=p(t,h,r+M,r+L,0,f.minX,f.maxX,l),t=null,b&&(y=p(b,h,i-x,i+A,1,f.minY,f.maxY,l),m=p(b,h,i+M,i+L,1,f.minY,f.maxY,l),b=null),w&&(v=p(w,h,i-x,i+A,1,f.minY,f.maxY,l),_=p(w,h,i+M,i+L,1,f.minY,f.maxY,l),w=null),u>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*r,2*i),s.push(m||[],e+1,2*r,2*i+1),s.push(v||[],e+1,2*r+1,2*i),s.push(_||[],e+1,2*r+1,2*i+1)}}},E.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug;if(t<0||t>24)return null;var a=1<<t,s=P(t,e=(e%a+a)%a,r);if(this.tiles[s])return x(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,h=e,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[P(u,h,c)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,h,c),o>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?x(this.tiles[s],n):null):null}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.geojson="json",t.mvt="mvt"}(e.VectorFormat||(e.VectorFormat={}))},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),a=r(1),s=r(31),l=r(107),u=r(5),h=r(21),c=function(t){function e(r){var i=t.call(this,u.ClassType.CIRCLE)||this,n={};a.MapUtils.extendOptions(n,e.defaultCircleOptions,r);for(var s=0,c=n;s<c.length;s++){if(null==c[s])throw Error("Parameters can not be null")}return(!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(h.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled),i.properties=new l.CircleLayerProperties(o.LatLng.convert(n.center),n.radius,n.fillColor,n.fillOpacity,n.strokeColor,n.strokeWidth,n.elevation,n.visible,n.draggable,n.clickable),i.zIndex=n.zIndex,i.elevation=n.elevation,i}return n(e,t),e.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.id=-1),this.map=t,null!=this.map&&(this.id=this.map.mapView.addAnnotation(this)),this.properties.annotationId=this.id)},e.prototype.setCenter=function(t){if(null!=t){var e=o.LatLng.convert(t);this.properties.getCenter().equals(e)||(this.properties.setCenter(e),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0))}else h.LogUtils.logNonNull("center")},e.prototype.setRadius=function(t){null!=t?this.properties.getRadius()!=t&&(this.properties.setRadius(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):h.LogUtils.logNonNull("radius")},e.prototype.setFillColor=function(t){null!=t?this.properties.getFillColor().code!=t&&(this.properties.setFillColor(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):h.LogUtils.logNonNull("fillColor")},e.prototype.setFillOpacity=function(t){null!=t?this.properties.getFillOpacity()!=t&&(this.properties.setFillOpacity(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):h.LogUtils.logNonNull("fillOpacity")},e.prototype.setStrokeColor=function(t){null!=t?this.properties.getStrokeColor().code!=t&&(this.properties.setStrokeColor(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):h.LogUtils.logNonNull("strokeColor")},e.prototype.setStrokeWidth=function(t){null!=t?this.properties.getStrokeWidth()!=t&&(this.properties.setStrokeWidth(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):h.LogUtils.logNonNull("strokeWidth")},e.prototype.setVisible=function(t){null!=t?this.properties.isVisible()!==t&&(this.properties.setVisible(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):h.LogUtils.logNonNull("visible")},e.prototype.setDraggable=function(t){null!=t?this.properties.setDraggable(t):h.LogUtils.logNonNull("draggable")},e.prototype.getCenter=function(){return this.properties.getCenter()},e.prototype.getRadius=function(){return this.properties.getRadius()},e.prototype.getFillColor=function(){return this.properties.getFillColor().code},e.prototype.getFillOpacity=function(){return this.properties.getFillOpacity()},e.prototype.getStrokeColor=function(){return this.properties.getStrokeColor().code},e.prototype.getStrokeWidth=function(){return this.properties.getStrokeWidth()},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.getProperties=function(){return this.properties},e.prototype.isUserInteractionEnabled=function(){return h.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){h.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){this.properties.setClickable(t)},e.defaultCircleOptions={radius:0,fillColor:"#0000ff",fillOpacity:1,visible:!0,strokeColor:"#00ff00",strokeWidth:0,draggable:!1,zIndex:0,elevation:0,userInteractionEnabled:!0,clickable:!0},e}(s.Annotation);e.Circle=c},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(23),a=r(11),s=r(1),l=r(2),u=function(t){function e(e,r,i,n,o,u,h,c,p,f){var d=t.call(this)||this;return d.annotationId=-1,d._center=e,d._radius=r,d._fillColor=a.Color.fromHex(i),d._fillColor.alpha=n,d._fillOpacity=n,d._strokeColor=a.Color.fromHex(o),d._strokeWidth=u*s.MapUtils.pixelScale,d._hypotenuseStrokeWidth=d._strokeWidth/Math.cos(Math.PI/l.PolyConstants.numTrianglesPerCircle),d._visible=c,d._draggable=p,d._elevation=h,d.clickable=f,d}return n(e,t),e.prototype.getCenter=function(){return this._center},e.prototype.setCenter=function(t){this._center=t},e.prototype.getRadius=function(){return this._radius},e.prototype.setRadius=function(t){this._radius=t},e.prototype.getFillColor=function(){return this._fillColor},e.prototype.setFillColor=function(t){t?(this._fillColor=a.Color.fromHex(t),this._fillColor.alpha=this._fillOpacity):this._fillColor=new a.Color(255,0,0,this._fillOpacity)},e.prototype.getFillOpacity=function(){return this._fillOpacity},e.prototype.setFillOpacity=function(t){this._fillOpacity=t,this._fillColor.alpha=t},e.prototype.getStrokeColor=function(){return this._strokeColor},e.prototype.setStrokeColor=function(t){t?(this._strokeColor=a.Color.fromHex(t),this._strokeColor.alpha=1):this._strokeColor=new a.Color(255,0,0,1)},e.prototype.getHypotenuseStrokeWidth=function(){return this._hypotenuseStrokeWidth},e.prototype.getStrokeWidth=function(){return this._strokeWidth},e.prototype.setStrokeWidth=function(t){var e=5*s.MapUtils.pixelScale;null!==t&&(e=t*s.MapUtils.pixelScale)<1&&(e=0),this._strokeWidth=e,this._hypotenuseStrokeWidth=e/Math.cos(Math.PI/l.PolyConstants.numTrianglesPerCircle)},e.prototype.getElevation=function(){return this._elevation},e.prototype.setElevation=function(t){this._elevation=t},e.prototype.isVisible=function(){return this._visible},e.prototype.setVisible=function(t){this._visible=t},e.prototype.isDraggable=function(){return this._draggable},e.prototype.setDraggable=function(t){this._draggable=t},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e}(o.LayerProperties);e.CircleLayerProperties=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),n=r(109),o=r(19),a=r(12),s=r(20),l=r(1),u=r(76),h=r(17),c=r(21),p=function(){function t(t,e){!t&&console.error("Can not create map view. HTML container element is null or undefined!"),this._mapView=new n.MapView(t,e),this._data=new u.MapData(this._mapView),this._isDestroyed=!1}return Object.defineProperty(t.prototype,"mapView",{get:function(){return this._mapView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.isMapReady=function(){if(this._isDestroyed){var t=(new Error).stack.match(/at (\S+)/g)[1].slice(5);console.error("Map is destroyed, function '"+t+"' will not working")}return!this._isDestroyed},t.prototype.enable3dMode=function(t){console.warn("This method 'enable3dMode' was intended to set map type map 3D. It has been superseded by 'setMapType' method. This method is subject to removal in a future versions."),t?this.setMapType(h.MapType.map3d):this.getMapType()==h.MapType.map3d&&this.setMapType(h.MapType.roadmap)},t.prototype.getBounds=function(t){return this.isMapReady()?this._mapView.getBounds(t):null},t.prototype.setMinZoom=function(t){this.isMapReady()&&this._mapView.setMinZoom(t)},t.prototype.setMaxZoom=function(t){this.isMapReady()&&this._mapView.setMaxZoom(t)},t.prototype.getCamera=function(){var t=this._mapView.getCamera();return new s.CameraPosition(t.getTarget(),t.getTilt(),t.getBearing(),t.getZoom())},t.prototype.setWeather=function(t,e){this.isMapReady()&&this._mapView.setWeather(t,e)},t.prototype.getWeather=function(){return this.isMapReady()?this._mapView.getWeather():null},t.prototype.panBy=function(t,e){var r=a.Point.convert(t),i=l.MapUtils.pointToPixel(r);this.isMapReady()&&this._mapView.panBy(i,e)},t.prototype.panTo=function(t,e){this.isMapReady()&&this._mapView.panTo(i.LatLng.convert(t),e)},t.prototype.moveCamera=function(t,e){this.isMapReady()&&this._mapView.moveCamera(t,e)},t.prototype.fitBounds=function(t,e,r){this.isMapReady()&&this._mapView.fitBounds(o.LatLngBounds.convert(t),e,r)},t.prototype.getCameraWithBounds=function(t,e){return this.isMapReady()?this._mapView.getCameraPositionForLatLngBounds(o.LatLngBounds.convert(t),e):null},t.prototype.addListener=function(t,e,r){return void 0===r&&(r={}),this.isMapReady()?this._mapView.addListener(t,e,r):null},t.prototype.setDate=function(t){this.isMapReady()&&this._mapView.setDate(t)},t.prototype.moveToMyLocation=function(t){void 0===t&&(t=!0),this.isMapReady()&&this._mapView.moveToMyLocation(t)},t.prototype.is3dMode=function(){return console.warn("This type of mode checking is not recommended. It is recommended that the 'getMapType' method be used instead. This method is subject to removal in a future versions."),this.getMapType()==h.MapType.map3d},t.prototype.getMinZoom=function(){return this.isMapReady()?this._mapView.mapSettings.getMinZoom():null},t.prototype.getPreferMinZoom=function(){return this.isMapReady()?this._mapView.mapSettings.getPreferMinZoom():null},t.prototype.getMaxZoom=function(){return this.isMapReady()?this._mapView.mapSettings.getMaxZoom():null},t.prototype.setMaxNativeZoom=function(t){if(null==t)throw Error("Parameter can not be null");return this.isMapReady()?this._mapView.setMaxNativeZoom(t):null},t.prototype.getMaxNativeZoom=function(){return this.isMapReady()?this._mapView.getMaxNativeZoom():null},t.prototype.setTimeEffect=function(t){this.isMapReady()&&this._mapView.setTimeEffect(t)},t.prototype.getTimeEffect=function(){return this.isMapReady()?this._mapView.getTimeEffect():null},t.prototype.setShadowEffect=function(t){this.isMapReady()&&this._mapView.setShadowEffect(t)},t.prototype.setWaterEffect=function(t){this.isMapReady()&&this._mapView.setWaterEffect(t)},t.prototype.setBuildingsEnabled=function(t){this.isMapReady()&&this._mapView.setBuildingsEnabled(t)},t.prototype.isBuildingsEnabled=function(){return this.isMapReady()?this._mapView.isBuildingsEnabled():null},t.prototype.setPOIsEnabled=function(t){this.isMapReady()&&this._mapView.setPOIsEnabled(t)},t.prototype.isPOIsEnabled=function(){return this.isMapReady()?this._mapView.isPOIsEnabled():null},t.prototype.getRestrictionBounds=function(){return this.isMapReady()?this._mapView.getRestrictionBounds():null},t.prototype.setRestrictionBounds=function(t){this.isMapReady()&&this._mapView.setRestrictionBounds(t)},t.prototype.setFilterPOIs=function(t){this.isMapReady()&&this._mapView.setFilterPOIs(t)},t.prototype.getFilterPOIs=function(){return this.isMapReady()?this._mapView.getFilterPOIs():null},t.prototype.setFilterBuildings=function(t){this.isMapReady()&&this._mapView.setFilterBuildings(t)},t.prototype.getFilterBuildings=function(){return this.isMapReady()?this._mapView.getFilterBuildings():null},t.prototype.setSelectedBuildings=function(t){this.isMapReady()&&this._mapView.setSelectedBuildings(t)},t.prototype.getSelectedBuildings=function(){return this.isMapReady()?this._mapView.getSelectedBuildings():null},t.prototype.setHiddenBuilding=function(t){c.LogUtils.logDeprecated("setHiddenBuilding(string)","setHiddenBuildings(string[])",!0),this.setHiddenBuildings([t])},t.prototype.setUnhiddenBuilding=function(t){c.LogUtils.logDeprecated("setUnhiddenBuilding(string)","setHiddenBuildings([])",!0),this.setHiddenBuildings([])},t.prototype.setHiddenBuildings=function(t){this.isMapReady()&&this._mapView.setHiddenBuildings(t)},t.prototype.setVisibleBuildings=function(t){this.isMapReady()&&this._mapView.setVisibleBuildings(t)},t.prototype.setZoomGesturesEnabled=function(t){this.isMapReady()&&this._mapView.setZoomGesturesEnabled(t)},t.prototype.setScrollGesturesEnabled=function(t){this.isMapReady()&&this._mapView.setScrollGesturesEnabled(t)},t.prototype.setRotateGesturesEnabled=function(t){this.isMapReady()&&this._mapView.setRotateGesturesEnabled(t)},t.prototype.setTiltGesturesEnabled=function(t){this.isMapReady()&&this._mapView.setTiltGesturesEnabled(t)},t.prototype.setAllGesturesEnabled=function(t){this.isMapReady()&&this._mapView.setAllGesturesEnabled(t)},t.prototype.setMapType=function(t){this.isMapReady()&&this._mapView.setMapType(t)},t.prototype.getMapType=function(){return this.isMapReady()?this._mapView.getMapType():null},t.prototype.setMapStyle=function(t){this.isMapReady()&&this._mapView.setMapStyle(t)},t.prototype.setMapId=function(t){this.isMapReady()&&this._mapView.setMapId(t)},t.prototype.destroy=function(){this._isDestroyed?console.warn("Map is destroyed"):(this._isDestroyed=!0,this._mapView&&this._mapView.destroy())},t}();e.Map4D=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(110),a=r(111),s=r(3),l=r(36),u=r(117),h=r(118),c=r(119),p=r(120),f=r(155),d=r(45),g=r(159),y=r(0),m=r(77),v=r(38),_=r(4),b=r(2),w=r(179),x=r(13),M=r(8),T=r(1),A=r(197),L=r(19),S=r(20),E=r(199),P=r(10),C=r(101),I=r(65),O=r(200),R=r(74),k=r(37),D=r(206),B=r(210),U=r(211),j=r(212),N=r(213),V=r(75),F=r(47),z=r(215),Z=r(33),G=r(216),W=r(7),Y=r(222),H=r(223),X=r(226),q=r(14),J=r(227),Q=r(17),K=r(228),$=r(238),tt=r(32),et=r(100),rt=function(t){function e(e,r){var i=t.call(this)||this;i.clientContainer=e,i.gl=null,i.disableShadowMapByTime=!1,i.lastTime=0,i._deltaTime=0,i.userMapType=Q.MapType.roadmap,i.defaultMapOptions={center:[-1,-1],zoom:12,tilt:0,bearing:0,minZoom:b.MapConstants.defaultMinZoom,maxZoom:b.MapConstants.defaultMaxZoom,maxNativeZoom:b.MapConstants.defaultMaxNativeZoom,geolocate:!1,controls:!1,controlOptions:F.ControlOptions.BOTTOM_RIGHT,mapType:Q.MapType.roadmap,cooperativeGestures:!1,contextOptions:{}},i.defaultAnimationOptions={duration:null,easing:null,animate:!1},i.defaultPaddingOptions={top:0,bottom:0,left:0,right:0},i.defaultWebGLContextOptions={stencil:!0,premultipliedAlpha:!1,alpha:!1};var n={};return T.MapUtils.extendOptions(n,i.defaultMapOptions,r),i.options=n,i.options.shouldChangeMapMode&&console.warn("This option 'shouldChangeMapMode' is no longer support, which is subject to removal in a future versions."),i.container=l.DOMUtils.create("div","mf-map4d",i.clientContainer),i.createStyleNode(),i.init(),i.createMapControlNode(i.container,i.options),i.createLogoNode(i.container),i.setMapType(i.options.mapType),i.tileManager.updateVisibleTiles(),i}return n(e,t),Object.defineProperty(e.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.setupMapViews(this.container,this.options),this.setupComponents(this.options),this.renderTaskQueue=new j.TaskQueue,this.loop(0)},e.prototype.requestRender=function(){this.dirty=!0},e.prototype.requestRenderFrame=function(t){return this.dirty=!0,this.renderTaskQueue.add(t)},e.prototype.cancelRenderFrame=function(t){this.renderTaskQueue.remove(t)},e.prototype.loop=function(t){var e=this;if(null!=this.gl){var r=t-this.lastTime,i=b.MapConstants.FPS-r;this._deltaTime=i>0?b.MapConstants.FPS:r,!this.dirty&&i>0?setTimeout((function(){requestAnimationFrame(e.loop.bind(e))}),i):(this.lastTime=t,this.resize(),(this.dirty||this.effectDirty)&&(this.dirty=!1,this.effectDirty=!1,this.update(),this.render()),(this.weatherManager.dirty()||this.timeEffectManager.dirty()||this.effectManager.dirty())&&(this.effectDirty=!0),this.mapState.dirty()&&(this.dirty=!0),requestAnimationFrame(this.loop.bind(this)))}},e.prototype.update=function(){var t=this;this._annotationManager.clearVisibleAnnotations(),this.cameraAnimation.updateTransitions(),this.tileManager.update(),this.annotationManager.update(),this.overlayManager.update(),this.geoJsonManager.update(),this.collision2DManager.clearCollision(),this.layers.forEach((function(e){e.update(t.mapState)})),this.mapSettings.is3dMode()&&(this.weatherManager.update(),this.mapState.getTilt()>b.MapConstants.maxTiltIntersectWithScreen&&this.skyObject.updateMatrices(this.mapState)),!this.effectManager.enableShadowEffect||this.disableShadowMapByTime||this.timeEffectManager.getTimeEffect()!=V.TimeEffect.Evening&&!this.timeEffectManager.isEveningTime()?this.disableShadowMapByTime&&this.timeEffectManager.getTimeEffect()!=V.TimeEffect.Evening&&!this.timeEffectManager.isEveningTime()&&(this.disableShadowMapByTime=!1,this.effectManager.enableShadowEffect=!0):(this.disableShadowMapByTime=!0,this.effectManager.enableShadowEffect=!1),this.compassImage&&(this.compassImage.style.transform="rotate("+this.mapState.getBearing()+"deg)"),this.collision2DManager.hitTest()},e.prototype.hasTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},e.prototype.resize=function(){if(null!=this.canvas&&null!=this.gl){T.MapUtils.pixelScale=window.devicePixelRatio||1;var t=Math.round(this.canvas.offsetWidth*T.MapUtils.pixelScale),e=Math.round(this.canvas.offsetHeight*T.MapUtils.pixelScale);this.offsetWidth==this.canvas.offsetWidth&&this.offsetHeight==this.canvas.offsetHeight||(this.offsetWidth=this.canvas.offsetWidth,this.offsetHeight=this.canvas.offsetHeight,(this.width==t&&this.height==e||this.devicePixelRatio!=T.MapUtils.pixelScale)&&(this.devicePixelRatio=T.MapUtils.pixelScale,this.mapsEventManager.notify(k.MapEvent.boundsChanged),this.reload(),this.setDirtyAfterResize())),this.width==t&&this.height==e||(this.width=t,this.height=e,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.mapState.setScreenSize(this.width,this.height),this.weatherManager.resize(t,e),this.effectManager.resize(t,e),null!=this.frameBuffer&&(this.frameBuffer.destroy(),this.frameBuffer=null),this.frameBuffer=new C.FrameBuffer(this.gl,this.width,this.height),this.mapsEventManager.notify(k.MapEvent.boundsChanged),this.setDirtyAfterResize())}},e.prototype.setDirtyAfterResize=function(){this.tileManager.updateVisibleTiles(),this.surfaceLayer.setDirty(),this.boundaryLayer.setDirty(),this.roadLayer.setDirty(),this.buildingLayer.setDirty(),this.userBuildingLayer.setDirty(),this.overlayManager.dirtyBuildingOverlay(),this.dirty=!0},e.prototype.render=function(){var t=this.gl;null!=t&&(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.mapRenderer.render(),this.renderTaskQueue.run(),this.mapSettings.is3dMode()&&(t.enable(t.BLEND),this.weatherManager.render(this.mapState),t.disable(t.BLEND)),this.collision2DManager.drawDebug())},e.prototype.renderSelection=function(){var t=this.gl;if(null!=t){t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),q.LayerRenderer.resetSelectionCode(),this.mapRenderer.renderSelection();var e=this.mapState.is3dMode()?b.MapConstants.mapBackgroundColor3D:this.getMapStyle().getMapBackgroundColor2D();t.clearColor(e.red,e.green,e.blue,1)}},e.prototype.getSelectionCode=function(t){if(null!=this.frameBuffer){this.frameBuffer.bind(),this.renderSelection();var e=T.MapUtils.touchBoxSize,r=4*e*e,i=new Uint8Array(r).fill(0);this.gl.readPixels(t.min.x,this.height-t.min.y-e,e,e,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this.frameBuffer.unbind();for(var n=new Map,o=0,a=0;a<r;a+=4){var s=i[a]<<16|i[a+1]<<8|i[a+2],l=n.get(s)?n.get(s):0;n.set(s,l+1),o=s}return n.forEach((function(t,e){t>n.get(o)&&(o=e)})),o}return-1},e.prototype.createLayer=function(t,e,r){if(this.layers.has(t))return console.log("Cannot create layer which layer id already exist"),null;var i=w.LayerFactory.createLayer(t,e,this,r);return null!=i?(this.mapRenderer.addLayer(i),this.layers.set(t,i),i):null},e.prototype.removeLayer=function(t,e){this.mapRenderer.removeLayer(t,e),this.layers.delete(t)},e.createCameraAnimationOptions=function(t){var e=new m.CameraAnimationOptions;if(t.animate){if(null!=t.duration&&t.duration<0)throw new Error("Animation duration must be greater or equal to 0");e.easing=t.easing}return e.duration=t.duration,e.gesture=!1,e},e.prototype.panBy=function(t,r){r=T.MapUtils.extendOptions({},this.defaultAnimationOptions,r),this.cameraAnimation.moveBy(t,e.createCameraAnimationOptions(r))},e.prototype.panTo=function(t,r){null==(r=T.MapUtils.extendOptions({},this.defaultAnimationOptions,r)).duration&&(r.duration=T.MapUtils.getTimePanTo(this.mapState.getTarget(),t,this.mapState.getZoom())),this.cameraAnimation.moveTo({target:t,zoom:this.mapState.getZoom()},e.createCameraAnimationOptions(r))},e.prototype.moveCamera=function(t,r){var i=S.CameraPosition.convert(t),n=new m.CameraOptions;if(null!=i.getZoom()?n.zoom=x.MathUtils.clamp(i.getZoom(),this.mapSettings.getPreferMinZoom(),this.mapSettings.getMaxZoom()):n.zoom=this.mapState.getZoom(),null!=i.getTilt()){var o=(a=n.zoom||this.mapState.getZoom())<b.MapConstants.defaultMinZoom3d?b.MapConstants.maxTilt2D:this.mapSettings.getPreferMaxTilt();n.tilt=x.MathUtils.clamp(i.getTilt(),this.mapSettings.getMinTilt(),o)}else{var a=n.zoom||this.mapState.getZoom();n.tilt=this.mapSettings.getPreferMaxTilt()==b.MapConstants.maxTilt2D||a<b.MapConstants.defaultMinZoom3d?0:b.MapConstants.maxTilt2D}var l=i.getBearing();if(n.bearing=null!=l?l:this.mapState.getBearing(),n.target=i.getTarget()||this.mapState.getTarget(),null!=r&&r.animate){var u=this.latLngToScreenCoordinate(n.target),h=new s.Vector2(this.mapState.screenWidth/2,this.mapState.screenHeight/2),c=x.MathUtils.distance(u,h),p=c/Math.max(this.mapState.screenWidth,this.mapState.screenHeight);r=T.MapUtils.extendOptions({},this.defaultAnimationOptions,r),c<h.x&&Math.abs(i.getZoom()-this.mapState.getCamera().getZoom())<1||p>b.MapConstants.distanceRatioToForceMoveCamera?(null==r.duration&&(r.duration=0),this.cameraAnimation.moveTo(n,e.createCameraAnimationOptions(r))):this.cameraAnimation.flyTo(n,e.createCameraAnimationOptions(r))}else this.cameraAnimation.moveTo(n)},e.prototype.fitBounds=function(t,e,r){var i=this.getCameraPositionForLatLngBounds(t,e);this.moveCamera(i,r)},e.prototype.moveBy=function(t){this.cameraAnimation.moveBy(t,null,!0)},e.prototype.moveByVelocity=function(t){this.mapState.isPanning()||this.mapState.isZoomIn()||this.mapState.isZoomOut()||this.cameraAnimation.moveByVelocity(t)},e.prototype.getCameraPositionForLatLngBounds=function(t,e){if((e=T.MapUtils.extendOptions({},this.defaultPaddingOptions,e)).top<0||e.bottom<0||e.left<0||e.right<0)throw new Error("Padding value must be greater or equal to 0");var r={top:e.top*T.MapUtils.pixelScale,bottom:e.bottom*T.MapUtils.pixelScale,left:e.left*T.MapUtils.pixelScale,right:e.right*T.MapUtils.pixelScale};return T.MapUtils.getCameraPositionForLatLngBounds(t,r,this.mapState,this.mapSettings)},e.prototype.getAnnotationManager=function(){return this.annotationManager},e.prototype.getOverlayManager=function(){return this.overlayManager},e.prototype.setZoom=function(t,e,r,i){var n=this;void 0===r&&(r=0),void 0===i&&(i=!1);var o=new m.CameraAnimationOptions;o.duration=r,o.gesture=i;var a=this.getCamera().getZoom(),s=this.mapSettings.getPreferMinZoom(),l=this.mapSettings.getMaxZoom();t=x.MathUtils.clamp(t,s,l),this.cameraAnimation.zoom(t,e,o),(Math.abs(s-t)<b.MathConstants.epsilon||Math.abs(l-t)<b.MathConstants.epsilon)&&(Math.abs(a-t)<b.MathConstants.epsilon?this.mapsEventManager.notify(k.MapEvent.limitedZoom):setTimeout((function(){n.mapsEventManager.notify(k.MapEvent.limitedZoom)}),1.1*b.MapConstants.defaultAnimationDuration))},e.prototype.setTilt=function(t,e){void 0===e&&(e=!1),this.cameraAnimation.setTilt(t,e)},e.prototype.setBearing=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=!1),this.cameraAnimation.setBearing(t,e,r)},e.prototype.stopAnimation=function(){this.cameraAnimation.stopAnimation()},e.prototype.setWeather=function(t,e){this.weatherManager.setProvider(e),this.weatherManager.setWeather(t),this.dirty=!0,t==R.Weather.Live&&null==e&&console.warn("Please provide `map4d.WeatherProvider` if you're using `map4d.Live` weather mode")},e.prototype.getWeather=function(){return this.weatherManager.getWeather()},e.prototype.enable3dMode=function(t){if(this.mapState.enable3dMode(t)){this.mapState.getZoom()>=b.MapConstants.defaultMinZoom3d&&this.tileManager.reload(),t?this.mapState.getZoom()<b.MapConstants.defaultMinZoom3d&&this.moveCamera({target:this.mapState.getTarget(),zoom:b.MapConstants.defaultMinZoom3d}):(this.effectManager.shadowMap.clear(),this.buildingLayer.clear(),this.userBuildingLayer.clear(),W.MapResourceManager.getInstance(this.gl).clearVisibleBuildingId());var e=this.mapState.is3dMode()?b.MapConstants.mapBackgroundColor3D:this.getMapStyle().getMapBackgroundColor2D();this.gl.clearColor(e.red,e.green,e.blue,1)}},e.prototype.getBounds=function(t){if((t=T.MapUtils.extendOptions({},this.defaultPaddingOptions,t)).top<0||t.bottom<0||t.left<0||t.right<0)throw new Error("Padding value must be greater or equal to 0");t={top:t.top*T.MapUtils.pixelScale,bottom:t.bottom*T.MapUtils.pixelScale,left:t.left*T.MapUtils.pixelScale,right:t.right*T.MapUtils.pixelScale};var e=this.mapState.getScreenSize();if(!this.getCamera().getTarget()||!this.mapState.getZoom()||e.x<=0||e.y<=0)return null;var r=this.mapState.getTilt(),i=!1;r>b.MapConstants.maxTiltIntersectWithScreen&&(this.mapState.setTilt(b.MapConstants.maxTiltIntersectWithScreen),i=!0);var n=this.mapState.cameraPosition,o=M.GeometryUtils.screenCoordinateToLatLng(new s.Vector2(t.left,t.top),n,e).normalize(),a=M.GeometryUtils.screenCoordinateToLatLng(new s.Vector2(e.x-t.right,t.top),n,e).normalize();i&&this.mapState.setTilt(r);var l=M.GeometryUtils.screenCoordinateToLatLng(new s.Vector2(e.x-t.right,e.y-t.bottom),n,e).normalize(),u=M.GeometryUtils.screenCoordinateToLatLng(new s.Vector2(t.left,e.y-t.bottom),n,e).normalize();if(!l.valid()||!u.valid())return L.LatLngBounds.world();var h=new L.LatLngBounds;return h.extend(a).extend(u).extend(o).extend(l),h},e.prototype.getCurrentMousePosition=function(t){return new s.Vector2((t.clientX-this.canvas.getBoundingClientRect().left)*T.MapUtils.pixelScale,(t.clientY-this.canvas.getBoundingClientRect().top)*T.MapUtils.pixelScale)},e.prototype.hideInfoWindow=function(t){this.annotationManager.hideInfoWindow(t)},e.prototype.isInfoWindowShown=function(t){return this.annotationManager.isInfoWindowShown(t)},e.prototype.showInfoWindow=function(t){this.annotationManager.showInfoWindow(t)},e.prototype.setMinZoom=function(t){this.mapSettings.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this.mapSettings.setMaxZoom(t)},e.prototype.setDataLayerMinZoom=function(t){this.dirty=!0,this.mapSettings.dataLayerMinZoom=t},e.prototype.setDataLayerMaxZoom=function(t){this.dirty=!0,this.mapSettings.dataLayerMaxZoom=t},e.prototype.getDataLayerMinZoom=function(){return this.mapSettings.dataLayerMinZoom},e.prototype.getDataLayerMaxZoom=function(){return this.mapSettings.dataLayerMaxZoom},e.prototype.setMaxNativeZoom=function(t){t=x.MathUtils.clamp(t,b.MapConstants.defaultMinZoom,b.MapConstants.defaultMaxZoom),this.getMaxNativeZoom()!=t&&(this.mapSettings.setMaxNativeZoom(t),this.tileManager.reload(),this.annotationManager.clearShapeIndexer(),t>b.MapConstants.geoJsonMinNativeZoom&&this.geoJsonManager.reloadIndexer())},e.prototype.getMaxNativeZoom=function(){return this.mapSettings.getMaxNativeZoom()},e.prototype.addOverlay=function(t){return this.dirty=!0,this.overlayManager.addOverlay(t)},e.prototype.removeOverlay=function(t){this.overlayManager.removeOverlay(t),this.dirty=!0},e.prototype.addAnnotation=function(t){return this.dirty=!0,this.annotationManager.addAnnotation(t)},e.prototype.updateAnnotationZIndex=function(t,e,r){this.annotationManager.updateAnnotationZIndex(t,e,r),this.dirty=!0},e.prototype.updateAnnotation=function(t,e){void 0===e&&(e=!1),this.annotationManager.updateAnnotation(t,e),this.dirty=!0},e.prototype.removeAnnotation=function(t){this.annotationManager.removeAnnotation(t),this.dirty=!0},e.prototype.screenCoordinateToLatLng=function(t,e){return void 0===e&&(e=0),e=this.mapState.is3dMode()?e:0,M.GeometryUtils.screenCoordinateToLatLng(t,this.mapState.cameraPosition,this.mapState.getScreenSize(),e)},e.prototype.latLngToScreenCoordinate=function(t,e){return void 0===e&&(e=0),e=this.mapState.is3dMode()?e:0,M.GeometryUtils.latLngToScreenCoordinate(t,e,this.mapState.cameraPosition,this.mapState.getScreenSize())},e.prototype.getCamera=function(){return this.mapState.getCamera()},e.prototype.setShadowEffect=function(t){this.disableShadowMapByTime=!1,this.effectManager.enableShadowEffect=t,this.dirty=!0},e.prototype.setWaterEffect=function(t){this.effectManager.enableWaterEffect=t,this.dirty=!0},e.prototype.setBuildingsEnabled=function(t){this.mapSettings.objectsEnabled!=t&&(this.mapSettings.objectsEnabled=t,this.mapState.is3dMode()&&(t&&this.buildingLayer.setDirty(),this.dirty=!0))},e.prototype.isBuildingsEnabled=function(){return this.mapSettings.objectsEnabled},e.prototype.setPOIsEnabled=function(t){this.mapSettings.placesEnabled!=t&&(this.dirty=!0,this.mapSettings.placesEnabled=t)},e.prototype.isPOIsEnabled=function(){return this.mapSettings.placesEnabled},e.prototype.getRestrictionBounds=function(){return this.mapSettings.getRestrictionBounds()},e.prototype.setRestrictionBounds=function(t){null==t?this.mapSettings.setRestrictionBounds(null):(this.mapSettings.setRestrictionBounds(L.LatLngBounds.convert(t)),this.mapState.constraintCameraWithRestrictionBounds())},e.prototype.reload=function(){this.tileManager.reload()},e.prototype.setupComponents=function(t){var e=this,r={};T.MapUtils.extendOptions(r,this.defaultMapOptions,t),P.ResourceManager.getInstance(this.gl),Z.TextLabelFactory.getInstance(this.gl),this.layers=new Map,this.httpTaskManager=f.TaskManager.getSharedInstance(),this.mapsEventManager=new E.MapsEventManager(this),this.mapSettings=new d.MapSettings,this.mapState=new c.MapState(this.mapSettings),this.timeEffectManager=new U.TimeEffectManager(this.mapState),this.mapRenderer=new g.MapRenderer(this.gl,this.mapState),this.cameraAnimation=new m.CameraAnimation(this.mapState,this,this.mapSettings),this.dirty=!0,this.mapObserver=new u.MapObserver,this.mapState.setScreenSize(this.width,this.height),r.restrictionBounds&&this.setRestrictionBounds(r.restrictionBounds),this.mapState.setZoom(r.zoom),this.mapState.setBearing(r.bearing),this.mapState.setTarget(_.LatLng.convert(r.center)),this.mapSettings.setMinZoom(r.minZoom),this.mapSettings.setMaxZoom(r.maxZoom),this.mapSettings.setMaxNativeZoom(r.maxNativeZoom),this.mapSettings.cooperativeGestures=r.cooperativeGestures,this.mapSettings.cooperativeGestures&&this.mouseEventHandler.setupBlocker(),this.options.mapType==Q.MapType.map3d?r.tilt=x.MathUtils.clamp(r.tilt,b.MapConstants.minTilt,b.MapConstants.maxTilt3D):r.tilt=x.MathUtils.clamp(r.tilt,b.MapConstants.minTilt,b.MapConstants.maxTilt2D),this.mapState.setTilt(r.tilt);var i=function(){e.dirty=!0},n=W.MapResourceManager.getInstance(this.gl);n.init(i,this.httpTaskManager),this.tileManager=new p.TileManager(this,this.httpTaskManager,this.mapState,this.mapSettings,i),this.overlayManager=new X.OverlayManager(this,this.httpTaskManager,i),this.directionsRendererManager=new $.DirectionsRendererManager,this.styleManager=new K.StyleManager(this.gl),n.clear2DColor=this.getMapStyle().getMapBackgroundColor2D();var o=this.createLayer(b.LayerConstants.rasterLayerId,y.LayerType.RASTER,b.MapConstants.baseMapLowestOrder);this.userPOILayer=this.createLayer(b.LayerConstants.userPOILayerId,y.LayerType.USERPOI,b.MapConstants.userPOILayerOrder),this.poiLayer=this.createLayer(b.LayerConstants.pointLayerId,y.LayerType.POI,b.MapConstants.baseMapMiddleOrder),this.surfaceLayer=this.createLayer(b.LayerConstants.surfaceLayerId,y.LayerType.SURFACE,b.MapConstants.baseMapLowestOrder),this.boundaryLayer=this.createLayer(b.LayerConstants.boundaryLayerId,y.LayerType.BOUNDARY,b.MapConstants.baseMapLowestOrder),this.roadLayer=this.createLayer(b.LayerConstants.roadsLayerId,y.LayerType.ROADS,b.MapConstants.baseMapLowestOrder),this.labelLayer=this.createLayer(b.LayerConstants.labelLayerId,y.LayerType.LABEL,b.MapConstants.baseMapMiddleOrder),this.createLayer(b.LayerConstants.skyLayerId,y.LayerType.SKY,b.MapConstants.baseMapLowestOrder),this.createLayer(G.GeoJsonManager.geoJsonLayerId,y.LayerType.GEOJSON,b.MapConstants.baseMapLowestOrder),this.buildingLayer=this.createLayer(b.LayerConstants.buildingLayerId,y.LayerType.BUILDING,b.MapConstants.buildingLayerOrder),this.userBuildingLayer=this.createLayer(b.LayerConstants.userBuildingLayerId,y.LayerType.USERBUILDING,b.MapConstants.buildingLayerOrder),this.hiddenBuildings=new Set,this.visibleBuildings=new Set,this.selectedBuildings=new Set,this.lightManager=new D.LightingManager(this.timeEffectManager),this.buildingLayer.timeEffectManager=this.timeEffectManager,this.buildingLayer.setLightingManager(this.lightManager),this.userBuildingLayer.timeEffectManager=this.timeEffectManager,this.userBuildingLayer.setLightingManager(this.lightManager);var a=new B.ShadowMap(this.gl,this.lightManager.sunLight,this.mapState);this.effectManager=new z.EffectManager(a,this.mapState),this.mapRenderer.setEffectManager(this.effectManager),o.effectManager=this.effectManager,o.timeEffectManager=this.timeEffectManager,o.setLightingManager(this.lightManager),this.buildingLayer.effectManager=this.effectManager,this.userBuildingLayer.effectManager=this.effectManager,this._annotationManager=new v.AnnotationManager(this,this.tileManager),this.weatherManager=new O.WeatherManager(this.gl,this.mapState),this.weatherManager.resize(this.width,this.height),this.lightManager.setOnLightPositionChanged((function(){a.updateMatrices()})),this.geoJsonManager=new G.GeoJsonManager(this),this.collision2DManager=new H.Collision2DManager(this.gl,this.mapState),this.uiSettings=new J.UISettings,this.skyObject=new N.SkyObject,this.frameBuffer=new C.FrameBuffer(this.gl,this.width,this.height),this.canvas.width=this.width,this.canvas.height=this.height,this.dirty=!0},e.prototype.createStyleNode=function(){var t=document.getElementsByTagName("head")[0],e=t.getElementsByClassName("map-style");if(!(e&&e.length>0)){var r=document.createElement("style");r.innerHTML=o.Style.content,r.className="map-style",t.appendChild(r)}},e.prototype.getMap4dStore=function(){return window.map4dsdk||(window.map4dsdk={idContextCounting:0}),window.map4dsdk},e.prototype.getNextMap4dId=function(){return++this.getMap4dStore().idContextCounting},e.prototype.setupMapViews=function(t,e){var r=l.DOMUtils.create("div","mf-mapgl",t);this.mapContainer=r,this.canvas=l.DOMUtils.create("canvas","",r);var i=T.MapUtils.extendOptions({},this.defaultWebGLContextOptions,e.contextOptions);this.gl=this.canvas.getContext("experimental-webgl",i),this.gl.id=this.getNextMap4dId();var n=b.MapConstants.mapBackgroundColor2D;this.gl.clearColor(n.red,n.green,n.blue,n.alpha),this.gl.stencilOp(this.gl.KEEP,this.gl.REPLACE,this.gl.REPLACE),T.MapUtils.pixelScale=window.devicePixelRatio||1,this.devicePixelRatio=T.MapUtils.pixelScale,this.hasTouch()&&(T.MapUtils.touchBoxSize=b.MapConstants.touchBoxSize*T.MapUtils.pixelScale),this.width=this.canvas.offsetWidth*T.MapUtils.pixelScale,this.height=this.canvas.offsetHeight*T.MapUtils.pixelScale,this.offsetWidth=this.canvas.offsetWidth,this.offsetHeight=this.canvas.offsetHeight,this.mouseEventHandler=new a.MouseEventHandler(this.canvas,this),window.addEventListener("resize",this.resize,!1)},e.prototype.createMapControlNode=function(t,e){var r=et.IConverter.convertControlOptions(e.controlOptions),i=l.DOMUtils.create("div","mf-ui "+o.Style.getStyleForControlOptions(r),t),n=null,a=null,s=null;if(e.geolocate&&(this.geolocateControl=new A.GeolocateControl(this)),e.controls){a=l.DOMUtils.create("div","vertical",i),this.zoomInButton=l.DOMUtils.create("div","mf-button",a),this.zoomInButton.innerHTML="<a class='mf-zoom-in-icon'></a>",this.zoomOutButton=l.DOMUtils.create("div","mf-button",a),this.zoomOutButton.innerHTML="<a class='mf-zoom-out-icon'></a>",n=l.DOMUtils.create("div","right",i),this.upButton=l.DOMUtils.create("div","mf-button",n),this.upButton.innerHTML="<a class='mf-up-icon'></a>",this.downButton=l.DOMUtils.create("div","mf-button",n),this.downButton.innerHTML="<a class='mf-down-icon'></a>";var u=r==F.ControlOptions.BOTTOM_RIGHT||r==F.ControlOptions.TOP_RIGHT;this.leftButton=l.DOMUtils.create("div","mf-button",u?a:n),this.leftButton.innerHTML="<a class='mf-left-icon'></a>",this.rightButton=l.DOMUtils.create("div","mf-button",u?n:a),this.rightButton.innerHTML="<a class='mf-right-icon'></a>",s=l.DOMUtils.create("div","horizontal",i),this.geolocateControl&&this.geolocateControl.updateMapUI(s),this.bearingButton=l.DOMUtils.create("div","mf-button",s),this.compassImage=l.DOMUtils.create("a","mf-direct-icon",this.bearingButton),this.compassImage.style.transform=null}this.addControlEvents()},e.prototype.createLogoNode=function(t){var e=et.IConverter.convertControlOptions(this.options.controlOptions)==F.ControlOptions.BOTTOM_LEFT?"mf-right":"mf-left",r=l.DOMUtils.create("div","mf-logo-container "+e,t),i=I.Images.get("logoIcon");r.innerHTML="<a target='_blank' href='https://www.map4d.vn/' aria-label='Map4D Logo'>\n      <img src="+i+" class='mf-logo'/>\n      </a>"},e.prototype.addControlEvents=function(){var t=this;this.options.controls&&(this.upButton.addEventListener("click",(function(){t.setTilt(t.mapState.getTilt()+10,!1)})),this.downButton.addEventListener("click",(function(){t.setTilt(t.mapState.getTilt()+-10,!1)})),this.leftButton.addEventListener("click",(function(){t.setBearing(t.mapState.getBearing()-10,0,!1)})),this.rightButton.addEventListener("click",(function(){t.setBearing(t.mapState.getBearing()+10,0,!1)})),this.zoomInButton.addEventListener("click",(function(){t.setZoom(t.mapState.getZoom()+1,new s.Vector2(t.width/2,t.height/2),0,!1)})),this.zoomOutButton.addEventListener("click",(function(){t.setZoom(t.mapState.getZoom()-1,new s.Vector2(t.width/2,t.height/2),0,!1)})),this.bearingButton.addEventListener("click",(function(){t.moveCamera({target:t.mapState.getTarget(),bearing:0},{animate:!0})})))},e.prototype.addListener=function(t,e,r){return this.mapsEventManager.addEvent(t,e,r)},e.prototype.addGeoJsonListener=function(t,e){return this.mapsEventManager.addGeoJsonListener(t,e)},e.prototype.updateInfoContents=function(t){this.annotationManager.updateInfoContents(t)},e.prototype.notifyCameraWillChange=function(t){this.dirty=!0,this.mapsEventManager.notify(k.MapEvent.cameraWillChange,null,t),this.lastZoomByStep=this.mapState.getCamera().getZoom()},e.prototype.notifyCameraIsChanging=function(){if(this.dirty=!0,this.mapsEventManager.notify(k.MapEvent.cameraChanging),this.mapsEventManager.notify(k.MapEvent.boundsChanged),this.surfaceLayer.setDirty(),this.boundaryLayer.setDirty(),this.roadLayer.setDirty(),this.buildingLayer.setDirty(),this.userBuildingLayer.setDirty(),this.tileManager.updateVisibleTiles(),this.overlayManager.dirtyBuildingOverlay(),this.mapState.isTilting()&&this.mapsEventManager.notify(k.MapEvent.tiltChanged),this.mapState.isBearing()&&this.mapsEventManager.notify(k.MapEvent.bearingChanged),(this.mapState.isMoving()||this.mapState.isFlinging())&&this.mapsEventManager.notify(k.MapEvent.targetChanged),this.mapState.isZoomIn()||this.mapState.isZoomOut()){var t=this.lastZoomByStep,e=this.mapState.isMouseWheel(),r=!1;this.mapState.isZoomIn()?t+=e?this.mapSettings.getZoomStep():1:this.mapState.isZoomOut()&&(t-=e?this.mapSettings.getZoomStep():1),e&&this.mapState.isZoomIn()&&this.mapState.getCamera().getZoom()>=t||e&&this.mapState.isZoomOut()&&this.mapState.getCamera().getZoom()<=t?r=!0:e||this.mapState.getCamera().getZoom()!=t||(r=!0),r&&(this.lastZoomByStep=t,this.mapsEventManager.notify(k.MapEvent.zoomChanged),this.mapState.mouseWheel=!1)}},e.prototype.notifyCameraDidChange=function(){this.dirty=!0,this.surfaceLayer.setDirty(),this.boundaryLayer.setDirty(),this.roadLayer.setDirty(),this.buildingLayer.setDirty(),this.userBuildingLayer.setDirty(),this.tileManager.updateVisibleTiles(),this.mapsEventManager.notify(k.MapEvent.idle),this.mapState.willChange=!1},e.prototype.getLayer=function(t){return this.layers.has(t)?this.layers.get(t):null},e.prototype.queryBuildingAndAnnotation=function(t){return this.annotationManager.queryBuildingAndAnnotation(t)},e.prototype.queryPOI=function(t){var e=this.collision2DManager.query(t);if(null==e)return null;if(!this.mapState.is3dMode()){var r=null;if(this.layers.forEach((function(t){if(t.getLayerType()==y.LayerType.POI_OVERLAY){if(null!=r)return;r=t.queryFeature(e)}})),null!=r)return r;if(this.isPOIsEnabled())return this.poiLayer.queryFeature(e)}return null},e.prototype.queryUserPOI=function(t){var e=this.collision2DManager.query(t);if(null==e)return null;var r=this.userPOILayer.queryFeature(e);return r||null},e.prototype.queryPlace=function(t){var e=this.collision2DManager.query(t);if(null==e)return null;var r=this.labelLayer.queryFeature(e);return r||null},e.prototype.queryBuildingAndAnnotationInfo=function(t){var e=this.getSelectionCode(t);return this.queryBuildingAndAnnotationId(e)},e.prototype.queryBuildingAndAnnotationId=function(t){if(t<0)return null;var e=[],r=[];this.isBuildingsEnabled()&&e.push(this.buildingLayer),e.push(this.userBuildingLayer),this.layers.forEach((function(t){if(t.getLayerType()===y.LayerType.BUILDING_OVERLAY){var i=t;i.isVisible()&&e.push(i)}else if(t.getLayerType()===y.LayerType.LINE){var n=t;r.push(n)}}));for(var i=null,n=0,o=e;n<o.length;n++){var a=o[n];0==a.textureBuildingGroups.size&&0==a.extrudeBuildings.length||(0!=a.textureBuildingGroups.size&&a.textureBuildingGroups.forEach((function(e){e.buildings.forEach((function(e){if(e.getSelectionCode()!=t);else{var r=e.getLayerProperties(),n=0;if(e.getType()==y.LayerType.USERBUILDING){var o=r;if(!o.isVisible()||!o.isClickable())return;n=o.getAnnotationId()}i=new Y.BuildingQueryResult(n,r.getId(),r.getName(),r.getLocation())}}))})),0!=a.extrudeBuildings.length&&a.extrudeBuildings.forEach((function(e){if(e.getSelectionCode()!=t);else{var r=e.getLayerProperties(),n=0;if(e.getType()==y.LayerType.USERBUILDING){var o=r;if(!o.isVisible()||!o.isClickable())return;n=o.getAnnotationId()}i=new Y.BuildingQueryResult(n,r.getId(),r.getName(),r.getLocation())}})))}for(var s=0,l=r;s<l.length;s++){l[s].renderTiles.forEach((function(e){e.tile.getTileRenderData().getLayerRenderDatas().forEach((function(e){if(e.getType()==y.LayerType.LINE){var r=e;if(r.getSelectionCode()==t){var n=r.getLayerProperties().getId();i=n}}}))}))}return i},e.prototype.setDate=function(t){this.mapSettings.setDate(t),this.reload(),this.mapSettings.is3dMode()&&(this.buildingLayer.clear(),this.userBuildingLayer.clear())},e.prototype.getMapContainer=function(){return this.mapContainer},e.prototype.destroy=function(){this.frameBuffer&&this.frameBuffer.destroy(),this.tileManager&&this.tileManager.destroy(),this.mapsEventManager&&this.mapsEventManager.destroy(),this.weatherManager&&this.weatherManager.destroy(),this.layers&&this.layers.clear(),this.buildingLayer&&this.buildingLayer.clear(),this.userBuildingLayer&&this.userBuildingLayer.clear(),this.effectManager&&this.effectManager.destroy(),this.httpTaskManager&&this.httpTaskManager.destroy(),this.mouseEventHandler.destroy(),window.removeEventListener("resize",this.resize,!1),P.ResourceManager.releaseInstance(this.gl),Z.TextLabelFactory.releaseInstance(this.gl),W.MapResourceManager.releaseInstance(this.gl);var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.removeNode(this.canvas),this.removeNode(this.mapContainer),this.removeNode(this.container),this.gl=null,this.frameBuffer=null,this.effectManager=null},e.prototype.removeNode=function(t){t.parentNode&&t.parentNode.removeChild(t),t.remove()},Object.defineProperty(e.prototype,"annotationManager",{get:function(){return this._annotationManager},enumerable:!0,configurable:!0}),e.prototype.moveToMyLocation=function(t){void 0===t&&(t=!0),this.geolocateControl&&this.geolocateControl.moveToMyLocation(t)},e.prototype.setTimeEffect=function(t){this.timeEffectManager.setTimeEffect(t),this.buildingLayer.setDirty(),this.userBuildingLayer.setDirty(),this.dirty=!0},e.prototype.getTimeEffect=function(){return this.timeEffectManager.getTimeEffect()},e.prototype.setFilterPOIs=function(t){this.mapSettings.filterPOITypes=t,this.mapState.is3dMode()||(this.dirty=!0)},e.prototype.getFilterPOIs=function(){return this.mapSettings.filterPOITypes},e.prototype.setFilterBuildings=function(t){this.buildingLayer.filterBuildingTypes=t,this.effectManager.shadowMap.clear(),this.dirty=!0},e.prototype.getFilterBuildings=function(){return this.buildingLayer.filterBuildingTypes},e.prototype.getSelectedBuildings=function(){return Array.from(this.selectedBuildings)},e.prototype.setSelectedBuildings=function(t){var e=this;this.selectedBuildings.clear(),t.forEach((function(t){e.selectedBuildings.add(t)})),this.buildingLayer.setDirty(),this.overlayManager.dirtyBuildingOverlay(),this.dirty=!0},e.prototype.setHiddenBuildings=function(t){var e=this;null!=t&&(this.hiddenBuildings.clear(),t.length>0&&t.forEach((function(t){e.hiddenBuildings.add(t)})),this.dirty=!0)},e.prototype.setVisibleBuildings=function(t){var e=this;null!=t&&(this.visibleBuildings.clear(),t.length>0&&t.forEach((function(t){e.visibleBuildings.add(t)})),this.dirty=!0)},e.prototype.isHiddenBuilding=function(t){return this.hiddenBuildings.has(t)},e.prototype.isVisibleBuilding=function(t){return this.visibleBuildings.has(t)},e.prototype.hasVisibleBuildings=function(){return this.visibleBuildings.size>0},e.prototype.getGeoJsonManager=function(){return this.geoJsonManager},e.prototype.getCollision2DManager=function(){return this.collision2DManager},e.prototype.isZoomGesturesEnabled=function(){return this.uiSettings.isZoomGesturesEnabled()},e.prototype.setZoomGesturesEnabled=function(t){this.uiSettings.setZoomGesturesEnabled(t)},e.prototype.isScrollGesturesEnabled=function(){return this.uiSettings.isScrollGesturesEnabled()},e.prototype.setScrollGesturesEnabled=function(t){this.uiSettings.setScrollGesturesEnabled(t)},e.prototype.isRotateGesturesEnabled=function(){return this.uiSettings.isRotateGesturesEnabled()},e.prototype.setRotateGesturesEnabled=function(t){this.uiSettings.setRotateGesturesEnabled(t)},e.prototype.isTiltGesturesEnabled=function(){return this.uiSettings.isTiltGesturesEnabled()},e.prototype.setTiltGesturesEnabled=function(t){this.uiSettings.setTiltGesturesEnabled(t)},e.prototype.setAllGesturesEnabled=function(t){this.uiSettings.setAllGesturesEnabled(t)},e.prototype.setMapType=function(t,e){void 0===e&&(e=!0);var r=et.IConverter.convertMapType(t);if(e&&(this.userMapType=r),this.mapSettings.getMapType()!==r){this.mapSettings.setMapType(r);var i=this.getMapStyle(r).getMapBackgroundColor2D();this.gl.clearColor(i.red,i.green,i.blue,1),W.MapResourceManager.getInstance(this.gl).clear2DColor=i,r==Q.MapType.map3d?this.enable3dMode(!0):this.mapState.is3dMode()?this.enable3dMode(!1):this.reload(),this.requestRender()}},e.prototype.getMapType=function(){return this.mapSettings.getMapType()},e.prototype.setMapStyle=function(t){if(this.styleManager.setMapStyle(t),this.getMapType()==Q.MapType.roadmap){var e=this.getMapStyle(Q.MapType.roadmap).getMapBackgroundColor2D();this.gl.clearColor(e.red,e.green,e.blue,1),W.MapResourceManager.getInstance(this.gl).clear2DColor=e,this.reload()}},e.prototype.getMapStyle=function(t){return void 0===t&&(t=null),null==t?this.styleManager.getStyle(this.mapSettings.getMapType()):this.styleManager.getStyle(t)},e.prototype.setMapId=function(t){var e=this,r=new tt.RequestTask(tt.Resource.Json);r.url=b.ServerConstants.getMapStyleUrl(t),r.completion=function(t){if(t.success&&null!=t.data)try{var r=JSON.parse(t.data);"ok"==r.code&&e.setMapStyle(r.result)}catch(t){console.error(t)}},this.httpTaskManager.postTask(r)},e.prototype.dirtyLayer=function(t){switch(t){case y.LayerType.SURFACE:case y.LayerType.BOUNDARY:this.surfaceLayer.setDirty(),this.boundaryLayer.setDirty();break;case y.LayerType.ROADS:this.roadLayer.setDirty();break;case y.LayerType.BUILDING:this.buildingLayer.setDirty();break;case y.LayerType.USERBUILDING:this.userBuildingLayer.setDirty();break;case y.LayerType.BUILDING_OVERLAY:this.overlayManager.dirtyBuildingOverlay();break;default:console.warn("Missing implement dirty layer type: ",t)}},e}(h.CameraAnimationObserver);e.MapView=rt},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(47),n=function(){function t(){}return t.getStyleForControlOptions=function(t){switch(t){case i.ControlOptions.TOP_LEFT:return"mf-ui-top-left";case i.ControlOptions.TOP_RIGHT:return"mf-ui-top-right";case i.ControlOptions.BOTTOM_LEFT:return"mf-ui-bottom-left";case i.ControlOptions.BOTTOM_RIGHT:return"mf-ui-bottom-right"}},t.bgColor="rgba(255,255,255,1)",t.size="29px",t.controlDistance="10px",t.content="\n.mf-map4d {\n  height: 100%;\n  width: 100%;\n  position: relative;\n  box-sizing: content-box;\n  overflow: hidden;\n}\n\n.mf-mapgl {    \n    position: absolute;\n    height: 100%;\n    width: 100%;\n    box-sizing: content-box;  \n  }\n  \n.mf-mapgl canvas {\n  width: inherit;\n  height: inherit;\n  position: absolute;\n  display: inherit;\n}\n\n.mf-map4d .mf-ui {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n}\n\n.mf-map4d .mf-ui .right {\n  display: flex;\n  flex-direction: column;\n}\n\n.mf-map4d .mf-ui .vertical {\n  display: flex;\n  flex-direction: column;\n}\n\n.mf-map4d .mf-ui .horizontal {\n  display: flex;\n  flex-direction: column;\n  align-self: flex-end;\n}\n\n.mf-ui.mf-ui-top-left {\n  top: "+t.controlDistance+";\n  left: "+t.controlDistance+";\n  flex-direction: inherit;\n}\n.mf-ui.mf-ui-top-right {\n  top: "+t.controlDistance+";\n  right: "+t.controlDistance+";\n  flex-direction: row-reverse;\n}\n.mf-ui.mf-ui-bottom-right {\n  bottom: "+t.controlDistance+";\n  right: "+t.controlDistance+";\n  flex-direction: row-reverse;\n}\n.mf-ui.mf-ui-bottom-left {\n  left: "+t.controlDistance+";\n  bottom: "+t.controlDistance+";\n  flex-direction: inherit;\n}\n\n.mf-map4d .mf-ui.mf-ui-top-left .horizontal {\n  align-self: flex-start;\n}\n\n.mf-map4d .mf-ui.mf-ui-top-right .horizontal {\n  align-self: flex-start;\n}\n\n.mf-map4d .mf-ui .mf-button {\n  margin: 3px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: space-around;\n    width: "+t.size+";\n    height: "+t.size+";\n    border-radius: 2px;\n    border: 1px solid darken("+t.bgColor+", 5%);\n    background-color: "+t.bgColor+";\n    cursor: pointer;\n    user-select: none;\n    -moz-user-select: none;\n    box-shadow: 0px 0px 4px #666;\n    background-color: #fff;\n  }\n\n.mf-map4d .mf-ui .mf-button:hover {\n    background-color: darken("+t.bgColor+", 5%);\n  }\n\n.mf-map4d .mf-ui .mf-button:active {\n    background-color: darken("+t.bgColor+', 10%);\n  }\n \n.mf-map4d .mf-ui.mf-ui-bottom-right .mf-location-box,\n.mf-map4d .mf-ui.mf-ui-bottom-left .mf-location-box {\n    margin-bottom: 9px;\n}\n\n.mf-map4d .mf-ui.mf-ui-top-right .mf-location-box,\n.mf-map4d .mf-ui.mf-ui-top-left .mf-location-box {\n    margin-top: 9px;\n}\n\n.mf-map4d .mf-ui a{\n  background-position: center !important;\n  background-repeat: no-repeat !important;\n  background-size: cover !important;\n  opacity: 0.5;\n  width: 29px;\n  height: 29px;\n}\n\n.mf-scrollbar::-webkit-scrollbar {\n  width: 10px;\n}\n \n.mf-scrollbar::-webkit-scrollbar-track {\n  -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); \n  border-radius: 10px;\n}\n \n.mf-scrollbar::-webkit-scrollbar-thumb {\n  border-radius: 10px;\n  -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); \n  background-color: #555;\n}\n\n.mf-map4d .mf-ui .mf-up-icon { \n  background-size: 21px 21px !important;\n  background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2NsaXAtcGF0aDp1cmwoI2EpO30uYntmaWxsOiM3YzgzOTE7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYSI+PHBhdGggY2xhc3M9ImIiIGQ9Ik0xOSwxNS41bC03LTctNyw3WiIvPjwvZz48L3N2Zz4=);       \n}\n\n.mf-map4d .mf-ui .mf-down-icon { \n  background-size: 21px 21px !important;\n  background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2NsaXAtcGF0aDp1cmwoI2EpO30uYntmaWxsOiM3YzgzOTE7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYSI+PHBhdGggY2xhc3M9ImIiIGQ9Ik01LDguNWw3LDcsNy03WiIvPjwvZz48L3N2Zz4=);       \n}\n\n.mf-map4d .mf-ui .mf-left-icon { \n  background-size: 21px 21px !important;\n  background-image: url(data:image/svg+xml;base64,PHN2ZyBpZD0iYXJyb3ctdW5kbyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogIDxkZWZzPgogICAgPGNsaXBQYXRoIGlkPSJjbGlwLXBhdGgiPgogICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlXzEzNzciIGRhdGEtbmFtZT0iUmVjdGFuZ2xlIDEzNzciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIvPgogICAgPC9jbGlwUGF0aD4KICA8L2RlZnM+CiAgPGcgaWQ9Ikdyb3VwXzIwNzciIGRhdGEtbmFtZT0iR3JvdXAgMjA3NyIgY2xpcC1wYXRoPSJ1cmwoI2NsaXAtcGF0aCkiPgogICAgPHBhdGggaWQ9IlBhdGhfMjYxOSIgZGF0YS1uYW1lPSJQYXRoIDI2MTkiIGQ9Ik0xMy4yNzEsOC4wNjZhNy45NDIsNy45NDIsMCwwLDEsMi4wMTcsNS40NTgsOC4xOTMsOC4xOTMsMCwwLDEtNS43LDcuODMxTDksMTkuNDU2YTYuNDE4LDYuNDE4LDAsMCwwLDQuMzktNi4wNTEsNi4wODMsNi4wODMsMCwwLDAtMS41NDItNC4wMzRMOSwxMi4yMTlWNS4xaDcuMTE5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNTU5IC0xLjI3NykiIGZpbGw9IiM3YzgzOTEiLz4KICA8L2c+Cjwvc3ZnPgo=);       \n}\n\n.mf-map4d .mf-ui .mf-right-icon { \n  background-size: 21px 21px !important;\n  background-image: url(data:image/svg+xml;base64,PHN2ZyBpZD0iYXJyb3ctdW5kbyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogIDxkZWZzPgogICAgPGNsaXBQYXRoIGlkPSJjbGlwLXBhdGgiPgogICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlXzEzNzciIGRhdGEtbmFtZT0iUmVjdGFuZ2xlIDEzNzciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIvPgogICAgPC9jbGlwUGF0aD4KICA8L2RlZnM+CiAgPGcgaWQ9Ikdyb3VwXzIwNzciIGRhdGEtbmFtZT0iR3JvdXAgMjA3NyIgY2xpcC1wYXRoPSJ1cmwoI2NsaXAtcGF0aCkiPgogICAgPHBhdGggaWQ9IlBhdGhfMjYxOSIgZGF0YS1uYW1lPSJQYXRoIDI2MTkiIGQ9Ik0xMS44NDksOC4wNjdhNy45NDUsNy45NDUsMCwwLDAtMi4wMTgsNS40Niw4LjIsOC4yLDAsMCwwLDUuNyw3LjgzM2wuNTkzLTEuOWE2LjQyLDYuNDIsMCwwLDEtNC4zOTEtNi4wNTMsNi4wODYsNi4wODYsMCwwLDEsMS41NDMtNC4wMzVsMi44NDgsMi44NDlWNS4xSDlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41NjEgLTEuMjgpIiBmaWxsPSIjN2M4MzkxIi8+CiAgPC9nPgo8L3N2Zz4K);       \n}\n\n.mf-map4d .mf-ui .mf-zoom-in-icon { \n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA6CAYAAADhu0ooAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMGSURBVHgB7ZrPTxNBFMdfjQm9CDWx0ioJShNJLyoeJHqAYNIL6gWihyaYKPGkN/8OT+rJoESjBxOOctCkDb2Uein2QKMJKRBIIZCw6sH2pPPdMussWaGlb0kznU+y6a9ZMp99b968LQ38EVAbcIzaBCOqG0ZUN4yobhhR3TCiumFEdcOI6oYR1Y3j5DOllXXKf12k0uoaWdYv+71gsIOi3aco3h+zj1DXCfKbgF9fpUAwnZm3Hw/i+tXLNDI8SMGODvILX0SzuQWa/Zxp6JxQVydN3hv3LbrsoulMjlLikCBNr4mIXbkYp1Co036vUqlSeXOL8oWiSOuiM9ZPWVZR68dPevps2nkd7++jsdsJW/Z/FL8t0eynjDi3tn7P956lBxPjxA1r1Z16M+M8h2Tyzi2XJIoRjkq1qoyLucbZxatQJG7YRDFBGRWk4Ghi2PW5ZYloP39tH+8+fHR9Fo2EaWRo0HmdzeWJGzZRbCGSgUtYj42tM1ReGdXy5ra9hjlhE90Qk5MgbSUyXXd2ow2qlYpnGg+IgiWpZ1tqBLaGQY1AtDtsP9bSddpj7LadwuBcbw9NTozVzouEnTGozJy0bAvILcoWUawvOTmko+xyEDHJ8sqaMzayG3W0gpIdkQHq3+OETRQTluuqvLEl9sMeu0GQaammMSTl+yryQoAzShpzwJa6auTSSmdUL2g21AIUOd2iotgeJJhwSYmOBBcDh5quktTcv4tzmO3pIFhbQLRy2S8L9nOssUcPk3X1rXv74yeP77OLslbdG6K7kWIoTC9evnfEvUC6vno745IE+cIiccN+94KiMyUmbykNAlpCNOvYJ2V1RjO/X1OAi6a2hc3iy/2ol+xh4JQN+PljDdyFpObm9xVGcRpNDFHx+5JnteaSDRzFr1Kwry6vrtNvkbKINvbXk+KIX+hzNQZYq16yybs3xdgYNcORiDbCXllsNbh5b5aW63XVVOWSBC0XUQmqMr594KJlRbkx/5LQDSOqG0ZUN4yobhhR3TCiumFEdaNtRP8C9QdgiPBj+C8AAAAASUVORK5CYII=);       \n}\n\n.mf-map4d .mf-ui .mf-zoom-out-icon { \n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA6CAYAAADhu0ooAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALdSURBVHgB7ZrBTxNBFIdfjbH1INREpFUSlCaSXlQ8iJoIgaQX1AtEDyR4kL/Hk3oyGKIJF8NRDpq0oZdSL8Ue2GhCCgRSCCauerA96fy2mWVqyrbQt2QznS9p2Da7ZL6+N++9bRv6K6AO4BR1CEZUN4yobhhR3TCiumFEdcOI6oYR1Y3T5DOlzR0qfFmj0tY22fZv57VIJEzx3guUHEw4j2j3OfKbkF833hDMZFecv824d/smjY0OUyQcJr/wRTSXX6WlT9kjXRPt7qLZp1O+RZddNJPNU1o8JEjTuyJit64nKRrtcl6rVKpU3tunQtESaW255/opyypq//xFz1/Mu8+TgwM0+SjlyB6G9XWdlj5mxbW1/Xu1/zI9m5kiblir7tzbRfcYktOPH3pK1s5L1J3nFK+iRdywiWKBMipIwYnUaMvXxmM9NDYy7D7P5QvEDZsoWohk6Ab249H2GSqvjGp577uzhzlh66O7YnESpK1E9s7DiJw947aVIVGwcp9XnWNkSLy3h7hgE1UjIBdo26I4vZz3vO5Kfx/NzkzWrosdiKEycxLYEZBblC2i2F9ycZVq1U1HRMwLjIKSHyID1P/HCZsoFizHvfLuvuiHfc6AINOyFTY2t93jSzG+/QnYUleNXEaZjFoFw4Y6F8cuBlQU7UGCBZeU6LRCevngzTlOe2oGm6icaSUL7z+4A0QzkAHqNDR+/w5xw1p1x8V0IwdyFKZXrxfcvtgIpOubd4t1NwGgUFwjbtjvXtA758Ti1WhiJMSwjj4pqzOGea97Vbxp6ljYLr7cjzaSPQ6csiE/v9rHvksvr3gKo1pPpEbI+rbesFpzyYZO4jcM6KsbWzv0R6Qsoo3+el48ktcG6gYD7NVGstNPHohzE9QOoaD9WON/WbQa3Ly3S+BmXTVVuSRB4CIqQVXGpw9cBFaUG/OVhG4YUd0worphRHXDiOqGEdUNI6obRlQ3Okb0H+xvLgcbOwA8AAAAAElFTkSuQmCC);  \n}\n\n.mf-map4d .mf-ui .mf-location {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA6CAYAAADhu0ooAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMlSURBVHgB7Zo/a1NRGMbfiJAuthnUJlSsMWBNB9s4tKZgwaCCgw7tpKCDFZd+FidnK1hwEMyg4hKIWKExXZI6NFYwsaIktQGjLsmk5znJSU9i0lya9y6n57dcuDkH7nPef8+9xPNXQAeAQ3RAsEJNwwo1DSvUNKxQ07BCTcMKNQ0r1DSsUNM4TC5TrdUos56jwtY3Km7vUKXyR94fGPBSYPgoRSbGKTh6gnxDR8hNPG59SoHAVDpLq2tZqlZrPdfHZqcpOj1JA14vuYErQiu/ftOjJ8/FtR69UyJi5yfCFDw5Qj7foLxXLO1Q6UeZNjbz9HHzs7znGxqkhTvzrkSXXaguEg8+d+OyTM0991TEnuXdPW6IZRf64OFj+cCov7u352UtOgHpHX+ZoJyIMMQu3r/JmsasXffNSroZlW4i0YxQv+1g7dz1K/KAkBWror45Yeu6eLikEAoWOohEY0q+SzcbEw4DdXtJNCEF9ly7OktLy3FKiSY2w9ic2CJa2Pour+Gx06LhtNYXUvJ1YqWl+6qDWRK1qYN6Do6OyLWcUWUTmlnfkNfwWKj1/oecnKPdwAGpTFBEpyLy+kXMXi7YhP4UEQJ+UWM6ybfve+5FmuogoqC4XSYu2IQqxxMYPta8h/RTs3Qv5LrK7jpV306MhlNc9bqcD9ovbEJVA9IjAxfkZI6iA+sNTB2Q0xnsBDah/uP1lM1/bW0g0anJnnsjYszoqA7u18qgX9iEKpuXbXRfBcy6ai6dgEGIabMU5BreF6OKCzahGP5INUSj0DYW4JJgDHT/irW4h990MF8xksD4mRBxwep1MQ9hAwP+hs/1drKA9TGk3mLaUV4Z6QxLyAVr150R9YioFUtlir9IdPS0ENhNJByU8sqxixeIE/7XtH28ciFdnz57JQ0CUnrx3q3/bGS/uPPirYkFkXNhCp8Nyaak0hnRRuRTaxn5agbkwYiU5xYJ3PuUImYharbd3nUDYwjdl3N26njc/vsNopv7lJefTEri45huBjAnEWXUtlsCFR77PyPDsEJNwwo1DSvUNKxQ07BCTcMKNQ0r1DSsUNP4By5Rba+rOeGSAAAAAElFTkSuQmCC);    \n}\n\n.mf-map4d .mf-ui .mf-mode-icon { \n  background-image: url(data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSgBBwcHCggKEwoKEygaFhooKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKP/AABEIAB0AHQMBEQACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APqmgAoAKAPAP21f+SWaV/2Gov8A0RPQB75ceb5En2cIZtp2CQkLuxxnHOKAPPpNX1/TJdVtr3U4bmaGwNwGMCxGKT0QEDzF/wBrBH0rSyZN2T2l94g08aDe3uqx6haajLFDJC1ssRjMgGCCvXH+R6Kydw1PPf21f+SWaV/2Gov/AERPUFHvd1D9otpYS8kfmKV3xttZcjqD2NAHHnwVc3PmtqmtzXsotmtbd3hC+UGGCTg/Ofcmr5uyFYlsPCN4txpx1XXJL2009leC3W2WIBlxtJIJzjHehy7ILHl/7av/ACSzSv8AsNRf+iJ6gYf8NV+B/wDoFeJP/AeD/wCPUAH/AA1X4H/6BXiT/wAB4P8A49QAf8NV+B/+gV4k/wDAeD/49QB5f+0L8a/DnxH8F2WkaHZavBcw6gl2zXkUaoUWORSAVkY5y47etAH/2Q==);    \n}\n\n.mf-map4d .mf-ui .mf-direct-icon { \n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA6CAYAAADhu0ooAAAD6UlEQVR42u2Y608VRxjG+aL/gDHYals1aUtBoAiJ4g2lmqAJWjFiE0VMsV5jNJE2eKm0XnLUqkExKEFTG2krF6PU1hta1KgR5aKHY0UJahRN/ErKu5dZzuM75yCHAwQO8csumSd5s5vs7mR++8zM+86EhSkpKSkpKSkpKSkpKSkNdrW3txdxnOAolFfLssr4esrr9V7jqOG4G2pb/G6jbMOuoNs4jnL8zpAXJRzfP+T7RUHvtbzOC6GtfwzDiLYlKIAohmvqcK+SAau6PjcbHoJydkD7PhfmH6eBN2/C+2pPCLHflqAMls2RyR1M5WsGu1Igh20naHE5KDkNFDkJtHglzNt30c+PG27beVpTUzNE1/VPGTKH404nZJ3bS1kbQGMTQCMiGXg+jNKzcORi5PF4hvK8imDArexoXddnEopS0kGjYkHhDPr5RGhbdkF4Gp0Hy5CxDJnLkO6gufbgP2g//AyKnuqHlDEmAdqydTAvX3MeKEPuk2mhxw8oYTfnLQF9EhcAHREFmjEfetFJiFevDzoNdHuPldPNbv7oAo1PBn0QFQCVEZPETv8Es/aBM+dqDze/XhrsZufwjQct/BbGXxedDSo8j6Bt2w2Kne5fabuDfjgONDEF+v4jzhu+QQXC35dB6ctBH3/ZE/LdPI2cAm3dJoj6Bvu7ap064+t4kJtNT6G78kBxyX6g3kB9rkaDZi6AUV5hf1Cd00R3UKPqJuib7wJ5s6+IToK+8wCXhP+H29vRC1ehJczsBJXzTc8rZIBp/UPKkAvVktUw693OWpTE7Xvc8TX+YRkKqBzavCgZ5eecAyp3JHr+MVD8V6FBvouoKdD35MN60VLiDDfr3KDlXLyPjhsY6Eh2P2MNRD87GvssTIW/gSbN8efI7jAxnE+npoI+m9A7LD8zTpbaH1TcbwBlrWc34wOdHxUD+oL3n3MzoO89DKO4DNr2X0DT5/ld7Jp65I5m807I1GTvck9urCWAXIRkRE4GzVoALTsXRsUFiCfNvhQiXry8YZZw7k3NAEUkcg08LvBT0pbBvPSvvUF110F/gSBr2MTZ0FZmQyv4FWZ1ba8dN89XQluxETQhBfRRrB+Yh71xvNjmjp74E5S5Flp6FiS0eeU6RPPzPjstblbDcB3iTfkiHrqJvh9k5BfZu3iwGpsgXTIrq2DxMA35u+ZnMEoroK3N8dW9xrlL3o5tX33YYJSodUMWG6Ll1b52Xa+1LGuVLTs6kAPqPjfwQtxiyBVtbW0j7Xrcuep9h5s8b+I2XHxN45hjS9DW1tZh3LmN3Q/HBngcU8DfV3fE4zAlJSUlJSUlJSUlJSWlwaS37MjGJ48GqSYAAAAASUVORK5CYII=);     \n}\n\n.mf-map4d .mf-ui a:hover {\n  opacity: 1;  \n}\n\n.mf-logo-container {\n  position: absolute;\n  bottom: 10px;  \n}\n\n.mf-logo-container.mf-right {\n  right: 10px;\n}\n\n.mf-logo-container.mf-left {\n  left: 10px;\n}\n\n.mf-logo {\n  cursor: pointer;\n  width: 75px;\n  opacity: 1;\n}\n\n.mf-info-window-container {\n  position: relative;\n  display: inline-block;\n  transform: translateY(-5px);\n  border: 1px solid #ddd;\n  border-radius: 5px;\n  z-index: 1000;\n}\n\n.mf-info-window-anchor:after, .mf-info-window-anchor:before {\n\tborder: solid transparent;\n\tcontent: " ";\n\theight: 0;\n\twidth: 0;\n\tposition: absolute;\n\tpointer-events: none;\n}\n\n.mf-info-window-anchor:after {\n\tborder-color: rgba(255, 255, 255, 0);\n\tborder-top-color: #ffffff;\n\tborder-width: 7px;\n\tmargin-left: -7px;\n}\n\n.mf-info-window-anchor:before {\n\tborder-color: rgba(221, 221, 221, 0);\n\tborder-top-color: #ddd;\n\tborder-width: 8px;\n\tmargin-left: -8px;\n}\n\n.mf-info-window-container .mf-anchor-bottom {\n\tposition: absolute;\n\ttop: 0%;\n\tleft: 50%;\n\ttransform: rotate(180deg);\n}\n\n.mf-info-window-container .mf-anchor-bottom-right {\n\tposition: absolute;\n\ttop: 0%;\n\tleft: 0%;\n\ttransform: rotate(180deg);\n}\n\n.mf-info-window-container .mf-anchor-bottom-left {\n\tposition: absolute;\n\ttop: 0%;\n\tright: 0%;\n\ttransform: rotate(180deg);\n}\n\n.mf-info-window-container .mf-anchor-top {\n\tposition: absolute;\n\ttop: 100%;\n\tleft: 50%;\n}\n\n.mf-info-window-container .mf-anchor-top-right {\n\tposition: absolute;\n\tleft: 0%;\n\ttop: 100%;\n}\n\n.mf-info-window-container .mf-anchor-top-left {\n\tposition: absolute;\n\tright: 0%;\n\ttop: 100%;\n}\n\n.mf-info-window-content p, h4{\n  margin-bottom: 0;\n  margin-top: 0;\n}\n\n.mf-info-window-content p:empty, h4:empty{\n  display: none;\n}\n\n.mf-info-window-content {\n  background-color: #ffffff;\n  overflow: auto;\n  max-width: 636px;\n  max-height: 298px;\n  text-align: left;\n  padding: 5px;\n}\n\n.mf-info-window-content h4{\n  font-family: Georgia, serif;\n  font-size: 14px;\n  font-weight: normal;\n  text-align: center;\n}\n\n.mf-info-window-content p{\n  font-family: Georgia, serif;\n  font-size: 12px;  \n}\n\n.mf-map4d .mf-ui .mf-button-mode {\n  position: fixed;\n  bottom: 130px;\n  right :13px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: space-around;\n    width: '+t.size+";\n    height: "+t.size+";\n    border-radius: 2px;\n    border: 1px solid darken("+t.bgColor+", 5%);\n    background-color: "+t.bgColor+';\n    cursor: pointer;\n    user-select: none;\n    -moz-user-select: none;\n}\n.mf-iconview-marker-container {\n  position: absolute;\n  display: inline-block;\n}\n.mf-label-marker-container {\n  position: absolute;\n  display: inline-block;\n}\n.mf-touch-pan-blocker,\n.mf-scroll-zoom-blocker {\n  color: #fff;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;\n  justify-content: center;\n  text-align: center;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgb(0 0 0 / 70%);\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 0.75s ease-in-out;\n  transition-delay: 1s;\n}\n.mf-touch-pan-blocker-show,\n.mf-scroll-zoom-blocker-show {\n    opacity: 1;\n    transition: opacity 0.1s ease-in-out;\n}\n',t}();e.Style=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n,o=r(3),a=r(36),s=r(1),l=r(37),u=r(112),h=r(115),c=r(116),p=r(13);!function(t){t[t.Down=0]="Down",t[t.Up=1]="Up",t[t.Drag=2]="Drag",t[t.DragEnd=3]="DragEnd",t[t.Wheel=4]="Wheel",t[t.Move=5]="Move",t[t.Over=6]="Over",t[t.Out=7]="Out",t[t.Double=8]="Double",t[t.None=9]="None"}(i=e.MouseAction||(e.MouseAction={})),function(t){t[t.Left=0]="Left",t[t.Wheel=1]="Wheel",t[t.Right=2]="Right",t[t.None=3]="None"}(n=e.MouseButton||(e.MouseButton={}));var f=function(){function t(t,e){this.canvas=t,this.mapView=e,this.checkDragStart=!0,this.mouseOverTimeout=50,this.longClickTimeout=500,this.longClickIsCalled=!1,this.lastTimeTouch=0,this.currentTouchZoom=0,this.inertia=[],t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("mouseup",this.mouseUp.bind(this)),t.addEventListener("wheel",this.mouseWheel.bind(this),{passive:!1}),t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mouseout",this.mouseOut.bind(this)),t.addEventListener("dblclick",this.doubleClick.bind(this)),t.addEventListener("contextmenu",(function(t){return t.preventDefault()})),t.addEventListener("touchstart",this.touchStart.bind(this),!1),t.addEventListener("touchmove",this.touchMove.bind(this),!1),t.addEventListener("touchcancel",this.touchCancel.bind(this),!1),t.addEventListener("touchend",this.touchEnd.bind(this),!1),this.scrollZoomHandler=new u.ScrollZoomHandler(this.mapView),this.dragRotateHandler=new h.DragRotateHandler(this.mapView),this.dragPanHandler=new c.DragPanHandler(this.mapView)}return t.prototype.destroy=function(){var t=this.canvas;t.removeEventListener("mousedown",this.mouseDown.bind(this)),t.removeEventListener("mousemove",this.mouseMove.bind(this)),t.removeEventListener("mouseup",this.mouseUp.bind(this)),t.removeEventListener("wheel",this.mouseWheel.bind(this)),t.removeEventListener("mouseover",this.mouseOver.bind(this)),t.removeEventListener("mouseout",this.mouseOut.bind(this)),t.removeEventListener("dblclick",this.doubleClick.bind(this)),t.removeEventListener("contextmenu",(function(t){return t.preventDefault()})),t.removeEventListener("touchstart",this.touchStart.bind(this),!1),t.removeEventListener("touchmove",this.touchMove.bind(this),!1),t.removeEventListener("touchcancel",this.touchCancel.bind(this),!1),t.removeEventListener("touchend",this.touchEnd.bind(this),!1)},t.prototype.touchStart=function(e){var r=e.touches.item(0);this.touchEvent=r;var i=this.mapView.mapSettings.cooperativeGestures?t.MAX_TOUCH_POINTS+1:t.MAX_TOUCH_POINTS;if(null!=r){if(e.touches.length<i){r.button=n.Left;var o=Date.now(),a=o-this.lastTimeTouch;if(this.lastTimeTouch=o,a<t.TIME_DETECT_DOUBLE_TOUCH)return void this.doubleClick(r);this.handleGestureStop()}else{var s=e.touches.item(1),l=this.mapView.getCurrentMousePosition(r),u=this.mapView.getCurrentMousePosition(s);this.handleGestureStart(l.x,l.y,u.x,u.y),r.button=n.Right}this.mouseDown(r),this.mapView.mapState.mouseWheel=!0}},t.prototype.touchMove=function(e){if(this.mapView.mapSettings.cooperativeGestures&&this.mapView.isScrollGesturesEnabled()&&!this.mapView.mapState.isMoving()){if(1===e.touches.length)return void this.showTouchPanBlockerAlert();"hidden"!==this.panAlertContainer.style.visibility&&(this.panAlertContainer.style.visibility="hidden",clearTimeout(this.panAlertTimer))}e.cancelable&&e.preventDefault();var r=this.mapView.mapSettings.cooperativeGestures?t.MAX_TOUCH_POINTS+1:t.MAX_TOUCH_POINTS,i=e.touches.item(0);if(this.touchEvent=i,null!=i)if(e.touches.length<r&&!this.isMultiTouch)i.button=n.Left,this.mouseMove(i);else if(e.touches.length>=r){var o=e.touches.item(1),a=this.mapView.getCurrentMousePosition(i),s=this.mapView.getCurrentMousePosition(o);this.handleGesture(a.x,a.y,s.x,s.y)}},t.prototype.touchCancel=function(t){},t.prototype.touchEnd=function(t){if(t.cancelable&&t.preventDefault(),0==t.touches.length){var e=void 0;this.isMultiTouch?(e=n.Right,this.handleGestureStop()):e=n.Left;var r=new o.Vector2(this.touchEvent.clientX,this.touchEvent.clientY),i=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!0,clientX:r.x,clientY:r.y,button:e});this.mouseUp(i)}},t.prototype.doubleClick=function(t){if(this.mapView.isZoomGesturesEnabled()){this.longClickIsCalled=!1;var e=this.mapView.getCurrentMousePosition(t);this.mapView.mapsEventManager.onDoubleClickEvent(e,t)||(this.mapView.mapsEventManager.notify(l.MapEvent.dblClick,t),this.dispatch({dx:0,dy:0,x:e.x,y:e.y,action:i.Double,button:t.button}))}},t.prototype.mouseOut=function(t){this.mouseOutside=!0,this.longClickIsCalled=!1,window.clearTimeout(this.longClickTimeoutHandler),window.clearTimeout(this.mouseOverTimeoutHandler);var e=this.mapView.getCurrentMousePosition(t);this.mapView.mapsEventManager.notify(l.MapEvent.mouseOut,t),this.dispatch({dx:0,dy:0,x:e.x,y:e.y,action:i.Out,button:t.button}),this.mousePosition=null},t.prototype.mouseWheel=function(t){if(this.mapView.mapSettings.cooperativeGestures&&this.mapView.isZoomGesturesEnabled()){if(!t.ctrlKey&&!t.metaKey)return void this.showZoomBlockerAlert();"hidden"!==this.zoomAlertContainer.style.visibility&&(this.zoomAlertContainer.style.visibility="hidden",clearTimeout(this.zoomAlertTimer))}if(this.longClickIsCalled=!1,0!=t.deltaY){var e=this.mapView.getCurrentMousePosition(t);this.dispatch({dx:t.deltaX,dy:1===t.deltaMode?40*t.deltaY:t.deltaY,x:e.x,y:e.y,action:i.Wheel,button:t.button},t),this.mapView.mapState.mouseWheel=!0}},t.prototype.mouseDown=function(t){var e=this;return window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()),this.longClickIsCalled=!1,this.mapView.stopAnimation(),this.mousePosition=this.mapView.getCurrentMousePosition(t),this.mouseDownPosition=this.mousePosition,this.mouseDownTime=Date.now(),t.button==n.Right?this.dragRotateHandler.onDragStart(this.mousePosition):this.dragPanHandler.onDragStart(this.mousePosition),this.dispatch({x:this.mousePosition.x,y:this.mousePosition.y,dx:0,dy:0,action:i.Down,button:t.button}),this.mapView.mapState.isStill()&&(window.clearTimeout(this.longClickTimeoutHandler),this.longClickTimeoutHandler=window.setTimeout((function(){t.button==n.Left&&(e.mapView.mapsEventManager.onLongClickEvent(e.mousePosition,t)||(e.longClickIsCalled=!0,e.mapView.mapsEventManager.notify(l.MapEvent.longClick,t)))}),this.longClickTimeout)),this.preMouseDown=t,!1},t.prototype.mouseMove=function(t){var e=this;this.longClickIsCalled=!1,window.clearTimeout(this.longClickTimeoutHandler);var r=this.mapView.getCurrentMousePosition(t),o=null!=this.preMouseDown?this.preMouseDown.button:t.button;if(this.mousePosition){var a=r.subtract(this.mousePosition);if(this.mousePosition=r,0==a.x&&0==a.y)return;var s={x:r.x,y:r.y,dx:a.x,dy:a.y,action:i.Drag,button:o};o==n.Left&&this.dragPanHandler.onDrag(s);var u=this.dragPanHandler.draggableAnnotation,h=!!u&&this.mapView.directionsRendererManager.isDirectionsRendererMarker(u.getId());this.checkDragStart&&(u?h||this.mapView.mapsEventManager.onDragEvent(l.MapEvent.dragStart,t,u):this.mapView.mapsEventManager.notify(l.MapEvent.dragStart,t),this.checkDragStart=!1),u?h||this.mapView.mapsEventManager.onDragEvent(l.MapEvent.drag,t,u):this.mapView.mapsEventManager.notify(l.MapEvent.drag,t),this.dispatch(s)}else this.mapView.mapState.isStill()&&(window.clearTimeout(this.mouseOverTimeoutHandler),this.mapView.mapsEventManager.onMouseOutEvent(r,t),this.mouseOverTimeoutHandler=window.setTimeout((function(){var r=e.mapView.getCurrentMousePosition(t);e.mapView.mapsEventManager.onHoverEvent(r,t)||e.mapView.mapsEventManager.notify(l.MapEvent.hover,t,!1)}),this.mouseOverTimeout)),this.mapView.mapsEventManager.notify(l.MapEvent.mouseMove,t),this.dispatch({x:r.x,y:r.y,dx:0,dy:0,action:i.Move,button:o});return!1},t.prototype.mouseOver=function(t){this.mouseOutside=!1,this.longClickIsCalled=!1;var e=this.mapView.getCurrentMousePosition(t);this.mapView.mapsEventManager.notify(l.MapEvent.mouseOver,t),this.dispatch({x:e.x,y:e.y,dx:0,dy:0,action:i.Over,button:t.button})},t.prototype.mouseUp=function(e){window.clearTimeout(this.longClickTimeoutHandler);var r=this.mapView.getCurrentMousePosition(e);this.mouseUpTime=Date.now();var o=r.subtract(this.mouseDownPosition),a=this.mouseUpTime-this.mouseDownTime;if(o.length<s.MapUtils.touchBoxSize){if(this.dispatch({x:r.x,y:r.y,dx:0,dy:0,action:i.Up,button:e.button}),this.mapView.mapState.isStill()&&!this.longClickIsCalled)if(e.button==n.Left){var u=this.mapView.getCurrentMousePosition(e);this.mapView.mapsEventManager.onClickEvent(u,e)||this.mapView.mapsEventManager.notify(l.MapEvent.click,e)}else if(e.button==n.Right){u=this.mapView.getCurrentMousePosition(e);this.mapView.mapsEventManager.onRightClickEvent(u,e)||this.mapView.mapsEventManager.notify(l.MapEvent.rightClick,e)}}else{var h=this.dragPanHandler.draggableAnnotation;if(h){var c=h.getId();if(this.mapView.directionsRendererManager.isDirectionsRendererMarker(c)){var p=this.mapView.directionsRendererManager.getDirectionsRendererByMarkerId(c),f=p.getOriginMarker(),d=p.getDestinationMarker(),g=p.getWaypointMarkers(),y=[];g.forEach((function(t){y.push(t.getPosition())})),p.onMarkerDragEnd&&p.onMarkerDragEnd({origin:f?f.getPosition():null,destination:d?d.getPosition():null,waypoints:y})}else this.mapView.mapsEventManager.onDragEvent(l.MapEvent.dragEnd,e,h)}else this.mapView.mapsEventManager.notify(l.MapEvent.dragEnd,e);this.checkDragStart=!0,this.dispatch({x:r.x,y:r.y,dx:a<t.FLING_DETECTION_TIME?o.x:0,dy:a<t.FLING_DETECTION_TIME?o.y:0,action:i.DragEnd,button:e.button})}return this.mousePosition=null,this.preMouseDown=null,this.longClickIsCalled=!1,!1},t.prototype.dispatch=function(t,e){this.mouseEventHandler(t,e)},t.prototype.mouseEventHandler=function(t,e){switch(t.action){case i.Drag:t.button==n.Right&&this.dragRotateHandler.onDrag(t);break;case i.Wheel:this.scrollZoomHandler.onWheel(t,e);break;case i.DragEnd:t.button==n.Left&&this.dragPanHandler.onDragEnd(t),t.button==n.Right&&this.dragRotateHandler.onDragEnd();break;case i.Double:if(t.button==n.Left){var r=this.mapView.mapState.getZoom()+1,a=new o.Vector2(t.x,t.y);this.mapView.setZoom(r,a,0,!0)}}},t.prototype.handleGestureStart=function(t,e,r,i){var n=r-t,a=i-e;this.inertia=[[Date.now(),this.mapView.mapState.getBearing()]],this.touchX1Prev=t,this.touchY1Prev=e,this.touchX2Prev=r,this.touchY2Prev=i,this.anchorZoom=new o.Vector2((t+r)/2,(e+i)/2),this.touchPrevDistance=Math.sqrt(n*n+a*a),this.touchStartAngle=Math.atan2(a,n),this.isMultiTouch=!0,this.isMultiTouchZoom=!1,this.isMultiTouchTilt=!1},t.prototype.handleGesture=function(e,r,i,n){var o=i-e,a=n-r,l=Math.sqrt(o*o+a*a),u=e-this.touchX1Prev,h=r-this.touchY1Prev,c=i-this.touchX2Prev,p=n-this.touchY2Prev;if(this.touchX1Prev=e,this.touchY1Prev=r,this.touchX2Prev=i,this.touchY2Prev=n,u*c>=0&&h*p>0){var f=Math.max(h,p)/s.MapUtils.pixelScale;this.mapView.setTilt(this.mapView.mapState.cameraPosition.getTilt()-f,!0),this.isMultiTouchTilt=!0}if(this.currentTouchZoom=(l-this.touchPrevDistance)/s.MapUtils.pixelScale,Math.abs(this.currentTouchZoom)>t.STEP_DETECT_ZOOM){this.inertia=[[Date.now(),this.mapView.mapState.getBearing()]];var d=this.currentTouchZoom/(t.STEP_DETECT_ZOOM*s.MapUtils.pixelScale);return this.mapView.setZoom(this.mapView.mapState.getZoom()+d,this.anchorZoom,0,!0),this.mapView.notifyCameraIsChanging(),this.touchPrevDistance=l,void(this.isMultiTouchZoom=!0)}var g=Math.atan2(a,o),y=g-this.touchStartAngle;if(Math.abs(y)>Math.PI/180&&!this.isMultiTouchZoom&&!this.isMultiTouchTilt){var m=this.mapView.mapState.getBearing()-180*y/Math.PI;this.inertia.push([Date.now(),-m]),this.mapView.setBearing(m,0,!0),this.mapView.notifyCameraIsChanging(),this.touchStartAngle=g}},t.prototype.handleGestureStop=function(){this.isMultiTouch=!1,this.isMultiTouchZoom=!1,this.isMultiTouchTilt=!1,this.currentTouchZoom=0;for(var t=this.inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift();if(this.inertia.length>2){var r=t.length,i=t[r-1],n=t[r-2],o=i[1]-n[1]>0?1:-1,a=i[1]-n[1],s=3*Math.abs(a);Math.abs(s)>360&&(s=360),s*=o;var l=Math.abs(s)/90;l=p.MathUtils.clamp(l,.5,1),this.mapView.setBearing(this.mapView.mapState.getBearing()-s,l,!0)}},t.prototype.setupBlocker=function(){var t=/(Mac)/i.test(window.navigator.userAgent),e=this.mapView.getMapContainer(),r=Math.max(10,Math.min(24,Math.floor(.05*e.clientWidth)))+"px";this.zoomAlertContainer=a.DOMUtils.create("div","mf-scroll-zoom-blocker",e),this.zoomAlertContainer.textContent="Use "+(t?"⌘":"ctrl")+" + scroll to zoom the map",this.zoomAlertContainer.style.fontSize=r,this.panAlertContainer=a.DOMUtils.create("div","mf-touch-pan-blocker",e),this.panAlertContainer.textContent="Use two fingers to move the map",this.panAlertContainer.style.fontSize=r},t.prototype.showZoomBlockerAlert=function(){var t=this;"hidden"===this.zoomAlertContainer.style.visibility&&(this.zoomAlertContainer.style.visibility="visible"),this.zoomAlertContainer.classList.add("mf-scroll-zoom-blocker-show"),clearTimeout(this.zoomAlertTimer),this.zoomAlertTimer=setTimeout((function(){t.zoomAlertContainer.classList.remove("mf-scroll-zoom-blocker-show")}),200)},t.prototype.showTouchPanBlockerAlert=function(){var t=this;"hidden"===this.panAlertContainer.style.visibility&&(this.panAlertContainer.style.visibility="visible"),this.panAlertContainer.classList.add("mf-touch-pan-blocker-show"),clearTimeout(this.panAlertTimer),this.panAlertTimer=setTimeout((function(){t.panAlertContainer.classList.remove("mf-touch-pan-blocker-show")}),500)},t.FLING_DETECTION_TIME=200,t.MAX_TOUCH_POINTS=2,t.STEP_DETECT_ZOOM=10,t.TIME_DETECT_DOUBLE_TOUCH=300,t}();e.MouseEventHandler=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(77),n=r(3),o=r(8),a=r(1),s=function(){function t(t){this._mapView=t,this._delta=0,this._enabled=!0,this.onTimeout=this.onTimeout.bind(this),this.onScrollFrame=this.onScrollFrame.bind(this)}return t.prototype.isEnabled=function(){return!!this._enabled},t.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0)},t.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},t.prototype.isActive=function(){return!!this._active},t.prototype.onWheel=function(t,e){if(this.data=t,this.isEnabled()){var r=Date.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r;var n=t.dy;0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this.onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._delta-=n,this.isActive()||this.start(t)),e.preventDefault()}},t.prototype.onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this.start(t)},t.prototype.start=function(t){this._delta&&(this._frameId&&(this._mapView.cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isTrackpad()&&this._finishTrackpadTimeout&&clearTimeout(this._finishTrackpadTimeout),this.isWheel()&&this._finishTimeout&&clearTimeout(this._finishTimeout),this._anchor=new n.Vector2(t.x,t.y),this._anchorLatLng=o.GeometryUtils.screenCoordinateToLatLng(this._anchor,this._mapView.mapState.cameraPosition,this._mapView.mapState.getScreenSize()),this._anchorLatLng.valid()||(this._anchorLatLng=this._mapView.mapState.getTarget()),this._frameId||(this._frameId=this._mapView.requestRenderFrame(this.onScrollFrame)))},t.prototype.onScrollFrame=function(){var t=this;if(this._frameId=null,this.isActive()){if(0!==this._delta){var e=this.isWheel()&&Math.abs(this._delta)>4.000244140625?1/450:.01,r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);var i=null==this._targetZoom?this._mapView.mapState.scale:Math.pow(2,this._targetZoom);if(this._targetZoom=Math.min(this._mapView.mapSettings.getMaxZoom(),Math.max(this._mapView.mapSettings.getMinZoom(),Math.log2(i*r))),this.isWheel()&&(this._startZoom=this._mapView.mapState.getZoom(),this._targetZoom>this._startZoom?this._targetZoom=a.MapUtils.getNextZoomByStep(this._targetZoom,this._mapView.mapSettings.getZoomStep(),!0):this._targetZoom<this._startZoom&&(this._targetZoom=a.MapUtils.getNextZoomByStep(this._targetZoom,this._mapView.mapSettings.getZoomStep(),!1)),this._easing=this.smoothOutEasing(200)),this._mapView.mapState.zoomIn=this._delta>0,this._mapView.mapState.zoomOut=this._delta<0,this.isTrackpad){var o=this._mapView.mapState.getZoom();this._mapView.mapState.zoomIn&&this._targetZoom<o&&(this._targetZoom=o),-1!=this._delta&&1!=this._delta||(this._mapView.mapState.zoomIn?this._targetZoom=Math.ceil(this._targetZoom):this._mapView.mapState.zoomOut&&(this._targetZoom=Math.round(this._targetZoom)))}this._delta=0}var s=null==this._targetZoom?this._mapView.mapState.getZoom():this._targetZoom,l=this._startZoom,u=this._easing,h=!1;if(this.isWheel()&&l&&u){var c=Math.min((Date.now()-this._lastWheelEventTime)/200,1),p=u(c),f=l*(1-p)+s*p,d=new n.Vector2(this.data.x,this.data.y);this.setZoom(f,d,200),c<1?this._frameId||(this._frameId=this._mapView.requestRenderFrame(this.onScrollFrame)):h=!0}else{d=new n.Vector2(this.data.x,this.data.y);this.setZoom(s,d),h=!0}h&&(this._active=!1,this.isWheel()&&(this._finishTimeout=window.setTimeout((function(){t._finishTimeout=null,t._targetZoom=null}),200)))}},t.prototype.isWheel=function(){return"wheel"===this._type},t.prototype.isTrackpad=function(){return"trackpad"===this._type},t.prototype.setZoom=function(t,e,r){void 0===r&&(r=0),this._mapView.mapState.getZoom()!=t&&this._mapView.isZoomGesturesEnabled()&&(this._mapView.setZoom(t,e,r),this._mapView.notifyCameraIsChanging())},t.prototype.smoothOutEasing=function(t){var e=i.bezier(.25,.1,.25,1);if(this._prevEase){var r=this._prevEase,n=(Date.now()-r.start)/r.duration,o=r.easing(n+.01)-r.easing(n),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);e=i.bezier(a,s,.25,1)}return this._prevEase={start:Date.now(),duration:t,easing:e},e},t}();e.ScrollZoomHandler=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by}return t.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},t.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},t.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},t.prototype.solveCurveX=function(t,e){var r,i,n,o,a,s;for(n=t,s=0;s<8;++s){if(o=this.sampleCurveX(n)-t,Math.abs(o)<e)return n;if(a=this.sampleCurveDerivativeX(n),Math.abs(a)<1e-6)break;n-=o/a}if((n=t)<(r=0))return r;if(n>(i=1))return i;for(;r<i;){if(o=this.sampleCurveX(n),Math.abs(o-t)<e)return n;t>o?r=n:i=n,n=.5*(i-r)+r}return n},t.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))},t}();e.UnitBezier=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(13),n=r(2),o=function(){function t(t,e,r){this.dx=0,this.dy=0,this.timeConstant=t,this.initialSpeedRate=0,this.velocityRatioX=0,this.velocityRatioY=0,this.cameraAnimationObserver=e,this.mapState=r}return t.prototype.getDisplacement=function(t,e,r){return t*e*-Math.expm1(-r/t)},t.prototype.getDuration=function(e,r){return-e*Math.log(t.minTrackSpeed/r)},t.prototype.startFling=function(e,r){return this.mapState.flinging=!0,e=i.MathUtils.clamp(e,n.MapConstants.flingMinVelocity,n.MapConstants.flingMaxVelocity),r=i.MathUtils.clamp(r,n.MapConstants.flingMinVelocity,n.MapConstants.flingMaxVelocity),e*=t.secToMs,r*=t.secToMs,this.initialSpeedRate=Math.sqrt(e*e+r*r),this.initialSpeedRate<t.minTrackSpeed?(this.stopFling(),void this.cameraAnimationObserver.notifyCameraDidChange()):(this.flingDuration=this.getDuration(this.timeConstant,this.initialSpeedRate),this.getDisplacement(this.timeConstant,this.initialSpeedRate,this.flingDuration)<t.minDisplacement?(this.stopFling(),void this.cameraAnimationObserver.notifyCameraDidChange()):(this.velocityRatioX=e/this.initialSpeedRate,this.velocityRatioY=r/this.initialSpeedRate,this.previousPositionX=0,this.previousPositionY=0,void(this.flingStart=Date.now())))},t.prototype.stopFling=function(){this.initialSpeedRate=0,this.mapState.flinging=!1},t.prototype.isFlingInProgress=function(){return this.initialSpeedRate>0},t.prototype.trackMovement=function(){if(!this.isFlingInProgress())return!1;var t=Date.now()-this.flingStart;if(t>this.flingDuration)return this.stopFling(),this.cameraAnimationObserver.notifyCameraDidChange(),!1;var e=this.getDisplacement(this.timeConstant,this.initialSpeedRate,t),r=e*this.velocityRatioX,i=e*this.velocityRatioY;return this.dx=r-this.previousPositionX,this.dy=i-this.previousPositionY,this.previousPositionX=r,this.previousPositionY=i,!0},t.secToMs=.001,t.minTrackSpeed=.01,t.minDisplacement=20,t}();e.FlingTracker=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(13),o=function(){function t(t){this.inertia=[],this._mapView=t,this.inertia=[]}return t.prototype.onDragStart=function(t){this.lastDragRotatePosition=new i.Vector2(t.x,t.y)},t.prototype.onDrag=function(t){if(this.inertia.push([Date.now(),-t.x]),this._mapView.isRotateGesturesEnabled()){var e=.4*(this.lastDragRotatePosition.x-t.x);this._mapView.setBearing(this._mapView.mapState.getBearing()-e,0,!0)}if(this._mapView.isTiltGesturesEnabled()){var r=-.5*(this.lastDragRotatePosition.y-t.y);this._mapView.setTilt(this._mapView.mapState.cameraPosition.getTilt()-r,!0)}this.lastDragRotatePosition=new i.Vector2(t.x,t.y)},t.prototype.onDragEnd=function(){if(this.drainInertiaBuffer(),this.inertia.length<2)this._mapView.notifyCameraDidChange();else{if(this._mapView.isRotateGesturesEnabled()){var t=this.inertia,e=t.length,r=t[e-1],i=t[e-2],o=r[1]-i[1]>0?1:-1,a=r[1]-i[1],s=3*Math.abs(a);Math.abs(s)>360&&(s=360),s*=o;var l=Math.abs(s)/90;l=n.MathUtils.clamp(l,.5,1),this._mapView.setBearing(this._mapView.mapState.getBearing()-s,l,!0)}this.inertia=[]}},t.prototype.drainInertiaBuffer=function(){for(var t=this.inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},t}();e.DragRotateHandler=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(1),o=r(2),a=r(12),s=r(6),l=r(5),u=function(){function t(t){this._mapView=t,this._targetStart=null}return t.prototype.onDragStart=function(t){if(this._draggableAnnotation=null,this._targetStart=this._mapView.screenCoordinateToLatLng(t),this._targetStart.valid()){var e=this._mapView.queryUserPOI(t);if(e&&e.isDraggable())this._draggableAnnotation=e;else{var r=this._mapView.queryBuildingAndAnnotation(t);if(null!=r){if(l.Map4dObject.isClassType(r,l.ClassType.BUILDING_QUERY_RESULT)){var i=this._mapView.annotationManager.getBuilding(r.annotationId);if(i&&i.isDraggable())return void(this._draggableAnnotation=i)}(l.Map4dObject.isClassType(r,l.ClassType.MARKER)&&r.isDraggable()||l.Map4dObject.isClassType(r,l.ClassType.POLYLINE)&&r.isDraggable()||l.Map4dObject.isClassType(r,l.ClassType.POLYGON)&&r.isDraggable()||l.Map4dObject.isClassType(r,l.ClassType.CIRCLE)&&r.isDraggable())&&(this._draggableAnnotation=r)}}}else this._targetStart=null},t.prototype.onDrag=function(t){var e=this,r=this._mapView.screenCoordinateToLatLng(new i.Vector2(t.x,t.y),0);if(r.valid())if(this._draggableAnnotation){if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.MARKER)){var n=this._draggableAnnotation,o=r.subtract(this._targetStart),u=n.getPosition().add(o);n.setPosition(u),this._targetStart=r}else if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.POLYLINE)){var h=this._draggableAnnotation,c=r.subtract(this._targetStart),p=h.getPath();p.forEach((function(t,e){var r=t.add(c);p[e]=r})),h.setPath(p),this._targetStart=r}else if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.POLYGON)){var f=this._draggableAnnotation,d=f.getPaths(),g=[],y=this._mapView.mapState.getScale();d.forEach((function(t){var n=[];t.forEach((function(t){var o=s.ProjectionMercator.projectScale(r,y),a=s.ProjectionMercator.projectScale(e._targetStart,y),l=o.subtract(a),u=s.ProjectionMercator.projectScale(t,y);u=u.add(new i.Vector2(l.x,l.y));var h=s.ProjectionMercator.unproject(u,y);n.push(h)})),g.push(n)})),f.setPaths(g),this._targetStart=r}else if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.CIRCLE)){var m=this._draggableAnnotation,v=r.subtract(this._targetStart),_=m.getCenter().add(v);m.setCenter(_),this._targetStart=r}else if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.POI)){var b=this._draggableAnnotation;o=r.subtract(this._targetStart),u=b.getPosition().add(o);b.setPosition(u),this._targetStart=r}else if(l.Map4dObject.isClassType(this._draggableAnnotation,l.ClassType.BUILDING)){var w=this._draggableAnnotation;o=r.subtract(this._targetStart),u=w.getPosition().add(o);w.setPosition(u),this._targetStart=r}}else if(this._mapView.isScrollGesturesEnabled()){var x=new a.Point(-t.dx,t.dy);this._mapView.moveBy(x)}},t.prototype.onDragEnd=function(t){if(null==this._draggableAnnotation&&this._mapView.isScrollGesturesEnabled()){var e=new i.Vector2(-t.dx,t.dy);this._mapView.moveByVelocity(new i.Vector2(e.x,e.y).multiply(o.MapConstants.flingSpeedMultiply*n.MapUtils.pixelScale))}this._draggableAnnotation=null},Object.defineProperty(t.prototype,"draggableAnnotation",{get:function(){return this._draggableAnnotation},enumerable:!0,configurable:!0}),t}();e.DragPanHandler=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.onMapWillChange=function(t){},t.prototype.onMapIsChanging=function(t){},t.prototype.onMapDidChange=function(t){},t}();e.MapObserver=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.notifyCameraWillChange=function(t){},t.prototype.notifyCameraIsChanging=function(){},t.prototype.notifyCameraDidChange=function(){},t}();e.CameraAnimationObserver=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(20),n=r(9),o=r(2),a=r(6),s=r(3),l=r(30),u=r(8),h=r(13),c=r(24),p=function(){function t(t){this.mouseWheel=!1,this.scale=1,this.willChange=!1,this.zoomIn=!1,this.zoomOut=!1,this.panning=!1,this.flyingTo=!1,this.tilting=!1,this.bearing=!1,this.gesture=!1,this.flinging=!1,this.constraining=!1,this.mouseWheel=!1,this.mapSettings=t,this.cameraPosition=new i.CameraPosition([0,0],0,0,0),this.projectionMatrix=new n.Matrix4,this.orthoProjectionMatrix=new n.Matrix4,this.viewProjectionMatrix=new n.Matrix4}return t.prototype.setScreenSize=function(t,e){this.screenWidth=t,this.screenHeight=e,this.projectionMatrix.setPerspective(o.CameraConstants.fov,t/e,o.CameraConstants.nearPlane,o.CameraConstants.farPlane),this.orthoProjectionMatrix.setOrtho(0,t,e,0),this.constraintCameraWithRestrictionBounds(),this.recalculateMatrices()},t.prototype.matrixFor=function(t,e){var r=1<<e.getTileCoordinate().getZoom(),i=a.ProjectionMercator.worldSize(this.scale)/r,n=e.toVec2(),o=n.x*i+i/2,l=n.y*i+i/2,h=u.GeometryUtils.pixelCoordinateToCameraCoordinate(new s.Vector2(o,l),this.cameraPosition);return t.setIdentity(i/2,i/2,1),t.translate(h.x,h.y,0)},t.prototype.recalculateMatrices=function(){this.viewProjectionMatrix.setRotationX(this.cameraPosition.getTilt());var t=this.viewProjectionMatrix.transform(new l.Vector3(0,0,1),0);this.viewProjectionMatrix.rotateZ(this.cameraPosition.getBearing()),this.cameraPositionVector=this.viewProjectionMatrix.transform(t,0),c.CameraUtils.calculateViewMatrix(this.viewProjectionMatrix,this.cameraPosition,this.screenHeight),this.viewProjectionMatrix.concat(this.projectionMatrix)},t.prototype.constraintCameraWithRestrictionBounds=function(){if(null!=this.mapSettings.getRestrictionBounds()&&!this.constraining&&0!=this.getScreenSize().x&&0!=this.getScreenSize().y){this.constraining=!0;var t,e,r=this.mapSettings.getRestrictionBounds(),i=this.getScale(),n=null,o=null,l=this.getScreenSize(),u=a.ProjectionMercator.projectScale(r.getSouthwest(),i),h=a.ProjectionMercator.projectScale(r.getNortheast(),i),c=u.x,p=h.y,f=h.x,d=u.y;t=f-c<l.x?l.x/(f-c):0,e=d-p<l.y?l.y/(d-p):0;var g=a.ProjectionMercator.projectScale(this.getTarget(),i),y=Math.min(t,e);if(y)return this.setTarget(a.ProjectionMercator.unproject(new s.Vector2(t?(f+c)/2:g.x,e?(d+p)/2:g.y),i)),this.setZoom(Math.floor(this.getZoom()+Math.log2(y))),void(this.constraining=!1);if(f-c<l.x)g.x=(f+c)/2;else{var m=l.x/2;g.x-m<c&&(n=c+m),g.x+m>f&&(n=f-m)}if(d-p<l.y)g.y=(d+p)/2;else{var v=l.y/2;g.y-v<p&&(o=p+v),g.y+v>d&&(o=d-v)}this.setTarget(a.ProjectionMercator.unproject(new s.Vector2(null!=n?n:g.x,null!=o?o:g.y),i)),this.constraining=!1}},t.prototype.setTarget=function(t){this.cameraPosition.setTarget(t),this.constraintCameraWithRestrictionBounds(),this.recalculateMatrices()},t.prototype.setTilt=function(t){this.cameraPosition.setTilt(t),this.constraintCameraWithRestrictionBounds(),this.recalculateMatrices()},t.prototype.setBearing=function(t){this.cameraPosition.setBearing(t),this.constraintCameraWithRestrictionBounds(),this.recalculateMatrices()},t.prototype.setZoom=function(t){this.cameraPosition.setZoom(t),this.scale=Math.pow(2,t),this.constraintCameraWithRestrictionBounds(),this.recalculateMatrices()},t.prototype.enable3dMode=function(t){if(t==this.mapSettings.is3dMode())return!1;if(!t){var e=h.MathUtils.clamp(this.getTilt(),this.getMinTilt(),o.MapConstants.maxTilt2D);this.setTilt(e)}return this.mapSettings.enable3dMode(t)},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.getViewProjectionMatrix=function(){return this.viewProjectionMatrix},t.prototype.getOrthoProjectionMatrix=function(){return this.orthoProjectionMatrix},t.prototype.getScreenSize=function(){return new s.Vector2(this.screenWidth,this.screenHeight)},t.prototype.getTilt=function(){return this.cameraPosition.getTilt()},t.prototype.getMinTilt=function(){return this.mapSettings.getMinTilt()},t.prototype.getMaxTilt=function(){return this.mapSettings.getMaxTilt()},t.prototype.getDistanceToSky=function(){return this.distanceToSky},t.prototype.setDistanceToSky=function(t){this.distanceToSky=t},t.prototype.getBearing=function(){return this.cameraPosition.getBearing()},t.prototype.getScale=function(){return this.scale},t.prototype.getZoom=function(){return this.cameraPosition.getZoom()},t.prototype.getTarget=function(){return this.cameraPosition.getTarget()},t.prototype.isGesture=function(){return this.gesture},t.prototype.isZoomIn=function(){return this.zoomIn},t.prototype.isZoomOut=function(){return this.zoomOut},t.prototype.isTilting=function(){return this.tilting},t.prototype.isBearing=function(){return this.bearing},t.prototype.isPanning=function(){return this.panning},t.prototype.isFlyingTo=function(){return this.flyingTo},t.prototype.isMoving=function(){return this.movingTo},t.prototype.isFlinging=function(){return this.flinging},t.prototype.isStill=function(){return!(this.isBearing()||this.isFlyingTo()||this.isMoving()||this.isPanning()||this.isTilting()||this.isZoomIn()||this.isZoomOut())},t.prototype.dirty=function(){return this.isFlyingTo()||this.isPanning()||this.isZoomIn()||this.isZoomOut()||this.isMoving()||this.isBearing()||this.isFlinging()},t.prototype.getCamera=function(){return this.cameraPosition},t.prototype.isWillChange=function(){return this.willChange},t.prototype.setCamera=function(t){this.cameraPosition=t},t.prototype.getMaxNativeZoom=function(){return this.mapSettings.getMaxNativeZoom()},t.prototype.is3dMode=function(){return this.mapSettings.is3dMode()},t.prototype.getSkyRatio=function(){return this.skyRatio},t.prototype.setSkyRatio=function(t){this.skyRatio=t},t.prototype.isMouseWheel=function(){return this.mouseWheel},t}();e.MapState=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(18),n=r(59),o=r(8),a=r(3),s=r(122),l=r(2),u=r(48),h=r(32),c=r(6),p=r(1),f=r(123),d=r(37),g=r(61),y=r(92),m=r(0),v=r(7),_=function(){function t(t,e,r,i,n){var o=this;this.visibleTiles=[],this.mapView=t,this.mapState=r,this.finishedLoad=!0,this.dirtyOverriddenTile=!1,this.overriddenTiles=new Set,this.tilesLoaded=!0,this.mapSettings=i,this.lastZoom=this.mapState.getZoom(),this.lastZoomUpdateVisibleTiles=this.mapState.getZoom(),this.tileRequestsMap=new Map,this.requestRender=n;this.tilePyramid=new g.TilePyramid(this.mapView,l.MapConstants.tileCacheSize,(function(t){return o.createTile(t)}),(function(t){o.removeTile(t)}),(function(t){o.updateTileFromCache(t)})),this.taskDataManager=new y.TaskDataManager(t,e,n,this.tileRequestsMap)}return t.prototype.isDirty=function(){return!(this.finishedLoad||this.mapState.isZoomIn()||this.mapState.isZoomOut())},t.prototype.removeTile=function(t){var e=t.getTileCoordinate();if(this.overriddenTiles.delete(e),t.isRenderable()){if(this.mapState.is3dMode()){var r=v.MapResourceManager.getInstance(this.mapView.gl);t.getTileRenderData().getLayerRenderDatas().forEach((function(t){if(t.getType()==m.LayerType.BUILDING){var e=t;r.removeVisibleBuildingId(e.getId())}}))}this.tilePyramid.getTileCache()||t.destroy()}else this.taskDataManager.removeTaskResult(e)},t.prototype.update=function(){this.isDirty()&&(this.tilePyramid.update(this.visibleTiles,this.mapState,this.lastZoom),this.dirtyOverriddenTile&&(this.dirtyOverriddenTile=!1,this.updateOverriddenTile()),this.taskDataManager.isAllRequestFinished()&&(0==this.tilesLoaded&&this.mapView.mapsEventManager.notify(d.MapEvent.tilesLoaded),this.tilesLoaded=!0,this.finishedLoad=!0,this.lastZoom=this.mapState.getZoom()))},t.prototype.reload=function(){this.mapView.getGeoJsonManager().removeAllTiles(),this.tilePyramid.getTiles().forEach((function(t){t.tile.destroy()})),this.mapView.getAnnotationManager().reload(),this.mapView.getOverlayManager().reload(),this.tilePyramid.clear(),this.finishedLoad=!1,this.mapView.dirty=!0,this.taskDataManager.reload()},t.prototype.destroy=function(){this.reload(),this.visibleTiles=[]},t.prototype.getTilePyramid=function(){return this.tilePyramid},t.prototype.getVisibleTiles=function(){return this.visibleTiles},t.prototype.updateVisibleTilesForZoom=function(t){var e=this;this.mapState.getZoom()>this.mapSettings.getMaxNativeZoom()&&(t=this.mapSettings.getMaxNativeZoom());var r=this.mapState.cameraPosition,i=this.mapState.getScreenSize(),u=Math.pow(2,t),h=this.mapState.getTilt(),d=!1;h>l.MapConstants.maxTiltIntersectWithScreen&&(this.mapState.setTilt(l.MapConstants.maxTiltIntersectWithScreen),d=!0);var g=o.GeometryUtils.screenCoordinateToLatLngZoom(new a.Vector2(0,0),r,i,t),y=c.ProjectionMercator.projectScale(g,u).multiply(1/p.MapUtils.getTileSize()),m=o.GeometryUtils.screenCoordinateToLatLngZoom(new a.Vector2(i.x,0),r,i,t),v=c.ProjectionMercator.projectScale(m,u).multiply(1/p.MapUtils.getTileSize());d&&this.mapState.setTilt(h);var _=o.GeometryUtils.screenCoordinateToLatLngZoom(new a.Vector2(i.x,i.y),r,i,t),b=c.ProjectionMercator.projectScale(_,u).multiply(1/p.MapUtils.getTileSize()),w=o.GeometryUtils.screenCoordinateToLatLngZoom(new a.Vector2(0,i.y),r,i,t),x=c.ProjectionMercator.projectScale(w,u).multiply(1/p.MapUtils.getTileSize()),M=o.GeometryUtils.screenCoordinateToLatLngZoom(new a.Vector2(i.x/2,i.y/2),r,i,t),T=c.ProjectionMercator.projectScale(M,u).multiply(1/p.MapUtils.getTileSize());this.mapState.is3dMode()&&(this.mapState.setSkyRatio(o.GeometryUtils.latLngToScreenCoordinate(g,0,r,i).y/i.y),this.mapState.setDistanceToSky(f.Geometry2DUtils.calculateDistanceBetweenPointToLineBy2Point(v,x,b)*p.MapUtils.getTileSize()));var A=1<<Math.floor(t),L=[],S=function(t,e,r){if(r>=0&&r<=A)for(var i=t;i<e;++i){var n=i+.5-T.x,o=r+.5-T.y,a={x:i,y:r,sqDist:n*n+o*o};L.push(a)}};s.Rasterize.scanTriangle(y,v,b,0,A,S),s.Rasterize.scanTriangle(b,x,y,0,A,S),L.sort((function(t,e){return t.sqDist==e.sqDist?t.x==e.x?t.y-e.y:t.x-e.x:t.sqDist-e.sqDist})),L.filter((function(t,e,r){return 0==e||t.x!=r[e-1].x||t.y!=r[e-1].y})).forEach((function(r){return e.visibleTiles.push(n.UnwrappedTileCoordinate.createWithXYZoom(r.x,r.y,t,e.mapState.is3dMode()))}))},t.prototype.updateVisibleTiles=function(){this.finishedLoad=!1,this.mapView.overlayManager.visibleTilesChanged(),this.visibleTiles=[];var t=this.mapState.getZoom();this.updateVisibleTilesForZoom(Math.floor(t)),this.lastZoomUpdateVisibleTiles=t,this.taskDataManager.cancelOutdatedTasks(this.visibleTiles)},t.prototype.updateTileFromCache=function(t){var e=this,r=t.getTileCoordinate();if(this.mapView.overlayManager.isOverrideBaseMapTile(r)){t.getTileData().getLayerIds().forEach((function(r){e.removeTileLayer(t,r)})),this.overriddenTiles.add(r)}else{var i=t.getTileData(),n=t.getTileRenderData();if(this.mapState.is3dMode()&&null!=i.getTileLayer(l.LayerConstants.buildingTileLayerId)){var o=v.MapResourceManager.getInstance(this.mapView.gl);n.getLayerRenderDatas().forEach((function(t){if(t.getType()==m.LayerType.BUILDING){var e=t,r=e.getId();o.hasVisibleBuildingId(r)||e.resetScaleZ(),o.retainVisibleBuildingId(r)}}))}n.isEmpty()&&this.requestTileData(t,r)}},t.prototype.createTile=function(t){var e=new i.Tile(i.Kind.BASEMAP,t,this.mapView.gl);return this.mapView.overlayManager.isOverrideBaseMapTile(t)?(this.overriddenTiles.add(t),e.setRenderable()):this.requestTileData(e,t),e},t.prototype.requestTileData=function(t,e){this.tilesLoaded=!1;var r=this.mapSettings.getMapUrl(),i=u.UrlUtils.getTileUrl(r,e.getX(),e.getY(),e.getZoom());this.taskDataManager.requestData(t,h.Resource.Tile,i)},t.prototype.dirtyOverriddenTiles=function(){this.dirtyOverriddenTile=!0,this.finishedLoad=!1},t.prototype.updateOverriddenTile=function(){var t=this,e=this.mapView.overlayManager;this.mapState.is3dMode();this.visibleTiles.forEach((function(r){var i=r.getTileCoordinate(),n=t.tilePyramid.getTile(i);null!=n&&(e.isOverrideBaseMapTile(i)?(t.overriddenTiles.add(i),n.isRenderable()?n.getTileData().getLayerIds().forEach((function(e){t.removeTileLayer(n,e)})):t.taskDataManager.removeTaskResult(i,!0)):t.overriddenTiles.has(i)&&(t.requestTileData(n,i),t.overriddenTiles.delete(i)))}))},t.prototype.removeTileLayer=function(t,e){var r=t.getTileData(),i=r.getTileLayer(e);if(null!=i){var n=t.getTileRenderData();i.getFeatures().forEach((function(t){n.removeLayerRenderData(t.getId())})),r.removeTileLayer(e)}},t}();e.TileManager=_},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.layerRenderDatas=new Map}return t.prototype.destroy=function(){this.layerRenderDatas.forEach((function(t){return t.destroy()})),this.layerRenderDatas.clear()},t.prototype.getLayerRenderDatas=function(){return this.layerRenderDatas},t.prototype.getLayerRenderData=function(t){return this.layerRenderDatas.get(t)},t.prototype.setLayerRenderData=function(t,e){this.layerRenderDatas.has(t)&&this.layerRenderDatas.get(t).destroy(),this.layerRenderDatas.set(t,e)},t.prototype.removeLayerRenderData=function(t){var e=this.layerRenderDatas.get(t);e&&(e.destroy(),this.layerRenderDatas.delete(t))},t.prototype.hasLayerRenderData=function(t){return this.layerRenderDatas.has(t)},t.prototype.isEmpty=function(){return 0==this.layerRenderDatas.size},t}();e.TileRenderData=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.scanTriangle=function(t,e,r,i,a,s){var l=new n(t,e),u=new n(e,r),h=new n(r,t);if(l.dy>u.dy){var c=l;l=u,u=c}if(l.dy>h.dy){c=l;l=h,h=c}if(u.dy>h.dy){c=u;u=h,h=c}l.dy&&o(h,l,i,a,s),u.dy&&o(h,u,i,a,s)},t}();e.Rasterize=i;var n=function(t,e){if(this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.dx=0,this.dy=0,t.y>e.y){var r=t;t=e,e=r}this.x0=t.x,this.y0=t.y,this.x1=e.x,this.y1=e.y,this.dx=e.x-t.x,this.dy=e.y-t.y};function o(t,e,r,i,n){var o=Math.max(r,Math.floor(e.y0)),a=Math.min(i,Math.ceil(e.y1));if(t.x0==e.x0&&t.y0==e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,h=t.dx>0?1:0,c=e.dx<0?1:0,p=o;p<a;++p){var f=l*Math.max(0,Math.min(t.dy,p+h-t.y0))+t.x0,d=u*Math.max(0,Math.min(e.dy,p+c-e.y0))+e.x0;n(Math.floor(d),Math.ceil(f),p)}}e.Edge=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=function(){function t(){}return t.calculateDistanceBetweenPointToLineBy2Point=function(e,r,i){return Math.sqrt(t.distToSegmentSquared(e,r,i))},t.calculateDistanceBetweenPointToLine=function(e,r){return Math.sqrt(t.distToSegmentSquared(e,new i.Vector2(r[0][0],r[0][1]),new i.Vector2(r[1][0],r[1][1])))},t.distToSegmentSquared=function(e,r,n){var o=t.dist2(r,n);if(0==o)return t.dist2(e,r);var a=((e.x-r.x)*(n.x-r.x)+(e.y-r.y)*(n.y-r.y))/o;return a=Math.max(0,Math.min(1,a)),t.dist2(e,new i.Vector2(r.x+a*(n.x-r.x),r.y+a*(n.y-r.y)))},t.dist2=function(e,r){return t.sqr(e.x-r.x)+t.sqr(e.y-r.y)},t.sqr=function(t){return t*t},t}();e.Geometry2DUtils=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.orderedKeys=[],this.size=t,this.tiles=new Map}return t.prototype.setSize=function(t){for(this.size=t;this.orderedKeys.length>t;){var e=this.orderedKeys[0];this.orderedKeys.shift(),this.tiles.delete(e.toString())}},t.prototype.add=function(t,e){if(e.isRenderable()&&this.size){if(this.tiles.has(t)){var r=this.orderedKeys.indexOf(t,0);r>-1&&this.orderedKeys.splice(r,1);var i=this.tiles.get(t);i!=e&&i.destroy()}if(this.tiles.set(t,e),this.orderedKeys.push(t),this.orderedKeys.length>this.size-1)this.pop(this.orderedKeys[0]).destroy()}else e.destroy()},t.prototype.get=function(t){return this.tiles.get(t)},t.prototype.pop=function(t){var e=this.tiles.get(t);if(this.tiles.delete(t)){var r=this.orderedKeys.indexOf(t,0);r>-1&&this.orderedKeys.splice(r,1)}return e},t.prototype.has=function(t){return null!=this.tiles.get(t)},t.prototype.clear=function(){this.orderedKeys=[],this.tiles.forEach((function(t){t.destroy()})),this.tiles.clear()},t}();e.TileCache=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(18),a=r(0),s=r(38),l=r(146),u=function(t){function e(e,r,i){var n=t.call(this,e,r,i)||this;return n.gl=i,n.layerDatas=new Map,n.geometryTileDatas=null,n}return n(e,t),e.prototype.getTexture=function(){return null},e.prototype.init=function(t,e){},e.prototype.setData=function(t){var e=this;this.geometryTileDatas=t,null!=t&&t.getLayerIds().forEach((function(t){t.startsWith(s.AnnotationManager.pointLayerId)&&e.removeLayerData(t)}))},e.prototype.hasData=function(t){return null!=this.geometryTileDatas&&null!=this.geometryTileDatas.getLayer(t)},e.prototype.removeLayerData=function(t){var e=this.layerDatas.get(t);e&&(e.destroy(),this.layerDatas.delete(t))},e.prototype._getLayerData=function(t,e,r){if(void 0===r&&(r=null),!this.layerDatas.has(t)){var i=this.geometryTileDatas.getLayer(t);if(null==i)return console.error("_getLayerData not reachable"),null;switch(e){case a.LayerType.GEOJSON:var n=new l.GeoJsonLayerData(i,this.gl);return this.layerDatas.set(t,n),this.layerDatas.get(t);default:return console.error("_getLayerData not reachable"),null}}return this.layerDatas.get(t)},e.prototype.getGeometryTileData=function(){return this.geometryTileDatas},e}(o.Tile);e.GeometryTile=u},function(t,e,r){t.exports=function(){"use strict";function t(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(r,i,n,o,a){!function e(r,i,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=i-n+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1),p=Math.max(n,Math.floor(i-l*h/s+c)),f=Math.min(o,Math.floor(i+(s-l)*h/s+c));e(r,i,p,f,a)}var d=r[i],g=n,y=o;for(t(r,n,i),a(r[o],d)>0&&t(r,n,o);g<y;){for(t(r,g,y),g++,y--;a(r[g],d)<0;)g++;for(;a(r[y],d)>0;)y--}0===a(r[n],d)?t(r,n,y):(y++,t(r,y,o)),y<=i&&(n=y+1),i<=y&&(o=y-1)}}(r,i,n||0,o||r.length-1,a||e)}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(19),n=r(38),o=r(6),a=r(3),s=r(0),l=r(15),u=r(25),h=function(){function t(t,e){this._id=t,this._layerId=n.AnnotationManager.annotationLayerId+t.toString(),this._circleAnnotation=e,this.updateBounds()}return t.prototype.createLayer=function(t){null==t.getLayer(this._layerId)&&t.createLayer(this._layerId,s.LayerType.CIRCLE,this._circleAnnotation.getZIndex())},t.prototype.updateTileData=function(t,e){var r=e.addTileLayer(this._layerId,s.LayerType.CIRCLE),i=new u.GeometryCollection([]);r.addFeature(this._layerId,l.GeometryType.Unknown,i,this._circleAnnotation.getProperties())},t.prototype.updateBounds=function(){var t=this._circleAnnotation.getCenter(),e=this._circleAnnotation.getRadius(),r=o.ProjectionMercator.convertToMeterFromLatLng(t),n=new a.Vector2(r.x-e,r.y-e),s=new a.Vector2(r.x+e,r.y+e),l=new i.LatLngBounds(o.ProjectionMercator.convertToLatLngFromMeter(n),o.ProjectionMercator.convertToLatLngFromMeter(s));this._minX=l.getSouthwest().lng,this._minY=l.getSouthwest().lat,this._maxX=l.getNortheast().lng,this._maxY=l.getNortheast().lat},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.getLayerId=function(){return this._layerId},t.prototype.getAnnotation=function(){return this._circleAnnotation},Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t}();e.CircleAnnotationData=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(83),s=r(5),l=function(t){function e(e,r){var i=t.call(this,s.ClassType.POLYGON_DATA,e)||this;return i.polygonAnnotation=r,i}return n(e,t),e.prototype.getAnnotation=function(){return this.polygonAnnotation},e.prototype.createLayer=function(t){var e=this.getLayerId();null==t.getLayer(e)&&t.createLayer(e,o.LayerType.FILL,this.polygonAnnotation.getZIndex())},e.prototype.getFeatures=function(){var t,e=[];this.polygonAnnotation.getPaths().forEach((function(t){var r=[];t.forEach((function(t){return r.push([t.lng,t.lat])})),e.push(r)}));var r={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:e}},{type:"Feature",properties:{},geometry:{type:"MultiLineString",coordinates:e}}]};return t=JSON.stringify(r,null,2),JSON.parse(t)},e.prototype.getProperties=function(){return this.polygonAnnotation.getProperties()},e.prototype.addTileLayer=function(t,e){return t.addTileLayer(e,o.LayerType.FILL)},e}(a.ShapeAnnotationData);e.PolygonAnnotationData=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(83),s=r(5),l=function(t){function e(e,r){var i=t.call(this,s.ClassType.POLYLINE_DATA,e)||this;return i.polylineAnnotation=r,i}return n(e,t),e.prototype.getAnnotation=function(){return this.polylineAnnotation},e.prototype.createLayer=function(t){var e=this.getLayerId();null==t.getLayer(e)&&t.createLayer(e,o.LayerType.LINE,this.polylineAnnotation.getZIndex())},e.prototype.getFeatures=function(){var t,e=[];this.polylineAnnotation.getPath().forEach((function(t){e.push([t.lng,t.lat])})),this.polylineAnnotation.isClosed()&&0!=e.length&&e.push(e[0]);var r={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e}}]};return t=JSON.stringify(r,null,2),JSON.parse(t)},e.prototype.getProperties=function(){return this.polylineAnnotation.getProperties()},e.prototype.addTileLayer=function(t,e){return t.addTileLayer(e,o.LayerType.LINE)},e}(a.ShapeAnnotationData);e.PolylineAnnotationData=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(0),o=r(38),a=r(48),s=r(25),l=r(15),u=r(2),h=r(5),c=function(){function t(t,e,r){this._gl=t,this._id=e,this._layerId=o.AnnotationManager.pointLayerId+e.toString(),this._symbolAnnotation=r,this._symbolAnnotation.getProperties().setId(this._layerId),this.updateBounds(),this.updateIcon()}return t.prototype.createLayer=function(t){null==t.getLayer(this._layerId)&&t.createLayer(this._layerId,n.LayerType.SYMBOL,u.MapConstants.buildingLayerOrder+this._symbolAnnotation.getZIndex())},t.prototype.updateTileData=function(t,e){var r=e.addTileLayer(this._layerId,n.LayerType.SYMBOL),i=this.getProperties(),o=new s.GeometryCollection([]);r.addFeature(this._layerId,l.GeometryType.Point,o,i)},t.prototype.updateBounds=function(){var t=this._symbolAnnotation.getPosition();this._minX=t.lng,this._minY=t.lat,this._maxX=t.lng,this._maxY=t.lat},t.prototype.updateAnnotationData=function(){var t=this._symbolAnnotation.getPosition();t.lat!=this._minY||t.lng!=this._minX?this.updateBounds():this.updateIcon()},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.getLayerId=function(){return this._layerId},Object.defineProperty(t.prototype,"symbolAnnotation",{get:function(){return this._symbolAnnotation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t.prototype.getProperties=function(){return this._symbolAnnotation.getProperties()},t.prototype.updateIcon=function(){var e=this.getProperties(),r=this._symbolAnnotation.getIcon();"string"!=typeof r?h.Map4dObject.isClassType(r,h.ClassType.ICON)&&(e.setUrl(r.getUrl()),e.setWidth(r.getWidth()*i.MapUtils.pixelScale),e.setHeight(r.getHeight()*i.MapUtils.pixelScale)):(e.setUrl(r),e.setWidth(-1),e.setHeight(-1)),a.UrlUtils.isUrlRequest(e.getUrl())||-1!=e.getWidth()&&-1!=e.getHeight()||(e.setWidth(t.DEFAULT_SYMBOL_WIDTH*i.MapUtils.pixelScale),e.setHeight(t.DEFAULT_SYMBOL_HEIGHT*i.MapUtils.pixelScale))},t.DEFAULT_SYMBOL_WIDTH=32,t.DEFAULT_SYMBOL_HEIGHT=32,t}();e.SymbolAnnotationData=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(132),n=r(36),o=r(1),a=r(84),s=function(){function t(t,e,r){this.map=t,this.symbolAnnotations=e,this.iconViewMarkerManager=r,this.infoWindows=new Map,this.createInfoWindowContainer()}return t.prototype.createInfoWindowContainer=function(){this.infoWindowContainer||(this.infoWindowContainer=n.DOMUtils.create("div","mf-info-window-container",this.map.getMapContainer()))},t.prototype.createInfoWindowAnchorContainer=function(){this.infoWindowAnchorContainer||(this.infoWindowAnchorContainer=n.DOMUtils.create("div","mf-info-window-anchor",this.infoWindowContainer))},t.prototype.createInfoContentsContainer=function(){this.infoContentsContainer||(this.createInfoWindowContainer(),this.infoContentsContainer=n.DOMUtils.create("div","mf-info-window-content mf-scrollbar",this.infoWindowContainer),this.createInfoWindowAnchorContainer())},t.prototype.createInfoWindow=function(t){var e=this.getInfoWindow(t);return null!=e?(null==this.infoContentsContainer&&(this.infoContentsContainer=n.DOMUtils.create("div",null,this.infoWindowContainer)),this.setContentsHTMLElement(e),this.infoContentsContainer):null},t.prototype.createInfoContents=function(t){var e=this.getInfoContents(t);return null!=e?(this.createInfoContentsContainer(),this.setContentsHTMLElement(e),this.infoContentsContainer):null},t.prototype.createDefaultInfoContents=function(t){var e=t.getTitle(),r=t.getSnippet();if(!(""!==e&&null!=e||""!==r&&null!=r))return null;this.createInfoContentsContainer();var i=this.getDefaultContents(t);return this.setContentsHTMLElement(i),this.infoContentsContainer},t.prototype.deselectMarker=function(){null!=this.selectedMarkerId&&this.hideInfoWindow(this.selectedMarkerId)},t.prototype.getDefaultContents=function(t){var e=t.getTitle()||"",r=t.getSnippet()||"";return(e.length>0?"<h4>"+e+"</h4>":"")+(r.length>0?"<p>"+t.getSnippet()+"</p>":"")},t.prototype.getInfoContents=function(t){var e=t.getInfoContents();return null!=e?e:null},t.prototype.getInfoWindow=function(t){var e=t.getInfoWindow();return null!=e?e:null},t.prototype.getInfoWindowHTMLElement=function(t){var e=this.createInfoWindow(t);if(null!=e)return e;var r=this.createInfoContents(t);return null!=r?r:this.createDefaultInfoContents(t)},t.prototype.isInfoWindowShown=function(t){return null!=this.selectedMarkerId&&this.selectedMarkerId==t},t.prototype.removeContent=function(){this.infoContentsContainer&&(n.DOMUtils.remove(this.infoContentsContainer),this.infoContentsContainer=null),this.infoWindowAnchorContainer&&(n.DOMUtils.remove(this.infoWindowAnchorContainer),this.infoWindowAnchorContainer=null)},t.prototype.render=function(t){null!=this.selectedMarkerId&&(t.indexOf(this.selectedMarkerId)>-1?this.update():this.infoWindowContainer.style.visibility="hidden")},t.prototype.update=function(){var t=this.iconViewMarkerManager.getIconViewMarkers().get(this.selectedMarkerId),e=this.symbolAnnotations.get(this.selectedMarkerId),r=0;if(e||t){var i=null,n=this.infoWindows.get(this.selectedMarkerId);if(e)i=n.getPositionBySymbolAnnotationData(e,this.map.mapState),r=e.symbolAnnotation.getProperties().getWidth();else{var s=this.iconViewMarkerManager.getIconViewsHTML().get(this.selectedMarkerId),l=document.getElementById(""+s.id),u=l.clientWidth*o.MapUtils.pixelScale,h=l.clientHeight*o.MapUtils.pixelScale;u=u%2?u+1:u,h=h%2?h+1:h,i=n.getPosition(t.getPosition(),t.getElevation(),u,h,t.getAnchor(),this.map.mapState),r=u}if(null==i)return;var c=i.x,p=i.y,f=this.infoWindowContainer.style;if(f.top=p.toString()+"px",f.left=c.toString()+"px","hidden"==f.visibility&&(f.visibility="visible"),!this.infoWindowAnchorContainer)return;for(var d=0;d<this.infoWindowAnchorContainer.classList.length;d++){var g=this.infoWindowAnchorContainer.classList[d];"mf-info-window-anchor"!==g&&g!=="mf-anchor-"+n.getAnchorDirection()&&this.infoWindowAnchorContainer.classList.remove(g)}this.infoWindowAnchorContainer.classList.add("mf-anchor-"+n.getAnchorDirection());var y=r/o.MapUtils.pixelScale/2;switch(n.getAnchorDirection()){case a.AnchorDirections.TOP_RIGHT:case a.AnchorDirections.BOTTOM_RIGHT:this.infoWindowAnchorContainer.style.marginLeft=y.toString()+"px";break;case a.AnchorDirections.TOP_LEFT:case a.AnchorDirections.BOTTOM_LEFT:this.infoWindowAnchorContainer.style.marginRight=y.toString()+"px";break;default:this.infoWindowAnchorContainer.style.margin="0px"}}},t.prototype.hideInfoWindow=function(t){var e=t||this.selectedMarkerId;null!=e&&(this.removeContent(),this.infoWindows.delete(e),this.selectedMarkerId=null)},t.prototype.showInfoWindow=function(t){if(t!==this.selectedMarkerId){this.deselectMarker();var e=this.iconViewMarkerManager.getIconViewMarkers().get(t),r=this.symbolAnnotations.get(t);if(null!=r&&r.symbolAnnotation.isVisible()||e&&e.isVisible()){var n=r?r.symbolAnnotation:e,o=this.getInfoWindowHTMLElement(n);if(o&&o.children.length>0){for(var a="",s=0;s<o.children.length;++s)a+=o.children[s].innerHTML;""==a&&(console.error("All content you set for Info Window is NULL, Please check your custom setInfoContents() method."),o=null)}var l=new i.InfoWindow(o,n.getWindowAnchor());this.infoWindows.clear(),this.infoWindows.set(t,l),this.selectedMarkerId=t,this.update()}}},t.prototype.setContentsHTMLElement=function(t){this.infoContentsContainer&&(this.infoContentsContainer.innerHTML=t.toString())},t.prototype.updateInfoContents=function(t){var e=this.iconViewMarkerManager.getIconViewMarkers().get(t),r=this.symbolAnnotations.get(t),i=r?r.symbolAnnotation:e,n=this.infoWindows.get(t);null!=n&&(n.setContent(this.getInfoWindowHTMLElement(i)),this.update())},t}();e.InfoWindowManager=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(12),o=r(8),a=r(2),s=r(84),l=function(){function t(t,e){this.anchorDirection=s.AnchorDirections.TOP,this.content=t,this.windowAnchor=e}return t.prototype.getContent=function(){return this.content},t.prototype.getPosition=function(t,e,r,l,u,h){if(null==this.content)return null;e=h.is3dMode()?e:0;var c=o.GeometryUtils.latLngToScreenCoordinate(t,e,h.cameraPosition,h.getScreenSize());c.x/=i.MapUtils.pixelScale,c.y/=i.MapUtils.pixelScale;var p=r/i.MapUtils.pixelScale,f=l/i.MapUtils.pixelScale,d=this.windowAnchor||new n.Point(.5,.5);if(null==this.windowAnchor){var g=this.getWindowAnchorDirection(f,c,h);switch(this.anchorDirection=g,g){case s.AnchorDirections.BOTTOM:d=new n.Point(.5,1),c.x-=this.content.offsetWidth/2,c.y+=l/2;break;case s.AnchorDirections.BOTTOM_RIGHT:d=new n.Point(.5,1),c.x-=p/2,c.y+=l/2;break;case s.AnchorDirections.BOTTOM_LEFT:d=new n.Point(.5,1),c.x-=this.content.offsetWidth-p/2,c.y+=l/2;break;case s.AnchorDirections.TOP:d=new n.Point(.5,0),c.x-=this.content.offsetWidth/2,c.y-=this.content.offsetHeight+1;break;case s.AnchorDirections.TOP_RIGHT:d=new n.Point(.5,0),c.x-=p/2,c.y-=this.content.offsetHeight+1;break;case s.AnchorDirections.TOP_LEFT:d=new n.Point(.5,0),c.x-=this.content.offsetWidth-p/2,c.y-=this.content.offsetHeight+1}}else c.x-=this.content.offsetWidth/2,c.y-=this.content.offsetHeight;return c.x+=(.5-u.x)*p-(.5-d.x)*p,c.y+=(.5-u.y)*f-(.5-d.y)*f-a.MapConstants.infoWindowPadding,new n.Point(c.x,c.y)},t.prototype.getWindowAnchorDirection=function(t,e,r){var n=e.y-this.content.offsetHeight-t<0,o=e.x-this.content.offsetWidth/2<0,a=e.x>r.screenWidth/i.MapUtils.pixelScale-this.content.offsetWidth/2;return n?o?s.AnchorDirections.BOTTOM_RIGHT:a?s.AnchorDirections.BOTTOM_LEFT:s.AnchorDirections.BOTTOM:o?s.AnchorDirections.TOP_RIGHT:a?s.AnchorDirections.TOP_LEFT:s.AnchorDirections.TOP},t.prototype.getPositionBySymbolAnnotationData=function(t,e){var r=t.symbolAnnotation,i=r.getProperties();return this.getPosition(r.getPosition(),r.getElevation(),i.getWidth(),i.getHeight(),r.getAnchor(),e)},t.prototype.setContent=function(t){this.content=t},t.prototype.getAnchorDirection=function(){return this.anchorDirection},t}();e.InfoWindow=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(36),n=r(1),o=r(5),a=r(51),s=r(52),l=r(2),u=r(85),h=function(){function t(t){this._mapView=t,this._iconViewMarkers=new Map,this._iconViewsHTML=new Map,this._labelsHTML=new Map}return t.prototype.update=function(){var t=this;this._iconViewMarkers.forEach((function(e){t.updateIconView(e.getId())}))},t.prototype.updateIconView=function(t){if(this._iconViewMarkers.get(t)){var e=n.MapUtils.pixelScale,r=this._iconViewMarkers.get(t),h=this._mapView.latLngToScreenCoordinate(r.getPosition(),r.getElevation());h.x/=e,h.y/=e;var c=null,p=r.getLabel();p&&(c=o.Map4dObject.isClassType(p,o.ClassType.MARKER_LABEL)?p:new a.MarkerLabel({text:p}));var f=r.getProperties();f.needUpdateIconView&&this._iconViewsHTML.has(t)&&(this.removeContainer(t),this._iconViewsHTML.delete(t),p&&this._labelsHTML.delete(t),f.needUpdateIconView=!1);var d=this._iconViewsHTML.get(t),g=this._labelsHTML.get(t);if(d||((d=i.DOMUtils.create("div","mf-iconview-marker-container",this._mapView.getMapContainer())).style.pointerEvents="none",d.id="mf-iconview-marker-"+t,d.innerHTML=""+r.getIconView(),this._iconViewsHTML.set(t,d)),p&&(!g||f.markerLabelDirty)){var y=c.getMargin(),m='<div style="text-align: center;font-family: Arial;font-weight: 600;overflow: hidden;white-space: nowrap;display: block;text-overflow: ellipsis;max-width: '+c.getMaxWidth()+"px;color: "+c.getColor()+";padding: "+y.top+"px "+y.right+"px "+y.bottom+"px "+y.left+"px;";if(c.hasHalo()){var v=c.getHaloColor();m+="text-shadow: 1px 0 color, -1px 0 color, 0 1px color, 0 -1px color, 1px 1px color, -1px -1px color, 1px -1px color, -1px 1px color;".replace(/color/g,v)}m+="font-size: "+c.getFontSize()+'px">'+c.getText()+"</div>",g?f.setMarkerLabelDirty(!1):((g=i.DOMUtils.create("div","mf-label-marker-container",this._mapView.getMapContainer())).style.pointerEvents="none",g.id="mf-label-marker-"+t,this._labelsHTML.set(t,g)),g.innerHTML=m}var _=r.getAnchor(),b=document.getElementById(""+d.id);if(b){var w=d.style,x=b.clientWidth%2?b.clientWidth+1:b.clientWidth,M=b.clientHeight%2?b.clientHeight+1:b.clientHeight,T=r.getAnimation();null!=T&&(T==s.Animation.DROP&&f._animationTime<l.MapConstants.dropAnimationDuration?(f._animationTime+=this._mapView.deltaTime,h.y*=u.Easing.easeOutBounce(f._animationTime/l.MapConstants.dropAnimationDuration),this._mapView.requestRender()):T==s.Animation.BOUNCE&&(f._animationTime+=this._mapView.deltaTime,h.y-=M*Math.abs(Math.cos(f._animationTime/1080)),this._mapView.requestRender()));var A=h.x-_.x*x,L=h.y-_.y*M;w.top=L.toString()+"px",w.left=A.toString()+"px",w.zIndex=r.getZIndex().toString(),r.isVisible()?w.visibility="visible":w.visibility="hidden";var S=null;if(p){var E=document.getElementById(""+g.id);S=g.style;var P=r.getLabelAnchor(),C=c.getAnchor(),I=E.clientWidth%2?E.clientWidth+1:E.clientWidth,O=E.clientHeight%2?E.clientHeight+1:E.clientHeight,R={left:A+x*P.x,top:L+M*P.y},k=R.left-I*C.x,D=R.top-O*C.y;S.top=D.toString()+"px",S.left=k.toString()+"px",S.zIndex=r.getZIndex().toString(),r.isVisible()?S.visibility="visible":S.visibility="hidden"}var B=this._mapView.getMaxNativeZoom();h.y=this._mapView.mapState.getZoom()>B?h.y:h.y+24;var U=this._mapView.screenCoordinateToLatLng(h);(d.offsetLeft>this._mapView.mapState.getScreenSize().x/e||d.offsetLeft<-d.offsetWidth||d.offsetTop>this._mapView.mapState.getScreenSize().y/e||d.offsetTop<-d.offsetHeight||U.lng==1/0||U.lat==1/0)&&(w.visibility="hidden",S&&(S.visibility="hidden")),this._mapView._annotationManager.addVisibleAnnotation(t)}}},t.prototype.add=function(t,e){this._iconViewMarkers.set(t,e),this.updateIconView(t)},t.prototype.getIconViewMarkers=function(){return this._iconViewMarkers},t.prototype.getIconViewsHTML=function(){return this._iconViewsHTML},t.prototype.remove=function(t){this.removeContainer(t),this._iconViewsHTML.delete(t),this._labelsHTML.delete(t),this._iconViewMarkers.delete(t)},t.prototype.removeContainer=function(t){if(this._iconViewsHTML.has(t)){var e=this._iconViewsHTML.get(t);i.DOMUtils.remove(e),e=null}if(this._labelsHTML.has(t)){var r=this._labelsHTML.get(t);i.DOMUtils.remove(r),r=null}},t.prototype.removeAllContainers=function(){this._iconViewsHTML.forEach((function(t){i.DOMUtils.remove(t),t=null})),this._iconViewsHTML.clear(),this._labelsHTML.forEach((function(t){i.DOMUtils.remove(t),t=null})),this._labelsHTML.clear()},t.prototype.destroy=function(){this.removeAllContainers(),this._iconViewMarkers.clear()},t}();e.IconViewMarkerManager=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(2),o=r(25),a=r(15),s=function(){function t(t,e){this._id=t,this._userPOIAnnotation=e;var r=this._userPOIAnnotation.getProperties();r.setId(n.LayerConstants.userPOILayerId+t),r.setAnnotationId(t),this.updateBounds()}return t.prototype.updateTileData=function(t,e){var r=e.addTileLayer(n.LayerConstants.userPOILayerId,i.LayerType.USERPOI),s=this._userPOIAnnotation.getProperties(),l=new o.GeometryCollection([]),u=s.getId();r.addFeature(u,a.GeometryType.Point,l,s)},t.prototype.updateBounds=function(){var t=this._userPOIAnnotation.getPosition();this._minX=t.lng,this._minY=t.lat,this._maxX=t.lng,this._maxY=t.lat},Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t.prototype.getUserPOIAnnotation=function(){return this._userPOIAnnotation},t}();e.UserPOIAnnotationData=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),n=r(0),o=r(25),a=r(15),s=r(6),l=r(12),u=function(){function t(t,e){this._id=t,this._userBuildingAnnotation=e,this._boundsUpdated=!1;var r=this._userBuildingAnnotation.getProperties();r.setId(i.LayerConstants.userBuildingLayerId+t),r.setAnnotationId(t),this.updateBounds()}return t.prototype.updateTileData=function(t,e){var r=e.addTileLayer(i.LayerConstants.userBuildingLayerId,n.LayerType.USERBUILDING),u=this._userBuildingAnnotation.getProperties(),h=new o.GeometryCollection([]),c=u.getCoordinates(),p=u.getId();if(0==c.length)r.addFeature(p,a.GeometryType.Building,h,u);else{for(var f=s.ProjectionMercator.convertToMeterFromLatLng(u.getLocation()),d=[],g=0;g<c.length;++g){var y=c[g],m=s.ProjectionMercator.convertToMeterFromLatLng(y);d.push(new l.Point(m.x-f.x,f.y-m.y))}h.geometryCoordinates.push(d),u.setModelName(p),r.addFeature(p,a.GeometryType.Polygon,h,u)}},t.prototype.updateBounds=function(t){var e=this._userBuildingAnnotation.getPosition();this._minX=e.lng,this._minY=e.lat,this._maxX=e.lng,this._maxY=e.lat,t&&(this._minX=t.minX,this._minY=t.minY,this._maxX=t.maxX,this._maxY=t.maxY,this._boundsUpdated=!0)},Object.defineProperty(t.prototype,"boundsUpdated",{get:function(){return this._boundsUpdated},set:function(t){this._boundsUpdated=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t.prototype.getUserBuildingAnnotation=function(){return this._userBuildingAnnotation},t}();e.UserBuildingAnnotationData=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(23),a=r(11),s=r(1),l=function(t){function e(e,r,i,n,o,l,u,h,c,p,f,d){var g=t.call(this)||this;return g.strokeWidth=e*s.MapUtils.pixelScale,g.strokeColor=a.Color.fromHex(r),g.strokeColor.alpha=i,g.strokeOpacity=i,g.closed=o,g.visible=l,g.draggable=u,g.style=h,g.strokePattern=c,g.elevation=n,g.clickable=p,g.lineCapType=f,g.lineJoinType=d,g}return n(e,t),e.prototype.setId=function(t){this.id=t},e.prototype.getId=function(){return this.id},e.prototype.getStrokeWidth=function(){return this.strokeWidth},e.prototype.setStrokeWidth=function(t){this.strokeWidth=t*s.MapUtils.pixelScale},e.prototype.getStrokeColor=function(){return this.strokeColor},e.prototype.setStrokeColor=function(t){null!=t?(this.strokeColor=a.Color.fromHex(t),this.strokeColor.alpha=this.strokeOpacity):this.strokeColor=new a.Color(255,0,0,this.strokeOpacity)},e.prototype.getStrokeOpacity=function(){return this.strokeOpacity},e.prototype.getStrokePattern=function(){return this.strokePattern},e.prototype.setStrokeOpacity=function(t){this.strokeOpacity=t,this.strokeColor.alpha=t},e.prototype.isVisible=function(){return this.visible},e.prototype.setVisible=function(t){this.visible=t},e.prototype.isClosed=function(){return this.closed},e.prototype.setClosed=function(t){this.closed=t},e.prototype.getElevation=function(){return this.elevation},e.prototype.setElevation=function(t){this.elevation=t},e.prototype.isDraggable=function(){return this.draggable},e.prototype.setDraggable=function(t){this.draggable=t},e.prototype.getStyle=function(){return this.style},e.prototype.setStyle=function(t){this.style=t},e.prototype.setStrokePattern=function(t){this.strokePattern=t},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e.prototype.getLineCapType=function(){return this.lineCapType},e.prototype.getLineJoinType=function(){return this.lineJoinType},e}(o.LayerProperties);e.LineLayerProperties=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(7),n=function(){function t(t,e,r,i,n,o,a,s,l,u){void 0===u&&(u=[]),this.gl=t,this._id=e,this._text=r,this._font=i,this._size=n,this._width=o,this._height=a,this._widthPerLine=s,this._model=l,this._vertices=u}return t.prototype.destroy=function(){i.MapResourceManager.getInstance(this.gl).releaseText(this._id)},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this._font},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"widthPerLine",{get:function(){return this._widthPerLine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),t}();e.TextLabelData=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(139),n=r(41),o=r(2),a=function(){function t(t,e,r,i,n){this.chars=" !&quot;#$%&amp;'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`\\abcdefghijklmnopqrstuvwxyz{|}~ăâđêôơưáàảãạắằẳẵặấầẩẫậéèẻẽẹếềểễệíìỉĩịóòỏõọốồổỗộớờởỡợúùủũụứừửữựýỳỷỹỵĂÂĐÊÔƠƯÁÀẢÃẠẮẰẲẴẶẤẦẨẪẬÉÈẺẼẸẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌỐỒỔỖỘỚỜỞỠỢÚÙỦŨỤỨỪỬỮỰÝỲỶỸỴ",this.gl=t,this._fontSize=e,this.fontImageData=[],this._metrics=new Array(this.chars.length),this.update(e,r,i,n)}return t.prototype.update=function(t,e,r,a){this.fontImageData=new Array(o.FontConstant.fontTextureWidth*o.FontConstant.fontTextureHeight*4).fill(0);var s=t/8,l=t/3,u=o.FontConstant.fontTextureWidth,h=o.FontConstant.fontTextureHeight;this._tinySDFGenerator=new i(t,s,l,e,r,a);for(var c=this._tinySDFGenerator,p=0,f=0;p+c.size<=h&&f<this.chars.length;p+=c.size)for(var d=0;d+c.size<=u&&f<this.chars.length;d+=c.size){var g=this.makeRGBAImageData(c.draw(this.chars[f]),c.size);g&&this.putImageData(g,d,p),this._metrics[this.chars[f]]={x:d,y:p},f++}var y=new Uint8Array(this.fontImageData);this._texture=new n.Texture(this.gl),this._texture.loadImageDataArray(y,u,h,this.gl.LINEAR)},t.prototype.makeRGBAImageData=function(t,e){for(var r=new Array(e*e*4),i=0;i<t.length;i++)r[4*i+0]=t[i],r[4*i+1]=t[i],r[4*i+2]=t[i],r[4*i+3]=255;return r},t.prototype.putImageData=function(t,e,r){for(var i=o.FontConstant.fontTextureWidth,n=this._tinySDFGenerator.size,a=0;a<n;++a)for(var s=0;s<n;++s)this.fontImageData[4*(r+a)*i+(4*e+4*s)]=t[4*a*n+4*s],this.fontImageData[4*(r+a)*i+(4*e+4*s+1)]=t[4*a*n+(4*s+1)],this.fontImageData[4*(r+a)*i+(4*e+4*s+2)]=t[4*a*n+(4*s+2)],this.fontImageData[4*(r+a)*i+(4*e+4*s+3)]=t[4*a*n+(4*s+3)]},Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tinySDFGenerator",{get:function(){return this._tinySDFGenerator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metrics",{get:function(){return this._metrics},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._texture.destroy()},t}();e.FontSDF=a},function(t,e,r){"use strict";t.exports=n;var i=1e20;function n(t,e,r,i,n,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=n||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function o(t,e,r,i,n,o,s){for(var l=0;l<e;l++){for(var u=0;u<r;u++)i[u]=t[u*e+l];for(a(i,n,o,s,r),u=0;u<r;u++)t[u*e+l]=n[u]}for(u=0;u<r;u++){for(l=0;l<e;l++)i[l]=t[u*e+l];for(a(i,n,o,s,e),l=0;l<e;l++)t[u*e+l]=Math.sqrt(n[l])}}function a(t,e,r,n,o){r[0]=0,n[0]=-i,n[1]=+i;for(var a=1,s=0;a<o;a++){for(var l=(t[a]+a*a-(t[r[s]]+r[s]*r[s]))/(2*a-2*r[s]);l<=n[s];)s--,l=(t[a]+a*a-(t[r[s]]+r[s]*r[s]))/(2*a-2*r[s]);r[++s]=a,n[s]=l,n[s+1]=+i}for(a=0,s=0;a<o;a++){for(;n[s+1]<a;)s++;e[a]=(a-r[s])*(a-r[s])+t[r[s]]}}n.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var a=e.data[4*n+3]/255;this.gridOuter[n]=1===a?0:0===a?i:Math.pow(Math.max(0,.5-a),2),this.gridInner[n]=1===a?i:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(o(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),o(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++){var s=this.gridOuter[n]-this.gridInner[n];r[n]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return r}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(26),a=r(15),s=r(0),l=r(53),u=r(1),h=r(3),c=r(27),p=r(22),f=r(40),d=function(t){function e(e,r){var i=t.call(this,s.LayerType.FILL)||this;return i.fillVertices=[],i.fillIndices=[],i.lineVertices=[],i.lineIndices=[],i.gl=r,i.tileLayer=e,i}return n(e,t),e.prototype.getFillModel=function(){return this.fillModel},e.prototype.getLineModel=function(){return this.lineModel},e.prototype.buildPolyline=function(t){var e=this,r=new l.PolylineBuilderContext;r.addVertex=function(t,r,i){e.lineVertices.push(t.x,t.y,r.x,r.y,i.x,i.y)},r.lineCapType=f.LineCapType.Round,r.lineJoinType=f.LineJoinType.Round;for(var i=u.MapUtils.getTileSize(),n=t.featureCount(),o=this.properties,s=0;s<n;++s){var c=t.getFeature(s);if(c.getType()==a.GeometryType.LineString)for(var p=c.getGeometries().geometryCoordinates,d=0;d<p.length;++d){for(var g=[],y=0;y<p[d].length;++y){var m=new h.Vector2(p[d][y][0],p[d][y][1]);m.x=m.x*i,m.y=m.y*i,g.push(m)}r.buildPolyLine(g,null,o.getStrokeWidth()),r.indices.forEach((function(t){return e.lineIndices.push(t)}))}}},e.prototype.buildPolygon=function(t){var e=this,r=this.fillVertices.length/2,i=new l.PolygonBuilderContext;i.addVertex=function(t){e.fillVertices.push(t.x,t.y)};for(var n=u.MapUtils.getTileSize(),o=t.featureCount(),s=0;s<o;++s){var c=t.getFeature(s);if(c.getType()==a.GeometryType.Polygon){for(var p=c.getGeometries().geometryCoordinates,f=[],d=0;d<p.length;++d){for(var g=[],y=0;y<p[d].length;++y){var m=new h.Vector2(p[d][y][0],p[d][y][1]);m.x=m.x*n,m.y=m.y*n,g.push(m)}f.push(g)}l.buildPolygon(f,i),i.indices.forEach((function(t){return e.fillIndices.push(t+r)})),r=this.fillVertices.length/2}}},e.prototype.destroy=function(){this.fillModel&&this.fillModel.destroy(),this.lineModel&&this.lineModel.destroy()},e.prototype.init=function(t){var e=t[0].getProperties();this.setLayerProperties(e),this.buildPolyline(this.tileLayer),this.buildPolygon(this.tileLayer),this.fillModel=new o.Model(this.gl),this.fillModel.init(this.fillVertices,[new c.AttributeInfo("a_position",2,0,2)],this.fillIndices),this.lineModel=new o.Model(this.gl),this.lineModel.init(this.lineVertices,[new c.AttributeInfo("a_position",2,0,6),new c.AttributeInfo("a_extrude",2,2,6),new c.AttributeInfo("a_uv",2,4,6)],this.lineIndices),this.fillVertices=[],this.fillIndices=[],this.lineVertices=[],this.lineIndices=[]},e.prototype.upload=function(t,e){void 0===e&&(e=null)},e}(p.LayerRenderData);e.FillLayerRenderData=d},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(22),a=r(0),s=function(t){function e(e,r){return t.call(this,a.LayerType.CIRCLE)||this}return n(e,t),e.prototype.destroy=function(){},e.prototype.init=function(t){var e=t[0].getProperties();this.setLayerProperties(e)},e.prototype.upload=function(t,e){},e}(o.LayerRenderData);e.CircleLayerRenderData=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(22),a=r(0),s=r(51),l=r(7),u=r(1),h=r(5),c=function(t){function e(e,r){var i=t.call(this,a.LayerType.SYMBOL)||this;return i.gl=r,i.textLabelData=null,i.texture=null,i}return n(e,t),e.prototype.destroy=function(){if(this.textLabelData&&this.textLabelData.destroy(),this.texture){this.texture.release(),this.texture=null;var t=this.properties;l.MapResourceManager.getInstance(this.gl).releaseTexture(t.getId())}},e.prototype.init=function(t){var e=this,r=l.MapResourceManager.getInstance(this.gl),i=t[0].getProperties(),n=i.getMarkerLabel(),o=function(){i.getWidth()<0&&i.setWidth(e.texture.width),i.getHeight()<0&&i.setHeight(e.texture.height)};if(i.isTextureDirty()?(this.texture&&(this.texture.release(),r.releaseTexture(i.getId())),this.texture=r.createMarkerTexture(i.getId(),i.getUrl(),o),i.setTextureDirty(!1)):(this.texture=r.getTexture(i.getId()),this.texture||(this.texture=r.createMarkerTexture(i.getId(),i.getUrl(),o))),this.texture&&this.texture.retain(),this.textLabelData&&(this.textLabelData.destroy(),this.textLabelData=null),n){i.setMarkerLabel(h.Map4dObject.isClassType(n,h.ClassType.MARKER_LABEL)?n:new s.MarkerLabel({text:n}));var a=i.getMarkerLabel();this.textLabelData=l.MapResourceManager.getInstance(this.gl).acquireText(a.getText(),a.getFontSize()*u.MapUtils.pixelScale,a.getFontWeight(),a.getMaxWidth(),a.getLine())}this.setLayerProperties(i)},e.prototype.upload=function(t,e){},e.prototype.getTextLabelData=function(){return this.textLabelData},e.prototype.setTextLabelData=function(t){this.textLabelData=t},e.prototype.getTexture=function(){return this.texture},e}(o.LayerRenderData);e.SymbolLayerRenderData=c},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(90),s=r(7),l=function(t){function e(){return t.call(this,o.LayerType.USERPOI)||this}return n(e,t),e.prototype.init=function(t){var e=t[0].getProperties();this.setLayerProperties(e)},e.prototype.upload=function(t,e){var r=s.MapResourceManager.getInstance(t),i=this.properties,n=i.getId(),o=i.getIcon();null!=o&&(i.isTextureDirty()?(r.releaseTexture(n),this.texture=r.createMarkerTexture(n,o),i.setTextureDirty(!1)):(this.texture=r.getTexture(n),null==this.texture&&(this.texture=r.createMarkerTexture(n,o))))},e.prototype.getTexture=function(){return this.texture},e}(a.POILayerRenderData);e.UserPOILayerRenderData=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(91),a=r(0),s=r(7),l=r(54),u=r(63),h=function(t){function e(){return t.call(this,a.LayerType.USERBUILDING)||this}return n(e,t),e.prototype.upload=function(t,e,r){void 0===r&&(r=null),this.gl=t;var i=this.properties,n=i.getModelName(),o=s.MapResourceManager.getInstance(t);i.isGrowUp()?(o.hasVisibleBuildingId(i.getId())?this.growUpscale=i.growUpscale:i.growUpscale=0,o.retainVisibleBuildingId(i.getId())):this.growUpscale=1,i.updateExtrudeModel&&o.getModel(n)&&(this.model&&(this.model.release(),this.model=null),o.releaseModel(n),i.updateExtrudeModel=!1);var a=s.MapResourceManager.getInstance(t).getModel(n);a&&a.points.length>0&&(i.setCoverPoints(a.points),i.updateBounds(new u.BoundingBox(a.minX,a.minY,a.maxX,a.maxY)),i.onModelLoaded&&i.onModelLoaded(),i.onModelLoaded=null),this.bind(r)},e.prototype.destroy=function(){var e=this.properties;e.isGrowUp()&&s.MapResourceManager.getInstance(this.gl).removeVisibleBuildingId(e.getId()),this.getBuildingType()!=l.BuildingType.Polygon&&t.prototype.destroy.call(this)},e.prototype.updateMatrices=function(e,r){void 0===r&&(r=!1),t.prototype.updateMatrices.call(this,e,r),this.properties.growUpscale=this.growUpscale},e}(o.BuildingLayerRenderData);e.UserBuildingLayerRenderData=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(87),n=r(30),o=function(){function t(){}return t.extrudePolygon=function(e,r){if(!(0==e.length||e[0].length<=2)){var o=[],a=[];t.convertToClockwise(e[0]);var s=[];e[0].forEach((function(t){s.push(t.x),s.push(t.y)}));var l=i.default(s),u=e[0],h=u.length,c=h;l.length;6*(c-0)*1,2*(2*(c-0));for(var p=0,f=0;f<u.length;++f)o.push([u[f].x,r,u[f].y,0,0,0,0,0]);for(f=0;f<l.length;++f)a.push(p+l[f]);var d=c-0,g=2*d;p=o.length;for(var y=0;y<2;++y){var m=0==y?r:0;for(f=0;f<d;++f)for(var v=0;v<2;++v){var _=(f+v)%d+0;o.push([u[_].x,m,u[_].y,0,0,0,0,0])}}for(f=0;f<d;++f)for(var b=0;b<6;++b){v=(t.quadToTriangle[b][0]+2*f)%g;var w=t.quadToTriangle[b][1]+1;a.push((w-1)*g+v+p)}for(var x=0;x<a.length;){var M=a[x++],T=a[x++],A=a[x++],L=new n.Vector3(o[M][0],o[M][1],o[M][2]),S=new n.Vector3(o[T][0],o[T][1],o[T][2]),E=new n.Vector3(o[A][0],o[A][1],o[A][2]),P=S.subtract(L);w=E.subtract(S).cross(P);o[M][5]=o[M][5]+w.x,o[M][6]=o[M][6]+w.y,o[M][7]=o[M][7]+w.z,o[T][5]=o[T][5]+w.x,o[T][6]=o[T][6]+w.y,o[T][7]=o[T][7]+w.z,o[A][5]=o[A][5]+w.x,o[A][6]=o[A][6]+w.y,o[A][7]=o[A][7]+w.z}for(f=0;f<o.length;++f){var C=new n.Vector3(o[f][5],o[f][6],o[f][7]);C=C.normalize(),o[f][5]=C.x,o[f][6]=C.y,o[f][7]=C.z}return{vertices:o,indices:a}}},t.convertToClockwise=function(e){t.calculatePolygonArea(e)>0&&t.reversePoints(e)},t.calculatePolygonArea=function(t){var e=t.length;if(!(e<3)){for(var r=0,i=0,n=e-1;i<e;){var o=t[n].x,a=t[n].y,s=t[i].x,l=t[i].y;n=i,i+=1,r+=o*l-s*a}return r}},t.reversePoints=function(t){for(var e=t.length,r=e/2,i=0;i<r;++i){var n=t[i];t[i]=t[e-i-1],t[e-i-1]=n}},t.quadToTriangle=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]],t}();e.BuildingExtrudeUtils=o},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(147),a=r(26),s=r(15),l=r(0),u=r(53),h=r(1),c=r(3),p=r(27),f=r(11),d=r(148),g=r(4),y=r(40),m=r(5),v=function(t){function e(e,r){var i=t.call(this,l.LayerType.GEOJSON)||this;return i.vertices=[],i.indices=[],i.gl=r,i.partials=new Map,i.fillOutlinedPartials=new Map,i.fillProperties=new Map,i.lineProperties=new Map,i.fillOutlinedProperties=new Map,i.pointCoordinates=new Map,i.buildFillStroke(e),i.buildModel(e),i.model=new a.Model(i.gl),i.model.init(i.vertices,[new p.AttributeInfo("a_position",2,0,4),new p.AttributeInfo("a_extrude",2,2,4)],i.indices),i.vertices=[],i.indices=[],i.initializeProperties(e),i}return n(e,t),e.prototype.getModel=function(){return this.model},e.prototype.getPartials=function(){return this.partials},e.prototype.getFillOutlinedPartials=function(){return this.fillOutlinedPartials},e.prototype.getFillProperties=function(){return this.fillProperties},e.prototype.getLineProperties=function(){return this.lineProperties},e.prototype.getFillOutlinedProperties=function(){return this.fillOutlinedProperties},e.prototype.getPointCoordinates=function(){return this.pointCoordinates},e.prototype.buildFillStroke=function(t){for(var e=h.MapUtils.getTileSize(),r=t.featureCount(),i=0,n=0,o=[],a=0;a<r;++a){var l=t.getFeature(a);if(l.getType()==s.GeometryType.LineString&&!0===l.getProperties().get("fill-outlined")){for(var u=l.getGeometries().geometryCoordinates,p=this.indices.length,f=0;f<u.length;++f){n+=u[f].length;for(var g=0;g<u[f].length;++g){var y=new c.Vector2(u[f][g][0],u[f][g][1]);y.x=y.x*e,y.y=y.y*e,this.vertices.push(y.x),this.vertices.push(y.y),this.vertices.push(0),this.vertices.push(0),i!=n-1?(this.indices.push(i++),this.indices.push(i)):i++}}var v=this.indices.length-p;o.push(new d.Range(p,v));var _="";m.Map4dObject.isClassType(l,m.ClassType.VECTOR_TILE_FEATURE)&&(_=l.getId());var b=this.fillOutlinedPartials.get(_);b?b.push(o):this.fillOutlinedPartials.set(_,[o]),o=[]}}},e.prototype.initializeProperties=function(t){if(m.Map4dObject.isClassType(t,m.ClassType.VECTOR_TILE_LAYER))for(var r=t.featureCount(),i=0;i<r;++i){var n=t.getFeature(i),o=n.getType(),a=n.getProperties(),l=n.getId()||"";if(o==s.GeometryType.Point){var u=a.get("coordinate-lat"),c=a.get("coordinate-lng");if(null==u||null==c){console.warn("Point feature does not have coordinate");continue}this.pointCoordinates.has(l)?this.pointCoordinates.get(l).push(new g.LatLng(u,c)):this.pointCoordinates.set(l,[new g.LatLng(u,c)])}else if(o==s.GeometryType.LineString)if(null==a)this.lineProperties.set(l,{strokeColor:e.defaultStrokeColor,strokeWidth:e.defaultStrokeWidth*h.MapUtils.pixelScale});else if(a.has("fill-outlined")){var p=a.get("stroke")||"#555555",d=a.has("stroke-opacity")?a.get("stroke-opacity"):1;(y=f.Color.fromHex(p)).alpha=d,this.fillOutlinedProperties.set(l,{strokeColor:y})}else{var y,v=a.get("stroke")||"#555555",_=a.has("stroke-opacity")?a.get("stroke-opacity"):1;(y=f.Color.fromHex(v)).alpha=_;var b=a.has("stroke-width")?a.get("stroke-width"):e.defaultStrokeWidth;b*=h.MapUtils.pixelScale,this.lineProperties.set(l,{strokeColor:y,strokeWidth:b})}else if(a){v=a.get("fill")||"#555555",_=a.has("fill-opacity")?a.get("fill-opacity"):.5;var w=f.Color.fromHex(v);w.alpha=_,this.fillProperties.set(l,{fillColor:w})}else this.fillProperties.set(l,{fillColor:e.defaultFillColor})}},e.prototype.buildModel=function(t){var e=this,r=this.vertices.length/4,i=0,n=new u.PolygonBuilderContext;n.addVertex=function(t){e.vertices.push(t.x,t.y,0,0),++i};var o=new u.PolylineBuilderContext;o.addVertex=function(t,r){e.vertices.push(t.x,t.y,r.x,r.y),++i},o.lineCapType=y.LineCapType.Butt,o.lineJoinType=y.LineJoinType.Round;for(var a=h.MapUtils.getTileSize(),l=t.featureCount(),p=0;p<l;++p){var f=t.getFeature(p),g=f.getProperties(),v=f.getType();if(v==s.GeometryType.Point);else if(v==s.GeometryType.Polygon){for(var _=this.indices.length,b=f.getGeometries().geometryCoordinates,w=[],x=0;x<b.length;++x){for(var M=[],T=0;T<b[x].length;++T){(E=new c.Vector2(b[x][T][0],b[x][T][1])).x=E.x*a,E.y=E.y*a,M.push(E)}w.push(M)}n.clear(),u.buildPolygon(w,n);var A="";m.Map4dObject.isClassType(f,m.ClassType.VECTOR_TILE_FEATURE)&&(A=f.getId()),n.indices.forEach((function(t){return e.indices.push(t+r)})),r+=i,i=0;var L=this.indices.length-_;this.partials.has(A)?this.partials.get(A).push(new d.Range(_,L)):this.partials.set(A,[new d.Range(_,L)])}else{if(null==g||g.has("fill-outlined"))continue;o.clear();for(_=this.indices.length,b=f.getGeometries().geometryCoordinates,x=0;x<b.length;++x){var S=[];for(T=0;T<b[x].length;++T){var E;(E=new c.Vector2(b[x][T][0],b[x][T][1])).x=E.x*a,E.y=E.y*a,S.push(E)}o.buildPolyLine(S)}o.indices.forEach((function(t){return e.indices.push(t+r)})),r+=i,i=0;L=this.indices.length-_,A="";m.Map4dObject.isClassType(f,m.ClassType.VECTOR_TILE_FEATURE)&&(A=f.getId()),this.partials.set(A,[new d.Range(_,L)])}}},e.prototype.destroy=function(){this.model&&this.model.destroy()},e.defaultFillColor=f.Color.fromHex("#555555"),e.defaultStrokeColor=f.Color.fromHex("#555555"),e.defaultStrokeWidth=5,e}(o.LayerData);e.GeoJsonLayerData=v},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.layerType=t}return t.prototype.getType=function(){return this.layerType},t}();e.LayerData=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this._start=t,this._length=e}return Object.defineProperty(t.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),t}();e.Range=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var r=t.call(this)||this;return r.data=e.data,r.width=e.width,r.height=e.height,r}return n(e,t),e.prototype.getData=function(){return this.data},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e}(r(23).LayerProperties);e.RasterLayerProperties=o},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(22),a=r(0),s=r(41),l=function(t){function e(){var e=t.call(this,a.LayerType.RASTER)||this;return e.texture=null,e}return n(e,t),e.prototype.destroy=function(){this.texture&&this.texture.destroy()},e.prototype.init=function(t){if(t&&t.length>0){var e=t[0];this.properties=e.getProperties()}},e.prototype.upload=function(t,e){if(this.properties){var r=this.properties;this.texture=new s.Texture(t),this.texture.loadImageFromArrayBuffer(r.getData(),r.getWidth(),r.getHeight(),!1,(function(){}))}},e.prototype.getTexture=function(){return this.texture},e}(o.LayerRenderData);e.RasterLayerRenderData=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(152),n=r(42),o=r(95),a=r(0),s=r(153),l=r(154),u=r(67),h=r(25),c=r(33),p=function(){function t(){}return t.build=function(t,e,r,p,f){var d=t.getTileRenderData();for(var g in e){var y=e[g],m=y.layerType;switch(m){case a.LayerType.LABEL:var v=new h.GeometryCollection(y.geometries||[]);switch(y.labelType){case n.LabelType.PLACE:case n.LabelType.ROAD:(M=new n.LabelLayerProperties(y.layer,y.labelType,y,p)).setZoom(t.getTileCoordinate().getZoom()),(T=new s.LabelLayerRenderData(r)).build(v,y.geometryType,M),d.setLayerRenderData(g,T);break;case n.LabelType.BOUNDARY:var _=new i.BoundaryLabelLayerProperties(y.nameLeft,y.layer,"left",y,p);_.setZoom(t.getTileCoordinate().getZoom()),_.align=c.TextAlign.top;var b=new s.LabelLayerRenderData(r);b.build(v,y.geometryType,_),b.isValid()&&d.setLayerRenderData(_.getId(),b);var w=new i.BoundaryLabelLayerProperties(y.nameRight,y.layer,"right",y,p);_.setZoom(t.getTileCoordinate().getZoom()),w.align=c.TextAlign.bottom;var x=new s.LabelLayerRenderData(r);x.build(v,y.geometryType,w),x.isValid()&&d.setLayerRenderData(w.getId(),x),_.otherSide=w,w.otherSide=_}break;case a.LayerType.ROADS:var M=new o.VectorLayerProperties(g,y.layer,y,p);(T=new l.RoadLayerRenderData(r)).build(new Float32Array(y.vertices),new Uint32Array(y.indices),M,f),d.setLayerRenderData(g,T);break;case a.LayerType.BOUNDARY:case a.LayerType.SURFACE:var T;M=new o.VectorLayerProperties(g,y.layer,y,p);(T=new u.SurfaceLayerRenderData(m,r)).build(new Float32Array(y.vertices),new Uint32Array(y.indices),M,y.geometryType,f),d.setLayerRenderData(g,T)}}},t}();e.VectorTileParserBuilder=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(57),a=r(42),s=function(t){function e(e,r,i,n,o){var s=t.call(this,r,a.LabelType.BOUNDARY,n,o)||this;return s.id=s.id+"|"+i,s.name=e,s.visible=!1,s}return n(e,t),e.prototype.setId=function(t){this.id=t},e.getNameLeft=function(t,e){return t[e==o.MapLanguage.vi?"name:left:vi":"name:left:en"]||t["name:left"]},e.getNameRight=function(t,e){return t[e==o.MapLanguage.vi?"name:right:vi":"name:right:en"]||t["name:right"]},e.prototype.isVisible=function(){return!!this._otherSide&&(this.visible&&this._otherSide.visible)},Object.defineProperty(e.prototype,"otherSide",{get:function(){return this._otherSide},set:function(t){this._otherSide=t},enumerable:!0,configurable:!0}),e}(a.LabelLayerProperties);e.BoundaryLabelLayerProperties=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(15),s=r(22),l=r(42),u=r(46),h=r(1),c=r(20),p=r(8),f=r(3),d=r(33),g=r(16),y=function(t){function e(e){var r=t.call(this,o.LayerType.LABEL)||this;return r.gl=e,r.lineCoords=[],r.screenLineCoords=[],r}return n(e,t),e.prototype.init=function(t){if(0!=t.length)for(var e=h.MapUtils.getTileSize(),r=0;r<t.length;++r){var i=t[r];if(i.getType()==a.GeometryType.Point||i.getType()==a.GeometryType.LineString)if(this.properties=i.getProperties(),this.properties){if(i.getType()==a.GeometryType.Point)return;for(var n=i.getGeometries().geometryCoordinates,o=0;o<n.length;++o){for(var s=0;s<n[o].length;++s){var l=new u(n[o][s][0],n[o][s][1]);l.x*=e,l.y*=e,this.lineCoords.push(l)}break}this.pathLength=this.calculatePathLength(this.lineCoords);break}}},e.prototype.upload=function(t,e){},e.prototype.destroy=function(){},e.prototype.isValid=function(){var t=this.properties;return t.getLabelType()==l.LabelType.PLACE||this.pathLength>=d.TextLabelFactory.measureTextLength(t.getName(),t.getFontSize())},e.prototype.build=function(t,e,r){var i=h.MapUtils.getTileSize();if(this.properties=r,e!=a.GeometryType.Point){for(var n=t.geometryCoordinates,o=0;o<n.length;++o){for(var s=0;s<n[o].length;++s){var l=new u(n[o][s][0],n[o][s][1]);l.x*=i,l.y*=i,this.lineCoords.push(l)}break}this.pathLength=this.calculatePathLength(this.lineCoords)}},e.prototype.calculatePathLength=function(t){for(var e=0,r=0;r<t.length-1;++r){var i=t[r];e+=t[r+1].dist(i)}return e},e.prototype.setTextData=function(t){this.textData=t},e.prototype.getTextData=function(){return this.textData},e.prototype.setCameraPosition=function(t){var e=!1;return this.camera?this.camera.getTilt()!=t.getTilt()||this.camera.getBearing()!=t.getBearing()||this.camera.getZoom()!=t.getZoom()?e=!0:this.camera.getTarget().equals(t.getTarget())||0!=t.getTilt()&&(e=!0):(this.camera=new c.CameraPosition([0,0],0,0,0),e=!0),e&&(this.camera.setTarget(t.getTarget()),this.camera.setTilt(t.getTilt()),this.camera.setBearing(t.getBearing()),this.camera.setZoom(t.getZoom())),e},e.prototype.buildScreenLineCoords=function(t,e,r,i){var n=this;this.screenLineCoords=[],this.lineCoords.forEach((function(o){var a=p.GeometryUtils.pixelCoordinateToScreenCoordinate(new f.Vector2(r.x+o.x*i,r.y-o.y*i),t,e,0);n.screenLineCoords.push(new u(a.x,a.y))})),this.pathLength=this.calculatePathLength(this.screenLineCoords)},e.prototype.getScreenLineCoords=function(){return this.screenLineCoords},e.prototype.getLineCoordinates=function(){return this.lineCoords},e.prototype.getScreenCoordinate=function(){return this.screenCoordinate},e.prototype.setScreenCoordinate=function(t){this.screenCoordinate=t},e.prototype.getOrder=function(){if(!this.order){var t=this.getLayerProperties();this.order=new g.Order(t.getId(),t.getSortRank())}return this.order},e}(s.LayerRenderData);e.LabelLayerRenderData=y},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(26),a=r(27),s=r(0),l=r(22),u=r(7),h=r(66),c=r(16),p=function(t){function e(e){var r=t.call(this,s.LayerType.ROADS)||this;return r.gl=e,r}return n(e,t),e.prototype.init=function(t){},e.prototype.upload=function(t,e){},e.prototype.destroy=function(){this.model&&this.model.destroy(),this.texture&&(this.texture.release(),this.texture=null,u.MapResourceManager.getInstance(this.gl).releaseTexture(this.textureId))},e.prototype.getModel=function(){return this.model},e.prototype.getTexture=function(){return this.texture},e.prototype.build=function(t,e,r,i){this.properties=r,this.model=new o.Model(this.gl),this.model.init(t,[new a.AttributeInfo("a_position",2,0,6),new a.AttributeInfo("a_extrude",2,2,6),new a.AttributeInfo("a_uv",2,4,6)],e);var n=h.PolylineUtils.createPatternTexture(r,i,u.MapResourceManager.getInstance(this.gl));n&&(this.textureId=n.textureId,this.texture=n.texture,this.texture.retain())},e.prototype.getOrder=function(){return this.order},e.prototype.createOrder=function(t){var e=this.getLayerProperties();return this.order=new c.Order(t,e.getSortRank()),this.order},e}(l.LayerRenderData);e.RoadLayerRenderData=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(35),n=r(156),o=r(45),a=r(32),s=r(157),l=r(158),u=function(){function t(){var e=this;this.maxConcurrentRequest=5,this.maxWorker=3,this.workers=[],this.pendingTasks=[],this.activedTasks=[],this.isDestroy=!1,t.createWorker(this.maxWorker,(function(t){e.onCompletionTask(t)}),(function(t){if(e.isDestroy)for(var r=0,i=t;r<i.length;r++){i[r].terminate()}else e.workers=t,e.executeTasks()}));for(var r=0;r<a.Resource.MAX;r++)this.pendingTasks.push([])}return t.getSharedInstance=function(){return globalThis.map4dshared||(globalThis.map4dshared={task:new t,mapCount:0}),globalThis.map4dshared.mapCount++,globalThis.map4dshared.task},Object.defineProperty(t,"workerSource",{get:function(){return l.default.replace("__HEADER_SIGNATURE__","web-"+i.Env.sdkVersion+"-"+o.MapSettings.getSignature)},enumerable:!0,configurable:!0}),t.createWorker=function(e,r,i){if(!globalThis.map4dshared){for(var n=new Blob([t.workerSource],{type:"application/javascript"}),o=window.URL.createObjectURL(n),a=[],l=function(t){var e=new Worker(o),i=new s.TaskWorker(e),n=new MessageChannel;e.postMessage("start-channel",[n.port1]),n.port2.onmessage=function(t){var e=t.data;i.finishedTask(),r(e)},a.push(i)},u=0;u<e;u++)l();i(a)}},t.prototype.postTask=function(t){this.pendingTasks[t.type].unshift(t),this.executeTasks()},t.prototype.executeTasks=function(){if(!(this.activedTasks.length>this.maxConcurrentRequest))for(var t=0,e=this.workers;t<e.length;t++){var r=e[t];if(r.canExecuteTask()&&this.hasTask()){var i=this.getTask();this.activedTasks.push(i),i.worker=r,r.executeTask(i)}}},t.prototype.hasTask=function(){if(this.pendingTasks.length<1)return!1;for(var t=0;t<a.Resource.MAX;t++)if(this.pendingTasks[t].length>0)return!0;return!1},t.prototype.getTask=function(){for(var t=0;t<a.Resource.MAX;t++)if(this.pendingTasks[t].length>0)return this.pendingTasks[t].pop();return null},t.prototype.cancelTask=function(t){if(t){var e=this.removeTask(t.id);null!=e&&(e.worker&&e.worker.cancel(e),e.completion&&e.completion(new a.ResponseTask(t.id)))}},t.prototype.onCompletionTask=function(t){var e=this.activedTasks.findIndex((function(e){return e.id==t.id}));if(e<0)this.executeTasks();else{var r=this.activedTasks[e];this.activedTasks.splice(e,1),r.completion&&r.completion(t),this.executeTasks()}},t.prototype.removeTask=function(t){for(var e=0;e<a.Resource.MAX;e++){var r=this.pendingTasks[e].findIndex((function(e){return e.id==t}));if(r>=0){var i=this.pendingTasks[e][r];return this.pendingTasks[e].splice(r,1),i}}var n=this.activedTasks.findIndex((function(e){return e.id==t}));if(n>=0){i=this.activedTasks[n];return this.activedTasks.splice(n,1),i}return null},t.prototype.destroy=function(){if(globalThis.map4dshared.mapCount--,!(globalThis.map4dshared.mapCount>0)){delete globalThis.map4dshared,this.isDestroy=!0;for(var t=0,e=this.workers;t<e.length;t++){e[t].terminate()}}},t}();if(e.TaskManager=u,!n.Thread.isWorker){document.currentScript.onload=function(t){var e=null!=t.path&&t.path.length>0?t.path[0].src:null,r=null!=t.currentTarget?t.currentTarget.src:null,i=null!=t.target?t.target.src:null,n=function(t){if(!t)return{};var e=t.substr(1),r={};return e.split("&").forEach((function(t){var e=t.split("=");r[e[0]]=decodeURIComponent(e[1])})),r}(e||r||i),o=window.__INIT_MAP__||window[n.callback];o&&o()}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return Object.defineProperty(t,"isWorker",{get:function(){try{return!window.document}catch(t){return!0}},enumerable:!0,configurable:!0}),t}();e.Thread=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.maxTask=3,this.numberOfRunningTask=0,this.worker=t}return t.prototype.finishedTask=function(){this.numberOfRunningTask=Math.max(this.numberOfRunningTask-1,0)},t.prototype.canExecuteTask=function(){return this.numberOfRunningTask<this.maxTask},t.prototype.executeTask=function(t){if(this.canExecuteTask()){var e={execute:!0,payload:JSON.stringify(t)};this.worker.postMessage(e),this.numberOfRunningTask+=1}},t.prototype.cancel=function(t){var e={execute:!1,payload:JSON.stringify(t)};this.worker.postMessage(e),this.numberOfRunningTask=Math.max(this.numberOfRunningTask-1,0)},t.prototype.terminate=function(){this.worker.terminate()},t}();e.TaskWorker=i},function(t,e,r){"use strict";r.r(e),e.default='/*! worker@1.1.1 */\r\nvar map4d_worker=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=56)}([function(t,e,r){"use strict";(function(t){\r\n/*!\r\n * The buffer module from node.js, for the browser.\r\n *\r\n * @author   Feross Aboukhadijeh <http://feross.org>\r\n * @license  MIT\r\n */\r\nvar n=r(61),i=r(27),o=r(28);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return h(this,t,e,r)}function h(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=c(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(t,0):c(t,e);if("Buffer"===e.type&&o(e.data))return c(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function f(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function l(t,e){if(f(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function c(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return j(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return L(this,e,r);case"utf8":case"utf-8":return T(this,e,r);case"ascii":return P(this,e,r);case"latin1":case"binary":return A(this,e,r);case"base64":return S(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function h(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var f=-1;for(o=r;o<s;o++)if(h(t,o)===h(e,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===u)return f*a}else-1!==f&&(o-=o-f),f=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var l=!0,c=0;c<u;c++)if(h(t,o+c)!==h(e,c)){l=!1;break}if(l)return o}return-1}function _(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function w(t,e,r,n){return Z(N(e,t.length-r),t,r,n)}function b(t,e,r,n){return Z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function x(t,e,r,n){return b(t,e,r,n)}function E(t,e,r,n){return Z(j(e),t,r,n)}function k(t,e,r,n){return Z(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function S(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function T(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,h=t[i],f=null,l=h>239?4:h>223?3:h>191?2:1;if(i+l<=r)switch(l){case 1:h<128&&(f=h);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&h)<<6|63&o)>127&&(f=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&h)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&h)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(f=u)}null===f?(f=65533,l=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return h(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return f(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return l(null,t)},u.allocUnsafeSlow=function(t){return l(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?T(this,0,t):g.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),h=this.slice(n,i),f=t.slice(e,r),l=0;l<s;++l)if(h[l]!==f[l]){o=h[l],a=f[l];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return _(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return b(this,t,e,r);case"latin1":case"binary":return x(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function L(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=z(t[o]);return i}function I(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function O(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function R(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function C(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function B(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,o){return o||B(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function D(t,e,r,n,o){return o||B(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||M(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||M(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||M(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||M(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||M(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||M(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||M(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||M(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||M(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||M(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||M(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||M(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||M(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):C(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):C(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=u.isBuffer(t)?t:N(new u(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var F=/[^+\\/0-9A-Za-z-_]/g;function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function j(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}(t).replace(F,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(4))},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,h=[],f=!1,l=-1;function c(){f&&u&&(f=!1,u.length?h=u.concat(h):l=-1,h.length&&d())}function d(){if(!f){var t=s(c);f=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,f=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new p(t,e)),1!==h.length||f||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){(function(t){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++)r[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return r},i=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(s(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,o=n.length,a=String(t).replace(i,(function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}})),u=n[r];r<o;u=n[++r])g(u)||!w(u)?a+=" "+u:a+=" "+s(u);return a},e.deprecate=function(r,n){if(void 0!==t&&!0===t.noDeprecation)return r;if(void 0===t)return function(){return e.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var o,a={};function s(t,r){var n={seen:[],stylize:h};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&e._extend(n,r),m(n.showHidden)&&(n.showHidden=!1),m(n.depth)&&(n.depth=2),m(n.colors)&&(n.colors=!1),m(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,t,n.depth)}function u(t,e){var r=s.styles[e];return r?"["+s.colors[r][0]+"m"+t+"["+s.colors[r][1]+"m":t}function h(t,e){return t}function f(t,r,n){if(t.customInspect&&r&&E(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return y(i)||(i=f(t,i,n)),i}var o=function(t,e){if(m(e))return t.stylize("undefined","undefined");if(y(e)){var r="\'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\')+"\'";return t.stylize(r,"string")}if(v(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,r);if(o)return o;var a=Object.keys(r),s=function(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),x(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(r);if(0===a.length){if(E(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if(_(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(b(r))return t.stylize(Date.prototype.toString.call(r),"date");if(x(r))return l(r)}var h,w="",k=!1,S=["{","}"];(d(r)&&(k=!0,S=["[","]"]),E(r))&&(w=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(w=" "+RegExp.prototype.toString.call(r)),b(r)&&(w=" "+Date.prototype.toUTCString.call(r)),x(r)&&(w=" "+l(r)),0!==a.length||k&&0!=r.length?n<0?_(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),h=k?function(t,e,r,n,i){for(var o=[],a=0,s=e.length;a<s;++a)A(e,String(a))?o.push(c(t,e,r,n,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\\d+$/)||o.push(c(t,e,r,n,i,!0))})),o}(t,r,n,s,a):a.map((function(e){return c(t,r,n,s,e,k)})),t.seen.pop(),function(t,e,r){if(t.reduce((function(t,e){return e.indexOf("\\n")>=0&&0,t+e.replace(/\\u001b\\[\\d\\d?m/g,"").length+1}),0)>60)return r[0]+(""===e?"":e+"\\n ")+" "+t.join(",\\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(h,w,S)):S[0]+w+S[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function c(t,e,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?s=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),A(n,i)||(a="["+i+"]"),s||(t.seen.indexOf(u.value)<0?(s=g(r)?f(t,u.value,null):f(t,u.value,r-1)).indexOf("\\n")>-1&&(s=o?s.split("\\n").map((function(t){return"  "+t})).join("\\n").substr(2):"\\n"+s.split("\\n").map((function(t){return"   "+t})).join("\\n")):s=t.stylize("[Circular]","special")),m(a)){if(o&&i.match(/^\\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\').replace(/(^"|"$)/g,"\'"),a=t.stylize(a,"string"))}return a+": "+s}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function g(t){return null===t}function v(t){return"number"==typeof t}function y(t){return"string"==typeof t}function m(t){return void 0===t}function _(t){return w(t)&&"[object RegExp]"===k(t)}function w(t){return"object"==typeof t&&null!==t}function b(t){return w(t)&&"[object Date]"===k(t)}function x(t){return w(t)&&("[object Error]"===k(t)||t instanceof Error)}function E(t){return"function"==typeof t}function k(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(r){if(m(o)&&(o=t.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\\\b"+r+"\\\\b","i").test(o)){var n=t.pid;a[r]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",r,n,t)}}else a[r]=function(){};return a[r]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=p,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=m,e.isRegExp=_,e.isObject=w,e.isDate=b,e.isError=x,e.isFunction=E,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(69);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",P(),e.format.apply(e,arguments))},e.inherits=r(70),e._extend=function(t,e){if(!e||!w(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t};var L="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function I(t,e){if(!t){var r=new Error("Promise was rejected with a falsy value");r.reason=t,t=r}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError(\'The "original" argument must be of type Function\');if(L&&t[L]){var e;if("function"!=typeof(e=t[L]))throw new TypeError(\'The "util.promisify.custom" argument must be of type Function\');return Object.defineProperty(e,L,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,r,n=new Promise((function(t,n){e=t,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(t,n){t?r(t):e(n)}));try{t.apply(this,i)}catch(t){r(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),L&&Object.defineProperty(e,L,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=L,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError(\'The "original" argument must be of type Function\');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};e.apply(this,r).then((function(e){t.nextTick(a,null,e)}),(function(e){t.nextTick(I,e,a)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.defineProperties(r,n(e)),r}}).call(this,r(1))},function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},a={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,o)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(n)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n=r(13),i=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};t.exports=l;var o=Object.create(r(8));o.inherits=r(7);var a=r(30),s=r(19);o.inherits(l,a);for(var u=i(s.prototype),h=0;h<u.length;h++){var f=u[h];l.prototype[f]||(l.prototype[f]=s.prototype[f])}function l(t){if(!(this instanceof l))return new l(t);a.call(this,t),s.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",c)}function c(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),l.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolyConstants=e.MapConstants=void 0;var n=r(52),i=function(){function t(){}return t.baseTileSize=256,t.radiusEarthMeters=6378137,t.placeWidth=26,t.placeHeight=32,t.defaultMinZoom=3,t.defaultMinZoom3d=17,t.defaultMaxZoom=22,t.defaultMaxNativeZoom=19,t.vectorBuildingsMinZoom=17,t.tileExtend=4096,t.mapBackgroundColor2D=n.Color.fromHex("#f2efe9"),t}();e.MapConstants=i;var o=function(){function t(){}return t.numTrianglesOnRoundCap=6,t.numTrianglesOnRoundJoin=5,t.numTrianglesPerCircle=4,t}();e.PolyConstants=o},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}},function(t,e,r){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(0).Buffer.isBuffer},function(t,e,r){"use strict";(function(t){var n=r(0).Buffer,i=r(12).Transform,o=r(83),a=r(2),s=r(20).ok,u=r(0).kMaxLength,h="Cannot create final Buffer. It would be larger than 0x"+u.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var f=Object.keys(o),l=0;l<f.length;l++){var c=f[l];c.match(/^Z/)&&Object.defineProperty(e,c,{enumerable:!0,value:o[c],writable:!1})}for(var d={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},p=Object.keys(d),g=0;g<p.length;g++){var v=p[g];d[d[v]]=v}function y(t,e,r){var i=[],o=0;function a(){for(var e;null!==(e=t.read());)i.push(e),o+=e.length;t.once("readable",a)}function s(){var e,a=null;o>=u?a=new RangeError(h):e=n.concat(i,o),i=[],t.close(),r(a,e)}t.on("error",(function(e){t.removeListener("end",s),t.removeListener("readable",a),r(e)})),t.on("end",s),t.end(e),a()}function m(t,e){if("string"==typeof e&&(e=n.from(e)),!n.isBuffer(e))throw new TypeError("Not a string or buffer");var r=t._finishFlushFlag;return t._processChunk(e,r)}function _(t){if(!(this instanceof _))return new _(t);P.call(this,t,o.DEFLATE)}function w(t){if(!(this instanceof w))return new w(t);P.call(this,t,o.INFLATE)}function b(t){if(!(this instanceof b))return new b(t);P.call(this,t,o.GZIP)}function x(t){if(!(this instanceof x))return new x(t);P.call(this,t,o.GUNZIP)}function E(t){if(!(this instanceof E))return new E(t);P.call(this,t,o.DEFLATERAW)}function k(t){if(!(this instanceof k))return new k(t);P.call(this,t,o.INFLATERAW)}function S(t){if(!(this instanceof S))return new S(t);P.call(this,t,o.UNZIP)}function T(t){return t===o.Z_NO_FLUSH||t===o.Z_PARTIAL_FLUSH||t===o.Z_SYNC_FLUSH||t===o.Z_FULL_FLUSH||t===o.Z_FINISH||t===o.Z_BLOCK}function P(t,r){var a=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||e.Z_DEFAULT_CHUNK,i.call(this,t),t.flush&&!T(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!T(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:o.Z_FINISH,t.chunkSize&&(t.chunkSize<e.Z_MIN_CHUNK||t.chunkSize>e.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<e.Z_MIN_WINDOWBITS||t.windowBits>e.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<e.Z_MIN_LEVEL||t.level>e.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<e.Z_MIN_MEMLEVEL||t.memLevel>e.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=e.Z_FILTERED&&t.strategy!=e.Z_HUFFMAN_ONLY&&t.strategy!=e.Z_RLE&&t.strategy!=e.Z_FIXED&&t.strategy!=e.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!n.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(r);var s=this;this._hadError=!1,this._handle.onerror=function(t,r){A(s),s._hadError=!0;var n=new Error(t);n.errno=r,n.code=e.codes[r],s.emit("error",n)};var u=e.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(u=t.level);var h=e.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(h=t.strategy),this._handle.init(t.windowBits||e.Z_DEFAULT_WINDOWBITS,u,t.memLevel||e.Z_DEFAULT_MEMLEVEL,h,t.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=u,this._strategy=h,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!a._handle},configurable:!0,enumerable:!0})}function A(e,r){r&&t.nextTick(r),e._handle&&(e._handle.close(),e._handle=null)}function L(t){t.emit("close")}Object.defineProperty(e,"codes",{enumerable:!0,value:Object.freeze(d),writable:!1}),e.Deflate=_,e.Inflate=w,e.Gzip=b,e.Gunzip=x,e.DeflateRaw=E,e.InflateRaw=k,e.Unzip=S,e.createDeflate=function(t){return new _(t)},e.createInflate=function(t){return new w(t)},e.createDeflateRaw=function(t){return new E(t)},e.createInflateRaw=function(t){return new k(t)},e.createGzip=function(t){return new b(t)},e.createGunzip=function(t){return new x(t)},e.createUnzip=function(t){return new S(t)},e.deflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new _(e),t,r)},e.deflateSync=function(t,e){return m(new _(e),t)},e.gzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new b(e),t,r)},e.gzipSync=function(t,e){return m(new b(e),t)},e.deflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new E(e),t,r)},e.deflateRawSync=function(t,e){return m(new E(e),t)},e.unzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new S(e),t,r)},e.unzipSync=function(t,e){return m(new S(e),t)},e.inflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new w(e),t,r)},e.inflateSync=function(t,e){return m(new w(e),t)},e.gunzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new x(e),t,r)},e.gunzipSync=function(t,e){return m(new x(e),t)},e.inflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),y(new k(e),t,r)},e.inflateRawSync=function(t,e){return m(new k(e),t)},a.inherits(P,i),P.prototype.params=function(r,n,i){if(r<e.Z_MIN_LEVEL||r>e.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+r);if(n!=e.Z_FILTERED&&n!=e.Z_HUFFMAN_ONLY&&n!=e.Z_RLE&&n!=e.Z_FIXED&&n!=e.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==r||this._strategy!==n){var a=this;this.flush(o.Z_SYNC_FLUSH,(function(){s(a._handle,"zlib binding closed"),a._handle.params(r,n),a._hadError||(a._level=r,a._strategy=n,i&&i())}))}else t.nextTick(i)},P.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},P.prototype._flush=function(t){this._transform(n.alloc(0),"",t)},P.prototype.flush=function(e,r){var i=this,a=this._writableState;("function"==typeof e||void 0===e&&!r)&&(r=e,e=o.Z_FULL_FLUSH),a.ended?r&&t.nextTick(r):a.ending?r&&this.once("end",r):a.needDrain?r&&this.once("drain",(function(){return i.flush(e,r)})):(this._flushFlag=e,this.write(n.alloc(0),"",r))},P.prototype.close=function(e){A(this,e),t.nextTick(L,this)},P.prototype._transform=function(t,e,r){var i,a=this._writableState,s=(a.ending||a.ended)&&(!t||a.length===t.length);return null===t||n.isBuffer(t)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,t.length>=a.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(t,i,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},P.prototype._processChunk=function(t,e,r){var i=t&&t.length,o=this._chunkSize-this._offset,a=0,f=this,l="function"==typeof r;if(!l){var c,d=[],p=0;this.on("error",(function(t){c=t})),s(this._handle,"zlib binding closed");do{var g=this._handle.writeSync(e,t,a,i,this._buffer,this._offset,o)}while(!this._hadError&&m(g[0],g[1]));if(this._hadError)throw c;if(p>=u)throw A(this),new RangeError(h);var v=n.concat(d,p);return A(this),v}s(this._handle,"zlib binding closed");var y=this._handle.write(e,t,a,i,this._buffer,this._offset,o);function m(u,h){if(this&&(this.buffer=null,this.callback=null),!f._hadError){var c=o-h;if(s(c>=0,"have should not go down"),c>0){var g=f._buffer.slice(f._offset,f._offset+c);f._offset+=c,l?f.push(g):(d.push(g),p+=g.length)}if((0===h||f._offset>=f._chunkSize)&&(o=f._chunkSize,f._offset=0,f._buffer=n.allocUnsafe(f._chunkSize)),0===h){if(a+=i-u,i=u,!l)return!0;var v=f._handle.write(e,t,a,i,f._buffer,f._offset,f._chunkSize);return v.callback=m,void(v.buffer=t)}if(!l)return!1;r()}}y.buffer=t,y.callback=m},a.inherits(_,P),a.inherits(w,P),a.inherits(b,P),a.inherits(x,P),a.inherits(E,P),a.inherits(k,P),a.inherits(S,P)}).call(this,r(1))},function(t,e,r){"use strict";t.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;var n=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),t.prototype.normalize=function(){var e=this.length,r=0,n=0;return e>0&&(r=this.x/e,n=this.y/e),new t(r,n)},t.prototype.set=function(t){this.x=t.x,this.y=t.y},t.prototype.invert=function(){return new t(-this.x,-this.y)},t.prototype.rotate90=function(){return new t(this.y,-this.x)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y)},t.prototype.rotateBy=function(e){var r=Math.cos(e*Math.PI/180),n=Math.sin(e*Math.PI/180);return new t(this.x*r-this.y*n,this.x*n+this.y*r)},t.prototype.rotateByRadian=function(e){var r=Math.cos(e),n=Math.sin(e);return new t(this.x*r-this.y*n,this.x*n+this.y*r)},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y},t.perp=function(e,r){return new t(r[1]-e[1],e[0]-r[0])},t.neg=function(e){return new t(-e.x,-e.y)},t}();e.Vector2=n},function(t,e,r){t.exports=i;var n=r(17).EventEmitter;function i(){n.call(this)}r(7)(i,n),i.Readable=r(18),i.Writable=r(78),i.Duplex=r(79),i.Transform=r(80),i.PassThrough=r(81),i.Stream=i,i.prototype.pipe=function(t,e){var r=this;function i(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),t.on("drain",o),t._isStdio||e&&!1===e.end||(r.on("end",s),r.on("close",u));var a=!1;function s(){a||(a=!0,t.end())}function u(){a||(a=!0,"function"==typeof t.destroy&&t.destroy())}function h(t){if(f(),0===n.listenerCount(this,"error"))throw t}function f(){r.removeListener("data",i),t.removeListener("drain",o),r.removeListener("end",s),r.removeListener("close",u),r.removeListener("error",h),t.removeListener("error",h),r.removeListener("end",f),r.removeListener("close",f),t.removeListener("close",f)}return r.on("error",h),t.on("error",h),r.on("end",f),r.on("close",f),t.on("close",f),t.emit("pipe",r),t}},function(t,e,r){"use strict";(function(e){void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,r,n,i){if("function"!=typeof t)throw new TypeError(\'"callback" argument must be a function\');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,r)}));case 3:return e.nextTick((function(){t.call(null,r,n)}));case 4:return e.nextTick((function(){t.call(null,r,n,i)}));default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick((function(){t.apply(null,o)}))}}}:t.exports=e}).call(this,r(1))},function(t,e,r){var n=r(0),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function a(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,e),e.Buffer=a),o(i,a),a.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},a.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapUtils=void 0;var n=r(6),i=function(){function t(){}return Object.defineProperty(t,"pixelScale",{get:function(){return t._pixelScale},set:function(e){t._pixelScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"touchBoxSize",{get:function(){return t._touchBoxSize},set:function(e){t._touchBoxSize=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"resourceScale",{get:function(){return Math.round(t._pixelScale)},enumerable:!1,configurable:!0}),t.getTileSize=function(){return n.MapConstants.baseTileSize*t.pixelScale},t.extendOptions=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=0,i=e;n<i.length;n++){var o=i[n];for(var a in o)t[a]=o[a]}return t},t._pixelScale=1,t._touchBoxSize=1,t}();e.MapUtils=i},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.IconPattern=e.DotPattern=e.DashPattern=e.SolidPattern=e.PatternItem=e.PatternType=void 0;var o,a=r(15);!function(t){t[t.Solid=0]="Solid",t[t.Dash=1]="Dash",t[t.Dot=2]="Dot",t[t.Icon=3]="Icon"}(o=e.PatternType||(e.PatternType={}));var s=function(){function t(t){this.type=t}return t.prototype.getType=function(){return this.type},t}();e.PatternItem=s;var u=function(t){function e(){return t.call(this,o.Solid)||this}return i(e,t),e}(s);e.SolidPattern=u;var h=function(t){function e(e){var r=t.call(this,o.Dash)||this;return r.length=e.length*a.MapUtils.pixelScale,r.gap=e.gap*a.MapUtils.pixelScale,r}return i(e,t),e.prototype.getLength=function(){return this.length},e.prototype.getGap=function(){return this.gap},e}(s);e.DashPattern=h;var f=function(t){function e(r){var n=t.call(this,o.Dot)||this,i={};return a.MapUtils.extendOptions(i,e.defaultDotPatternOptions,r),n.repeat=i.repeat,n}return i(e,t),e.prototype.getRepeat=function(){return this.repeat},e.defaultDotPatternOptions={repeat:1},e}(s);e.DotPattern=f;var l=function(t){function e(e){var r=t.call(this,o.Icon)||this;return r.url=e.url,r}return i(e,t),e.prototype.getUrl=function(){return this.url},e}(s);e.IconPattern=l},function(t,e,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}t.exports=s,t.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,o),n(r)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}y(t,e,o,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&y(t,"error",e,r)}(t,i,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function h(t){if("function"!=typeof t)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof t)}function f(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function l(t,e,r,n){var i,o,a,s;if(h(r),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),a=o[e]),void 0===a)a=o[e]=r,++t._eventsCount;else if("function"==typeof a?a=o[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=f(t))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function p(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):v(i,i.length)}function g(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function y(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError(\'The "emitter" argument must be of type EventEmitter. Received type \'+typeof t);t.addEventListener(e,(function i(o){n.once&&t.removeEventListener(e,i),r(o)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+t+".");u=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return f(this)},s.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)o(u,this,e);else{var h=u.length,f=v(u,h);for(r=0;r<h;++r)o(f[r],this,e)}return!0},s.prototype.addListener=function(t,e){return l(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return l(this,t,e,!0)},s.prototype.once=function(t,e){return h(e),this.on(t,d(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return h(e),this.prependListener(t,d(this,t,e)),this},s.prototype.removeListener=function(t,e){var r,n,i,o,a;if(h(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},s.prototype.listeners=function(t){return p(this,t,!0)},s.prototype.rawListeners=function(t){return p(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(t,e,r){(e=t.exports=r(30)).Stream=e,e.Readable=e,e.Writable=r(19),e.Duplex=r(5),e.Transform=r(34),e.PassThrough=r(77)},function(t,e,r){"use strict";(function(e,n,i){var o=r(13);function a(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,r){var n=t.entry;t.entry=null;for(;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=m;var s,u=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:o.nextTick;m.WritableState=y;var h=Object.create(r(8));h.inherits=r(7);var f={deprecate:r(76)},l=r(31),c=r(14).Buffer,d=i.Uint8Array||function(){};var p,g=r(32);function v(){}function y(t,e){s=s||r(5),t=t||{};var n=e instanceof s;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,h=t.writableHighWaterMark,f=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(h||0===h)?h:f,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===t.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function(t,e,r,n,i){--e.pendingcb,r?(o.nextTick(i,n),o.nextTick(k,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),k(t,e))}(t,r,n,e,i);else{var a=x(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||b(t,r),n?u(w,t,r,a,i):w(t,r,a,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function m(t){if(s=s||r(5),!(p.call(m,this)||this instanceof s))return new m(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function _(t,e,r,n,i,o,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function w(t,e,r,n){r||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),k(t,e)}function b(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var s=0,u=!0;r;)i[s]=r,r.isBuf||(u=!1),r=r.next,s+=1;i.allBuffers=u,_(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new a(e),e.bufferedRequestCount=0}else{for(;r;){var h=r.chunk,f=r.encoding,l=r.callback;if(_(t,e,!1,e.objectMode?1:h.length,h,f,l),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function x(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function E(t,e){t._final((function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),k(t,e)}))}function k(t,e){var r=x(e);return r&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(E,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}h.inherits(m,l),y.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(y.prototype,"buffer",{get:f.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(m,Symbol.hasInstance,{value:function(t){return!!p.call(this,t)||this===m&&(t&&t._writableState instanceof y)}})):p=function(t){return t instanceof this},m.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},m.prototype.write=function(t,e,r){var n,i=this._writableState,a=!1,s=!i.objectMode&&(n=t,c.isBuffer(n)||n instanceof d);return s&&!c.isBuffer(t)&&(t=function(t){return c.from(t)}(t)),"function"==typeof e&&(r=e,e=null),s?e="buffer":e||(e=i.defaultEncoding),"function"!=typeof r&&(r=v),i.ended?function(t,e){var r=new Error("write after end");t.emit("error",r),o.nextTick(e,r)}(this,r):(s||function(t,e,r,n){var i=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),o.nextTick(n,a),i=!1),i}(this,i,t,r))&&(i.pendingcb++,a=function(t,e,r,n,i,o){if(!r){var a=function(t,e,r){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=c.from(e,r));return e}(e,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=e.objectMode?1:n.length;e.length+=s;var u=e.length<e.highWaterMark;u||(e.needDrain=!0);if(e.writing||e.corked){var h=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},h?h.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,s,n,i,o);return u}(this,i,s,t,e,r)),a},m.prototype.cork=function(){this._writableState.corked++},m.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},m.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(m.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),m.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},m.prototype._writev=null,m.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,r){e.ending=!0,k(t,e),r&&(e.finished?o.nextTick(r):t.once("finish",r));e.ended=!0,t.writable=!1}(this,n,r)},Object.defineProperty(m.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),m.prototype.destroy=g.destroy,m.prototype._undestroy=g.undestroy,m.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,r(1),r(74).setImmediate,r(4))},function(t,e,r){"use strict";(function(e){var n=r(84);\r\n/*!\r\n * The buffer module from node.js, for the browser.\r\n *\r\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\r\n * @license  MIT\r\n */function i(t,e){if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0}function o(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var a=r(2),s=Object.prototype.hasOwnProperty,u=Array.prototype.slice,h="foo"===function(){}.name;function f(t){return Object.prototype.toString.call(t)}function l(t){return!o(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var c=t.exports=m,d=/\\s*function\\s+([^\\(\\s]*)\\s*/;function p(t){if(a.isFunction(t)){if(h)return t.name;var e=t.toString().match(d);return e&&e[1]}}function g(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function v(t){if(h||!a.isFunction(t))return a.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function y(t,e,r,n,i){throw new c.AssertionError({message:r,actual:t,expected:e,operator:n,stackStartFunction:i})}function m(t,e){t||y(t,!0,e,"==",c.ok)}function _(t,e,r,n){if(t===e)return!0;if(o(t)&&o(e))return 0===i(t,e);if(a.isDate(t)&&a.isDate(e))return t.getTime()===e.getTime();if(a.isRegExp(t)&&a.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&f(t)===f(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===i(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(o(t)!==o(e))return!1;var s=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return-1!==s&&s===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),function(t,e,r,n){if(null==t||null==e)return!1;if(a.isPrimitive(t)||a.isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=w(t),o=w(e);if(i&&!o||!i&&o)return!1;if(i)return t=u.call(t),e=u.call(e),_(t,e,r);var s,h,f=E(t),l=E(e);if(f.length!==l.length)return!1;for(f.sort(),l.sort(),h=f.length-1;h>=0;h--)if(f[h]!==l[h])return!1;for(h=f.length-1;h>=0;h--)if(s=f[h],!_(t[s],e[s],r,n))return!1;return!0}(t,e,r,n))}return r?t===e:t==e}function w(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function b(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function x(t,e,r,n){var i;if("function"!=typeof e)throw new TypeError(\'"block" argument must be a function\');"string"==typeof r&&(n=r,r=null),i=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),t&&!i&&y(i,r,"Missing expected exception"+n);var o="string"==typeof n,s=!t&&i&&!r;if((!t&&a.isError(i)&&o&&b(i,r)||s)&&y(i,r,"Got unwanted exception"+n),t&&i&&r&&!b(i,r)||!t&&i)throw i}c.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function(t){return g(v(t.actual),128)+" "+t.operator+" "+g(v(t.expected),128)}(this),this.generatedMessage=!0);var e=t.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var r=new Error;if(r.stack){var n=r.stack,i=p(e),o=n.indexOf("\\n"+i);if(o>=0){var a=n.indexOf("\\n",o+1);n=n.substring(a+1)}this.stack=n}}},a.inherits(c.AssertionError,Error),c.fail=y,c.ok=m,c.equal=function(t,e,r){t!=e&&y(t,e,r,"==",c.equal)},c.notEqual=function(t,e,r){t==e&&y(t,e,r,"!=",c.notEqual)},c.deepEqual=function(t,e,r){_(t,e,!1)||y(t,e,r,"deepEqual",c.deepEqual)},c.deepStrictEqual=function(t,e,r){_(t,e,!0)||y(t,e,r,"deepStrictEqual",c.deepStrictEqual)},c.notDeepEqual=function(t,e,r){_(t,e,!1)&&y(t,e,r,"notDeepEqual",c.notDeepEqual)},c.notDeepStrictEqual=function t(e,r,n){_(e,r,!0)&&y(e,r,n,"notDeepStrictEqual",t)},c.strictEqual=function(t,e,r){t!==e&&y(t,e,r,"===",c.strictEqual)},c.notStrictEqual=function(t,e,r){t===e&&y(t,e,r,"!==",c.notStrictEqual)},c.throws=function(t,e,r){x(!0,t,e,r)},c.doesNotThrow=function(t,e,r){x(!1,t,e,r)},c.ifError=function(t){if(t)throw t},c.strict=n((function t(e,r){e||y(e,!0,r,"==",t)}),c,{equal:c.strictEqual,deepEqual:c.deepStrictEqual,notEqual:c.notStrictEqual,notDeepEqual:c.notDeepStrictEqual}),c.strict.strict=c.strict;var E=Object.keys||function(t){var e=[];for(var r in t)s.call(t,r)&&e.push(r);return e}}).call(this,r(4))},function(t,e,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MathUtils=void 0;var n=function(){function t(){}return t.clamp=function(t,e,r){return t<e?e:t>r?r:t},t.toRadians=function(t){return t*Math.PI/180},t.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t.findNextPowerOf2=function(t){return t-=1,1<<Math.log2(t)+1},t.findPreviousPowerOf2=function(t){return 1<<31-Math.clz32(t)},t}();e.MathUtils=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LineJoinType=e.LineCapType=void 0,function(t){t[t.Butt=0]="Butt",t[t.Square=1]="Square",t[t.Round=2]="Round"}(e.LineCapType||(e.LineCapType={})),function(t){t[t.Miter=0]="Miter",t[t.Bevel=1]="Bevel",t[t.Round=2]="Round"}(e.LineJoinType||(e.LineJoinType={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TileFeature=e.GeometryType=void 0,function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.Raster=4]="Raster",t[t.Building=5]="Building"}(e.GeometryType||(e.GeometryType={}));var n=function(){function t(t,e,r,n){this.id=t,this.type=e,this.geometries=r,this.properties=n}return t.prototype.getId=function(){return this.id},t.prototype.getType=function(){return this.type},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getProperties=function(){return this.properties},t}();e.TileFeature=n},function(t,e){\r\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\r\ne.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,h=u>>1,f=-7,l=r?i-1:0,c=r?-1:1,d=t[e+l];for(l+=c,o=d&(1<<-f)-1,d>>=-f,f+=s;f>0;o=256*o+t[e+l],l+=c,f-=8);for(a=o&(1<<-f)-1,o>>=-f,f+=n;f>0;a=256*a+t[e+l],l+=c,f-=8);if(0===o)o=1-h;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=h}return(d?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,h=8*o-i-1,f=(1<<h)-1,l=f>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+l>=1?c/u:c*Math.pow(2,1-l))*u>=2&&(a++,u/=2),a+l>=f?(s=0,a=f):a+l>=1?(s=(e*u-1)*Math.pow(2,i),a+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,h+=i;h>0;t[r+d]=255&a,d+=p,a/=256,h-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){"use strict";var n=r(62),i=r(65);t.exports=function t(e){if(!e)return null;if(e instanceof ArrayBuffer)return e;if("string"==typeof e)return n(e);if(ArrayBuffer.isView(e))return e.byteOffset?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e.buffer;var r;if(e.buffer||e.data||e._data)return r=t(e.buffer||e.data||e._data);if(Array.isArray(e))for(var o=0;o<e.length;o++)if(null!=e[o].length){e=i(e);break}return(r=new Uint8Array(e)).length?r.buffer:null}},function(t,e,r){"use strict";(function(e,n){var i=r(13);t.exports=_;var o,a=r(28);_.ReadableState=m;r(17).EventEmitter;var s=function(t,e){return t.listeners(e).length},u=r(31),h=r(14).Buffer,f=e.Uint8Array||function(){};var l=Object.create(r(8));l.inherits=r(7);var c=r(71),d=void 0;d=c&&c.debuglog?c.debuglog("stream"):function(){};var p,g=r(72),v=r(32);l.inherits(_,u);var y=["error","close","destroy","pause","resume"];function m(t,e){t=t||{};var n=e instanceof(o=o||r(5));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,a=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=r(33).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function _(t){if(o=o||r(5),!(this instanceof _))return new _(t);this._readableState=new m(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),u.call(this)}function w(t,e,r,n,i){var o,a=t._readableState;null===e?(a.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,E(t)}(t,a)):(i||(o=function(t,e){var r;n=e,h.isBuffer(n)||n instanceof f||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(a,e)),o?t.emit("error",o):a.objectMode||e&&e.length>0?("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===h.prototype||(e=function(t){return h.from(t)}(e)),n?a.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):b(t,a,e,!0):a.ended?t.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(e=a.decoder.write(e),a.objectMode||0!==e.length?b(t,a,e,!1):S(t,a)):b(t,a,e,!1))):n||(a.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(a)}function b(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&E(t)),S(t,e)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),_.prototype.destroy=v.destroy,_.prototype._undestroy=v.undestroy,_.prototype._destroy=function(t,e){this.push(null),e(t)},_.prototype.push=function(t,e){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=h.from(t,e),e=""),r=!0),w(this,t,e,!1,r)},_.prototype.unshift=function(t){return w(this,t,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){return p||(p=r(33).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};function x(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function E(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(d("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(k,t):k(t))}function k(t){d("emit readable"),t.emit("readable"),L(t)}function S(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(T,t,e))}function T(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function P(t){d("readable nexttick read 0"),t.read(0)}function A(t,e){e.reading||(d("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),L(t),e.flowing&&!e.reading&&t.read(0)}function L(t){var e=t._readableState;for(d("flow",e.flowing);e.flowing&&null!==t.read(););}function I(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=function(t,e,r){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():r?function(t,e){var r=e.head,n=1,i=r.data;t-=i.length;for(;r=r.next;){var o=r.data,a=t>o.length?o.length:t;if(a===o.length?i+=o:i+=o.slice(0,t),0===(t-=a)){a===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(a));break}++n}return e.length-=n,i}(t,e):function(t,e){var r=h.allocUnsafe(t),n=e.head,i=1;n.data.copy(r),t-=n.data.length;for(;n=n.next;){var o=n.data,a=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,a),0===(t-=a)){a===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(a));break}++i}return e.length-=i,r}(t,e);return n}(t,e.buffer,e.decoder),r);var r}function M(t){var e=t._readableState;if(e.length>0)throw new Error(\'"endReadable()" called on non-empty stream\');e.endEmitted||(e.ended=!0,i.nextTick(O,e,t))}function O(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function R(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}_.prototype.read=function(t){d("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return d("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?M(this):E(this),null;if(0===(t=x(t,e))&&e.ended)return 0===e.length&&M(this),null;var n,i=e.needReadable;return d("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&d("length less than watermark",i=!0),e.ended||e.reading?d("reading or ended",i=!1):i&&(d("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=x(r,e))),null===(n=t>0?I(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&M(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(t,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,d("pipe count=%d opts=%j",o.pipesCount,e);var u=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?f:_;function h(e,n){d("onunpipe"),e===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,d("cleanup"),t.removeListener("close",y),t.removeListener("finish",m),t.removeListener("drain",l),t.removeListener("error",v),t.removeListener("unpipe",h),r.removeListener("end",f),r.removeListener("end",_),r.removeListener("data",g),c=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||l())}function f(){d("onend"),t.end()}o.endEmitted?i.nextTick(u):r.once("end",u),t.on("unpipe",h);var l=function(t){return function(){var e=t._readableState;d("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,L(t))}}(r);t.on("drain",l);var c=!1;var p=!1;function g(e){d("ondata"),p=!1,!1!==t.write(e)||p||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==R(o.pipes,t))&&!c&&(d("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,p=!0),r.pause())}function v(e){d("onerror",e),_(),t.removeListener("error",v),0===s(t,"error")&&t.emit("error",e)}function y(){t.removeListener("finish",m),_()}function m(){d("onfinish"),t.removeListener("close",y),_()}function _(){d("unpipe"),r.unpipe(t)}return r.on("data",g),function(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?a(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(t,"error",v),t.once("close",y),t.once("finish",m),t.emit("pipe",r),o.flowing||(d("pipe resume"),r.resume()),t},_.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=R(e.pipes,t);return-1===a||(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},_.prototype.on=function(t,e){var r=u.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&E(this):i.nextTick(P,this))}return r},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(A,t,e))}(this,t)),this},_.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;for(var i in t.on("end",(function(){if(d("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(i){(d("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(e.push(i)||(n=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<y.length;o++)t.on(y[o],this.emit.bind(this,y[o]));return this._read=function(e){d("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=I}).call(this,r(4),r(1))},function(t,e,r){t.exports=r(17).EventEmitter},function(t,e,r){"use strict";var n=r(13);function i(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var r=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return o||a?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?(n.nextTick(i,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,r){"use strict";var n=r(14).Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=u,this.end=h,e=4;break;case"utf8":this.fillLast=s,e=4;break;case"base64":this.text=f,this.end=l,e=3;break;default:return this.write=c,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function a(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function s(t){var e=this.lastTotal-this.lastNeed,r=function(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function u(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function h(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function f(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function l(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function c(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},o.prototype.text=function(t,e){var r=function(t,e,r){var n=e.length-1;if(n<r)return 0;var i=a(e[n]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=a(e[n]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=a(e[n]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,r){"use strict";t.exports=a;var n=r(5),i=Object.create(r(8));function o(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(t){if(!(this instanceof a))return new a(t);n.call(this,t),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush((function(e,r){u(t,e,r)})):u(this,null,null)}function u(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=r(7),i.inherits(a,n),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},a.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,(function(t){e(t),r.emit("close")}))}},function(t,e,r){"use strict";var n,i=r(3),o=r(85),a=r(36),s=r(37),u=r(22);function h(t,e){return t.msg=u[e],e}function f(t){return(t<<1)-(t>4?9:0)}function l(t){for(var e=t.length;--e>=0;)t[e]=0}function c(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(i.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function d(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,c(t.strm)}function p(t,e){t.pending_buf[t.pending++]=e}function g(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function v(t,e){var r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,u=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,f=t.w_mask,l=t.prev,c=t.strstart+258,d=h[o+a-1],p=h[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(h[(r=e)+a]===p&&h[r+a-1]===d&&h[r]===h[o]&&h[++r]===h[o+1]){o+=2,r++;do{}while(h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&h[++o]===h[++r]&&o<c);if(n=258-(c-o),o=c-258,n>a){if(t.match_start=e,a=n,n>=s)break;d=h[o+a-1],p=h[o+a]}}}while((e=l[e&f])>u&&0!=--i);return a<=t.lookahead?a:t.lookahead}function y(t){var e,r,n,o,u,h,f,l,c,d,p=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-262)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=r=t.hash_size;do{n=t.head[--e],t.head[e]=n>=p?n-p:0}while(--r);e=r=p;do{n=t.prev[--e],t.prev[e]=n>=p?n-p:0}while(--r);o+=p}if(0===t.strm.avail_in)break;if(h=t.strm,f=t.window,l=t.strstart+t.lookahead,c=o,d=void 0,(d=h.avail_in)>c&&(d=c),r=0===d?0:(h.avail_in-=d,i.arraySet(f,h.input,h.next_in,d,l),1===h.state.wrap?h.adler=a(h.adler,f,d,l):2===h.state.wrap&&(h.adler=s(h.adler,f,d,l)),h.next_in+=d,h.total_in+=d,d),t.lookahead+=r,t.lookahead+t.insert>=3)for(u=t.strstart-t.insert,t.ins_h=t.window[u],t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+3-1])&t.hash_mask,t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function m(t,e){for(var r,n;;){if(t.lookahead<262){if(y(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-262&&(t.match_length=v(t,r)),t.match_length>=3)if(n=o._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}function _(t,e){for(var r,n,i;;){if(t.lookahead<262){if(y(t),t.lookahead<262&&0===e)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-262&&(t.match_length=v(t,r),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(d(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=o._tr_tally(t,0,t.window[t.strstart-1]))&&d(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}function w(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function x(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=0,o._tr_init(e),0):h(t,-2)}function E(t){var e,r=x(t);return 0===r&&((e=t.state).window_size=2*e.w_size,l(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),r}function k(t,e,r,n,o,a){if(!t)return-2;var s=1;if(-1===e&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),o<1||o>9||8!==r||n<8||n>15||e<0||e>9||a<0||a>4)return h(t,-2);8===n&&(n=9);var u=new b;return t.state=u,u.strm=t,u.wrap=s,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=o+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<o+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=a,u.method=r,E(t)}n=[new w(0,0,0,0,(function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(y(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,d(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(d(t,!1),t.strm.avail_out),1)})),new w(4,4,8,4,m),new w(4,5,16,8,m),new w(4,6,32,32,m),new w(4,4,16,16,_),new w(8,16,32,32,_),new w(8,16,128,128,_),new w(8,32,128,256,_),new w(32,128,258,1024,_),new w(32,258,258,4096,_)],e.deflateInit=function(t,e){return k(t,e,8,15,8,0)},e.deflateInit2=k,e.deflateReset=E,e.deflateResetKeep=x,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=e,0):-2},e.deflate=function(t,e){var r,i,a,u;if(!t||!t.state||e>5||e<0)return t?h(t,-2):-2;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&4!==e)return h(t,0===t.avail_out?-5:-2);if(i.strm=t,r=i.last_flush,i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var v=8+(i.w_bits-8<<4)<<8;v|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(v|=32),v+=31-v%31,i.status=113,g(i,v),0!==i.strstart&&(g(i,t.adler>>>16),g(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),c(t),a=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),c(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),c(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&c(t),i.pending+2<=i.pending_buf_size&&(p(i,255&t.adler),p(i,t.adler>>8&255),t.adler=0,i.status=113)):i.status=113),0!==i.pending){if(c(t),0===t.avail_out)return i.last_flush=-1,0}else if(0===t.avail_in&&f(e)<=f(r)&&4!==e)return h(t,-5);if(666===i.status&&0!==t.avail_in)return h(t,-5);if(0!==t.avail_in||0!==i.lookahead||0!==e&&666!==i.status){var m=2===i.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(y(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}(i,e):3===i.strategy?function(t,e){for(var r,n,i,a,s=t.window;;){if(t.lookahead<=258){if(y(t),t.lookahead<=258&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=s[i=t.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=t.strstart+258;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);t.match_length=258-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=o._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(d(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(d(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(d(t,!1),0===t.strm.avail_out)?1:2}(i,e):n[i.level].func(i,e);if(3!==m&&4!==m||(i.status=666),1===m||3===m)return 0===t.avail_out&&(i.last_flush=-1),0;if(2===m&&(1===e?o._tr_align(i):5!==e&&(o._tr_stored_block(i,0,0,!1),3===e&&(l(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),c(t),0===t.avail_out))return i.last_flush=-1,0}return 4!==e?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&t.adler),p(i,t.adler>>8&255),p(i,t.adler>>16&255),p(i,t.adler>>24&255),p(i,255&t.total_in),p(i,t.total_in>>8&255),p(i,t.total_in>>16&255),p(i,t.total_in>>24&255)):(g(i,t.adler>>>16),g(i,65535&t.adler)),c(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?h(t,-2):(t.state=null,113===e?h(t,-3):0):-2},e.deflateSetDictionary=function(t,e){var r,n,o,s,u,h,f,c,d=e.length;if(!t||!t.state)return-2;if(2===(s=(r=t.state).wrap)||1===s&&42!==r.status||r.lookahead)return-2;for(1===s&&(t.adler=a(t.adler,e,d,0)),r.wrap=0,d>=r.w_size&&(0===s&&(l(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new i.Buf8(r.w_size),i.arraySet(c,e,d-r.w_size,r.w_size,0),e=c,d=r.w_size),u=t.avail_in,h=t.next_in,f=t.input,t.avail_in=d,t.next_in=0,t.input=e,y(r);r.lookahead>=3;){n=r.strstart,o=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--o);r.strstart=n,r.lookahead=2,y(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=h,t.input=f,t.avail_in=u,r.wrap=s,0},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,r){"use strict";t.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+e[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();t.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},function(t,e,r){"use strict";var n=r(3),i=r(36),o=r(37),a=r(86),s=r(87);function u(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(852),e.distcode=e.distdyn=new n.Buf32(592),e.sane=1,e.back=-1,0):-2}function l(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,f(t)):-2}function c(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?-2:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,l(t))):-2}function d(t,e){var r,n;return t?(n=new h,t.state=n,n.window=null,0!==(r=c(t,e))&&(t.state=null),r):-2}var p,g,v=!0;function y(t){if(v){var e;for(p=new n.Buf32(512),g=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,p,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,g,0,t.work,{bits:5}),v=!1}t.lencode=p,t.lenbits=9,t.distcode=g,t.distbits=5}function m(t,e,r,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),n.arraySet(a.window,e,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}e.inflateReset=l,e.inflateReset2=c,e.inflateResetKeep=f,e.inflateInit=function(t){return d(t,15)},e.inflateInit2=d,e.inflate=function(t,e){var r,h,f,l,c,d,p,g,v,_,w,b,x,E,k,S,T,P,A,L,I,M,O,R,C=0,B=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(r=t.state).mode&&(r.mode=13),c=t.next_out,f=t.output,p=t.avail_out,l=t.next_in,h=t.input,d=t.avail_in,g=r.hold,v=r.bits,_=d,w=p,M=0;t:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;v<16;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(2&r.wrap&&35615===g){r.check=0,B[0]=255&g,B[1]=g>>>8&255,r.check=o(r.check,B,2,0),g=0,v=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&g)<<8)+(g>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&g)){t.msg="unknown compression method",r.mode=30;break}if(v-=4,I=8+(15&(g>>>=4)),0===r.wbits)r.wbits=I;else if(I>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<I,t.adler=r.check=1,r.mode=512&g?10:12,g=0,v=0;break;case 2:for(;v<16;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(r.flags=g,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=g>>8&1),512&r.flags&&(B[0]=255&g,B[1]=g>>>8&255,r.check=o(r.check,B,2,0)),g=0,v=0,r.mode=3;case 3:for(;v<32;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.head&&(r.head.time=g),512&r.flags&&(B[0]=255&g,B[1]=g>>>8&255,B[2]=g>>>16&255,B[3]=g>>>24&255,r.check=o(r.check,B,4,0)),g=0,v=0,r.mode=4;case 4:for(;v<16;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.head&&(r.head.xflags=255&g,r.head.os=g>>8),512&r.flags&&(B[0]=255&g,B[1]=g>>>8&255,r.check=o(r.check,B,2,0)),g=0,v=0,r.mode=5;case 5:if(1024&r.flags){for(;v<16;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.length=g,r.head&&(r.head.extra_len=g),512&r.flags&&(B[0]=255&g,B[1]=g>>>8&255,r.check=o(r.check,B,2,0)),g=0,v=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((b=r.length)>d&&(b=d),b&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,h,l,b,I)),512&r.flags&&(r.check=o(r.check,h,b,l)),d-=b,l+=b,r.length-=b),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===d)break t;b=0;do{I=h[l+b++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I))}while(I&&b<d);if(512&r.flags&&(r.check=o(r.check,h,b,l)),d-=b,l+=b,I)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===d)break t;b=0;do{I=h[l+b++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I))}while(I&&b<d);if(512&r.flags&&(r.check=o(r.check,h,b,l)),d-=b,l+=b,I)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;v<16;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(g!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}g=0,v=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;v<32;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}t.adler=r.check=u(g),g=0,v=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=c,t.avail_out=p,t.next_in=l,t.avail_in=d,r.hold=g,r.bits=v,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){g>>>=7&v,v-=7&v,r.mode=27;break}for(;v<3;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}switch(r.last=1&g,v-=1,3&(g>>>=1)){case 0:r.mode=14;break;case 1:if(y(r),r.mode=20,6===e){g>>>=2,v-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}g>>>=2,v-=2;break;case 14:for(g>>>=7&v,v-=7&v;v<32;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if((65535&g)!=(g>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&g,g=0,v=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(b=r.length){if(b>d&&(b=d),b>p&&(b=p),0===b)break t;n.arraySet(f,h,l,b,c),d-=b,l+=b,p-=b,c+=b,r.length-=b;break}r.mode=12;break;case 17:for(;v<14;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(r.nlen=257+(31&g),g>>>=5,v-=5,r.ndist=1+(31&g),g>>>=5,v-=5,r.ncode=4+(15&g),g>>>=4,v-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;v<3;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.lens[U[r.have++]]=7&g,g>>>=3,v-=3}for(;r.have<19;)r.lens[U[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,O={bits:r.lenbits},M=s(0,r.lens,0,19,r.lencode,0,r.work,O),r.lenbits=O.bits,M){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;S=(C=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,T=65535&C,!((k=C>>>24)<=v);){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(T<16)g>>>=k,v-=k,r.lens[r.have++]=T;else{if(16===T){for(R=k+2;v<R;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(g>>>=k,v-=k,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}I=r.lens[r.have-1],b=3+(3&g),g>>>=2,v-=2}else if(17===T){for(R=k+3;v<R;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}v-=k,I=0,b=3+(7&(g>>>=k)),g>>>=3,v-=3}else{for(R=k+7;v<R;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}v-=k,I=0,b=11+(127&(g>>>=k)),g>>>=7,v-=7}if(r.have+b>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;b--;)r.lens[r.have++]=I}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,O={bits:r.lenbits},M=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,O),r.lenbits=O.bits,M){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,O={bits:r.distbits},M=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,O),r.distbits=O.bits,M){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(d>=6&&p>=258){t.next_out=c,t.avail_out=p,t.next_in=l,t.avail_in=d,r.hold=g,r.bits=v,a(t,w),c=t.next_out,f=t.output,p=t.avail_out,l=t.next_in,h=t.input,d=t.avail_in,g=r.hold,v=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;S=(C=r.lencode[g&(1<<r.lenbits)-1])>>>16&255,T=65535&C,!((k=C>>>24)<=v);){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(S&&0==(240&S)){for(P=k,A=S,L=T;S=(C=r.lencode[L+((g&(1<<P+A)-1)>>P)])>>>16&255,T=65535&C,!(P+(k=C>>>24)<=v);){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}g>>>=P,v-=P,r.back+=P}if(g>>>=k,v-=k,r.back+=k,r.length=T,0===S){r.mode=26;break}if(32&S){r.back=-1,r.mode=12;break}if(64&S){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&S,r.mode=22;case 22:if(r.extra){for(R=r.extra;v<R;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.length+=g&(1<<r.extra)-1,g>>>=r.extra,v-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;S=(C=r.distcode[g&(1<<r.distbits)-1])>>>16&255,T=65535&C,!((k=C>>>24)<=v);){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(0==(240&S)){for(P=k,A=S,L=T;S=(C=r.distcode[L+((g&(1<<P+A)-1)>>P)])>>>16&255,T=65535&C,!(P+(k=C>>>24)<=v);){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}g>>>=P,v-=P,r.back+=P}if(g>>>=k,v-=k,r.back+=k,64&S){t.msg="invalid distance code",r.mode=30;break}r.offset=T,r.extra=15&S,r.mode=24;case 24:if(r.extra){for(R=r.extra;v<R;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}r.offset+=g&(1<<r.extra)-1,g>>>=r.extra,v-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break t;if(b=w-p,r.offset>b){if((b=r.offset-b)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}b>r.wnext?(b-=r.wnext,x=r.wsize-b):x=r.wnext-b,b>r.length&&(b=r.length),E=r.window}else E=f,x=c-r.offset,b=r.length;b>p&&(b=p),p-=b,r.length-=b;do{f[c++]=E[x++]}while(--b);0===r.length&&(r.mode=21);break;case 26:if(0===p)break t;f[c++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;v<32;){if(0===d)break t;d--,g|=h[l++]<<v,v+=8}if(w-=p,t.total_out+=w,r.total+=w,w&&(t.adler=r.check=r.flags?o(r.check,f,w,c-w):i(r.check,f,w,c-w)),w=p,(r.flags?g:u(g))!==r.check){t.msg="incorrect data check",r.mode=30;break}g=0,v=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;v<32;){if(0===d)break t;d--,g+=h[l++]<<v,v+=8}if(g!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}g=0,v=0}r.mode=29;case 29:M=1;break t;case 30:M=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=c,t.avail_out=p,t.next_in=l,t.avail_in=d,r.hold=g,r.bits=v,(r.wsize||w!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&m(t,t.output,t.next_out,w-t.avail_out)?(r.mode=31,-4):(_-=t.avail_in,w-=t.avail_out,t.total_in+=_,t.total_out+=w,r.total+=w,r.wrap&&w&&(t.adler=r.check=r.flags?o(r.check,f,w,t.next_out-w):i(r.check,f,w,t.next_out-w)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===_&&0===w||4===e)&&0===M&&(M=-5),M)},e.inflateEnd=function(t){if(!t||!t.state)return-2;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?-2:(r.head=e,e.done=!1,0):-2},e.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?-2:11===r.mode&&i(1,e,n,0)!==r.check?-3:m(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,0):-2},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,r){"use strict";(function(e,n){var i=r(2),o=r(12),a=t.exports=function(){o.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};i.inherits(a,o),a.prototype.read=function(t,r){this._reads.push({length:Math.abs(t),allowLess:t<0,func:r}),e.nextTick(function(){this._process(),this._paused&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}.bind(this))},a.prototype.write=function(t,e){return this.writable?(r=n.isBuffer(t)?t:new n(t,e||this._encoding),this._buffers.push(r),this._buffered+=r.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused):(this.emit("error",new Error("Stream not writable")),!1);var r},a.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},a.prototype.destroySoon=a.prototype.end,a.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},a.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},a.prototype._processReadAllowingLess=function(t){this._reads.shift();var e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},a.prototype._processRead=function(t){this._reads.shift();for(var e=0,r=0,i=new n(t.length);e<t.length;){var o=this._buffers[r++],a=Math.min(o.length,t.length-e);o.copy(i,e,0,a),e+=a,a!==o.length&&(this._buffers[--r]=o.slice(a))}r>0&&this._buffers.splice(0,r),this._buffered-=t.length,t.func.call(this,i)},a.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){var t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}).call(this,r(1),r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(41),i=r(42);function o(t,e,r){var n=t*e;return 8!==r&&(n=Math.ceil(n/(8/r))),n}var a=t.exports=function(t,e){var r=t.width,i=t.height,a=t.interlace,s=t.bpp,u=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],a)for(var h=n.getImagePasses(r,i),f=0;f<h.length;f++)this._images.push({byteWidth:o(h[f].width,s,u),height:h[f].height,lineIndex:0});else this._images.push({byteWidth:o(r,s,u),height:i,lineIndex:0});this._xComparison=8===u?s:16===u?2*s:1};a.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},a.prototype._unFilterType1=function(t,e,r){for(var n=this._xComparison,i=n-1,o=0;o<r;o++){var a=t[1+o],s=o>i?e[o-n]:0;e[o]=a+s}},a.prototype._unFilterType2=function(t,e,r){for(var n=this._lastLine,i=0;i<r;i++){var o=t[1+i],a=n?n[i]:0;e[i]=o+a}},a.prototype._unFilterType3=function(t,e,r){for(var n=this._xComparison,i=n-1,o=this._lastLine,a=0;a<r;a++){var s=t[1+a],u=o?o[a]:0,h=a>i?e[a-n]:0,f=Math.floor((h+u)/2);e[a]=s+f}},a.prototype._unFilterType4=function(t,e,r){for(var n=this._xComparison,o=n-1,a=this._lastLine,s=0;s<r;s++){var u=t[1+s],h=a?a[s]:0,f=s>o?e[s-n]:0,l=s>o&&a?a[s-n]:0,c=i(f,h,l);e[s]=u+c}},a.prototype._reverseFilterLine=function(t){var r,n=t[0],i=this._images[this._imageIndex],o=i.byteWidth;if(0===n)r=t.slice(1,o+1);else switch(r=new e(o),n){case 1:this._unFilterType1(t,r,o);break;case 2:this._unFilterType2(t,r,o);break;case 3:this._unFilterType3(t,r,o);break;case 4:this._unFilterType4(t,r,o);break;default:throw new Error("Unrecognised filter type - "+n)}this.write(r),i.lineIndex++,i.lineIndex>=i.height?(this._lastLine=null,this._imageIndex++,i=this._images[this._imageIndex]):this._lastLine=r,i?this.read(i.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";var n=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];e.getImagePasses=function(t,e){for(var r=[],i=t%8,o=e%8,a=(t-i)/8,s=(e-o)/8,u=0;u<n.length;u++){for(var h=n[u],f=a*h.x.length,l=s*h.y.length,c=0;c<h.x.length&&h.x[c]<i;c++)f++;for(c=0;c<h.y.length&&h.y[c]<o;c++)l++;f>0&&l>0&&r.push({width:f,height:l,index:u})}return r},e.getInterlaceIterator=function(t){return function(e,r,i){var o=e%n[i].x.length,a=(e-o)/n[i].x.length*8+n[i].x[o],s=r%n[i].y.length;return 4*a+((r-s)/n[i].y.length*8+n[i].y[s])*t*4}}},function(t,e,r){"use strict";t.exports=function(t,e,r){var n=t+e-r,i=Math.abs(n-t),o=Math.abs(n-e),a=Math.abs(n-r);return i<=o&&i<=a?t:o<=a?e:r}},function(t,e,r){"use strict";(function(e){var n=r(10),i=r(44),o=t.exports=function(t,e){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[n.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[n.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[n.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[n.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[n.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[n.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};o.prototype.start=function(){this.read(n.PNG_SIGNATURE.length,this._parseSignature.bind(this))},o.prototype._parseSignature=function(t){for(var e=n.PNG_SIGNATURE,r=0;r<e.length;r++)if(t[r]!==e[r])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},o.prototype._parseChunkBegin=function(t){for(var r=t.readUInt32BE(0),o=t.readUInt32BE(4),a="",s=4;s<8;s++)a+=String.fromCharCode(t[s]);var u=Boolean(32&t[4]);if(this._hasIHDR||o===n.TYPE_IHDR){if(this._crc=new i,this._crc.write(new e(a)),this._chunks[o])return this._chunks[o](r);u?this.read(r+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+a))}else this.error(new Error("Expected IHDR on beggining"))},o.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},o.prototype._parseChunkEnd=function(t){var e=t.readInt32BE(0),r=this._crc.crc32();this._options.checkCRC&&r!==e?this.error(new Error("Crc error - "+e+" - "+r)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},o.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},o.prototype._parseIHDR=function(t){this._crc.write(t);var e=t.readUInt32BE(0),r=t.readUInt32BE(4),i=t[8],o=t[9],a=t[10],s=t[11],u=t[12];if(8===i||4===i||2===i||1===i||16===i)if(o in n.COLORTYPE_TO_BPP_MAP)if(0===a)if(0===s)if(0===u||1===u){this._colorType=o;var h=n.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:e,height:r,depth:i,interlace:Boolean(u),palette:Boolean(o&n.COLORTYPE_PALETTE),color:Boolean(o&n.COLORTYPE_COLOR),alpha:Boolean(o&n.COLORTYPE_ALPHA),bpp:h,colorType:o}),this._handleChunkEnd()}else this.error(new Error("Unsupported interlace method"));else this.error(new Error("Unsupported filter method"));else this.error(new Error("Unsupported compression method"));else this.error(new Error("Unsupported color type"));else this.error(new Error("Unsupported bit depth "+i))},o.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},o.prototype._parsePLTE=function(t){this._crc.write(t);for(var e=Math.floor(t.length/3),r=0;r<e;r++)this._palette.push([t[3*r],t[3*r+1],t[3*r+2],255]);this.palette(this._palette),this._handleChunkEnd()},o.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},o.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===n.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(t.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(var e=0;e<t.length;e++)this._palette[e][3]=t[e];this.palette(this._palette)}this._colorType===n.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===n.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},o.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},o.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/n.GAMMA_DIVISION),this._handleChunkEnd()},o.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},o.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===n.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);var r=t-e.length;r>0?this._handleIDAT(r):this._handleChunkEnd()},o.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},o.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";var n=[];!function(){for(var t=0;t<256;t++){for(var e=t,r=0;r<8;r++)1&e?e=3988292384^e>>>1:e>>>=1;n[t]=e}}();var i=t.exports=function(){this._crc=-1};i.prototype.write=function(t){for(var e=0;e<t.length;e++)this._crc=n[255&(this._crc^t[e])]^this._crc>>>8;return!0},i.prototype.crc32=function(){return-1^this._crc},i.crc32=function(t){for(var e=-1,r=0;r<t.length;r++)e=n[255&(e^t[r])]^e>>>8;return-1^e}},function(t,e,r){"use strict";(function(t){var n=r(41),i=[function(){},function(t,e,r,n){if(n===e.length)throw new Error("Ran out of data");var i=e[n];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=255},function(t,e,r,n){if(n+1>=e.length)throw new Error("Ran out of data");var i=e[n];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=e[n+1]},function(t,e,r,n){if(n+2>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=255},function(t,e,r,n){if(n+3>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=e[n+3]}],o=[function(){},function(t,e,r,n){var i=e[0];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=n},function(t,e,r){var n=e[0];t[r]=n,t[r+1]=n,t[r+2]=n,t[r+3]=e[1]},function(t,e,r,n){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=n},function(t,e,r){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}];function a(t,e,r,n,o,a){for(var s=t.width,u=t.height,h=t.index,f=0;f<u;f++)for(var l=0;l<s;l++){var c=r(l,f,h);i[n](e,o,c,a),a+=n}return a}function s(t,e,r,n,i,a){for(var s=t.width,u=t.height,h=t.index,f=0;f<u;f++){for(var l=0;l<s;l++){var c=i.get(n),d=r(l,f,h);o[n](e,c,d,a)}i.resetAfterLine()}}e.dataToBitMap=function(e,r){var i,o=r.width,u=r.height,h=r.depth,f=r.bpp,l=r.interlace;if(8!==h)var c=function(t,e){var r=[],n=0;function i(){if(n===t.length)throw new Error("Ran out of data");var i,o,a,s,u,h,f,l,c=t[n];switch(n++,e){default:throw new Error("unrecognised depth");case 16:f=t[n],n++,r.push((c<<8)+f);break;case 4:f=15&c,l=c>>4,r.push(l,f);break;case 2:u=3&c,h=c>>2&3,f=c>>4&3,l=c>>6&3,r.push(l,f,h,u);break;case 1:i=1&c,o=c>>1&1,a=c>>2&1,s=c>>3&1,u=c>>4&1,h=c>>5&1,f=c>>6&1,l=c>>7&1,r.push(l,f,h,u,s,a,o,i)}}return{get:function(t){for(;r.length<t;)i();var e=r.slice(0,t);return r=r.slice(t),e},resetAfterLine:function(){r.length=0},end:function(){if(n!==t.length)throw new Error("extra data found")}}}(e,h);i=h<=8?new t(o*u*4):new Uint16Array(o*u*4);var d,p,g=Math.pow(2,h)-1,v=0;if(l)d=n.getImagePasses(o,u),p=n.getInterlaceIterator(o,u);else{var y=0;p=function(){var t=y;return y+=4,t},d=[{width:o,height:u}]}for(var m=0;m<d.length;m++)8===h?v=a(d[m],i,p,f,e,v):s(d[m],i,p,f,c,g);if(8===h){if(v!==e.length)throw new Error("extra data found")}else c.end();return i}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){t.exports=function(t,r){var n=r.depth,i=r.width,o=r.height,a=r.colorType,s=r.transColor,u=r.palette,h=t;return 3===a?function(t,e,r,n,i){for(var o=0,a=0;a<n;a++)for(var s=0;s<r;s++){var u=i[t[o]];if(!u)throw new Error("index "+t[o]+" not in palette");for(var h=0;h<4;h++)e[o+h]=u[h];o+=4}}(t,h,i,o,u):(s&&function(t,e,r,n,i){for(var o=0,a=0;a<n;a++)for(var s=0;s<r;s++){var u=!1;if(1===i.length?i[0]===t[o]&&(u=!0):i[0]===t[o]&&i[1]===t[o+1]&&i[2]===t[o+2]&&(u=!0),u)for(var h=0;h<4;h++)e[o+h]=0;o+=4}}(t,h,i,o,s),8!==n&&(16===n&&(h=new e(i*o*4)),function(t,e,r,n,i){for(var o=Math.pow(2,i)-1,a=0,s=0;s<n;s++)for(var u=0;u<r;u++){for(var h=0;h<4;h++)e[a+h]=Math.floor(255*t[a+h]/o+.5);a+=4}}(t,h,i,o,n))),h}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(10),i=r(44),o=r(90),a=r(91),s=r(9),u=t.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||s.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:n.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:n.COLORTYPE_COLOR_ALPHA,-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};u.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},u.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},u.prototype.filterData=function(t,e,r){var i=o(t,e,r,this._options),s=n.COLORTYPE_TO_BPP_MAP[this._options.colorType];return a(i,e,r,this._options,s)},u.prototype._packChunk=function(t,r){var n=r?r.length:0,o=new e(n+12);return o.writeUInt32BE(n,0),o.writeUInt32BE(t,4),r&&r.copy(o,8),o.writeInt32BE(i.crc32(o.slice(4,o.length-4)),o.length-4),o},u.prototype.packGAMA=function(t){var r=new e(4);return r.writeUInt32BE(Math.floor(t*n.GAMMA_DIVISION),0),this._packChunk(n.TYPE_gAMA,r)},u.prototype.packIHDR=function(t,r){var i=new e(13);return i.writeUInt32BE(t,0),i.writeUInt32BE(r,4),i[8]=this._options.bitDepth,i[9]=this._options.colorType,i[10]=0,i[11]=0,i[12]=0,this._packChunk(n.TYPE_IHDR,i)},u.prototype.packIDAT=function(t){return this._packChunk(n.TYPE_IDAT,t)},u.prototype.packIEND=function(){return this._packChunk(n.TYPE_IEND,null)}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";var n=t.exports=function(t){this._buffer=t,this._reads=[]};n.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},n.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){var t=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=t.length||t.allowLess))break;this._reads.shift();var e=this._buffer;this._buffer=e.slice(t.length),t.func.call(this,e.slice(0,t.length))}return this._reads.length>0?new Error("There are some read requests waitng on finished stream"):this._buffer.length>0?new Error("unrecognised content at end of stream"):void 0}},function(t,e,r){"use strict";var n=r(3),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,e.string2buf=function(t){var e,r,i,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e},e.buf2binstring=function(t){return u(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},e.buf2string=function(t,e){var r,n,i,o,s=e||t.length,h=new Array(2*s);for(n=0,r=0;r<s;)if((i=t[r++])<128)h[n++]=i;else if((o=a[i])>4)h[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<s;)i=i<<6|63&t[r++],o--;o>1?h[n++]=65533:i<65536?h[n++]=i:(i-=65536,h[n++]=55296|i>>10&1023,h[n++]=56320|1023&i)}return u(h,n)},e.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+a[t[r]]>e?r:e}},function(t,e,r){"use strict";var n=r(51);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o,this,e),this.length=this._features.length}function o(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,e,this.extent,this._keys,this._values)}},function(t,e,r){"use strict";var n=r(126);function i(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(o,this,e)}function o(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function a(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n+=((r=t[a]).x-e.x)*(e.y+r.y);return n}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];t.pos<r;){if(o<=0){var h=t.readVarint();i=7&h,o=h>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new n(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,h=-1/0;t.pos<e;){if(n<=0){var f=t.readVarint();r=7&f,n=f>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,u,s,h]},i.prototype.toGeoJSON=function(t,e,r){var n,o,s=this.extent*Math.pow(2,r),u=this.extent*t,h=this.extent*e,f=this.loadGeometry(),l=i.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+h)/s;t[e]=[360*(r.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(n=0;n<f.length;n++)d[n]=f[n][0];c(f=d);break;case 2:for(n=0;n<f.length;n++)c(f[n]);break;case 3:for(f=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var s=a(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}r&&i.push(r);return i}(f),n=0;n<f.length;n++)for(o=0;o<f[n].length;o++)c(f[n][o])}1===f.length?f=f[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:f},properties:this.properties};return"id"in this&&(p.id=this.id),p}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;var n=function(){function t(t,e,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),this.alpha=n,this._buffer=new Float32Array([t,e,r])}return t.prototype.rgbBuffer=function(){return this._buffer},t.prototype.buffer=function(){return new Float32Array([this.red,this.green,this.blue,this.alpha])},Object.defineProperty(t.prototype,"red",{get:function(){return this._buffer[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"green",{get:function(){return this._buffer[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blue",{get:function(){return this._buffer[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+255*this.red+","+255*this.green+","+255*this.blue+","+this.alpha+")"},enumerable:!1,configurable:!0}),t.fromHex=function(e){void 0===e&&(e="000000"),4!=e.length&&7!=e.length&&9!=e.length||(e=e.substring(1,e.length)),3==e.length&&(e=e.split("").map((function(t){return t+t})).join(""));var r=parseInt(e,16);return 6==e.length?new t((r>>16)/255,(r>>8&255)/255,(255&r)/255):new t((r>>24&255)/255,(r>>16&255)/255,(r>>8&255)/255,(255&r)/255)},t.fromInt=function(e){return void 0===e&&(e=0),e<0&&(e=0),new t((e>>16&255)/255,(e>>8&255)/255,(255&e)/255)},t.fromVec3=function(e){return new t(e.x,e.y,e.z)},t.mix=function(e,r,n){return new t(e.red*n+r.red*(1-n),e.green*n+r.green*(1-n),e.blue*n+r.blue*(1-n),e.alpha*n+r.alpha*(1-n))},Object.defineProperty(t.prototype,"code",{get:function(){var t=function(t){var e=Math.floor(255*t).toString(16);return e=(e=1==e.length?"0"+e:e).length>2?e.substr(0,2):e};return"#"+t(this.red)+t(this.green)+t(this.blue)+t(this.alpha)},enumerable:!1,configurable:!0}),t.isValid=function(t){return/^#?([0-9A-Fa-f]){6,8}$/i.test(t)},t}();e.Color=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapLanguage=void 0,function(t){t.en="en",t.vi="vi"}(e.MapLanguage||(e.MapLanguage={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolylineBuilderContext=e.buildPolygon=e.PolygonBuilderContext=void 0;var n=r(11),i=r(6),o=r(131),a=r(24),s=r(25),u=function(){function t(t){void 0===t&&(t=function(t){}),this.indices=[],this.addVertex=t}return t.prototype.clear=function(){this.indices=[]},t}();e.PolygonBuilderContext=u,e.buildPolygon=function(t,e){var r=[],n=[];t.forEach((function(t,o){0!=o&&n.push(r.length/2),t.forEach((function(t){r.push((t.x+.5)*i.MapConstants.tileExtend),r.push((.5-t.y)*i.MapConstants.tileExtend),e.addVertex(t)}))})),e.indices=o.default(r,n)};var h=function(){function t(t,e,r,n,i){void 0===t&&(t=function(t,e){}),void 0===e&&(e=s.LineCapType.Butt),void 0===r&&(r=s.LineJoinType.Bevel),void 0===n&&(n=!1),void 0===i&&(i=3),this.indices=[],this.addVertex=t,this.lineCapType=e,this.lineJoinType=r,this.closedPolyline=n,this.miterLimit=i,this.numVertices=0,this.textureWidth=1,this.textureHeight=1}return t.prototype.buildPolyLine=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null),this.buildPolyLineSegment(t,e,r)},t.prototype.clear=function(){this.indices=[],this.numVertices=0},t.prototype.buildPolyLineSegment=function(t,e,r){void 0===r&&(r=null);var o=0,u=this.closedPolyline?t.length+2:t.length,h=t.length,f=u-0;if(!(f<2)){var l,c,d,p=t[0],g=t[1];c=new n.Vector2(g.y-p.y,p.x-g.x).normalize(),this.closedPolyline||this.addCap(p,c,!0),this.addPolyLineVertex(p,c,new n.Vector2(0,1)),this.addPolyLineVertex(p,c.multiply(-1),new n.Vector2(0,0));for(var v=1;v<f-1;++v){var y=(v+0+1)%h;if(o+=a.MathUtils.distance(p,g),(p=g)!=(g=t[y])){l=c,c=new n.Vector2(g.y-p.y,p.x-g.x).normalize();var m=1;0==(d=l.add(c)).x&&0==d.y?d=new n.Vector2(l.y-c.y,c.x-l.x):m=2/d.dot(d),d=d.multiply(m);var _=this.lineJoinType==s.LineJoinType.Bevel;d.length>this.miterLimit&&(_=!0,d=d.multiply(this.miterLimit/d.length));var w=o;if(this.lineJoinType!=s.LineJoinType.Miter||_){var b=_||this.lineJoinType==s.LineJoinType.Bevel?1:i.PolyConstants.numTrianglesOnRoundJoin;c.x*l.y-c.y*l.x>0?(this.addPolyLineVertex(p,d,new n.Vector2(w,1)),this.addPolyLineVertex(p,l.multiply(-1),new n.Vector2(w,0)),this.addIndices(),this.addFan(p,l.multiply(-1),c.multiply(-1),d,new n.Vector2(w,0),new n.Vector2(w,0),new n.Vector2(w,1),b),this.addPolyLineVertex(p,d,new n.Vector2(w,1)),this.addPolyLineVertex(p,c.multiply(-1),new n.Vector2(w,0))):(this.addPolyLineVertex(p,l,new n.Vector2(w,1)),this.addPolyLineVertex(p,d.multiply(-1),new n.Vector2(w,0)),this.addIndices(),this.addFan(p,l,c,d.multiply(-1),new n.Vector2(w,1),new n.Vector2(w,1),new n.Vector2(w,0),b),this.addPolyLineVertex(p,c,new n.Vector2(w,1)),this.addPolyLineVertex(p,d.multiply(-1),new n.Vector2(w,0)))}else this.addPolyLineVertex(p,d,new n.Vector2(w,1)),this.addPolyLineVertex(p,d.multiply(-1),new n.Vector2(w,0)),this.addIndices()}}o+=a.MathUtils.distance(p,g),r||(r=1);var x=r*(this.textureWidth/this.textureHeight);o=Math.round(o/x)*x,this.addPolyLineVertex(g,c,new n.Vector2(o,1)),this.addPolyLineVertex(g,c.multiply(-1),new n.Vector2(o,0)),this.addIndices(),this.closedPolyline||this.addCap(g,c,!1),e&&e()}},t.prototype.addCap=function(t,e,r){var o=r?0:1;switch(this.lineCapType){case s.LineCapType.Butt:break;case s.LineCapType.Square:var a=new n.Vector2(-e.y,e.x);this.addPolyLineVertex(t,e.add(a),new n.Vector2(o,0)),this.addPolyLineVertex(t,e.multiply(-1).add(a),new n.Vector2(o,0)),r||this.addIndices();break;case s.LineCapType.Round:var u=e,h=e.multiply(-1),f=new n.Vector2(0,0),l=new n.Vector2(o,1),c=new n.Vector2(o,0),d=new n.Vector2(o,.5);r&&(u=u.multiply(-1),h=h.multiply(-1),l.y=0,c.y=1),this.addFan(t,u,h,f,l,c,d,i.PolyConstants.numTrianglesOnRoundCap);break;default:console.log("Invalid line cap type")}},t.prototype.addPolyLineVertex=function(t,e,r){++this.numVertices,this.addVertex(t,e,r)},t.prototype.addIndices=function(){this.indices.push(this.numVertices-4),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-3),this.indices.push(this.numVertices-2),this.indices.push(this.numVertices-1)},t.prototype.addFan=function(t,e,r,i,o,a,s,u){var h=e.x*r.y-e.y*r.x,f=Math.atan2(h,e.dot(r)),l=this.numVertices;this.addPolyLineVertex(t,i,s),this.addPolyLineVertex(t,e,o);for(var c=e,d=0;d<u;d++){var p=(d+1)/u;c=e.rotateByRadian(f*p);var g=new n.Vector2(0,0);g=o.multiply(1-p).add(a.multiply(p)),this.addPolyLineVertex(t,c,g),this.indices.push(l),this.indices.push(l+d+(f>0?1:2)),this.indices.push(l+d+(f>0?2:1))}},t}();e.PolylineBuilderContext=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolylineUtils=void 0;var n=r(26),i=r(15),o=r(11),a=r(24),s=r(16),u=function(){function t(){}return t.getLongestSegmentLength=function(t){var e=i.MapUtils.getTileSize(),r=0;return t.forEach((function(t){if(t.getType()==n.GeometryType.LineString){for(var i=t.getGeometries().geometryCoordinates,s=0,u=0;u<i.length;++u){for(var h=[],f=0;f<i[u].length;++f){var l=new o.Vector2(i[u][f][0],i[u][f][1]);l.x=l.x*e,l.y=l.y*e,h.push(l)}for(f=0;f<h.length-1;++f)s+=a.MathUtils.distance(h[f],h[f+1])}s>r&&(r=s)}else console.warn("Invalid geometry type: "+t.getType())})),r},t.getLongestSegmentLengthForCollections=function(t,e){var r=0;return t.forEach((function(t){for(var n=t.geometryCoordinates,i=0,s=0;s<n.length;++s){for(var u=[],h=0;h<n[s].length;++h){var f=new o.Vector2(n[s][h][0],n[s][h][1]);f.x=f.x*e,f.y=f.y*e,u.push(f)}for(h=0;h<u.length-1;++h)i+=a.MathUtils.distance(u[h],u[h+1])}i>r&&(r=i)})),r},t.calculateDashTextureSize=function(t,e,r){t=t?Math.round(t):1,r instanceof s.DotPattern&&t<8&&(t=8);var n,i,o=a.MathUtils.findNextPowerOf2(t);if(r instanceof s.DotPattern)n=(n=o*(r.getRepeat()+1))>e?o:a.MathUtils.findNextPowerOf2(n),i=o;else if(r instanceof s.DashPattern){var u=r,h=u.getLength()+u.getGap();for(h>e&&(h=a.MathUtils.findPreviousPowerOf2(e)),n=o;n<h;)n+=o;n=a.MathUtils.findNextPowerOf2(n),i=o}return{width:n,height:i}},t.buildPatternItem=function(t){return!t||t.isSolid()?new s.SolidPattern:t.isDash()?new s.DashPattern({length:t.length,gap:t.gap}):t.isDot()?new s.DotPattern({repeat:t.repeat}):new s.IconPattern({url:t.texture})},t}();e.PolylineUtils=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(57);Object.defineProperty(e,"WorkerHelper",{enumerable:!0,get:function(){return n.WorkerHelper}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerHelper=void 0;var n=r(58),i=r(115),o=r(117),a=r(118),s=r(122),u=function(){function t(t){this.id=t}return t.prototype.abort=function(){null!=this.request&&this.request.abort()},t}(),h=function(){function t(){}return t.setupWorkerThread=function(){var t=this;self.onmessage=function(e){var r=e.data;"start-channel"==r?t.receivedPort=e.ports[0]:r.execute?t.execute(JSON.parse(r.payload)):t.cancel(JSON.parse(r.payload))}},t.getTexture=function(t,e){var r=this,o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){var e=new i.ResponseTask(t.id);if(200==o.status){e.success=!0;var a=n(o.response);if(!a)return e.success=!1,void r.receivedPort.postMessage(e);a.data=a.data.buffer,e.data=a,r.receivedPort.postMessage(e,[e.data.data])}else e.success=!1,r.receivedPort.postMessage(e)}},o.open("GET",t.url),o.responseType="arraybuffer",o.send(),e.request=o},t.getModel=function(t,e){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=new i.ResponseTask(t.id);if(200==n.status){e.success=!0;var o=a.ObjModelLoader.loadModel(n.responseText,!0);e.data=o,null!=o&&o.length>0?r.receivedPort.postMessage(e,[e.data[0].data]):(e.success=!1,r.receivedPort.postMessage(e))}else e.success=!1,r.receivedPort.postMessage(e)}},n.open("GET",t.url),n.send(),e.request=n},t.getTile=function(t,e){var r=this,o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){var e=new i.ResponseTask(t.id);if(200==o.status){e.success=!0;var a=JSON.parse(o.responseText);if(null==a.result)return e.success=!1,void r.receivedPort.postMessage(e);var u=a.result.rasterTile;if(null==u||u.startsWith("data:image"))a.result.rasterTile=null;else{var h=n(u="data:image;base64,"+u);h?(h.data=h.data.buffer,a.result.rasterTile=h):a.result.rasterTile=null}e.data=a;var f=[];if(a.result.vectorTile){var l=s.VectorTileParserWorker.parse(a.result.vectorTile,t.tile,t.config);a.result.vectorTile=l.vectorDatas,f=l.transferableDatas}null!=a.result.rasterTile&&f.push(e.data.result.rasterTile.data),r.receivedPort.postMessage(e,f)}else e.success=!1,r.receivedPort.postMessage(e)}},o.open(t.method,t.url,!0),null!=t.params&&o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),this.setHeaderInfo(o),o.send(t.params),e.request=o},t.getJsonData=function(t,e){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=new i.ResponseTask(t.id);200==n.status?(e.success=!0,e.data=n.responseText,r.receivedPort.postMessage(e)):(e.success=!1,r.receivedPort.postMessage(e))}},n.open(t.method,t.url,!0),null!=t.params&&n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json"),n.send(t.params),e.request=n},t.setHeaderInfo=function(t){t.setRequestHeader("Content-Language","__HEADER_SIGNATURE__")},t.getWeather=function(t,e){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=new i.ResponseTask(t.id);if(200==n.status){e.success=!0;var o=JSON.parse(n.responseText);e.data=o,r.receivedPort.postMessage(e)}else e.success=!1,r.receivedPort.postMessage(e)}},n.open(t.method,t.url,!0),null!=t.params&&n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Accept","application/json"),this.setHeaderInfo(n),n.send(t.params),e.request=n},t.execute=function(t){var e=new u(t.id);switch(this.executeTasks.push(e),t.type){case i.Resource.Texture:case i.Resource.CustomTexture:case i.Resource.TileOverlay:this.getTexture(t,e);break;case i.Resource.Tile:this.getTile(t,e);break;case i.Resource.Json:case i.Resource.BuildingOverlay:case i.Resource.POIOverlay:this.getJsonData(t,e);break;case i.Resource.Model:case i.Resource.CustomModel:this.getModel(t,e)}},t.cancel=function(t){var e=this.removeTask(t.id);null!=e&&e.abort()},t.removeTask=function(t){var e=this.executeTasks.findIndex((function(e){return e.id==t}));if(e>=0){var r=this.executeTasks[e];return this.executeTasks.splice(e,1),r}return null},t.executeTasks=[],t}();e.WorkerHelper=h,o.Thread.isWorker&&h.setupWorkerThread()},function(t,e,r){"use strict";var n=r(59),i=r(29);function o(t,e){if(!(t=i(t)))return null;e?"string"==typeof e&&(e={type:e}):e={};var r=e.type;if(!r){if(!(r=n(new Uint8Array(t))))return null;if(!o[r=r.mime])throw Error("Type `"+r+"` does not seem to be supported")}return o[r](t,e)}t.exports=o,o.png=o["image/png"]=r(67),o.gif=o["image/gif"]=r(97),o["image/jpeg"]=o["image/jpg"]=o.jpg=o.jpeg=r(99),o.bmp=o["image/bmp"]=o["image/bitmap"]=r(104),o.tiff=o["image/tiff"]=r(108),o.webp=o["image/webp"]=r(114)},function(t,e,r){"use strict";const n=r(60),i=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),o=t=>{const e=n(t);return i.has(e&&e.ext)?e:null};t.exports=o,t.exports.default=o,Object.defineProperty(o,"minimumBytes",{value:n.minimumBytes})},function(module,exports,__webpack_require__){"use strict";(function(Buffer){const toBytes=t=>[...t].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let r=t[e],n=1,i=0;for(;++i<8;)n*=256,r+=t[e+i]*n;return r}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \\`input\\` argument to be of type \\`Uint8Array\\` or \\`Buffer\\` or \\`ArrayBuffer\\`, got \\`${typeof t}\\``);const e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;const r=(t,r)=>{r=Object.assign({offset:0},r);for(let n=0;n<t.length;n++)if(r.mask){if(t[n]!==(r.mask[n]&e[n+r.offset]))return!1}else if(t[n]!==e[n+r.offset])return!1;return!0},n=(t,e)=>r(toBytes(t),e);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const t=(t,e=0)=>t.findIndex((t,r,n)=>r>=e&&80===n[r]&&75===n[r+1]&&3===n[r+2]&&4===n[r+3]);let i=0,o=!1,a=null;do{const s=i+30;if(o||(o=r(oxmlContentTypes,{offset:s})||r(oxmlRels,{offset:s})),a||(n("word/",{offset:s})?a={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:s})?a={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:s})&&(a={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),o&&a)return a;i=t(e,s)}while(i>=0);if(a)return a}if(r([80,75])&&(3===e[2]||5===e[2]||7===e[2])&&(4===e[3]||6===e[3]||8===e[3]))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(0===e[6]||1===e[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const t=e.subarray(4,4100),r=t.findIndex((t,e,r)=>66===r[e]&&130===r[e+1]);if(-1!==r){const e=r+3,n=r=>[...r].every((r,n)=>t[e+n]===r.charCodeAt(0));if(n("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(n("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let t=30;do{const n=readUInt64LE(e,t+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:t})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}t+=n}while(t+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let t=0;t<2&&t<e.length-16;t++){if(r([73,68,51],{offset:t})||r([255,226],{offset:t,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:t,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:t,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:t,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((67===e[0]||70===e[0])&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])||r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(t){reject(t)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})}).call(this,__webpack_require__(0).Buffer)},function(t,e,r){"use strict";e.byteLength=function(t){var e=h(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,n=h(t),a=n[0],s=n[1],u=new o(function(t,e,r){return 3*(e+r)/4-r}(0,a,s)),f=0,l=s>0?a-4:a;for(r=0;r<l;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;2===s&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,u[f++]=255&e);1===s&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e);return u},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(f(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function f(t,e,r){for(var i,o,a=[],s=e;s<r;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e,r){"use strict";var n=r(63),i=r(64);function o(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e.buffer}t.exports=function(t){if("string"!=typeof t)throw Error("Argument should be a string");return/^data\\:/i.test(t)?function(t){var e=(t=t.replace(/\\r?\\n/g,"")).indexOf(",");if(-1===e||e<=4)throw new TypeError("malformed data-URI");for(var r=t.substring(5,e).split(";"),i=!1,a="US-ASCII",s=0;s<r.length;s++)"base64"==r[s]?i=!0:0==r[s].indexOf("charset=")&&(a=r[s].substring(8));var u=unescape(t.substring(e+1));i&&(u=n(u));var h=o(u);return h.type=r[0]||"text/plain",h.charset=a,h}(t):(i(t)&&(t=n(t)),o(t))}},function(t,e){t.exports=function(t){return atob(t)}},function(t,e,r){!function(r){"use strict";function n(t,e){if(t instanceof Boolean||"boolean"==typeof t)return!1;if(e instanceof Object||(e={}),e.hasOwnProperty("allowBlank")&&!e.allowBlank&&""===t)return!1;var r="(?:[A-Za-z0-9+\\\\/]{4})*(?:[A-Za-z0-9+\\\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return e.mime&&(r="(data:\\\\w+\\\\/[a-zA-Z\\\\+\\\\-\\\\.]+;base64,)?"+r),!1===e.paddingRequired&&(r="(?:[A-Za-z0-9+\\\\/]{4})*(?:[A-Za-z0-9+\\\\/]{2}(==)?|[A-Za-z0-9+\\\\/]{3}=?)?"),new RegExp("^"+r+"$","gi").test(t)}t.exports&&(e=t.exports=n),e.isBase64=n}()},function(t,e,r){var n=r(66);t.exports=function(t,e,r){if(!t)throw new TypeError("must specify data as first parameter");if(r=0|+(r||0),Array.isArray(t)&&t[0]&&"number"==typeof t[0][0]){var i,o,a,s,u=t[0].length,h=t.length*u;e&&"string"!=typeof e||(e=new(n(e||"float32"))(h+r));var f=e.length-r;if(h!==f)throw new Error("source length "+h+" ("+u+"x"+t.length+") does not match destination length "+f);for(i=0,a=r;i<t.length;i++)for(o=0;o<u;o++)e[a++]=null===t[i][o]?NaN:t[i][o]}else if(e&&"string"!=typeof e)e.set(t,r);else{var l=n(e||"float32");if(Array.isArray(t)||"array"===e)for(e=new l(t.length+r),i=0,a=r,s=e.length;a<s;a++,i++)e[a]=null===t[i]?NaN:t[i];else 0===r?e=new l(t):(e=new l(t.length+r)).set(t,r)}return e}},function(t,e){t.exports=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},function(t,e,r){"use strict";(function(e){var n=r(68).PNG,i=r(29);t.exports=function(t,r){var o=n.sync.read(e.from(t));return{data:new Uint8Array(i(o.data)),width:0|o.width,height:0|o.height}}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(t,n){var i=r(2),o=r(12),a=r(82),s=r(89),u=r(92),h=e.PNG=function(e){o.call(this),e=e||{},this.width=0|e.width,this.height=0|e.height,this.data=this.width>0&&this.height>0?new t(4*this.width*this.height):null,e.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new a(e),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new s(e),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};i.inherits(h,o),h.sync=u,h.prototype.pack=function(){return this.data&&this.data.length?(n.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)),this):(this.emit("error","No data provided"),this)},h.prototype.parse=function(t,e){var r,n;e&&(r=function(t){this.removeListener("error",n),this.data=t,e(null,this)}.bind(this),n=function(t){this.removeListener("parsed",r),e(t,null)}.bind(this),this.once("parsed",r),this.once("error",n));return this.end(t),this},h.prototype.write=function(t){return this._parser.write(t),!0},h.prototype.end=function(t){this._parser.end(t)},h.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},h.prototype._gamma=function(t){this.gamma=t},h.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},h.bitblt=function(t,e,r,n,i,o,a,s){if(n|=0,i|=0,o|=0,a|=0,s|=0,(r|=0)>t.width||n>t.height||r+i>t.width||n+o>t.height)throw new Error("bitblt reading outside image");if(a>e.width||s>e.height||a+i>e.width||s+o>e.height)throw new Error("bitblt writing outside image");for(var u=0;u<o;u++)t.data.copy(e.data,(s+u)*e.width+a<<2,(n+u)*t.width+r<<2,(n+u)*t.width+r+i<<2)},h.prototype.bitblt=function(t,e,r,n,i,o,a){return h.bitblt(this,t,e,r,n,i,o,a),this},h.adjustGamma=function(t){if(t.gamma){for(var e=0;e<t.height;e++)for(var r=0;r<t.width;r++)for(var n=t.width*e+r<<2,i=0;i<3;i++){var o=t.data[n+i]/255;o=Math.pow(o,1/2.2/t.gamma),t.data[n+i]=Math.round(255*o)}t.gamma=0}},h.prototype.adjustGamma=function(){h.adjustGamma(this)}}).call(this,r(0).Buffer,r(1))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e){},function(t,e,r){"use strict";var n=r(14).Buffer,i=r(73);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e,r,i,o=n.allocUnsafe(t>>>0),a=this.head,s=0;a;)e=a.data,r=o,i=s,e.copy(r,i),s+=a.data.length,a=a.next;return o},t}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,r){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},r(75),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(4))},function(t,e,r){(function(t,e){!function(t,r){"use strict";if(!t.setImmediate){var n,i,o,a,s,u=1,h={},f=!1,l=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick((function(){p(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},n=function(t){o.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,n=function(t){var e=l.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):n=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),n=function(e){t.postMessage(a+e,"*")}),c.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var i={callback:t,args:e};return h[u]=i,n(u),u++},c.clearImmediate=d}function d(t){delete h[t]}function p(t){if(f)setTimeout(p,0,t);else{var e=h[t];if(e){f=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(void 0,r)}}(e)}finally{d(t),f=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,r(4),r(1))},function(t,e,r){(function(e){function r(t){try{if(!e.localStorage)return!1}catch(t){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function(t,e){if(r("noDeprecation"))return t;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(e);r("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this,r(4))},function(t,e,r){"use strict";t.exports=o;var n=r(34),i=Object.create(r(8));function o(t){if(!(this instanceof o))return new o(t);n.call(this,t)}i.inherits=r(7),i.inherits(o,n),o.prototype._transform=function(t,e,r){r(null,t)}},function(t,e,r){t.exports=r(19)},function(t,e,r){t.exports=r(5)},function(t,e,r){t.exports=r(18).Transform},function(t,e,r){t.exports=r(18).PassThrough},function(t,e,r){"use strict";var n=r(2),i=r(9),o=r(39),a=r(88),s=r(43),u=r(45),h=r(46),f=t.exports=function(t){o.call(this),this._parser=new s(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(f,o),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=i.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var e=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,r=Math.max(e,i.Z_MIN_CHUNK);this._inflate=i.createInflate({chunkSize:r});var n=e,o=this.emit.bind(this,"error");this._inflate.on("error",(function(t){n&&o(t)})),this._filter.on("complete",this._complete.bind(this));var a=this._filter.write.bind(this._filter);this._inflate.on("data",(function(t){n&&(t.length>n&&(t=t.slice(0,n)),n-=t.length,a(t))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new a(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"),this.destroySoon())},f.prototype._complete=function(t){if(!this.errord){try{var e=u.dataToBitMap(t,this._bitmapInfo),r=h(e,this._bitmapInfo);e=null}catch(t){return void this._handleError(t)}this.emit("parsed",r)}}},function(t,e,r){"use strict";(function(t,n){var i=r(20),o=r(21),a=r(35),s=r(38),u=r(23);for(var h in u)e[h]=u[h];e.NONE=0,e.DEFLATE=1,e.INFLATE=2,e.GZIP=3,e.GUNZIP=4,e.DEFLATERAW=5,e.INFLATERAW=6,e.UNZIP=7;function f(t){if("number"!=typeof t||t<e.DEFLATE||t>e.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}f.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=e.UNZIP),this.mode===e.DEFLATE||this.mode===e.GZIP||this.mode===e.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==e.INFLATE&&this.mode!==e.GUNZIP&&this.mode!==e.INFLATERAW&&this.mode!==e.UNZIP||s.inflateEnd(this.strm),this.mode=e.NONE,this.dictionary=null)},f.prototype.write=function(t,e,r,n,i,o,a){return this._write(!0,t,e,r,n,i,o,a)},f.prototype.writeSync=function(t,e,r,n,i,o,a){return this._write(!1,t,e,r,n,i,o,a)},f.prototype._write=function(r,o,a,s,u,h,f,l){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==e.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===o,"must provide flush value"),this.write_in_progress=!0,o!==e.Z_NO_FLUSH&&o!==e.Z_PARTIAL_FLUSH&&o!==e.Z_SYNC_FLUSH&&o!==e.Z_FULL_FLUSH&&o!==e.Z_FINISH&&o!==e.Z_BLOCK)throw new Error("Invalid flush value");if(null==a&&(a=t.alloc(0),u=0,s=0),this.strm.avail_in=u,this.strm.input=a,this.strm.next_in=s,this.strm.avail_out=l,this.strm.output=h,this.strm.next_out=f,this.flush=o,!r)return this._process(),this._checkError()?this._afterSync():void 0;var c=this;return n.nextTick((function(){c._process(),c._after()})),this},f.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},f.prototype._process=function(){var t=null;switch(this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case e.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=e.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;139===this.strm.input[t]?(this.gzip_id_bytes_read=2,this.mode=e.GUNZIP):this.mode=e.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===e.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===e.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===e.Z_DATA_ERROR&&(this.err=e.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===e.GUNZIP&&this.err===e.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},f.prototype._checkError=function(){switch(this.err){case e.Z_OK:case e.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===e.Z_FINISH)return this._error("unexpected end of file"),!1;break;case e.Z_STREAM_END:break;case e.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},f.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,e=this.strm.avail_in;this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close()}},f.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},f.prototype.init=function(t,r,n,o,a){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(t>=8&&t<=15,"invalid windowBits"),i(r>=-1&&r<=9,"invalid compression level"),i(n>=1&&n<=9,"invalid memlevel"),i(o===e.Z_FILTERED||o===e.Z_HUFFMAN_ONLY||o===e.Z_RLE||o===e.Z_FIXED||o===e.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,t,n,o,a),this._setDictionary()},f.prototype.params=function(){throw new Error("deflateParams Not supported")},f.prototype.reset=function(){this._reset(),this._setDictionary()},f.prototype._init=function(t,r,n,i,u){switch(this.level=t,this.windowBits=r,this.memLevel=n,this.strategy=i,this.flush=e.Z_NO_FLUSH,this.err=e.Z_OK,this.mode!==e.GZIP&&this.mode!==e.GUNZIP||(this.windowBits+=16),this.mode===e.UNZIP&&(this.windowBits+=32),this.mode!==e.DEFLATERAW&&this.mode!==e.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new o,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,e.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:case e.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==e.Z_OK&&this._error("Init error"),this.dictionary=u,this.write_in_progress=!1,this.init_done=!0},f.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==e.Z_OK&&this._error("Failed to set dictionary")}},f.prototype._reset=function(){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:case e.GZIP:this.err=a.deflateReset(this.strm);break;case e.INFLATE:case e.INFLATERAW:case e.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==e.Z_OK&&this._error("Failed to reset stream")},e.Zlib=f}).call(this,r(0).Buffer,r(1))},function(t,e,r){"use strict";\r\n/*\r\nobject-assign\r\n(c) Sindre Sorhus\r\n@license MIT\r\n*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,s,u=a(t),h=1;h<arguments.length;h++){for(var f in r=Object(arguments[h]))i.call(r,f)&&(u[f]=r[f]);if(n){s=n(r);for(var l=0;l<s.length;l++)o.call(r,s[l])&&(u[s[l]]=r[s[l]])}}return u}},function(t,e,r){"use strict";var n=r(3);function i(t){for(var e=t.length;--e>=0;)t[e]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576);i(h);var f=new Array(60);i(f);var l=new Array(512);i(l);var c=new Array(256);i(c);var d=new Array(29);i(d);var p,g,v,y=new Array(30);function m(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function _(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function w(t){return t<256?l[t]:l[256+(t>>>7)]}function b(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function x(t,e,r){t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function E(t,e,r){x(t,r[2*e],r[2*e+1])}function k(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function S(t,e,r){var n,i,o=new Array(16),a=0;for(n=1;n<=15;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=k(o[s]++,s))}}function T(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function P(t){t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function A(t,e,r,n){var i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]}function L(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&A(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!A(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function I(t,e,r){var n,i,s,u,h=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],i=t.pending_buf[t.l_buf+h],h++,0===n?E(t,i,e):(E(t,(s=c[i])+256+1,e),0!==(u=o[s])&&x(t,i-=d[s],u),E(t,s=w(--n),r),0!==(u=a[s])&&x(t,n-=y[s],u))}while(h<t.last_lit);E(t,256,e)}function M(t,e){var r,n,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<u;r++)0!==o[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):o[2*r+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=h,r=t.heap_len>>1;r>=1;r--)L(t,o,r);i=u;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],L(t,o,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,o[2*i]=o[2*r]+o[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,o[2*r+1]=o[2*n+1]=i,t.heap[1]=i++,L(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,n,i,o,a,s,u=e.dyn_tree,h=e.max_code,f=e.stat_desc.static_tree,l=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(o=0;o<=15;o++)t.bl_count[o]=0;for(u[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<573;r++)(o=u[2*u[2*(n=t.heap[r])+1]+1]+1)>p&&(o=p,g++),u[2*n+1]=o,n>h||(t.bl_count[o]++,a=0,n>=d&&(a=c[n-d]),s=u[2*n],t.opt_len+=s*(o+a),l&&(t.static_len+=s*(f[2*n+1]+a)));if(0!==g){do{for(o=p-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(o=p;0!==o;o--)for(n=t.bl_count[o];0!==n;)(i=t.heap[--r])>h||(u[2*i+1]!==o&&(t.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),n--)}}(t,e),S(o,h,t.bl_count)}function O(t,e,r){var n,i,o=-1,a=e[1],s=0,u=7,h=4;for(0===a&&(u=138,h=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++s<u&&i===a||(s<h?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,o=i,0===a?(u=138,h=3):i===a?(u=6,h=3):(u=7,h=4))}function R(t,e,r){var n,i,o=-1,a=e[1],s=0,u=7,h=4;for(0===a&&(u=138,h=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++s<u&&i===a)){if(s<h)do{E(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(E(t,i,t.bl_tree),s--),E(t,16,t.bl_tree),x(t,s-3,2)):s<=10?(E(t,17,t.bl_tree),x(t,s-3,3)):(E(t,18,t.bl_tree),x(t,s-11,7));s=0,o=i,0===a?(u=138,h=3):i===a?(u=6,h=3):(u=7,h=4)}}i(y);var C=!1;function B(t,e,r,i){x(t,0+(i?1:0),3),function(t,e,r,i){P(t),i&&(b(t,r),b(t,~r)),n.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r,!0)}e._tr_init=function(t){C||(!function(){var t,e,r,n,i,u=new Array(16);for(r=0,n=0;n<28;n++)for(d[n]=r,t=0;t<1<<o[n];t++)c[r++]=n;for(c[r-1]=n,i=0,n=0;n<16;n++)for(y[n]=i,t=0;t<1<<a[n];t++)l[i++]=n;for(i>>=7;n<30;n++)for(y[n]=i<<7,t=0;t<1<<a[n]-7;t++)l[256+i++]=n;for(e=0;e<=15;e++)u[e]=0;for(t=0;t<=143;)h[2*t+1]=8,t++,u[8]++;for(;t<=255;)h[2*t+1]=9,t++,u[9]++;for(;t<=279;)h[2*t+1]=7,t++,u[7]++;for(;t<=287;)h[2*t+1]=8,t++,u[8]++;for(S(h,287,u),t=0;t<30;t++)f[2*t+1]=5,f[2*t]=k(t,5);p=new m(h,o,257,286,15),g=new m(f,a,0,30,15),v=new m(new Array(0),s,0,19,7)}(),C=!0),t.l_desc=new _(t.dyn_ltree,p),t.d_desc=new _(t.dyn_dtree,g),t.bl_desc=new _(t.bl_tree,v),t.bi_buf=0,t.bi_valid=0,T(t)},e._tr_stored_block=B,e._tr_flush_block=function(t,e,r,n){var i,o,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),M(t,t.l_desc),M(t,t.d_desc),a=function(t){var e;for(O(t,t.dyn_ltree,t.l_desc.max_code),O(t,t.dyn_dtree,t.d_desc.max_code),M(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*u[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==e?B(t,e,r,n):4===t.strategy||o===i?(x(t,2+(n?1:0),3),I(t,h,f)):(x(t,4+(n?1:0),3),function(t,e,r,n){var i;for(x(t,e-257,5),x(t,r-1,5),x(t,n-4,4),i=0;i<n;i++)x(t,t.bl_tree[2*u[i]+1],3);R(t,t.dyn_ltree,e-1),R(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),I(t,t.dyn_ltree,t.dyn_dtree)),T(t),n&&P(t)},e._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(c[r]+256+1)]++,t.dyn_dtree[2*w(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){x(t,2,3),E(t,256,h),function(t){16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,r){"use strict";t.exports=function(t,e){var r,n,i,o,a,s,u,h,f,l,c,d,p,g,v,y,m,_,w,b,x,E,k,S,T;r=t.state,n=t.next_in,S=t.input,i=n+(t.avail_in-5),o=t.next_out,T=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,h=r.wsize,f=r.whave,l=r.wnext,c=r.window,d=r.hold,p=r.bits,g=r.lencode,v=r.distcode,y=(1<<r.lenbits)-1,m=(1<<r.distbits)-1;t:do{p<15&&(d+=S[n++]<<p,p+=8,d+=S[n++]<<p,p+=8),_=g[d&y];e:for(;;){if(d>>>=w=_>>>24,p-=w,0===(w=_>>>16&255))T[o++]=65535&_;else{if(!(16&w)){if(0==(64&w)){_=g[(65535&_)+(d&(1<<w)-1)];continue e}if(32&w){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}b=65535&_,(w&=15)&&(p<w&&(d+=S[n++]<<p,p+=8),b+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=S[n++]<<p,p+=8,d+=S[n++]<<p,p+=8),_=v[d&m];r:for(;;){if(d>>>=w=_>>>24,p-=w,!(16&(w=_>>>16&255))){if(0==(64&w)){_=v[(65535&_)+(d&(1<<w)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(x=65535&_,p<(w&=15)&&(d+=S[n++]<<p,(p+=8)<w&&(d+=S[n++]<<p,p+=8)),(x+=d&(1<<w)-1)>u){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=w,p-=w,x>(w=o-a)){if((w=x-w)>f&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=0,k=c,0===l){if(E+=h-w,w<b){b-=w;do{T[o++]=c[E++]}while(--w);E=o-x,k=T}}else if(l<w){if(E+=h+l-w,(w-=l)<b){b-=w;do{T[o++]=c[E++]}while(--w);if(E=0,l<b){b-=w=l;do{T[o++]=c[E++]}while(--w);E=o-x,k=T}}}else if(E+=l-w,w<b){b-=w;do{T[o++]=c[E++]}while(--w);E=o-x,k=T}for(;b>2;)T[o++]=k[E++],T[o++]=k[E++],T[o++]=k[E++],b-=3;b&&(T[o++]=k[E++],b>1&&(T[o++]=k[E++]))}else{E=o-x;do{T[o++]=T[E++],T[o++]=T[E++],T[o++]=T[E++],b-=3}while(b>2);b&&(T[o++]=T[E++],b>1&&(T[o++]=T[E++]))}break}}break}}while(n<i&&o<s);n-=b=p>>3,d&=(1<<(p-=b<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},function(t,e,r){"use strict";var n=r(3),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,r,u,h,f,l,c){var d,p,g,v,y,m,_,w,b,x=c.bits,E=0,k=0,S=0,T=0,P=0,A=0,L=0,I=0,M=0,O=0,R=null,C=0,B=new n.Buf16(16),U=new n.Buf16(16),D=null,F=0;for(E=0;E<=15;E++)B[E]=0;for(k=0;k<u;k++)B[e[r+k]]++;for(P=x,T=15;T>=1&&0===B[T];T--);if(P>T&&(P=T),0===T)return h[f++]=20971520,h[f++]=20971520,c.bits=1,0;for(S=1;S<T&&0===B[S];S++);for(P<S&&(P=S),I=1,E=1;E<=15;E++)if(I<<=1,(I-=B[E])<0)return-1;if(I>0&&(0===t||1!==T))return-1;for(U[1]=0,E=1;E<15;E++)U[E+1]=U[E]+B[E];for(k=0;k<u;k++)0!==e[r+k]&&(l[U[e[r+k]]++]=k);if(0===t?(R=D=l,m=19):1===t?(R=i,C-=257,D=o,F-=257,m=256):(R=a,D=s,m=-1),O=0,k=0,E=S,y=f,A=P,L=0,g=-1,v=(M=1<<P)-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){_=E-L,l[k]<m?(w=0,b=l[k]):l[k]>m?(w=D[F+l[k]],b=R[C+l[k]]):(w=96,b=0),d=1<<E-L,S=p=1<<A;do{h[y+(O>>L)+(p-=d)]=_<<24|w<<16|b|0}while(0!==p);for(d=1<<E-1;O&d;)d>>=1;if(0!==d?(O&=d-1,O+=d):O=0,k++,0==--B[E]){if(E===T)break;E=e[r+l[k]]}if(E>P&&(O&v)!==g){for(0===L&&(L=P),y+=S,I=1<<(A=E-L);A+L<T&&!((I-=B[A+L])<=0);)A++,I<<=1;if(M+=1<<A,1===t&&M>852||2===t&&M>592)return 1;h[g=O&v]=P<<24|A<<16|y-f|0}}return 0!==O&&(h[y+O]=E-L<<24|64<<16|0),c.bits=P,0}},function(t,e,r){"use strict";(function(e){var n=r(2),i=r(39),o=r(40),a=t.exports=function(t){i.call(this);var r=[],n=this;this._filter=new o(t,{read:this.read.bind(this),write:function(t){r.push(t)},complete:function(){n.emit("complete",e.concat(r))}}),this._filter.start()};n.inherits(a,i)}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(2),i=r(12),o=r(10),a=r(47),s=t.exports=function(t){i.call(this);var e=t||{};this._packer=new a(e),this._deflate=this._packer.createDeflate(),this.readable=!0};n.inherits(s,i),s.prototype.pack=function(t,r,n,i){this.emit("data",new e(o.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(r,n)),i&&this.emit("data",this._packer.packGAMA(i));var a=this._packer.filterData(t,r,n);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(a)}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(10);t.exports=function(t,r,i,o){var a,s=-1!==[n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(o.colorType);if(o.colorType===o.inputColorType){var u=(a=new ArrayBuffer(2),new DataView(a).setInt16(0,256,!0),256!==new Int16Array(a)[0]);if(8===o.bitDepth||16===o.bitDepth&&u)return t}var h=16!==o.bitDepth?t:new Uint16Array(t.buffer),f=255,l=n.COLORTYPE_TO_BPP_MAP[o.inputColorType];4!==l||o.inputHasAlpha||(l=3);var c=n.COLORTYPE_TO_BPP_MAP[o.colorType];16===o.bitDepth&&(f=65535,c*=2);var d=new e(r*i*c),p=0,g=0,v=o.bgColor||{};function y(){var t,e,r,i=f;switch(o.inputColorType){case n.COLORTYPE_COLOR_ALPHA:i=h[p+3],t=h[p],e=h[p+1],r=h[p+2];break;case n.COLORTYPE_COLOR:t=h[p],e=h[p+1],r=h[p+2];break;case n.COLORTYPE_ALPHA:i=h[p+1],e=t=h[p],r=t;break;case n.COLORTYPE_GRAYSCALE:e=t=h[p],r=t;break;default:throw new Error("input color type:"+o.inputColorType+" is not supported at present")}return o.inputHasAlpha&&(s||(i/=f,t=Math.min(Math.max(Math.round((1-i)*v.red+i*t),0),f),e=Math.min(Math.max(Math.round((1-i)*v.green+i*e),0),f),r=Math.min(Math.max(Math.round((1-i)*v.blue+i*r),0),f))),{red:t,green:e,blue:r,alpha:i}}void 0===v.red&&(v.red=f),void 0===v.green&&(v.green=f),void 0===v.blue&&(v.blue=f);for(var m=0;m<i;m++)for(var _=0;_<r;_++){var w=y();switch(o.colorType){case n.COLORTYPE_COLOR_ALPHA:case n.COLORTYPE_COLOR:8===o.bitDepth?(d[g]=w.red,d[g+1]=w.green,d[g+2]=w.blue,s&&(d[g+3]=w.alpha)):(d.writeUInt16BE(w.red,g),d.writeUInt16BE(w.green,g+2),d.writeUInt16BE(w.blue,g+4),s&&d.writeUInt16BE(w.alpha,g+6));break;case n.COLORTYPE_ALPHA:case n.COLORTYPE_GRAYSCALE:var b=(w.red+w.green+w.blue)/3;8===o.bitDepth?(d[g]=b,s&&(d[g+1]=w.alpha)):(d.writeUInt16BE(b,g),s&&d.writeUInt16BE(w.alpha,g+2));break;default:throw new Error("unrecognised color Type "+o.colorType)}p+=l,g+=c}return d}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(42);var i={0:function(t,e,r,n,i){for(var o=0;o<r;o++)n[i+o]=t[e+o]},1:function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=a>=o?t[e+a-o]:0,u=t[e+a]-s;n[i+a]=u}},2:function(t,e,r,n,i){for(var o=0;o<r;o++){var a=e>0?t[e+o-r]:0,s=t[e+o]-a;n[i+o]=s}},3:function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=a>=o?t[e+a-o]:0,u=e>0?t[e+a-r]:0,h=t[e+a]-(s+u>>1);n[i+a]=h}},4:function(t,e,r,i,o,a){for(var s=0;s<r;s++){var u=s>=a?t[e+s-a]:0,h=e>0?t[e+s-r]:0,f=e>0&&s>=a?t[e+s-(r+a)]:0,l=t[e+s]-n(u,h,f);i[o+s]=l}}},o={0:function(t,e,r){for(var n=0,i=e+r,o=e;o<i;o++)n+=Math.abs(t[o]);return n},1:function(t,e,r,n){for(var i=0,o=0;o<r;o++){var a=o>=n?t[e+o-n]:0,s=t[e+o]-a;i+=Math.abs(s)}return i},2:function(t,e,r){for(var n=0,i=e+r,o=e;o<i;o++){var a=e>0?t[o-r]:0,s=t[o]-a;n+=Math.abs(s)}return n},3:function(t,e,r,n){for(var i=0,o=0;o<r;o++){var a=o>=n?t[e+o-n]:0,s=e>0?t[e+o-r]:0,u=t[e+o]-(a+s>>1);i+=Math.abs(u)}return i},4:function(t,e,r,i){for(var o=0,a=0;a<r;a++){var s=a>=i?t[e+a-i]:0,u=e>0?t[e+a-r]:0,h=e>0&&a>=i?t[e+a-(r+i)]:0,f=t[e+a]-n(s,u,h);o+=Math.abs(f)}return o}};t.exports=function(t,r,n,a,s){var u;if("filterType"in a&&-1!==a.filterType){if("number"!=typeof a.filterType)throw new Error("unrecognised filter types");u=[a.filterType]}else u=[0,1,2,3,4];16===a.bitDepth&&(s*=2);for(var h=r*s,f=0,l=0,c=new e((h+1)*n),d=u[0],p=0;p<n;p++){if(u.length>1)for(var g=1/0,v=0;v<u.length;v++){var y=o[u[v]](t,l,h,s);y<g&&(d=u[v],g=y)}c[f]=d,f++,i[d](t,l,h,c,f,s),f+=h,l+=h}return c}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";var n=r(93),i=r(96);e.read=function(t,e){return n(t,e||{})},e.write=function(t,e){return i(t,e)}},function(t,e,r){"use strict";(function(e){var n=!0,i=r(9),o=r(94);i.deflateSync||(n=!1);var a=r(48),s=r(95),u=r(43),h=r(45),f=r(46);t.exports=function(t,r){if(!n)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var l,c,d;var p=[];var g=new a(t);if(new u(r,{read:g.read.bind(g),error:function(t){l=t},metadata:function(t){c=t},gamma:function(t){d=t},palette:function(t){c.palette=t},transColor:function(t){c.transColor=t},inflateData:function(t){p.push(t)},simpleTransparency:function(){c.alpha=!0}}).start(),g.process(),l)throw l;var v,y=e.concat(p);if(p.length=0,c.interlace)v=i.inflateSync(y);else{var m=(1+(c.width*c.bpp*c.depth+7>>3))*c.height;v=o(y,{chunkSize:m,maxLength:m})}if(y=null,!v||!v.length)throw new Error("bad png - invalid inflate data response");var _=s.process(v,c);y=null;var w=h.dataToBitMap(_,c);_=null;var b=f(w,c);return c.data=b,c.gamma=d||0,c}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(n,i){var o=r(20).ok,a=r(9),s=r(2),u=r(0).kMaxLength;function h(t){if(!(this instanceof h))return new h(t);t&&t.chunkSize<a.Z_MIN_CHUNK&&(t.chunkSize=a.Z_MIN_CHUNK),a.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function f(t,e){e&&n.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function l(t,e){return function(t,e){if("string"==typeof e&&(e=i.from(e)),!(e instanceof i))throw new TypeError("Not a string or buffer");var r=t._finishFlushFlag;return null==r&&(r=a.Z_FINISH),t._processChunk(e,r)}(new h(e),t)}h.prototype._processChunk=function(t,e,r){if("function"==typeof r)return a.Inflate._processChunk.call(this,t,e,r);var n,s=this,h=t&&t.length,l=this._chunkSize-this._offset,c=this._maxLength,d=0,p=[],g=0;function v(t,e){if(!s._hadError){var r=l-e;if(o(r>=0,"have should not go down"),r>0){var n=s._buffer.slice(s._offset,s._offset+r);if(s._offset+=r,n.length>c&&(n=n.slice(0,c)),p.push(n),g+=n.length,0===(c-=n.length))return!1}return(0===e||s._offset>=s._chunkSize)&&(l=s._chunkSize,s._offset=0,s._buffer=i.allocUnsafe(s._chunkSize)),0===e&&(d+=h-t,h=t,!0)}}this.on("error",(function(t){n=t})),o(this._handle,"zlib binding closed");do{var y=this._handle.writeSync(e,t,d,h,this._buffer,this._offset,l);y=y||this._writeState}while(!this._hadError&&v(y[0],y[1]));if(this._hadError)throw n;if(g>=u)throw f(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+u.toString(16)+" bytes");var m=i.concat(p,g);return f(this),m},s.inherits(h,a.Inflate),t.exports=e=l,e.Inflate=h,e.createInflate=function(t){return new h(t)},e.inflateSync=l}).call(this,r(1),r(0).Buffer)},function(t,e,r){"use strict";(function(t){var n=r(48),i=r(40);e.process=function(e,r){var o=[],a=new n(e);return new i(r,{read:a.read.bind(a),write:function(t){o.push(t)},complete:function(){}}).start(),a.process(),t.concat(o)}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=!0,i=r(9);i.deflateSync||(n=!1);var o=r(10),a=r(47);t.exports=function(t,r){if(!n)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var s=new a(r||{}),u=[];u.push(new e(o.PNG_SIGNATURE)),u.push(s.packIHDR(t.width,t.height)),t.gamma&&u.push(s.packGAMA(t.gamma));var h=s.filterData(t.data,t.width,t.height),f=i.deflateSync(h,s.getDeflateOptions());if(h=null,!f||!f.length)throw new Error("bad png - invalid compressed data response");return u.push(s.packIDAT(f)),u.push(s.packIEND()),e.concat(u)}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(98).GifReader;t.exports=function(t,r){var i=new n(e.from(t)),o=new Uint8Array(i.width*i.height*4);return i.decodeAndBlitFrameRGBA(0,o),{data:o,width:i.width,height:i.height}}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";function n(t,e,r,n){for(var i=t[e++],o=1<<i,a=o+1,s=a+1,u=i+1,h=(1<<u)-1,f=0,l=0,c=0,d=t[e++],p=new Int32Array(4096),g=null;;){for(;f<16&&0!==d;)l|=t[e++]<<f,f+=8,1===d?d=t[e++]:--d;if(f<u)break;var v=l&h;if(l>>=u,f-=u,v!==o){if(v===a)break;for(var y=v<s?v:g,m=0,_=y;_>o;)_=p[_]>>8,++m;var w=_;if(c+m+(y!==v?1:0)>n)return void console.log("Warning, gif stream longer than expected.");r[c++]=w;var b=c+=m;for(y!==v&&(r[c++]=w),_=y;m--;)_=p[_],r[--b]=255&_,_>>=8;null!==g&&s<4096&&(p[s++]=g<<8|w,s>=h+1&&u<12&&(++u,h=h<<1|1)),g=v}else s=a+1,h=(1<<(u=i+1))-1,g=null}return c!==n&&console.log("Warning, gif stream shorter than expected."),r}try{e.GifWriter=function(t,e,r,n){var i=0,o=void 0===(n=void 0===n?{}:n).loop?null:n.loop,a=void 0===n.palette?null:n.palette;if(e<=0||r<=0||e>65535||r>65535)throw new Error("Width/Height invalid.");function s(t){var e=t.length;if(e<2||e>256||e&e-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return e}t[i++]=71,t[i++]=73,t[i++]=70,t[i++]=56,t[i++]=57,t[i++]=97;var u=0,h=0;if(null!==a){for(var f=s(a);f>>=1;)++u;if(f=1<<u,--u,void 0!==n.background){if((h=n.background)>=f)throw new Error("Background index out of range.");if(0===h)throw new Error("Background index explicitly passed as 0.")}}if(t[i++]=255&e,t[i++]=e>>8&255,t[i++]=255&r,t[i++]=r>>8&255,t[i++]=(null!==a?128:0)|u,t[i++]=h,t[i++]=0,null!==a)for(var l=0,c=a.length;l<c;++l){var d=a[l];t[i++]=d>>16&255,t[i++]=d>>8&255,t[i++]=255&d}if(null!==o){if(o<0||o>65535)throw new Error("Loop count invalid.");t[i++]=33,t[i++]=255,t[i++]=11,t[i++]=78,t[i++]=69,t[i++]=84,t[i++]=83,t[i++]=67,t[i++]=65,t[i++]=80,t[i++]=69,t[i++]=50,t[i++]=46,t[i++]=48,t[i++]=3,t[i++]=1,t[i++]=255&o,t[i++]=o>>8&255,t[i++]=0}var p=!1;this.addFrame=function(e,r,n,o,u,h){if(!0===p&&(--i,p=!1),h=void 0===h?{}:h,e<0||r<0||e>65535||r>65535)throw new Error("x/y invalid.");if(n<=0||o<=0||n>65535||o>65535)throw new Error("Width/Height invalid.");if(u.length<n*o)throw new Error("Not enough pixels for the frame size.");var f=!0,l=h.palette;if(null==l&&(f=!1,l=a),null==l)throw new Error("Must supply either a local or global palette.");for(var c=s(l),d=0;c>>=1;)++d;c=1<<d;var g=void 0===h.delay?0:h.delay,v=void 0===h.disposal?0:h.disposal;if(v<0||v>3)throw new Error("Disposal out of range.");var y=!1,m=0;if(void 0!==h.transparent&&null!==h.transparent&&(y=!0,(m=h.transparent)<0||m>=c))throw new Error("Transparent color index.");if((0!==v||y||0!==g)&&(t[i++]=33,t[i++]=249,t[i++]=4,t[i++]=v<<2|(!0===y?1:0),t[i++]=255&g,t[i++]=g>>8&255,t[i++]=m,t[i++]=0),t[i++]=44,t[i++]=255&e,t[i++]=e>>8&255,t[i++]=255&r,t[i++]=r>>8&255,t[i++]=255&n,t[i++]=n>>8&255,t[i++]=255&o,t[i++]=o>>8&255,t[i++]=!0===f?128|d-1:0,!0===f)for(var _=0,w=l.length;_<w;++_){var b=l[_];t[i++]=b>>16&255,t[i++]=b>>8&255,t[i++]=255&b}return i=function(t,e,r,n){t[e++]=r;var i=e++,o=1<<r,a=o-1,s=o+1,u=s+1,h=r+1,f=0,l=0;function c(r){for(;f>=r;)t[e++]=255&l,l>>=8,f-=8,e===i+256&&(t[i]=255,i=e++)}function d(t){l|=t<<f,f+=h,c(8)}var p=n[0]&a,g={};d(o);for(var v=1,y=n.length;v<y;++v){var m=n[v]&a,_=p<<8|m,w=g[_];if(void 0===w){for(l|=p<<f,f+=h;f>=8;)t[e++]=255&l,l>>=8,f-=8,e===i+256&&(t[i]=255,i=e++);4096===u?(d(o),u=s+1,h=r+1,g={}):(u>=1<<h&&++h,g[_]=u++),p=m}else p=w}d(p),d(s),c(1),i+1===e?t[i]=0:(t[i]=e-i-1,t[e++]=0);return e}(t,i,d<2?2:d,u)},this.end=function(){return!1===p&&(t[i++]=59,p=!0),i},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(e){t=e},this.getOutputBufferPosition=function(){return i},this.setOutputBufferPosition=function(t){i=t}},e.GifReader=function(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var r=t[e++]|t[e++]<<8,i=t[e++]|t[e++]<<8,o=t[e++],a=o>>7,s=1<<(7&o)+1;t[e++],t[e++];var u=null,h=null;a&&(u=e,h=s,e+=3*s);var f=!0,l=[],c=0,d=null,p=0,g=null;for(this.width=r,this.height=i;f&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,g=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var v=t[e++];c=t[e++]|t[e++]<<8,d=t[e++],0==(1&v)&&(d=null),p=v>>2&7,e++;break;case 254:for(;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var y=t[e++]|t[e++]<<8,m=t[e++]|t[e++]<<8,_=t[e++]|t[e++]<<8,w=t[e++]|t[e++]<<8,b=t[e++],x=b>>6&1,E=1<<(7&b)+1,k=u,S=h,T=!1;if(b>>7){T=!0;k=e,S=E,e+=3*E}var P=e;for(e++;;){var A;if(!((A=t[e++])>=0))throw Error("Invalid block size");if(0===A)break;e+=A}l.push({x:y,y:m,width:_,height:w,has_local_palette:T,palette_offset:k,palette_size:S,data_offset:P,data_length:e-P,transparent_index:d,interlaced:!!x,delay:c,disposal:p});break;case 59:f=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return l.length},this.loopCount=function(){return g},this.frameInfo=function(t){if(t<0||t>=l.length)throw new Error("Frame index out of range.");return l[t]},this.decodeAndBlitFrameBGRA=function(e,i){var o=this.frameInfo(e),a=o.width*o.height,s=new Uint8Array(a);n(t,o.data_offset,s,a);var u=o.palette_offset,h=o.transparent_index;null===h&&(h=256);var f=o.width,l=r-f,c=f,d=4*(o.y*r+o.x),p=4*((o.y+o.height)*r+o.x),g=d,v=4*l;!0===o.interlaced&&(v+=4*r*7);for(var y=8,m=0,_=s.length;m<_;++m){var w=s[m];if(0===c&&(c=f,(g+=v)>=p&&(v=4*l+4*r*(y-1),g=d+(f+l)*(y<<1),y>>=1)),w===h)g+=4;else{var b=t[u+3*w],x=t[u+3*w+1],E=t[u+3*w+2];i[g++]=E,i[g++]=x,i[g++]=b,i[g++]=255}--c}},this.decodeAndBlitFrameRGBA=function(e,i){var o=this.frameInfo(e),a=o.width*o.height,s=new Uint8Array(a);n(t,o.data_offset,s,a);var u=o.palette_offset,h=o.transparent_index;null===h&&(h=256);var f=o.width,l=r-f,c=f,d=4*(o.y*r+o.x),p=4*((o.y+o.height)*r+o.x),g=d,v=4*l;!0===o.interlaced&&(v+=4*r*7);for(var y=8,m=0,_=s.length;m<_;++m){var w=s[m];if(0===c&&(c=f,(g+=v)>=p&&(v=4*l+4*r*(y-1),g=d+(f+l)*(y<<1),y>>=1)),w===h)g+=4;else{var b=t[u+3*w],x=t[u+3*w+1],E=t[u+3*w+2];i[g++]=b,i[g++]=x,i[g++]=E,i[g++]=255}--c}}}}catch(t){}},function(t,e,r){"use strict";var n=r(100),i=r(103);t.exports=function(t,e){var r=n.decode(t);if(!r)throw new Error("Error decoding jpeg");return{data:i(r.data),height:r.height,width:r.width}}},function(t,e,r){var n=r(101),i=r(102);t.exports={encode:n,decode:i}},function(t,e,r){(function(e){function r(t){Math.round;var r,n,i,o,a,s=Math.floor,u=new Array(64),h=new Array(64),f=new Array(64),l=new Array(64),c=new Array(65535),d=new Array(65535),p=new Array(64),g=new Array(64),v=[],y=0,m=7,_=new Array(64),w=new Array(64),b=new Array(64),x=new Array(256),E=new Array(2048),k=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],P=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],L=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],I=[0,1,2,3,4,5,6,7,8,9,10,11],M=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],O=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(t,e){for(var r=0,n=0,i=new Array,o=1;o<=16;o++){for(var a=1;a<=t[o];a++)i[e[n]]=[],i[e[n]][0]=r,i[e[n]][1]=o,n++,r++;r*=2}return i}function C(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(y|=1<<m),r--,--m<0&&(255==y?(B(255),B(0)):B(y),m=7,y=0)}function B(t){v.push(t)}function U(t){B(t>>8&255),B(255&t)}function D(t,e,r,n,i){for(var o,a=i[0],s=i[240],u=function(t,e){var r,n,i,o,a,s,u,h,f,l,c=0;for(f=0;f<8;++f){r=t[c],n=t[c+1],i=t[c+2],o=t[c+3],a=t[c+4],s=t[c+5],u=t[c+6];var d=r+(h=t[c+7]),g=r-h,v=n+u,y=n-u,m=i+s,_=i-s,w=o+a,b=o-a,x=d+w,E=d-w,k=v+m,S=v-m;t[c]=x+k,t[c+4]=x-k;var T=.707106781*(S+E);t[c+2]=E+T,t[c+6]=E-T;var P=.382683433*((x=b+_)-(S=y+g)),A=.5411961*x+P,L=1.306562965*S+P,I=.707106781*(k=_+y),M=g+I,O=g-I;t[c+5]=O+A,t[c+3]=O-A,t[c+1]=M+L,t[c+7]=M-L,c+=8}for(c=0,f=0;f<8;++f){r=t[c],n=t[c+8],i=t[c+16],o=t[c+24],a=t[c+32],s=t[c+40],u=t[c+48];var R=r+(h=t[c+56]),C=r-h,B=n+u,U=n-u,D=i+s,F=i-s,z=o+a,N=o-a,j=R+z,Z=R-z,V=B+D,G=B-D;t[c]=j+V,t[c+32]=j-V;var Y=.707106781*(G+Z);t[c+16]=Z+Y,t[c+48]=Z-Y;var H=.382683433*((j=N+F)-(G=U+C)),q=.5411961*j+H,W=1.306562965*G+H,X=.707106781*(V=F+U),J=C+X,K=C-X;t[c+40]=K+q,t[c+24]=K-q,t[c+8]=J+W,t[c+56]=J-W,c++}for(f=0;f<64;++f)l=t[f]*e[f],p[f]=l>0?l+.5|0:l-.5|0;return p}(t,e),h=0;h<64;++h)g[k[h]]=u[h];var f=g[0]-r;r=g[0],0==f?C(n[0]):(C(n[d[o=32767+f]]),C(c[o]));for(var l=63;l>0&&0==g[l];l--);if(0==l)return C(a),r;for(var v,y=1;y<=l;){for(var m=y;0==g[y]&&y<=l;++y);var _=y-m;if(_>=16){v=_>>4;for(var w=1;w<=v;++w)C(s);_&=15}o=32767+g[y],C(i[(_<<4)+d[o]]),C(c[o]),y++}return 63!=l&&C(a),r}function F(t){if(t<=0&&(t=1),t>100&&(t=100),a!=t){(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=s((e[r]*t+50)/100);n<1?n=1:n>255&&(n=255),u[k[r]]=n}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var a=s((i[o]*t+50)/100);a<1?a=1:a>255&&(a=255),h[k[o]]=a}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,p=0;p<8;p++)for(var g=0;g<8;g++)f[d]=1/(u[k[d]]*c[p]*c[g]*8),l[d]=1/(h[k[d]]*c[p]*c[g]*8),d++})(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),a=t}}this.encode=function(t,a){(new Date).getTime();a&&F(a),v=new Array,y=0,m=7,U(65496),U(65504),U(16),B(74),B(70),B(73),B(70),B(0),B(1),B(1),B(0),U(1),U(1),B(0),B(0),function(){U(65499),U(132),B(0);for(var t=0;t<64;t++)B(u[t]);B(1);for(var e=0;e<64;e++)B(h[e])}(),function(t,e){U(65472),U(17),B(8),U(e),U(t),B(3),B(1),B(17),B(0),B(2),B(17),B(1),B(3),B(17),B(1)}(t.width,t.height),function(){U(65476),U(418),B(0);for(var t=0;t<16;t++)B(S[t+1]);for(var e=0;e<=11;e++)B(T[e]);B(16);for(var r=0;r<16;r++)B(P[r+1]);for(var n=0;n<=161;n++)B(A[n]);B(1);for(var i=0;i<16;i++)B(L[i+1]);for(var o=0;o<=11;o++)B(I[o]);B(17);for(var a=0;a<16;a++)B(M[a+1]);for(var s=0;s<=161;s++)B(O[s])}(),U(65498),U(12),B(3),B(1),B(0),B(2),B(17),B(3),B(17),B(0),B(63),B(0);var s=0,c=0,d=0;y=0,m=7,this.encode.displayName="_encode_";for(var p,g,x,k,R,z,N,j,Z,V=t.data,G=t.width,Y=t.height,H=4*G,q=0;q<Y;){for(p=0;p<H;){for(z=R=H*q+p,N=-1,j=0,Z=0;Z<64;Z++)z=R+(j=Z>>3)*H+(N=4*(7&Z)),q+j>=Y&&(z-=H*(q+1+j-Y)),p+N>=H&&(z-=p+N-H+4),g=V[z++],x=V[z++],k=V[z++],_[Z]=(E[g]+E[x+256>>0]+E[k+512>>0]>>16)-128,w[Z]=(E[g+768>>0]+E[x+1024>>0]+E[k+1280>>0]>>16)-128,b[Z]=(E[g+1280>>0]+E[x+1536>>0]+E[k+1792>>0]>>16)-128;s=D(_,f,s,r,i),c=D(w,l,c,n,o),d=D(b,l,d,n,o),p+=32}q+=8}if(m>=0){var W=[];W[1]=m+1,W[0]=(1<<m+1)-1,C(W)}return U(65497),new e(v)},function(){(new Date).getTime();t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)x[e]=t(e)}(),r=R(S,T),n=R(L,I),i=R(P,A),o=R(M,O),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var n=t;n<e;n++)d[32767+n]=r,c[32767+n]=[],c[32767+n][1]=r,c[32767+n][0]=n;for(var i=-(e-1);i<=-t;i++)d[32767+i]=r,c[32767+i]=[],c[32767+i][1]=r,c[32767+i][0]=e-1+i;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)E[t]=19595*t,E[t+256>>0]=38470*t,E[t+512>>0]=7471*t+32768,E[t+768>>0]=-11059*t,E[t+1024>>0]=-21709*t,E[t+1280>>0]=32768*t+8421375,E[t+1536>>0]=-27439*t,E[t+1792>>0]=-5329*t}(),F(t),(new Date).getTime()}()}void 0!==typeof t&&(t.exports=function(t,e){void 0===e&&(e=50);return{data:new r(e).encode(t,e),width:t.width,height:t.height}})}).call(this,r(0).Buffer)},function(t,e,r){(function(e){var r=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function e(){}function r(t,e){for(var r,n,i=0,o=[],a=16;a>0&&!t[a-1];)a--;o.push({children:[],index:0});var s,u=o[0];for(r=0;r<a;r++){for(n=0;n<t[r];n++){for((u=o.pop()).children[u.index]=e[i];u.index>0;){if(0===o.length)throw new Error("Could not recreate Huffman Table");u=o.pop()}for(u.index++,o.push(u);o.length<=r;)o.push(s={children:[],index:0}),u.children[u.index]=s.children,u=s;i++}r+1<a&&(o.push(s={children:[],index:0}),u.children[u.index]=s.children,u=s)}return o[0].children}function n(e,r,n,i,o,a,s,u,h){n.precision,n.samplesPerLine,n.scanLines;var f=n.mcusPerLine,l=n.progressive,c=(n.maxH,n.maxV,r),d=0,p=0;function g(){if(p>0)return p--,d>>p&1;if(255==(d=e[r++])){var t=e[r++];if(t)throw new Error("unexpected marker: "+(d<<8|t).toString(16))}return p=7,d>>>7}function v(t){for(var e,r=t;null!==(e=g());){if("number"==typeof(r=r[e]))return r;if("object"!=typeof r)throw new Error("invalid huffman sequence")}return null}function y(t){for(var e=0;t>0;){var r=g();if(null===r)return;e=e<<1|r,t--}return e}function m(t){var e=y(t);return e>=1<<t-1?e:e+(-1<<t)+1}var _=0;var w,b=0;function x(t,e,r,n,i){var o=r%f,a=(r/f|0)*t.v+n,s=o*t.h+i;e(t,t.blocks[a][s])}function E(t,e,r){var n=r/t.blocksPerLine|0,i=r%t.blocksPerLine;e(t,t.blocks[n][i])}var k,S,T,P,A,L,I=i.length;L=l?0===a?0===u?function(t,e){var r=v(t.huffmanTableDC),n=0===r?0:m(r)<<h;e[0]=t.pred+=n}:function(t,e){e[0]|=g()<<h}:0===u?function(e,r){if(_>0)_--;else for(var n=a,i=s;n<=i;){var o=v(e.huffmanTableAC),u=15&o,f=o>>4;if(0!==u){r[t[n+=f]]=m(u)*(1<<h),n++}else{if(f<15){_=y(f)+(1<<f)-1;break}n+=16}}}:function(e,r){for(var n=a,i=s,o=0;n<=i;){var u=t[n],f=r[u]<0?-1:1;switch(b){case 0:var l=v(e.huffmanTableAC),c=15&l;o=l>>4;if(0===c)o<15?(_=y(o)+(1<<o),b=4):(o=16,b=1);else{if(1!==c)throw new Error("invalid ACn encoding");w=m(c),b=o?2:3}continue;case 1:case 2:r[u]?r[u]+=(g()<<h)*f:0===--o&&(b=2==b?3:0);break;case 3:r[u]?r[u]+=(g()<<h)*f:(r[u]=w<<h,b=0);break;case 4:r[u]&&(r[u]+=(g()<<h)*f)}n++}4===b&&0===--_&&(b=0)}:function(e,r){var n=v(e.huffmanTableDC),i=0===n?0:m(n);r[0]=e.pred+=i;for(var o=1;o<64;){var a=v(e.huffmanTableAC),s=15&a,u=a>>4;if(0!==s){r[t[o+=u]]=m(s),o++}else{if(u<15)break;o+=16}}};var M,O,R,C,B=0;for(O=1==I?i[0].blocksPerLine*i[0].blocksPerColumn:f*n.mcusPerColumn,o||(o=O);B<O;){for(S=0;S<I;S++)i[S].pred=0;if(_=0,1==I)for(k=i[0],A=0;A<o;A++)E(k,L,B),B++;else for(A=0;A<o;A++){for(S=0;S<I;S++)for(R=(k=i[S]).h,C=k.v,T=0;T<C;T++)for(P=0;P<R;P++)x(k,L,B,T,P);if(++B===O)break}if(p=0,(M=e[r]<<8|e[r+1])<65280)throw new Error("marker was not found");if(!(M>=65488&&M<=65495))break;r+=2}return r-c}function i(t,e){var r,n,i=[],o=e.blocksPerLine,a=e.blocksPerColumn,s=o<<3,u=new Int32Array(64),h=new Uint8Array(64);function f(t,r,n){var i,o,a,s,u,h,f,l,c,d,p=e.quantizationTable,g=n;for(d=0;d<64;d++)g[d]=t[d]*p[d];for(d=0;d<8;++d){var v=8*d;0!=g[1+v]||0!=g[2+v]||0!=g[3+v]||0!=g[4+v]||0!=g[5+v]||0!=g[6+v]||0!=g[7+v]?(i=5793*g[0+v]+128>>8,o=5793*g[4+v]+128>>8,a=g[2+v],s=g[6+v],u=2896*(g[1+v]-g[7+v])+128>>8,l=2896*(g[1+v]+g[7+v])+128>>8,h=g[3+v]<<4,c=i-o+1>>1,i=i+o+1>>1,o=c,c=3784*a+1567*s+128>>8,a=1567*a-3784*s+128>>8,s=c,c=u-(f=g[5+v]<<4)+1>>1,u=u+f+1>>1,f=c,c=l+h+1>>1,h=l-h+1>>1,l=c,c=i-s+1>>1,i=i+s+1>>1,s=c,c=o-a+1>>1,o=o+a+1>>1,a=c,c=2276*u+3406*l+2048>>12,u=3406*u-2276*l+2048>>12,l=c,c=799*h+4017*f+2048>>12,h=4017*h-799*f+2048>>12,f=c,g[0+v]=i+l,g[7+v]=i-l,g[1+v]=o+f,g[6+v]=o-f,g[2+v]=a+h,g[5+v]=a-h,g[3+v]=s+u,g[4+v]=s-u):(c=5793*g[0+v]+512>>10,g[0+v]=c,g[1+v]=c,g[2+v]=c,g[3+v]=c,g[4+v]=c,g[5+v]=c,g[6+v]=c,g[7+v]=c)}for(d=0;d<8;++d){var y=d;0!=g[8+y]||0!=g[16+y]||0!=g[24+y]||0!=g[32+y]||0!=g[40+y]||0!=g[48+y]||0!=g[56+y]?(i=5793*g[0+y]+2048>>12,o=5793*g[32+y]+2048>>12,a=g[16+y],s=g[48+y],u=2896*(g[8+y]-g[56+y])+2048>>12,l=2896*(g[8+y]+g[56+y])+2048>>12,h=g[24+y],c=i-o+1>>1,i=i+o+1>>1,o=c,c=3784*a+1567*s+2048>>12,a=1567*a-3784*s+2048>>12,s=c,c=u-(f=g[40+y])+1>>1,u=u+f+1>>1,f=c,c=l+h+1>>1,h=l-h+1>>1,l=c,c=i-s+1>>1,i=i+s+1>>1,s=c,c=o-a+1>>1,o=o+a+1>>1,a=c,c=2276*u+3406*l+2048>>12,u=3406*u-2276*l+2048>>12,l=c,c=799*h+4017*f+2048>>12,h=4017*h-799*f+2048>>12,f=c,g[0+y]=i+l,g[56+y]=i-l,g[8+y]=o+f,g[48+y]=o-f,g[16+y]=a+h,g[40+y]=a-h,g[24+y]=s+u,g[32+y]=s-u):(c=5793*n[d+0]+8192>>14,g[0+y]=c,g[8+y]=c,g[16+y]=c,g[24+y]=c,g[32+y]=c,g[40+y]=c,g[48+y]=c,g[56+y]=c)}for(d=0;d<64;++d){var m=128+(g[d]+8>>4);r[d]=m<0?0:m>255?255:m}}for(var l=0;l<a;l++){var c=l<<3;for(r=0;r<8;r++)i.push(new Uint8Array(s));for(var d=0;d<o;d++){f(e.blocks[l][d],h,u);var p=0,g=d<<3;for(n=0;n<8;n++){var v=i[c+n];for(r=0;r<8;r++)v[g+r]=h[p++]}}}return i}function o(t){return t<0?0:t>255?255:t}return e.prototype={load:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}.bind(this),e.send(null)},parse:function(e){var o=0;e.length;function a(){var t=e[o]<<8|e[o+1];return o+=2,t}function s(){var t=a(),r=e.subarray(o,o+t-2);return o+=r.length,r}function u(t){var e,r,n=0,i=0;for(r in t.components)t.components.hasOwnProperty(r)&&(n<(e=t.components[r]).h&&(n=e.h),i<e.v&&(i=e.v));var o=Math.ceil(t.samplesPerLine/8/n),a=Math.ceil(t.scanLines/8/i);for(r in t.components)if(t.components.hasOwnProperty(r)){e=t.components[r];for(var s=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/n),u=Math.ceil(Math.ceil(t.scanLines/8)*e.v/i),h=o*e.h,f=a*e.v,l=[],c=0;c<f;c++){for(var d=[],p=0;p<h;p++)d.push(new Int32Array(64));l.push(d)}e.blocksPerLine=s,e.blocksPerColumn=u,e.blocks=l}t.maxH=n,t.maxV=i,t.mcusPerLine=o,t.mcusPerColumn=a}var h,f,l=null,c=null,d=[],p=[],g=[],v=[],y=a();if(65496!=y)throw new Error("SOI not found");for(y=a();65497!=y;){switch(y){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var m=s();65504===y&&74===m[0]&&70===m[1]&&73===m[2]&&70===m[3]&&0===m[4]&&(l={version:{major:m[5],minor:m[6]},densityUnits:m[7],xDensity:m[8]<<8|m[9],yDensity:m[10]<<8|m[11],thumbWidth:m[12],thumbHeight:m[13],thumbData:m.subarray(14,14+3*m[12]*m[13])}),65518===y&&65===m[0]&&100===m[1]&&111===m[2]&&98===m[3]&&101===m[4]&&0===m[5]&&(c={version:m[6],flags0:m[7]<<8|m[8],flags1:m[9]<<8|m[10],transformCode:m[11]});break;case 65499:for(var _=a()+o-2;o<_;){var w=e[o++],b=new Int32Array(64);if(w>>4==0)for(j=0;j<64;j++){b[t[j]]=e[o++]}else{if(w>>4!=1)throw new Error("DQT: invalid table spec");for(j=0;j<64;j++){b[t[j]]=a()}}d[15&w]=b}break;case 65472:case 65473:case 65474:a(),(h={}).extended=65473===y,h.progressive=65474===y,h.precision=e[o++],h.scanLines=a(),h.samplesPerLine=a(),h.components={},h.componentsOrder=[];var x,E=e[o++];for(z=0;z<E;z++){x=e[o];var k=e[o+1]>>4,S=15&e[o+1],T=e[o+2];h.componentsOrder.push(x),h.components[x]={h:k,v:S,quantizationIdx:T},o+=3}u(h),p.push(h);break;case 65476:var P=a();for(z=2;z<P;){var A=e[o++],L=new Uint8Array(16),I=0;for(j=0;j<16;j++,o++)I+=L[j]=e[o];var M=new Uint8Array(I);for(j=0;j<I;j++,o++)M[j]=e[o];z+=17+I,(A>>4==0?v:g)[15&A]=r(L,M)}break;case 65501:a(),f=a();break;case 65498:a();var O=e[o++],R=[];for(z=0;z<O;z++){Z=h.components[e[o++]];var C=e[o++];Z.huffmanTableDC=v[C>>4],Z.huffmanTableAC=g[15&C],R.push(Z)}var B=e[o++],U=e[o++],D=e[o++],F=n(e,o,h,R,f,B,U,D>>4,15&D);o+=F;break;case 65535:255!==e[o]&&o--;break;default:if(255==e[o-3]&&e[o-2]>=192&&e[o-2]<=254){o-=3;break}throw new Error("unknown JPEG marker "+y.toString(16))}y=a()}if(1!=p.length)throw new Error("only single frame JPEGs supported");for(var z=0;z<p.length;z++){var N=p[z].components;for(var j in N)N[j].quantizationTable=d[N[j].quantizationIdx],delete N[j].quantizationIdx}this.width=h.samplesPerLine,this.height=h.scanLines,this.jfif=l,this.adobe=c,this.components=[];for(z=0;z<h.componentsOrder.length;z++){var Z=h.components[h.componentsOrder[z]];this.components.push({lines:i(0,Z),scaleX:Z.h/h.maxH,scaleY:Z.v/h.maxV})}},getData:function(t,e){var r,n,i,a,s,u,h,f,l,c,d,p,g,v,y,m,_,w,b,x,E,k=this.width/t,S=this.height/e,T=0,P=t*e*this.components.length,A=new Uint8Array(P);switch(this.components.length){case 1:for(r=this.components[0],c=0;c<e;c++)for(s=r.lines[0|c*r.scaleY*S],l=0;l<t;l++)d=s[0|l*r.scaleX*k],A[T++]=d;break;case 2:for(r=this.components[0],n=this.components[1],c=0;c<e;c++)for(s=r.lines[0|c*r.scaleY*S],u=n.lines[0|c*n.scaleY*S],l=0;l<t;l++)d=s[0|l*r.scaleX*k],A[T++]=d,d=u[0|l*n.scaleX*k],A[T++]=d;break;case 3:for(E=!0,this.adobe&&this.adobe.transformCode?E=!0:void 0!==this.colorTransform&&(E=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],c=0;c<e;c++)for(s=r.lines[0|c*r.scaleY*S],u=n.lines[0|c*n.scaleY*S],h=i.lines[0|c*i.scaleY*S],l=0;l<t;l++)E?(d=s[0|l*r.scaleX*k],p=u[0|l*n.scaleX*k],w=o(d+1.402*((g=h[0|l*i.scaleX*k])-128)),b=o(d-.3441363*(p-128)-.71413636*(g-128)),x=o(d+1.772*(p-128))):(w=s[0|l*r.scaleX*k],b=u[0|l*n.scaleX*k],x=h[0|l*i.scaleX*k]),A[T++]=w,A[T++]=b,A[T++]=x;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(E=!1,this.adobe&&this.adobe.transformCode?E=!0:void 0!==this.colorTransform&&(E=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],a=this.components[3],c=0;c<e;c++)for(s=r.lines[0|c*r.scaleY*S],u=n.lines[0|c*n.scaleY*S],h=i.lines[0|c*i.scaleY*S],f=a.lines[0|c*a.scaleY*S],l=0;l<t;l++)E?(d=s[0|l*r.scaleX*k],p=u[0|l*n.scaleX*k],g=h[0|l*i.scaleX*k],v=f[0|l*a.scaleX*k],y=255-o(d+1.402*(g-128)),m=255-o(d-.3441363*(p-128)-.71413636*(g-128)),_=255-o(d+1.772*(p-128))):(y=s[0|l*r.scaleX*k],m=u[0|l*n.scaleX*k],_=h[0|l*i.scaleX*k],v=f[0|l*a.scaleX*k]),A[T++]=255-y,A[T++]=255-m,A[T++]=255-_,A[T++]=255-v;break;default:throw new Error("Unsupported color mode")}return A},copyToImageData:function(t,e){var r,n,i,a,s,u,h,f,l,c=t.width,d=t.height,p=t.data,g=this.getData(c,d),v=0,y=0;switch(this.components.length){case 1:for(n=0;n<d;n++)for(r=0;r<c;r++)i=g[v++],p[y++]=i,p[y++]=i,p[y++]=i,e&&(p[y++]=255);break;case 3:for(n=0;n<d;n++)for(r=0;r<c;r++)h=g[v++],f=g[v++],l=g[v++],p[y++]=h,p[y++]=f,p[y++]=l,e&&(p[y++]=255);break;case 4:for(n=0;n<d;n++)for(r=0;r<c;r++)s=g[v++],u=g[v++],i=g[v++],h=255-o(s*(1-(a=g[v++])/255)+a),f=255-o(u*(1-a/255)+a),l=255-o(i*(1-a/255)+a),p[y++]=h,p[y++]=f,p[y++]=l,e&&(p[y++]=255);break;default:throw new Error("Unsupported color mode")}}},e}();t.exports=function(t,n){var i={useTArray:!1,colorTransform:void 0,formatAsRGBA:!0};n?"object"==typeof n?n={useTArray:void 0===n.useTArray?i.useTArray:n.useTArray,colorTransform:void 0===n.colorTransform?i.colorTransform:n.colorTransform,formatAsRGBA:void 0===n.formatAsRGBA?i.formatAsRGBA:n.formatAsRGBA}:(n=i).useTArray=!0:n=i;var o=new Uint8Array(t),a=new r;a.parse(o),a.colorTransform=n.colorTransform;var s=n.formatAsRGBA?4:3,u=a.width*a.height*s;try{var h={width:a.width,height:a.height,data:n.useTArray?new Uint8Array(u):new e(u)}}catch(t){throw t instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+u):t}return a.copyToImageData(h,n.formatAsRGBA),h}}).call(this,r(0).Buffer)},function(t,e,r){(function(e){t.exports=function(t){if(t){if("Uint8Array"===t.constructor.name||t.constructor===Uint8Array)return t;"string"==typeof t&&(t=e(t));for(var r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t[n];return r}}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";(function(e){var n=r(105);t.exports=function(t,r){for(var i=n.decode(e.from(t)),o=i.width,a=i.height,s=new Uint8Array(o*a*4),u=0;u<s.length;u+=4){var h=i.data[u+0],f=i.data[u+1],l=i.data[u+2],c=i.data[u+3];s[u+0]=c,s[u+1]=l,s[u+2]=f,s[u+3]=i.is_with_alpha?h:255}return{data:s,width:i.width,height:i.height}}}).call(this,r(0).Buffer)},function(t,e,r){var n=r(106),i=r(107);t.exports={encode:n,decode:i}},function(t,e,r){(function(e){function r(t){this.buffer=t.data,this.width=t.width,this.height=t.height,this.extraBytes=this.width%4,this.rgbSize=this.height*(3*this.width+this.extraBytes),this.headerInfoSize=40,this.data=[],this.flag="BM",this.reserved=0,this.offset=54,this.fileSize=this.rgbSize+this.offset,this.planes=1,this.bitPP=24,this.compress=0,this.hr=0,this.vr=0,this.colors=0,this.importantColors=0}r.prototype.encode=function(){var t=new e(this.offset+this.rgbSize);this.pos=0,t.write(this.flag,this.pos,2),this.pos+=2,t.writeUInt32LE(this.fileSize,this.pos),this.pos+=4,t.writeUInt32LE(this.reserved,this.pos),this.pos+=4,t.writeUInt32LE(this.offset,this.pos),this.pos+=4,t.writeUInt32LE(this.headerInfoSize,this.pos),this.pos+=4,t.writeUInt32LE(this.width,this.pos),this.pos+=4,t.writeInt32LE(-this.height,this.pos),this.pos+=4,t.writeUInt16LE(this.planes,this.pos),this.pos+=2,t.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,t.writeUInt32LE(this.compress,this.pos),this.pos+=4,t.writeUInt32LE(this.rgbSize,this.pos),this.pos+=4,t.writeUInt32LE(this.hr,this.pos),this.pos+=4,t.writeUInt32LE(this.vr,this.pos),this.pos+=4,t.writeUInt32LE(this.colors,this.pos),this.pos+=4,t.writeUInt32LE(this.importantColors,this.pos),this.pos+=4;for(var r=0,n=3*this.width+this.extraBytes,i=0;i<this.height;i++){for(var o=0;o<this.width;o++){var a=this.pos+i*n+3*o;r++,t[a]=this.buffer[r++],t[a+1]=this.buffer[r++],t[a+2]=this.buffer[r++]}if(this.extraBytes>0){var s=this.pos+i*n+3*this.width;t.fill(0,s,s+this.extraBytes)}}return t},t.exports=function(t,e){return void 0===e&&(e=100),{data:new r(t).encode(),width:t.width,height:t.height}}}).call(this,r(0).Buffer)},function(t,e,r){(function(e){function r(t,e){if(this.pos=0,this.buffer=t,this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),"BM"!=this.flag)throw new Error("Invalid BMP File");this.parseHeader(),this.parseRGBA()}r.prototype.parseHeader=function(){if(this.fileSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.reserved=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.offset=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.headerSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.width=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.height=this.buffer.readInt32LE(this.pos),this.pos+=4,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compress=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.rawSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.hr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.vr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.colors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.importantColors=this.buffer.readUInt32LE(this.pos),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var r=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++);this.palette[e]={red:i,green:n,blue:r,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},r.prototype.parseRGBA=function(){var t="bit"+this.bitPP,r=this.width*this.height*4;this.data=new e(r),this[t]()},r.prototype.bit1=function(){var t=Math.ceil(this.width/8),e=t%4,r=this.height>=0?this.height-1:-this.height;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var o=this.buffer.readUInt8(this.pos++),a=n*this.width*4+8*i*4,s=0;s<8&&8*i+s<this.width;s++){var u=this.palette[o>>7-s&1];this.data[a+4*s]=0,this.data[a+4*s+1]=u.blue,this.data[a+4*s+2]=u.green,this.data[a+4*s+3]=u.red}0!=e&&(this.pos+=4-e)}},r.prototype.bit4=function(){if(2==this.compress){this.data.fill(255);for(var t=0,e=this.bottom_up?this.height-1:0,r=!1;t<this.data.length;){var n=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++);if(0==n){if(0==i){this.bottom_up?e--:e++,t=e*this.width*4,r=!1;continue}if(1==i)break;if(2==i){var o=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);this.bottom_up?e-=a:e+=a,t+=a*this.width*4+4*o}else{for(var s=this.buffer.readUInt8(this.pos++),u=0;u<i;u++)r?h.call(this,15&s):h.call(this,(240&s)>>4),1&u&&u+1<i&&(s=this.buffer.readUInt8(this.pos++)),r=!r;1==(i+1>>1&1)&&this.pos++}}else for(u=0;u<n;u++)r?h.call(this,15&i):h.call(this,(240&i)>>4),r=!r}function h(e){var r=this.palette[e];this.data[t]=0,this.data[t+1]=r.blue,this.data[t+2]=r.green,this.data[t+3]=r.red,t+=4}}else{var f=Math.ceil(this.width/2),l=f%4;for(a=this.height-1;a>=0;a--){var c=this.bottom_up?a:this.height-1-a;for(o=0;o<f;o++){i=this.buffer.readUInt8(this.pos++),t=c*this.width*4+2*o*4;var d=i>>4,p=15&i,g=this.palette[d];if(this.data[t]=0,this.data[t+1]=g.blue,this.data[t+2]=g.green,this.data[t+3]=g.red,2*o+1>=this.width)break;g=this.palette[p],this.data[t+4]=0,this.data[t+4+1]=g.blue,this.data[t+4+2]=g.green,this.data[t+4+3]=g.red}0!=l&&(this.pos+=4-l)}}},r.prototype.bit8=function(){if(1==this.compress){this.data.fill(255);for(var t=0,e=this.bottom_up?this.height-1:0;t<this.data.length;){var r=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);if(0==r){if(0==n){this.bottom_up?e--:e++,t=e*this.width*4;continue}if(1==n)break;if(2==n){var i=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++);this.bottom_up?e-=o:e+=o,t+=o*this.width*4+4*i}else{for(var a=0;a<n;a++){var s=this.buffer.readUInt8(this.pos++);u.call(this,s)}!0&n&&this.pos++}}else for(a=0;a<r;a++)u.call(this,n)}function u(e){var r=this.palette[e];this.data[t]=0,this.data[t+1]=r.blue,this.data[t+2]=r.green,this.data[t+3]=r.red,t+=4}}else{var h=this.width%4;for(o=this.height-1;o>=0;o--){var f=this.bottom_up?o:this.height-1-o;for(i=0;i<this.width;i++){n=this.buffer.readUInt8(this.pos++),t=f*this.width*4+4*i;if(n<this.palette.length){var l=this.palette[n];this.data[t]=0,this.data[t+1]=l.blue,this.data[t+2]=l.green,this.data[t+3]=l.red}else this.data[t]=0,this.data[t+1]=255,this.data[t+2]=255,this.data[t+3]=255}0!=h&&(this.pos+=4-h)}}},r.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var o=this.buffer.readUInt16LE(this.pos);this.pos+=2;var a=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,u=(o>>10&e)/e*255|0,h=o>>15?255:0,f=n*this.width*4+4*i;this.data[f]=h,this.data[f+1]=a,this.data[f+2]=s,this.data[f+3]=u}this.pos+=t}},r.prototype.bit16=function(){var t=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,3==this.compress&&(this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4);for(var e=[0,0,0],r=0;r<16;r++)this.maskRed>>r&1&&e[0]++,this.maskGreen>>r&1&&e[1]++,this.maskBlue>>r&1&&e[2]++;e[1]+=e[0],e[2]+=e[1],e[0]=8-e[0],e[1]-=8,e[2]-=8;for(var n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,o=0;o<this.width;o++){var a=this.buffer.readUInt16LE(this.pos);this.pos+=2;var s=(a&this.maskBlue)<<e[0],u=(a&this.maskGreen)>>e[1],h=(a&this.maskRed)>>e[2],f=i*this.width*4+4*o;this.data[f]=0,this.data[f+1]=s,this.data[f+2]=u,this.data[f+3]=h}this.pos+=t}},r.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++),a=e*this.width*4+4*r;this.data[a]=0,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=o}this.pos+=this.width%4}},r.prototype.bit32=function(){if(3==this.compress){this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4;for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),s=e*this.width*4+4*r;this.data[s]=n,this.data[s+1]=i,this.data[s+2]=o,this.data[s+3]=a}}else for(t=this.height-1;t>=0;t--)for(e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){i=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++),s=e*this.width*4+4*r;this.data[s]=n,this.data[s+1]=i,this.data[s+2]=o,this.data[s+3]=a}},r.prototype.getData=function(){return this.data},t.exports=function(t){return new r(t)}}).call(this,r(0).Buffer)},function(t,e,r){"use strict";var n=r(109);t.exports=function(t,e){var r=n.decode(t);return n.decodeImages(t,r),{data:n.toRGBA8(r[0]),height:r[0].height,width:r[0].width}}},function(t,e,r){(function(e){!function(){var n={};function i(){void 0===e&&console.log.apply(console,arguments)}t.exports=n,function(t,e){var r,n,o;r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(){function t(t){this.message="JPEG error: "+t}return t.prototype=Error(),t.prototype.name="JpegError",t.constructor=t}(),o=function(){function t(t,e){this.message=t,this.g=e}return t.prototype=Error(),t.prototype.name="DNLMarkerError",t.constructor=t}(),function(){function e(){this.M=null,this.B=-1}function i(t,e){for(var r,n,i=0,o=[],a=16;0<a&&!t[a-1];)a--;o.push({children:[],index:0});var s,u=o[0];for(r=0;r<a;r++){for(n=0;n<t[r];n++){for((u=o.pop()).children[u.index]=e[i];0<u.index;)u=o.pop();for(u.index++,o.push(u);o.length<=r;)o.push(s={children:[],index:0}),u.children[u.index]=s.children,u=s;i++}r+1<a&&(o.push(s={children:[],index:0}),u.children[u.index]=s.children,u=s)}return o[0].children}function a(t,e,i,a,s,f,l,c,d){function p(){if(0<C)return C--,R>>C&1;if(255===(R=t[e++])){var r=t[e++];if(r){if(220===r&&I){e+=2;var a=t[e++]<<8|t[e++];if(0<a&&a!==i.g)throw new o("Found DNL marker (0xFFDC) while parsing scan data",a)}throw new n("unexpected marker "+(R<<8|r).toString(16))}}return C=7,R>>>7}function g(t){for(;;){if("number"==typeof(t=t[p()]))return t;if("object"!==(void 0===t?"undefined":r(t)))throw new n("invalid huffman sequence")}}function v(t){for(var e=0;0<t;)e=e<<1|p(),t--;return e}function y(t){if(1===t)return 1===p()?1:-1;var e=v(t);return e>=1<<t-1?e:e+(-1<<t)+1}function m(t,e){var r=g(t.D);for(r=0===r?0:y(r),t.a[e]=t.m+=r,r=1;64>r;){var n=g(t.o),i=15&n;if(n>>=4,0===i){if(15>n)break;r+=16}else r+=n,t.a[e+h[r]]=y(i),r++}}function _(t,e){var r=g(t.D);r=0===r?0:y(r)<<d,t.a[e]=t.m+=r}function w(t,e){t.a[e]|=p()<<d}function b(t,e){if(0<B)B--;else for(var r=f;r<=l;){var n=g(t.o),i=15&n;if(n>>=4,0===i){if(15>n){B=v(n)+(1<<n)-1;break}r+=16}else r+=n,t.a[e+h[r]]=y(i)*(1<<d),r++}}function x(t,e){for(var r,i=f,o=0;i<=l;){r=e+h[i];var a=0>t.a[r]?-1:1;switch(U){case 0:if(r=15&(o=g(t.o)),o>>=4,0===r)15>o?(B=v(o)+(1<<o),U=4):(o=16,U=1);else{if(1!==r)throw new n("invalid ACn encoding");E=y(r),U=o?2:3}continue;case 1:case 2:t.a[r]?t.a[r]+=a*(p()<<d):0==--o&&(U=2===U?3:0);break;case 3:t.a[r]?t.a[r]+=a*(p()<<d):(t.a[r]=E<<d,U=0);break;case 4:t.a[r]&&(t.a[r]+=a*(p()<<d))}i++}4===U&&0==--B&&(U=0)}for(var E,k,S,T,P,A,L,I=9<arguments.length&&void 0!==arguments[9]&&arguments[9],M=i.P,O=e,R=0,C=0,B=0,U=0,D=a.length,F=i.S?0===f?0===c?_:w:0===c?b:x:m,z=0,N=1===D?a[0].c*a[0].l:M*i.O;z<N;){var j=s?Math.min(N-z,s):N;for(k=0;k<D;k++)a[k].m=0;if(B=0,1===D){var Z=a[0];for(P=0;P<j;P++)F(Z,64*((Z.c+1)*(z/Z.c|0)+z%Z.c)),z++}else for(P=0;P<j;P++){for(k=0;k<D;k++)for(A=(Z=a[k]).h,L=Z.j,S=0;S<L;S++)for(T=0;T<A;T++)F(Z,64*((Z.c+1)*((z/M|0)*Z.j+S)+(z%M*Z.h+T)));z++}if(C=0,(Z=u(t,e))&&Z.f&&((0,_util.warn)("decodeScan - unexpected MCU data, current marker is: "+Z.f),e=Z.offset),!(Z=Z&&Z.F)||65280>=Z)throw new n("marker was not found");if(!(65488<=Z&&65495>=Z))break;e+=2}return(Z=u(t,e))&&Z.f&&((0,_util.warn)("decodeScan - unexpected Scan data, current marker is: "+Z.f),e=Z.offset),e-O}function s(t,e){for(var r=e.c,i=e.l,o=new Int16Array(64),a=0;a<i;a++)for(var s=0;s<r;s++){var u=64*((e.c+1)*a+s),h=o,f=e.G,l=e.a;if(!f)throw new n("missing required Quantization Table.");for(var c=0;64>c;c+=8){var d=l[u+c],p=l[u+c+1],g=l[u+c+2],v=l[u+c+3],y=l[u+c+4],m=l[u+c+5],_=l[u+c+6],w=l[u+c+7];if(d*=f[c],0==(p|g|v|y|m|_|w))d=5793*d+512>>10,h[c]=d,h[c+1]=d,h[c+2]=d,h[c+3]=d,h[c+4]=d,h[c+5]=d,h[c+6]=d,h[c+7]=d;else{p*=f[c+1],g*=f[c+2],v*=f[c+3],y*=f[c+4],m*=f[c+5];var b=5793*d+128>>8,x=5793*y+128>>8,E=g,k=_*=f[c+6];x=(b=b+x+1>>1)-x,d=3784*E+1567*k+128>>8,E=1567*E-3784*k+128>>8,m=(y=(y=2896*(p-(w*=f[c+7]))+128>>8)+(m<<=4)+1>>1)-m,v=(w=(w=2896*(p+w)+128>>8)+(v<<=4)+1>>1)-v,k=(b=b+(k=d)+1>>1)-k,E=(x=x+E+1>>1)-E,d=2276*y+3406*w+2048>>12,y=3406*y-2276*w+2048>>12,w=d,d=799*v+4017*m+2048>>12,v=4017*v-799*m+2048>>12,m=d,h[c]=b+w,h[c+7]=b-w,h[c+1]=x+m,h[c+6]=x-m,h[c+2]=E+v,h[c+5]=E-v,h[c+3]=k+y,h[c+4]=k-y}}for(f=0;8>f;++f)d=h[f],0==((p=h[f+8])|(g=h[f+16])|(v=h[f+24])|(y=h[f+32])|(m=h[f+40])|(_=h[f+48])|(w=h[f+56]))?(d=-2040>(d=5793*d+8192>>14)?0:2024<=d?255:d+2056>>4,l[u+f]=d,l[u+f+8]=d,l[u+f+16]=d,l[u+f+24]=d,l[u+f+32]=d,l[u+f+40]=d,l[u+f+48]=d,l[u+f+56]=d):(b=5793*d+2048>>12,x=5793*y+2048>>12,d=3784*(E=g)+1567*(k=_)+2048>>12,E=1567*E-3784*k+2048>>12,k=d,m=(y=(y=2896*(p-w)+2048>>12)+m+1>>1)-m,v=(w=(w=2896*(p+w)+2048>>12)+v+1>>1)-v,d=2276*y+3406*w+2048>>12,y=3406*y-2276*w+2048>>12,w=d,d=799*v+4017*m+2048>>12,v=4017*v-799*m+2048>>12,p=(x=(x=(b=4112+(b+x+1>>1))-x)+E+1>>1)+(m=d),_=x-m,m=(E=x-E)-v,d=16>(d=(b=b+k+1>>1)+w)?0:4080<=d?255:d>>4,p=16>p?0:4080<=p?255:p>>4,g=16>(g=E+v)?0:4080<=g?255:g>>4,v=16>(v=(k=b-k)+y)?0:4080<=v?255:v>>4,y=16>(y=k-y)?0:4080<=y?255:y>>4,m=16>m?0:4080<=m?255:m>>4,_=16>_?0:4080<=_?255:_>>4,w=16>(w=b-w)?0:4080<=w?255:w>>4,l[u+f]=d,l[u+f+8]=p,l[u+f+16]=g,l[u+f+24]=v,l[u+f+32]=y,l[u+f+40]=m,l[u+f+48]=_,l[u+f+56]=w)}return e.a}function u(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,n=t.length-1;if(r=r<e?r:e,e>=n)return null;var i=t[e]<<8|t[e+1];if(65472<=i&&65534>=i)return{f:null,F:i,offset:e};for(var o=t[r]<<8|t[r+1];!(65472<=o&&65534>=o);){if(++r>=n)return null;o=t[r]<<8|t[r+1]}return{f:i.toString(16),F:o,offset:r}}var h=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);e.prototype={parse:function(t){function e(){var e=t[d]<<8|t[d+1];return d+=2,e}function r(){var r=e(),n=u(t,r=d+r-2,d);return n&&n.f&&((0,_util.warn)("readDataBlock - incorrect length, current marker is: "+n.f),r=n.offset),r=t.subarray(d,r),d+=r.length,r}function f(t){for(var e=Math.ceil(t.v/8/t.s),r=Math.ceil(t.g/8/t.u),n=0;n<t.b.length;n++){P=t.b[n];var i=Math.ceil(Math.ceil(t.v/8)*P.h/t.s),o=Math.ceil(Math.ceil(t.g/8)*P.j/t.u);P.a=new Int16Array(64*r*P.j*(e*P.h+1)),P.c=i,P.l=o}t.P=e,t.O=r}var l=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).N,c=void 0===l?null:l,d=0,p=null,g=0;l=[];var v=[],y=[],m=e();if(65496!==m)throw new n("SOI not found");for(m=e();65497!==m;){switch(m){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var _=r();65518===m&&65===_[0]&&100===_[1]&&111===_[2]&&98===_[3]&&101===_[4]&&(p={version:_[5]<<8|_[6],Y:_[7]<<8|_[8],Z:_[9]<<8|_[10],W:_[11]});break;case 65499:m=e()+d-2;for(var w;d<m;){var b=t[d++],x=new Uint16Array(64);if(0==b>>4)for(_=0;64>_;_++)x[w=h[_]]=t[d++];else{if(1!=b>>4)throw new n("DQT - invalid table spec");for(_=0;64>_;_++)x[w=h[_]]=e()}l[15&b]=x}break;case 65472:case 65473:case 65474:if(E)throw new n("Only single frame JPEGs supported");e();var E={};for(E.X=65473===m,E.S=65474===m,E.precision=t[d++],m=e(),E.g=c||m,E.v=e(),E.b=[],E.C={},_=t[d++],m=x=b=0;m<_;m++){w=t[d];var k=t[d+1]>>4,S=15&t[d+1];b<k&&(b=k),x<S&&(x=S),k=E.b.push({h:k,j:S,T:t[d+2],G:null}),E.C[w]=k-1,d+=3}E.s=b,E.u=x,f(E);break;case 65476:for(w=e(),m=2;m<w;){for(b=t[d++],x=new Uint8Array(16),_=k=0;16>_;_++,d++)k+=x[_]=t[d];for(S=new Uint8Array(k),_=0;_<k;_++,d++)S[_]=t[d];m+=17+k,(0==b>>4?y:v)[15&b]=i(x,S)}break;case 65501:e();var T=e();break;case 65498:for(_=1==++g&&!c,e(),b=t[d++],w=[],m=0;m<b;m++){x=E.C[t[d++]];var P=E.b[x];x=t[d++],P.D=y[x>>4],P.o=v[15&x],w.push(P)}m=t[d++],b=t[d++],x=t[d++];try{var A=a(t,d,E,w,T,m,b,x>>4,15&x,_);d+=A}catch(e){if(e instanceof o)return(0,_util.warn)(\'Attempting to re-parse JPEG image using "scanLines" parameter found in DNL marker (0xFFDC) segment.\'),this.parse(t,{N:e.g});throw e}break;case 65500:d+=4;break;case 65535:255!==t[d]&&d--;break;default:if(255===t[d-3]&&192<=t[d-2]&&254>=t[d-2])d-=3;else{if(!(_=u(t,d-2))||!_.f)throw new n("unknown marker "+m.toString(16));(0,_util.warn)("JpegImage.parse - unexpected data, current marker is: "+_.f),d=_.offset}}m=e()}for(this.width=E.v,this.height=E.g,this.A=p,this.b=[],m=0;m<E.b.length;m++)(T=l[(P=E.b[m]).T])&&(P.G=T),this.b.push({R:s(0,P),U:P.h/E.s,V:P.j/E.u,c:P.c,l:P.l});this.i=this.b.length},L:function(t,e){var r,n,i=this.width/t,o=this.height/e,a=this.b.length,s=t*e*a,u=new Uint8ClampedArray(s),h=new Uint32Array(t);for(n=0;n<a;n++){var f=this.b[n],l=f.U*i,c=f.V*o,d=n,p=f.R,g=f.c+1<<3;for(r=0;r<t;r++)f=0|r*l,h[r]=(4294967288&f)<<3|7&f;for(l=0;l<e;l++)for(f=g*(4294967288&(f=0|l*c))|(7&f)<<3,r=0;r<t;r++)u[d]=p[f+h[r]],d+=a}if(o=this.M)for(n=0;n<s;)for(i=f=0;f<a;f++,n++,i+=2)u[n]=(u[n]*o[i]>>8)+o[i+1];return u},w:function(){return this.A?!!this.A.W:3===this.i?0!==this.B:1===this.B},I:function(t){for(var e,r,n,i=0,o=t.length;i<o;i+=3)e=t[i],r=t[i+1],n=t[i+2],t[i]=e-179.456+1.402*n,t[i+1]=e+135.459-.344*r-.714*n,t[i+2]=e-226.816+1.772*r;return t},K:function(t){for(var e,r,n,i,o=0,a=0,s=t.length;a<s;a+=4)e=t[a],r=t[a+1],n=t[a+2],i=t[a+3],t[o++]=r*(-660635669420364e-19*r+.000437130475926232*n-54080610064599e-18*e+.00048449797120281*i-.154362151871126)-122.67195406894+n*(-.000957964378445773*n+.000817076911346625*e-.00477271405408747*i+1.53380253221734)+e*(.000961250184130688*e-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),t[o++]=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*n+.000659397001245577*e+.000426105652938837*i-.176491792462875)+n*(-.000778269941513683*n+.00130872261408275*e+.000770482631801132*i-.151051492775562)+e*(.00126935368114843*e-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),t[o++]=r*(-.000570115196973677*r-263409051004589e-19*n+.0020741088115012*e-.00288260236853442*i+.814272968359295)-20.810012546947+n*(-153496057440975e-19*n-.000132689043961446*e+.000560833691242812*i-.195152027534049)+e*(.00174418132927582*e-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);return t.subarray(0,o)},J:function(t){for(var e,r,n,i=0,o=t.length;i<o;i+=4)e=t[i],r=t[i+1],n=t[i+2],t[i]=434.456-e-1.402*n,t[i+1]=119.541-e+.344*r+.714*n,t[i+2]=481.816-e-1.772*r;return t},H:function(t){for(var e,r,n,i,o=0,a=1/255,s=0,u=t.length;s<u;s+=4)e=t[s]*a,r=t[s+1]*a,n=t[s+2]*a,i=t[s+3]*a,t[o++]=255+e*(-4.387332384609988*e+54.48615194189176*r+18.82290502165302*n+212.25662451639585*i-285.2331026137004)+r*(1.7149763477362134*r-5.6096736904047315*n-17.873870861415444*i-5.497006427196366)+n*(-2.5217340131683033*n-21.248923337353073*i+17.5119270841813)-i*(21.86122147463605*i+189.48180835922747),t[o++]=255+e*(8.841041422036149*e+60.118027045597366*r+6.871425592049007*n+31.159100130055922*i-79.2970844816548)+r*(-15.310361306967817*r+17.575251261109482*n+131.35250912493976*i-190.9453302588951)+n*(4.444339102852739*n+9.8632861493405*i-24.86741582555878)-i*(20.737325471181034*i+187.80453709719578),t[o++]=255+e*(.8842522430003296*e+8.078677503112928*r+30.89978309703729*n-.23883238689178934*i-14.183576799673286)+r*(10.49593273432072*r+63.02378494754052*n+50.606957656360734*i-112.23884253719248)+n*(.03296041114873217*n+115.60384449646641*i-193.58209356861505)-i*(22.33816807309886*i+180.12613974708367);return t.subarray(0,o)},getData:function(t,e,r){if(4<this.i)throw new n("Unsupported color mode");if(t=this.L(t,e),1===this.i&&r){r=t.length,e=new Uint8ClampedArray(3*r);for(var i=0,o=0;o<r;o++){var a=t[o];e[i++]=a,e[i++]=a,e[i++]=a}return e}if(3===this.i&&this.w())return this.I(t);if(4===this.i){if(this.w())return r?this.K(t):this.J(t);if(r)return this.H(t)}return t}},t.JpegDecoder=e}(),t.encodeImage=function(e,r,n,i){var o={t256:[r],t257:[n],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[n],t279:[r*n*4],t282:[1],t283:[1],t284:[1],t286:[0],t287:[0],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(i)for(var a in i)o[a]=i[a];var s=new Uint8Array(t.encode([o])),u=new Uint8Array(e),h=new Uint8Array(1e3+r*n*4);for(a=0;a<s.length;a++)h[a]=s[a];for(a=0;a<u.length;a++)h[1e3+a]=u[a];return h.buffer},t.encode=function(e){var r=new Uint8Array(2e4),n=4,i=t._binBE;r[0]=77,r[1]=77,r[3]=42;var o=8;i.writeUint(r,n,o),n+=4;for(var a=0;a<e.length;a++){var s=t._writeIFD(i,r,o,e[a]);o=s[1],a<e.length-1&&i.writeUint(r,s[0],o)}return r.slice(0,o).buffer},t.decode=function(e){t.decode._decodeG3.allow2D=null;var r=new Uint8Array(e),n=0,i=t._binBE.readASCII(r,n,2);n+=2;var o="II"==i?t._binLE:t._binBE;o.readUshort(r,n);n+=2;var a=o.readUint(r,n);n+=4;for(var s=[];;){var u=t._readIFD(o,r,a,s);if(0==(a=o.readUint(r,u)))break}return s},t.decodeImages=function(e,r){for(var n=new Uint8Array(e),o=t._binBE.readASCII(n,0,2),a=0;a<r.length;a++){var s=r[a];if(null!=s.t256){s.isLE="II"==o,s.width=s.t256[0],s.height=s.t257[0];var u=s.t259?s.t259[0]:1,h=s.t266?s.t266[0]:1;s.t284&&2==s.t284[0]&&i("PlanarConfiguration 2 should not be used!");var f=(s.t258?Math.min(32,s.t258[0]):1)*(s.t277?s.t277[0]:1),l=8*Math.ceil(s.width*f/8),c=s.t273;null==c&&(c=s.t324);var d=s.t279;1==u&&1==c.length&&(d=[s.height*(l>>>3)]),null==d&&(d=s.t325);var p=new Uint8Array(s.height*(l>>>3)),g=0;if(null!=s.t322){for(var v=s.t322[0],y=s.t323[0],m=Math.floor((s.width+v-1)/v),_=Math.floor((s.height+y-1)/y),w=new Uint8Array(0|Math.ceil(v*y*f/8)),b=0;b<_;b++)for(var x=0;x<m;x++){for(var E=b*m+x,k=0;k<w.length;k++)w[k]=0;t.decode._decompress(s,n,c[E],d[E],u,w,0,h),6==u?p=w:t._copyTile(w,0|Math.ceil(v*f/8),y,p,0|Math.ceil(s.width*f/8),s.height,0|Math.ceil(x*v*f/8),b*y)}g=8*p.length}else{var S=s.t278?s.t278[0]:s.height;S=Math.min(S,s.height);for(E=0;E<c.length;E++)t.decode._decompress(s,n,c[E],d[E],u,p,0|Math.ceil(g/8),h),g+=l*S;g=Math.min(g,8*p.length)}s.data=new Uint8Array(p.buffer,0,0|Math.ceil(g/8))}}},t.decode._decompress=function(r,n,o,a,s,u,h,f){if(1==s)for(var l=0;l<a;l++)u[h+l]=n[o+l];else if(3==s)t.decode._decodeG3(n,o,a,u,h,r.width,f);else if(4==s)t.decode._decodeG4(n,o,a,u,h,r.width,f);else if(5==s)t.decode._decodeLZW(n,o,u,h);else if(6==s)t.decode._decodeOldJPEG(r,n,o,a,u,h);else if(7==s)t.decode._decodeNewJPEG(r,n,o,a,u,h);else if(8==s)for(var c=new Uint8Array(n.buffer,o,a),d=e.inflate(c),p=0;p<d.length;p++)u[h+p]=d[p];else 32773==s?t.decode._decodePackBits(n,o,a,u,h):32809==s?t.decode._decodeThunder(n,o,a,u,h):i("Unknown compression",s);if(r.t317&&2==r.t317[0])for(var g=r.t277?r.t277[0]:1,v=r.t278?r.t278[0]:r.height,y=r.width*g,m=0;m<v;m++){var _=h+m*y;if(3==g)for(l=3;l<y;l+=3)u[_+l]=u[_+l]+u[_+l-3]&255,u[_+l+1]=u[_+l+1]+u[_+l-2]&255,u[_+l+2]=u[_+l+2]+u[_+l-1]&255;else for(l=g;l<y;l++)u[_+l]=u[_+l]+u[_+l-g]&255}},t.decode._decodeNikon=function(t,e,r,n,o){var a,s;i(t.slice(e,e+100)),a=t[e],s=t[++e],e++,i(a.toString(16),s.toString(16),r)},t.decode._decodeNewJPEG=function(e,r,n,i,o,a){var s=e.t347,u=s?s.length:0,h=new Uint8Array(u+i);if(s){for(var f=0,l=0;l<u-1&&(255!=s[l]||217!=s[l+1]);l++)h[f++]=s[l];var c=r[n],d=r[n+1];255==c&&216==d||(h[f++]=c,h[f++]=d);for(l=2;l<i;l++)h[f++]=r[n+l]}else for(l=0;l<i;l++)h[l]=r[n+l];if(32803==e.t262){var p=e.t258[0],g=(new LosslessJpegDecoder).decode(h),v=g.length;if(16==p)for(l=0;l<v;l++)o[a++]=255&g[l],o[a++]=g[l]>>>8;else{if(12!=p)throw new Error("unsupported bit depth "+p);for(l=0;l<v;l+=2)o[a++]=g[l]>>>4,o[a++]=255&(g[l]<<4|g[l+1]>>>8),o[a++]=255&g[l+1]}}else{var y=new t.JpegDecoder;y.parse(h);var m=y.getData(y.width,y.height);for(l=0;l<m.length;l++)o[a+l]=m[l]}6==e.t262[0]&&(e.t262[0]=2)},t.decode._decodeOldJPEGInit=function(t,e,r,n){var o,a,s,u,h,f=0,l=0,c=!1,d=t.t513,p=d?d[0]:0,g=t.t514,v=g?g[0]:0,y=t.t324||t.t273||d,m=t.t530,_=0,w=0,b=t.t277?t.t277[0]:1,x=t.t515;if(y&&(l=y[0],c=y.length>1),!c){if(255==e[r]&&216==e[r+1])return{jpegOffset:r};if(null!=d&&(255==e[r+p]&&216==e[r+p+1]?f=r+p:i("JPEGInterchangeFormat does not point to SOI"),null==g?i("JPEGInterchangeFormatLength field is missing"):(p>=l||p+v<=l)&&i("JPEGInterchangeFormatLength field value is invalid"),null!=f))return{jpegOffset:f}}if(null!=m&&(_=m[0],w=m[1]),null!=d&&null!=g)if(v>=2&&p+v<=l){for(o=255==e[r+p+v-2]&&216==e[r+p+v-1]?new Uint8Array(v-2):new Uint8Array(v),s=0;s<o.length;s++)o[s]=e[r+p+s];i("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else i("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(null==o){var E=0,k=[];k[E++]=255,k[E++]=216;var S=t.t519;if(null==S)throw new Error("JPEGQTables tag is missing");for(s=0;s<S.length;s++)for(k[E++]=255,k[E++]=219,k[E++]=0,k[E++]=67,k[E++]=s,u=0;u<64;u++)k[E++]=e[r+S[s]+u];for(h=0;h<2;h++){var T=t[0==h?"t520":"t521"];if(null==T)throw new Error((0==h?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(s=0;s<T.length;s++){k[E++]=255,k[E++]=196;var P=19;for(u=0;u<16;u++)P+=e[r+T[s]+u];for(k[E++]=P>>>8,k[E++]=255&P,k[E++]=s|h<<4,u=0;u<16;u++)k[E++]=e[r+T[s]+u];for(u=0;u<P;u++)k[E++]=e[r+T[s]+16+u]}}if(k[E++]=255,k[E++]=192,k[E++]=0,k[E++]=8+3*b,k[E++]=8,k[E++]=t.height>>>8&255,k[E++]=255&t.height,k[E++]=t.width>>>8&255,k[E++]=255&t.width,k[E++]=b,1==b)k[E++]=1,k[E++]=17,k[E++]=0;else for(s=0;s<3;s++)k[E++]=s+1,k[E++]=0!=s?17:(15&_)<<4|15&w,k[E++]=s;null!=x&&0!=x[0]&&(k[E++]=255,k[E++]=221,k[E++]=0,k[E++]=4,k[E++]=x[0]>>>8&255,k[E++]=255&x[0]),o=new Uint8Array(k)}var A=-1;for(s=0;s<o.length-1;){if(255==o[s]&&192==o[s+1]){A=s;break}s++}if(-1==A){var L=new Uint8Array(o.length+10+3*b);L.set(o);var I=o.length;if(A=o.length,(o=L)[I++]=255,o[I++]=192,o[I++]=0,o[I++]=8+3*b,o[I++]=8,o[I++]=t.height>>>8&255,o[I++]=255&t.height,o[I++]=t.width>>>8&255,o[I++]=255&t.width,o[I++]=b,1==b)o[I++]=1,o[I++]=17,o[I++]=0;else for(s=0;s<3;s++)o[I++]=s+1,o[I++]=0!=s?17:(15&_)<<4|15&w,o[I++]=s}if(255==e[l]&&218==e[l+1]){var M=e[l+2]<<8|e[l+3];for((a=new Uint8Array(M+2))[0]=e[l],a[1]=e[l+1],a[2]=e[l+2],a[3]=e[l+3],s=0;s<M-2;s++)a[s+4]=e[l+s+4]}else{var O=0;if((a=new Uint8Array(8+2*b))[O++]=255,a[O++]=218,a[O++]=0,a[O++]=6+2*b,a[O++]=b,1==b)a[O++]=1,a[O++]=0;else for(s=0;s<3;s++)a[O++]=s+1,a[O++]=s<<4|s;a[O++]=0,a[O++]=63,a[O++]=0}return{jpegOffset:r,tables:o,sosMarker:a,sofPosition:A}},t.decode._decodeOldJPEG=function(e,r,n,i,o,a){var s,u,h,f=t.decode._decodeOldJPEGInit(e,r,n,i);if(null!=f.jpegOffset)for(s=n+i-f.jpegOffset,h=new Uint8Array(s),d=0;d<s;d++)h[d]=r[f.jpegOffset+d];else{for(u=f.tables.length,(h=new Uint8Array(u+f.sosMarker.length+i+2)).set(f.tables),u,h[f.sofPosition+5]=e.height>>>8&255,h[f.sofPosition+6]=255&e.height,h[f.sofPosition+7]=e.width>>>8&255,h[f.sofPosition+8]=255&e.width,255==r[n]&&r[n+1]==SOS||(h.set(f.sosMarker,bufoff),bufoff+=sosMarker.length),d=0;d<i;d++)h[bufoff++]=r[n+d];h[bufoff++]=255,h[bufoff++]=EOI}var l=new t.JpegDecoder;l.parse(h);for(var c=l.getData(l.width,l.height),d=0;d<c.length;d++)o[a+d]=c[d];6==e.t262[0]&&(e.t262[0]=2)},t.decode._decodePackBits=function(t,e,r,n,i){for(var o=new Int8Array(t.buffer),a=new Int8Array(n.buffer),s=e+r;e<s;){var u=o[e];if(e++,u>=0&&u<128)for(var h=0;h<u+1;h++)a[i]=o[e],i++,e++;if(u>=-127&&u<0){for(h=0;h<1-u;h++)a[i]=o[e],i++;e++}}},t.decode._decodeThunder=function(t,e,r,n,i){for(var o=[0,1,0,-1],a=[0,1,2,3,0,-3,-2,-1],s=e+r,u=2*i,h=0;e<s;){var f=t[e],l=f>>>6,c=63&f;if(e++,3==l&&(h=15&c,n[u>>>1]|=h<<4*(1-u&1),u++),0==l)for(var d=0;d<c;d++)n[u>>>1]|=h<<4*(1-u&1),u++;if(2==l)for(d=0;d<2;d++){4!=(p=c>>>3*(1-d)&7)&&(h+=a[p],n[u>>>1]|=h<<4*(1-u&1),u++)}if(1==l)for(d=0;d<3;d++){var p;2!=(p=c>>>2*(2-d)&3)&&(h+=o[p],n[u>>>1]|=h<<4*(1-u&1),u++)}}},t.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},t.decode._lens=function(){var t=function(t,e,r,n){for(var i=0;i<e.length;i++)t[e[i]]=r+i*n},e="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",r="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",n="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",i="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",o="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";e=e.split(","),r=r.split(","),n=n.split(","),i=i.split(","),o=o.split(",");var a={},s={};return t(a,e,0,1),t(a,n,64,64),t(a,o,1792,64),t(s,r,0,1),t(s,i,64,64),t(s,o,1792,64),[a,s]}(),t.decode._decodeG4=function(e,r,n,i,o,a,s){for(var u=t.decode,h=r<<3,f=0,l="",c=[],d=[],p=0;p<a;p++)d.push(0);d=u._makeDiff(d);for(var g=0,v=0,y=0,m=0,_=0,w=0,b="",x=0,E=8*Math.ceil(a/8);h>>>3<r+n;){y=u._findDiff(d,g+(0==g?0:1),1-_),m=u._findDiff(d,y,_);var k=0;if(1==s&&(k=e[h>>>3]>>>7-(7&h)&1),2==s&&(k=e[h>>>3]>>>(7&h)&1),h++,l+=k,"H"==b){if(null!=u._lens[_][l]){var S=u._lens[_][l];l="",f+=S,S<64&&(u._addNtimes(c,f,_),g+=f,_=1-_,f=0,0==--x&&(b=""))}}else"0001"==l&&(l="",u._addNtimes(c,m-g,_),g=m),"001"==l&&(l="",b="H",x=2),null!=u._dmap[l]&&(v=y+u._dmap[l],u._addNtimes(c,v-g,_),g=v,l="",_=1-_);c.length==a&&""==b&&(u._writeBits(c,i,8*o+w*E),_=0,w++,g=0,d=u._makeDiff(c),c=[])}},t.decode._findDiff=function(t,e,r){for(var n=0;n<t.length;n+=2)if(t[n]>=e&&t[n+1]==r)return t[n]},t.decode._makeDiff=function(t){var e=[];1==t[0]&&e.push(0,1);for(var r=1;r<t.length;r++)t[r-1]!=t[r]&&e.push(r,t[r]);return e.push(t.length,0,t.length,1),e},t.decode._decodeG3=function(e,r,n,i,o,a,s){for(var u=t.decode,h=r<<3,f=0,l="",c=[],d=[],p=0;p<a;p++)c.push(0);for(var g=0,v=0,y=0,m=0,_=0,w=-1,b="",x=0,E=!1,k=8*Math.ceil(a/8);h>>>3<r+n;){y=u._findDiff(d,g+(0==g?0:1),1-_),m=u._findDiff(d,y,_);var S=0;if(1==s&&(S=e[h>>>3]>>>7-(7&h)&1),2==s&&(S=e[h>>>3]>>>(7&h)&1),h++,l+=S,E){if(null!=u._lens[_][l]){var T=u._lens[_][l];l="",f+=T,T<64&&(u._addNtimes(c,f,_),_=1-_,f=0)}}else if("H"==b){if(null!=u._lens[_][l]){T=u._lens[_][l];l="",f+=T,T<64&&(u._addNtimes(c,f,_),g+=f,_=1-_,f=0,0==--x&&(b=""))}}else"0001"==l&&(l="",u._addNtimes(c,m-g,_),g=m),"001"==l&&(l="",b="H",x=2),null!=u._dmap[l]&&(v=y+u._dmap[l],u._addNtimes(c,v-g,_),g=v,l="",_=1-_);l.endsWith("000000000001")&&(w>=0&&u._writeBits(c,i,8*o+w*k),1==s&&(E=1==(e[h>>>3]>>>7-(7&h)&1)),2==s&&(E=1==(e[h>>>3]>>>(7&h)&1)),h++,null==u._decodeG3.allow2D&&(u._decodeG3.allow2D=E),u._decodeG3.allow2D||(E=!0,h--),l="",_=0,w++,g=0,d=u._makeDiff(c),c=[])}c.length==a&&u._writeBits(c,i,8*o+w*k)},t.decode._addNtimes=function(t,e,r){for(var n=0;n<e;n++)t.push(r)},t.decode._writeBits=function(t,e,r){for(var n=0;n<t.length;n++)e[r+n>>>3]|=t[n]<<7-(r+n&7)},t.decode._decodeLZW=function(e,r,n,i){if(null==t.decode._lzwTab){for(var o=new Uint32Array(65535),a=new Uint16Array(65535),s=new Uint8Array(2e6),u=0;u<256;u++)s[u<<2]=u,o[u]=u<<2,a[u]=1;t.decode._lzwTab=[o,a,s]}for(var h=t.decode._copyData,f=t.decode._lzwTab[0],l=t.decode._lzwTab[1],c=(s=t.decode._lzwTab[2],258),d=1032,p=9,g=r<<3,v=0,y=0;v=(e[g>>>3]<<16|e[g+8>>>3]<<8|e[g+16>>>3])>>24-(7&g)-p&(1<<p)-1,g+=p,257!=v;){if(256==v){if(p=9,c=258,d=1032,v=(e[g>>>3]<<16|e[g+8>>>3]<<8|e[g+16>>>3])>>24-(7&g)-p&(1<<p)-1,g+=p,257==v)break;n[i]=v,i++}else if(v<c){var m=f[v],_=l[v];if(h(s,m,n,i,_),i+=_,y>=c)f[c]=d,s[f[c]]=m[0],l[c]=1,d=d+1+3&-4,c++;else f[c]=d,h(s,f[y],s,d,w=l[y]),s[d+w]=s[m],w++,l[c]=w,c++,d=d+w+3&-4;c+1==1<<p&&p++}else{var w;if(y>=c)f[c]=d,l[c]=0,c++;else f[c]=d,h(s,f[y],s,d,w=l[y]),s[d+w]=s[d],w++,l[c]=w,c++,h(s,d,n,i,w),i+=w,d=d+w+3&-4;c+1==1<<p&&p++}y=v}},t.decode._copyData=function(t,e,r,n,i){for(var o=0;o<i;o+=4)r[n+o]=t[e+o],r[n+o+1]=t[e+o+1],r[n+o+2]=t[e+o+2],r[n+o+3]=t[e+o+3]},t.tags={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffset",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",296:"ResolutionUnit",297:"PageNumber",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffset",325:"TileByteCounts",330:"SubIFDs",336:"DotRange",338:"ExtraSample",339:"SampleFormat",347:"JPEGTables",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",700:"XMP",33421:"CFARepeatPatternDim",33422:"CFAPattern",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33723:"IPTC/NAA",34377:"Photoshop",34665:"ExifIFD",34675:"ICC Profile",34850:"ExposureProgram",34853:"GPSInfo",34855:"ISOSpeedRatings",34858:"TimeZoneOffset",34859:"SelfTimeMode",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37377:"ShutterSpeedValue",37378:"ApertureValue",37380:"ExposureBiasValue",37383:"MeteringMode",37385:"Flash",37386:"FocalLength",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37398:"TIFF/EPStandardID",37399:"SensingMethod",37500:"MakerNote",37510:"UserComment",37724:"ImageSourceData",40092:"XPComment",40094:"XPKeywords",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelXDimension",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50733:"BayerGreenSplit",50738:"AntiAliasStrength",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50727:"AnalogBalance",50728:"AsShotNeutral",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50827:"OriginalRawFileName",50829:"ActiveArea",50830:"MaskedAreas",50931:"CameraCalibrationSignature",50932:"ProfileCalibrationSignature",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualityFinalSize",51091:"OriginalDefaultCropSize",51125:"DefaultUserCrop"},t.ttypes={256:3,257:3,258:3,259:3,262:3,273:4,274:3,277:3,278:4,279:4,282:5,283:5,284:3,286:5,287:5,296:3,305:2,306:2,338:3,513:4,514:4,34665:4},t._readIFD=function(e,r,n,o){var a=e.readUshort(r,n);n+=2;var s={};o.push(s);for(var u=0;u<a;u++){var h=e.readUshort(r,n);n+=2;var f=e.readUshort(r,n);n+=2;var l=e.readUint(r,n);n+=4;var c=e.readUint(r,n);n+=4;var d=[];if(s["t"+h]=d,1==f||7==f)for(var p=0;p<l;p++)d.push(r[(l<5?n-4:c)+p]);if(2==f&&d.push(e.readASCII(r,l<5?n-4:c,l-1)),3==f)for(p=0;p<l;p++)d.push(e.readUshort(r,(l<3?n-4:c)+2*p));if(4==f)for(p=0;p<l;p++)d.push(e.readUint(r,(l<2?n-4:c)+4*p));if(5==f)for(p=0;p<l;p++)d.push(e.readUint(r,c+8*p)/e.readUint(r,c+8*p+4));if(8==f)for(p=0;p<l;p++)d.push(e.readShort(r,(l<3?n-4:c)+2*p));if(9==f)for(p=0;p<l;p++)d.push(e.readInt(r,(l<2?n-4:c)+4*p));if(10==f)for(p=0;p<l;p++)d.push(e.readInt(r,c+8*p)/e.readInt(r,c+8*p+4));if(11==f)for(p=0;p<l;p++)d.push(e.readFloat(r,c+4*p));if(12==f)for(p=0;p<l;p++)d.push(e.readDouble(r,c+8*p));if(0!=l&&0==d.length&&i("unknown TIFF tag type: ",f,"num:",l),330==h)for(p=0;p<l;p++)t._readIFD(e,r,d[p],o)}return n},t._writeIFD=function(e,r,n,i){var o=Object.keys(i);e.writeUshort(r,n,o.length);for(var a=(n+=2)+12*o.length+4,s=0;s<o.length;s++){var u=o[s],h=parseInt(u.slice(1)),f=t.ttypes[h];if(null==f)throw new Error("unknown type of tag: "+h);var l=i[u];2==f&&(l=l[0]+"\\0");var c=l.length;e.writeUshort(r,n,h),n+=2,e.writeUshort(r,n,f),n+=2,e.writeUint(r,n,c);var d=[-1,1,1,2,4,8,0,0,0,0,0,0,8][f]*c,p=n+=4;if(d>4&&(e.writeUint(r,n,a),p=a),2==f&&e.writeASCII(r,p,l),3==f)for(var g=0;g<c;g++)e.writeUshort(r,p+2*g,l[g]);if(4==f)for(g=0;g<c;g++)e.writeUint(r,p+4*g,l[g]);if(5==f)for(g=0;g<c;g++)e.writeUint(r,p+8*g,Math.round(1e4*l[g])),e.writeUint(r,p+8*g+4,1e4);if(12==f)for(g=0;g<c;g++)e.writeDouble(r,p+8*g,l[g]);d>4&&(a+=d+=1&d),n+=4}return[n,a]},t.toRGBA8=function(t){var e=t.width,r=t.height,n=e*r,o=4*n,a=t.data,s=new Uint8Array(4*n),u=t.t262[0],h=t.t258?Math.min(32,t.t258[0]):1,f=t.isLE?1:0;if(0==u)for(var l=Math.ceil(h*e/8),c=0;c<r;c++){var d=c*l,p=c*e;if(1==h)for(var g=0;g<e;g++){var v=p+g<<2,y=a[d+(g>>3)]>>7-(7&g)&1;s[v]=s[v+1]=s[v+2]=255*(1-y),s[v+3]=255}if(4==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+(g>>1)]>>4-4*(1&g)&15;s[v]=s[v+1]=s[v+2]=17*(15-y),s[v+3]=255}if(8==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+g];s[v]=s[v+1]=s[v+2]=255-y,s[v+3]=255}}else if(1==u)for(l=Math.ceil(h*e/8),c=0;c<r;c++){d=c*l,p=c*e;if(1==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+(g>>3)]>>7-(7&g)&1;s[v]=s[v+1]=s[v+2]=255*y,s[v+3]=255}if(2==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+(g>>2)]>>6-2*(3&g)&3;s[v]=s[v+1]=s[v+2]=85*y,s[v+3]=255}if(8==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+g];s[v]=s[v+1]=s[v+2]=y,s[v+3]=255}if(16==h)for(g=0;g<e;g++){v=p+g<<2,y=a[d+(2*g+f)];s[v]=s[v+1]=s[v+2]=Math.min(255,y),s[v+3]=255}}else if(2==u)if(8==h)if(t.t338)if(t.t338[0]>0)for(g=0;g<o;g++)s[g]=a[g];else for(g=0;g<o;g+=4)s[g]=a[g],s[g+1]=a[g+1],s[g+2]=a[g+2],s[g+3]=255;else{if(4==(b=t.t258?t.t258.length:3))for(g=0;g<o;g++)s[g]=a[g];if(3==b)for(g=0;g<n;g++){var m=3*g;s[v=g<<2]=a[m],s[v+1]=a[m+1],s[v+2]=a[m+2],s[v+3]=255}}else for(g=0;g<n;g++){m=6*g;s[v=g<<2]=a[m],s[v+1]=a[m+2],s[v+2]=a[m+4],s[v+3]=255}else if(3==u){var _=t.t320;for(g=0;g<n;g++){v=g<<2;var w=a[g];s[v]=_[w]>>8,s[v+1]=_[256+w]>>8,s[v+2]=_[512+w]>>8,s[v+3]=255}}else if(5==u){var b,x=(b=t.t258?t.t258.length:4)>4?1:0;for(g=0;g<n;g++){v=g<<2;var E=g*b,k=255-a[E],S=255-a[E+1],T=255-a[E+2],P=(255-a[E+3])*(1/255);s[v]=~~(k*P+.5),s[v+1]=~~(S*P+.5),s[v+2]=~~(T*P+.5),s[v+3]=255*(1-x)+a[E+4]*x}}else i("Unknown Photometric interpretation: "+u);return s},t.replaceIMG=function(){for(var e=document.getElementsByTagName("img"),r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("src");if(null!=i){var o=i.split(".").pop().toLowerCase();if("tif"==o||"tiff"==o){var a=new XMLHttpRequest;t._xhrs.push(a),t._imgs.push(n),a.open("GET",i),a.responseType="arraybuffer",a.onload=t._imgLoaded,a.send()}}}},t._xhrs=[],t._imgs=[],t._imgLoaded=function(e){var r=e.target.response,n=t.decode(r),i=n[0];t.decodeImages(r,n);var o=t.toRGBA8(i),a=i.width,s=i.height,u=t._xhrs.indexOf(e.target),h=t._imgs[u];t._xhrs.splice(u,1),t._imgs.splice(u,1);var f=document.createElement("canvas");f.width=a,f.height=s;for(var l=f.getContext("2d"),c=l.createImageData(a,s),d=0;d<o.length;d++)c.data[d]=o[d];l.putImageData(c,0,0);var p=["style","class","id"];for(d=0;d<p.length;d++)f.setAttribute(p[d],h.getAttribute(p[d]));h.parentNode.replaceChild(f,h)},t._binBE={nextZero:function(t,e){for(;0!=t[e];)e++;return e},readUshort:function(t,e){return t[e]<<8|t[e+1]},readShort:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+1],n[1]=e[r+0],t._binBE.i16[0]},readInt:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+3],n[1]=e[r+2],n[2]=e[r+1],n[3]=e[r+0],t._binBE.i32[0]},readUint:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+3],n[1]=e[r+2],n[2]=e[r+1],n[3]=e[r+0],t._binBE.ui32[0]},readASCII:function(t,e,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(t[e+i]);return n},readFloat:function(e,r){for(var n=t._binBE.ui8,i=0;i<4;i++)n[i]=e[r+3-i];return t._binBE.fl32[0]},readDouble:function(e,r){for(var n=t._binBE.ui8,i=0;i<8;i++)n[i]=e[r+7-i];return t._binBE.fl64[0]},writeUshort:function(t,e,r){t[e]=r>>8&255,t[e+1]=255&r},writeUint:function(t,e,r){t[e]=r>>24&255,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=r>>0&255},writeASCII:function(t,e,r){for(var n=0;n<r.length;n++)t[e+n]=r.charCodeAt(n)},writeDouble:function(e,r,n){t._binBE.fl64[0]=n;for(var i=0;i<8;i++)e[r+i]=t._binBE.ui8[7-i]}},t._binBE.ui8=new Uint8Array(8),t._binBE.i16=new Int16Array(t._binBE.ui8.buffer),t._binBE.i32=new Int32Array(t._binBE.ui8.buffer),t._binBE.ui32=new Uint32Array(t._binBE.ui8.buffer),t._binBE.fl32=new Float32Array(t._binBE.ui8.buffer),t._binBE.fl64=new Float64Array(t._binBE.ui8.buffer),t._binLE={nextZero:t._binBE.nextZero,readUshort:function(t,e){return t[e+1]<<8|t[e]},readShort:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+0],n[1]=e[r+1],t._binBE.i16[0]},readInt:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+0],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t._binBE.i32[0]},readUint:function(e,r){var n=t._binBE.ui8;return n[0]=e[r+0],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t._binBE.ui32[0]},readASCII:t._binBE.readASCII,readFloat:function(e,r){for(var n=t._binBE.ui8,i=0;i<4;i++)n[i]=e[r+i];return t._binBE.fl32[0]},readDouble:function(e,r){for(var n=t._binBE.ui8,i=0;i<8;i++)n[i]=e[r+i];return t._binBE.fl64[0]}},t._copyTile=function(t,e,r,n,i,o,a,s){for(var u=Math.min(e,i-a),h=Math.min(r,o-s),f=0;f<h;f++)for(var l=(s+f)*i+a,c=f*e,d=0;d<u;d++)n[l+d]=t[c+d]}}(n,r(110))}()}).call(this,r(1))},function(t,e,r){"use strict";var n={};(0,r(3).assign)(n,r(111),r(112),r(23)),t.exports=n},function(t,e,r){"use strict";var n=r(35),i=r(3),o=r(49),a=r(22),s=r(21),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==r)throw new Error(a[r]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(r=n.deflateSetDictionary(this.strm,f)))throw new Error(a[r]);this._dict_set=!0}}function f(t,e){var r=new h(e);if(r.push(t,!0),r.err)throw r.msg||a[r.err];return r.result}h.prototype.push=function(t,e){var r,a,s=this.strm,h=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===u.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(h),s.next_out=0,s.avail_out=h),1!==(r=n.deflate(s,a))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===a?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==a||(this.onEnd(0),s.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=h,e.deflate=f,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},function(t,e,r){"use strict";var n=r(38),i=r(3),o=r(49),a=r(23),s=r(22),u=r(21),h=r(113),f=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new h,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===f.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=n.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[r])}function c(t,e){var r=new l(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}l.prototype.push=function(t,e){var r,s,u,h,l,c=this.strm,d=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?c.input=o.binstring2buf(t):"[object ArrayBuffer]"===f.call(t)?c.input=new Uint8Array(t):c.input=t,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new i.Buf8(d),c.next_out=0,c.avail_out=d),(r=n.inflate(c,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&r!==a.Z_STREAM_END&&(0!==c.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(c.output,c.next_out),h=c.next_out-u,l=o.buf2string(c.output,u),c.next_out=h,c.avail_out=d-h,h&&i.arraySet(c.output,c.output,u,h,0),this.onData(l)):this.onData(i.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(g=!0)}while((c.avail_in>0||0===c.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),c.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=l,e.inflate=c,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},e.ungzip=c},function(t,e,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,r){"use strict";t.exports=function(t,e){}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResponseTask=e.RequestTask=e.Resource=void 0;var n=r(116);!function(t){t[t.Tile=0]="Tile",t[t.CustomModel=1]="CustomModel",t[t.CustomTexture=2]="CustomTexture",t[t.TileOverlay=3]="TileOverlay",t[t.POIOverlay=4]="POIOverlay",t[t.BuildingOverlay=5]="BuildingOverlay",t[t.Model=6]="Model",t[t.Texture=7]="Texture",t[t.RasterOverlay=8]="RasterOverlay",t[t.Json=9]="Json",t[t.MAX=10]="MAX"}(e.Resource||(e.Resource={}));var i=function(t){this.method="GET",this.params=null,this.id=n.UUID.generate(),this.type=t};e.RequestTask=i;var o=function(t){this.id=t,this.success=!1,this.data=null};e.ResponseTask=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UUID=void 0;var n=function(){function t(){}return t.generate=function(){return Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)+this.count++},t.count=0,t}();e.UUID=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Thread=void 0;var n=function(){function t(){}return Object.defineProperty(t,"isWorker",{get:function(){try{return!window.document}catch(t){return!0}},enumerable:!1,configurable:!0}),t}();e.Thread=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ObjModelLoader=void 0;var n=r(11),i=r(119),o=r(120),a=r(121),s=function(){function t(){}return t.loadModel=function(t,e){if(void 0===e&&(e=!1),0==t.length)return null;for(var r=t.split("\\n").map((function(t){return t.trim().toLowerCase().split(" ").filter((function(t){return""!==t}))})),s=[new i.Vector3],u=[new i.Vector3],h=[new n.Vector2],f=[],l=null,c=[],d=-1,p=null,g=Number.MAX_VALUE,v=Number.MAX_VALUE,y=Number.MAX_VALUE,m=Number.MIN_VALUE,_=Number.MIN_VALUE,w=Number.MIN_VALUE,b=[],x=0,E=r;x<E.length;x++){var k=E[x],S=k[0];if("v"==S){var T=+k[1]||0,P=+k[2]||0,A=+k[3]||0,L=new i.Vector3(T,P,A);s.push(L),P>d&&(d=P,p=L),g=Math.min(g,T),m=Math.max(m,T),v=Math.min(v,A),_=Math.max(_,A),y=Math.min(y,P),w=Math.max(w,P)}else if("vn"==S){T=+k[1]||0,P=+k[2]||0,A=+k[3]||0;u.push(new i.Vector3(T,P,A))}else if("vt"==S){T=+k[1]||0,P=+k[2]||0;h.push(new n.Vector2(T,P))}else if("f"==S)for(var I=0;I<3;I++){var M=k[I+1].split("/"),O=(L=s[+M[0]||0],h[+M[1]||0]),R=u[+M[2]||0];l||(l=new o.ModelGeometry,f.push(l)),c.push(L.x),c.push(L.y),c.push(L.z),c.push(O.x),c.push(O.y),c.push(R.x),c.push(R.y),c.push(R.z),b.push(new a.Point(L.x,L.z)),l.numberOfVertices++}}return f[0].data=e?new Float32Array(c).buffer:c,f[0].points=b,f[0].highestPosition=p,f[0].minX=g,f[0].minY=v,f[0].minZ=y,f[0].maxX=m,f[0].maxY=_,f[0].maxZ=w,f},t}();e.ObjModelLoader=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3=void 0;var n=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=r}return t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.buffer=function(){return new Float32Array([this.x,this.y,this.z])},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!1,configurable:!0}),t.prototype.normalize=function(){var e=this.length,r=0,n=0,i=0;return e>0&&(r=this.x/e,n=this.y/e,i=this.z/e),new t(r,n,i)},t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.invert=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.rotate90=function(){return new t(this.y,-this.x,this.z)},t.prototype.add=function(e){return new t(e.x+this.x,e.y+this.y,e.z+this.z)},t.prototype.subtract=function(e){return e?new t(this.x-e.x,this.y-e.y,this.z-e.z):this.clone()},t.prototype.multiply=function(e){return new t(e*this.x,e*this.y,e*this.z)},t.prototype.rotateBy=function(e){var r=Math.cos(e*Math.PI/180),n=Math.sin(e*Math.PI/180);return new t(this.x*r-this.y*n,this.x*n+this.y*r)},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y+t.z*this.z},t.perp=function(e,r){return new t(r[1]-e[1],e[0]-r[0])},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}();e.Vector3=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ModelGeometry=void 0;var n=function(){this.numberOfVertices=0};e.ModelGeometry=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Point=void 0;var n=function(){function t(t,e){if(null==t||null==e)throw Error("Parameters can not be null");this.x=t,this.y=e}return t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.toString=function(){return"("+String(this.x)+","+String(this.y)+")"},t.convert=function(e){if(e instanceof t)return e;if(Array.isArray(e)&&2===e.length)return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e&&"x"in e&&"y"in e)return new t(Number(e.x),Number(e.y));throw new Error("`IPoint` argument must be specified as a Point instance, an object {x: <x>, y: <y>}, or an array of [<x>, <y>]")},t}();e.Point=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VectorTileParserWorker=e.LayerType=e.LabelType=void 0;var n,i,o=r(142),a=r(123),s=r(124),u=r(127),h=r(128),f=r(6),l=r(129),c=r(130),d=r(132);!function(t){t[t.PLACE=0]="PLACE",t[t.ROAD=1]="ROAD",t[t.BOUNDARY=2]="BOUNDARY"}(n=e.LabelType||(e.LabelType={})),function(t){t[t.SURFACE=0]="SURFACE",t[t.ROADS=1]="ROADS",t[t.BOUNDARY=2]="BOUNDARY",t[t.LABEL=3]="LABEL",t[t.RASTER=4]="RASTER",t[t.POI=5]="POI",t[t.BUILDING=6]="BUILDING",t[t.LINE=7]="LINE",t[t.FILL=8]="FILL",t[t.CIRCLE=9]="CIRCLE",t[t.SYMBOL=10]="SYMBOL",t[t.USERPOI=11]="USERPOI",t[t.USERBUILDING=12]="USERBUILDING",t[t.GEOJSON=13]="GEOJSON",t[t.RASTER_OVERLAY=14]="RASTER_OVERLAY",t[t.POI_OVERLAY=15]="POI_OVERLAY",t[t.BUILDING_OVERLAY=16]="BUILDING_OVERLAY"}(i=e.LayerType||(e.LayerType={}));var p=r(133),g=r(26),v=r(134),y=r(135),m=r(53),_=function(){function t(){}return t.getLayers=function(e,r){if(r==h.VectorFormat.geojson)return e;var n=new a(t.base64ToArrayBuffer(e));return new s.VectorTile(n).layers},t.getFeatureCollection=function(t,e,r,n,i,a){var s=t[e];if(r==h.VectorFormat.geojson)return null==s||"FeatureCollection"!=s.type||null==s.features||0==s.features.length?null:o.default(s,{maxZoom:n,buffer:0,extent:f.MapConstants.tileExtend,tolerance:4}).getTile(n,i,a).features;for(var u=[],l=0;l<s.length;l++)u.push(s.feature(l));return u},t.getFeatureProperties=function(t,e){return e==h.VectorFormat.geojson?t.tags:t.properties},t.getFeatureGeometry=function(t,e){if(e==h.VectorFormat.geojson)return t.geometry;var r=t.loadGeometry().map((function(t){return t.map((function(t){return[t.x,t.y]}))}));return 1==t.type?r[0]:r},t.project=function(t,e,r,n,i){var o=e*r,a=e*n,s=e*i,u=180-360*(t[1]+s)/o;return[360*(t[0]+a)/o-180,360/Math.PI*Math.atan(Math.exp(u*Math.PI/180))-90]},t.generateLabelVectorTileData=function(t,e,r,n,o){var a={geometryType:e,layerType:i.LABEL,labelType:r,layer:t,id:n.id,sort_rank:n.sort_rank,kind:n.kind,kind_detail:n.kind_detail,operator:n.operator,min_zoom:n.min_zoom,collision_rank:n.collision_rank,size:o.size,color:(o.color||{}).code,haloColor:(o.halo.color||{}).code};return n.name&&(a.name=n.name),n.nameLeft&&(a.nameLeft=n.nameLeft),n.nameRight&&(a.nameRight=n.nameRight),n.coordinates&&(a.coordinates=n.coordinates),n.featureGeometry&&(a.geometries=n.featureGeometry),a},t.generateRoadVectorTileData=function(t,e,r,n,o){return{geometryType:g.GeometryType.LineString,layerType:i.ROADS,layer:t,id:e,sort_rank:r,kind:"",kind_detail:"",name:"road|group|"+e,operator:"",min_zoom:0,collision_rank:0,color:n.color,width:n.width,outlineWidth:n.outlineWidth,outlineColor:n.outlineColor,pattern:n.pattern,patternTextureSize:o.patternTextureSize,vertices:o.vertices.buffer,indices:o.indices.buffer}},t.parse=function(e,r,o){var a={},s=[],h=r.zoom,_=r.x,w=r.y,b=new y.MapStyle(o.style),x=o.format,E=o.language,k={pixelScale:o.scale,resourceScale:Math.round(o.scale)},S=f.MapConstants.baseTileSize*k.pixelScale,T=Math.pow(2,h),P=E==m.MapLanguage.vi?"name:vi":"name:en",A=t.getLayers(e,x),L=function(e){var r=t.getFeatureCollection(A,e,x,h,_,w);if(null==r||0==r.length)return"continue";var o=void 0;"roads"===e&&(o=u(v.compareOrderASC));for(var y=function(u){var c=r[u],y=e+"|"+h+"|"+_+"|"+w+"|"+u,m=t.getFeatureGeometry(c,x),A=t.getFeatureProperties(c,x);switch(c.type){case 1:if(!(R=A[P]||A.name)&&"places"!=e&&1!=m.length)return"continue";if(C=b.build(e,"text",h,A.kind,A.kind_detail,k)){A.name=R,A.coordinates=t.project(m[0],c.extent||f.MapConstants.tileExtend,T,_,w);var L=t.generateLabelVectorTileData(e,g.GeometryType.Point,n.PLACE,A,C);a["label|place|"+A.id]=L}break;case 2:case 3:if("buildings"===e&&h<f.MapConstants.vectorBuildingsMinZoom)return"continue";var I=c.type,M=I==g.GeometryType.LineString?"lines":"polygons",O=b.build(e,M,h,A.kind,A.kind_detail,k);if(null==O)return"continue";var R,C,B=new p.GeometryCollection(m),U=i.SURFACE;if(I==g.GeometryType.LineString)if("roads"===e){if(U=i.ROADS,(R=A[P]||A.name)&&1==m.length)if(C=b.build(e,"text",h,A.kind,A.kind_detail,k)){var D=m[0].map((function(e){return t.project(e,c.extent||f.MapConstants.tileExtend,T,_,w)}));A.name=R,A.coordinates=[D[0],D[D.length-1]],A.featureGeometry=m;L=t.generateLabelVectorTileData(e,g.GeometryType.LineString,n.ROAD,A,C);a["label|road|"+A.id]=L}}else if("boundaries"===e){U=i.BOUNDARY;var F=l.BoundaryLabelLayerProperties.getNameLeft(A,E),z=l.BoundaryLabelLayerProperties.getNameRight(A,E);if(F&&z&&1==m.length){var N=b.build(e,"text",h,A.kind,A.kind_detail,k);if(N){D=m[0].map((function(e){return t.project(e,c.extent||f.MapConstants.tileExtend,T,_,w)}));A.nameLeft=F,A.nameRight=z,A.coordinates=[D[0],D[D.length-1]],A.featureGeometry=m;L=t.generateLabelVectorTileData(e,g.GeometryType.LineString,n.BOUNDARY,A,N);a["label|boundary|"+A.id]=L}}}if(U==i.ROADS)o=o.insert(new v.Order(u,A.sort_rank||0),{osmId:A.id,tileLayerId:y,geometries:B,width:Math.round(O.width),color:(O.color||{}).code,outlineWidth:Math.round(O.outline.width||0),outlineColor:(O.outline.color||{}).code||"",pattern:O.pattern});else{var j=d.SurfaceLayerRenderData.buildGlData(I,B,O.width,S,b,O.pattern);L={geometryType:I,layerType:U,layer:e,id:A.id,sort_rank:A.sort_rank,kind:A.kind,kind_detail:A.kind_detail,name:A[P]||A.name,operator:A.operator,min_zoom:A.min_zoom,collision_rank:A.collision_rank,color:(O.color||{}).code,width:O.width,outlineWidth:(O.outline||{}).width,outlineColor:((O.outline||{}).color||{}).code,pattern:O.pattern,patternTextureSize:j.patternTextureSize,vertices:j.vertices.buffer,indices:j.indices.buffer};a[y]=L,s.push(L.vertices),s.push(L.indices)}break;default:console.error("Invalid type")}},m=0;m<r.length;m++)y(m);if("roads"===e){var L,I="",M="",O=0,R=0,C=null,B=[],U=0,D=0;if(o.forEach((function(r,n){if(n.width==O&&n.color==I&&n.pattern==C&&n.outlineWidth==R&&n.outlineColor==M)B.push(n.geometries);else{if(B.length>0){var i=c.RoadLayerRenderData.buildGlData(B,O,S,b,C),o=t.generateRoadVectorTileData(e,U++,D,{color:I,width:O,outlineWidth:R,outlineColor:M,pattern:C},i);a[L]=o,s.push(o.vertices,o.indices)}B=[n.geometries],D=r.order,n.osmId,L=n.tileLayerId,I=n.color,O=n.width,M=n.outlineColor,R=n.outlineWidth,C=n.pattern}})),B.length>0){var F=c.RoadLayerRenderData.buildGlData(B,O,S,b,C),z=t.generateRoadVectorTileData(e,U++,D,{color:I,width:O,outlineWidth:R,outlineColor:M,pattern:C},F);a[L]=z,s.push(z.vertices,z.indices)}}};for(var I in A)L(I);return{vectorDatas:a,transferableDatas:s}},t.base64ToArrayBuffer=function(t){for(var e=atob(t),r=e.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=e.charCodeAt(i);return n.buffer},t}();e.VectorTileParserWorker=_},function(t,e,r){"use strict";t.exports=i;var n=r(27);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function a(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function u(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function h(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function l(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function _(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=m(this.buf,this.pos)+4294967296*w(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return s(t,n,e);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return s(t,n,e);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return s(t,n,e);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return s(t,n,e);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return s(t,n,e);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return s(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&o?function(t,e,r){return o.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var n="",i=e;for(;i<r;){var o,a,s,u=t[i],h=null,f=u>239?4:u>223?3:u>191?2:1;if(i+f>r)break;1===f?u<128&&(h=u):2===f?128==(192&(o=t[i+1]))&&(h=(31&u)<<6|63&o)<=127&&(h=null):3===f?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((h=(15&u)<<12|(63&o)<<6|63&a)<=2047||h>=55296&&h<=57343)&&(h=null)):4===f&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((h=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,f=1):h>65535&&(h-=65536,n+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),n+=String.fromCharCode(h),i+=f}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var r=a(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&u(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&u(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e,r){t.exports.VectorTile=r(125),t.exports.VectorTileFeature=r(51),t.exports.VectorTileLayer=r(50)},function(t,e,r){"use strict";var n=r(50);function i(t,e,r){if(3===t){var i=new n(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}t.exports=function(t,e){this.layers=t.readFields(i,{},e)}},function(t,e,r){"use strict";function n(t,e){this.x=t,this.y=e}t.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},function(t,e,r){"use strict";t.exports=function(t){return new s(t||g,null)};function n(t,e,r,n,i,o){this._color=t,this.key=e,this.value=r,this.left=n,this.right=i,this._count=o}function i(t){return new n(t._color,t.key,t.value,t.left,t.right,t._count)}function o(t,e){return new n(t,e.key,e.value,e.left,e.right,e._count)}function a(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function s(t,e){this._compare=t,this.root=e}var u=s.prototype;function h(t,e){var r;if(e.left&&(r=h(t,e.left)))return r;return(r=t(e.key,e.value))||(e.right?h(t,e.right):void 0)}function f(t,e,r,n){if(e(t,n.key)<=0){var i;if(n.left)if(i=f(t,e,r,n.left))return i;if(i=r(n.key,n.value))return i}if(n.right)return f(t,e,r,n.right)}function l(t,e,r,n,i){var o,a=r(t,i.key),s=r(e,i.key);if(a<=0){if(i.left&&(o=l(t,e,r,n,i.left)))return o;if(s>0&&(o=n(i.key,i.value)))return o}if(s>0&&i.right)return l(t,e,r,n,i.right)}function c(t,e){this.tree=t,this._stack=e}Object.defineProperty(u,"keys",{get:function(){var t=[];return this.forEach((function(e,r){t.push(e)})),t}}),Object.defineProperty(u,"values",{get:function(){var t=[];return this.forEach((function(e,r){t.push(r)})),t}}),Object.defineProperty(u,"length",{get:function(){return this.root?this.root._count:0}}),u.insert=function(t,e){for(var r=this._compare,i=this.root,u=[],h=[];i;){var f=r(t,i.key);u.push(i),h.push(f),i=f<=0?i.left:i.right}u.push(new n(0,t,e,null,null,1));for(var l=u.length-2;l>=0;--l){i=u[l];h[l]<=0?u[l]=new n(i._color,i.key,i.value,u[l+1],i.right,i._count+1):u[l]=new n(i._color,i.key,i.value,i.left,u[l+1],i._count+1)}for(l=u.length-1;l>1;--l){var c=u[l-1];i=u[l];if(1===c._color||1===i._color)break;var d=u[l-2];if(d.left===c)if(c.left===i){if(!(p=d.right)||0!==p._color){if(d._color=0,d.left=c.right,c._color=1,c.right=d,u[l-2]=c,u[l-1]=i,a(d),a(c),l>=3)(g=u[l-3]).left===d?g.left=c:g.right=c;break}c._color=1,d.right=o(1,p),d._color=0,l-=1}else{if(!(p=d.right)||0!==p._color){if(c.right=i.left,d._color=0,d.left=i.right,i._color=1,i.left=c,i.right=d,u[l-2]=i,u[l-1]=c,a(d),a(c),a(i),l>=3)(g=u[l-3]).left===d?g.left=i:g.right=i;break}c._color=1,d.right=o(1,p),d._color=0,l-=1}else if(c.right===i){if(!(p=d.left)||0!==p._color){if(d._color=0,d.right=c.left,c._color=1,c.left=d,u[l-2]=c,u[l-1]=i,a(d),a(c),l>=3)(g=u[l-3]).right===d?g.right=c:g.left=c;break}c._color=1,d.left=o(1,p),d._color=0,l-=1}else{var p;if(!(p=d.left)||0!==p._color){var g;if(c.left=i.right,d._color=0,d.right=i.left,i._color=1,i.right=c,i.left=d,u[l-2]=i,u[l-1]=c,a(d),a(c),a(i),l>=3)(g=u[l-3]).right===d?g.right=i:g.left=i;break}c._color=1,d.left=o(1,p),d._color=0,l-=1}}return u[0]._color=1,new s(r,u[0])},u.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return h(t,this.root);case 2:return f(e,this._compare,t,this.root);case 3:if(this._compare(e,r)>=0)return;return l(e,r,this._compare,t,this.root)}},Object.defineProperty(u,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new c(this,t)}}),Object.defineProperty(u,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new c(this,t)}}),u.at=function(t){if(t<0)return new c(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new c(this,r);if(t-=1,!e.right)break;if(t>=e.right._count)break;e=e.right}return new c(this,[])},u.ge=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o<=0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new c(this,n)},u.gt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o<0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new c(this,n)},u.lt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o>0&&(i=n.length),r=o<=0?r.left:r.right}return n.length=i,new c(this,n)},u.le=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var o=e(t,r.key);n.push(r),o>=0&&(i=n.length),r=o<0?r.left:r.right}return n.length=i,new c(this,n)},u.find=function(t){for(var e=this._compare,r=this.root,n=[];r;){var i=e(t,r.key);if(n.push(r),0===i)return new c(this,n);r=i<=0?r.left:r.right}return new c(this,[])},u.remove=function(t){var e=this.find(t);return e?e.remove():this},u.get=function(t){for(var e=this._compare,r=this.root;r;){var n=e(t,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var d=c.prototype;function p(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function g(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(d,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(d,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),d.clone=function(){return new c(this.tree,this._stack.slice())},d.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new n(r._color,r.key,r.value,r.left,r.right,r._count);for(var u=t.length-2;u>=0;--u){(r=t[u]).left===t[u+1]?e[u]=new n(r._color,r.key,r.value,e[u+1],r.right,r._count):e[u]=new n(r._color,r.key,r.value,r.left,e[u+1],r._count)}if((r=e[e.length-1]).left&&r.right){var h=e.length;for(r=r.left;r.right;)e.push(r),r=r.right;var f=e[h-1];e.push(new n(r._color,f.key,f.value,r.left,r.right,r._count)),e[h-1].key=r.key,e[h-1].value=r.value;for(u=e.length-2;u>=h;--u)r=e[u],e[u]=new n(r._color,r.key,r.value,r.left,e[u+1],r._count);e[h-1].left=e[h]}if(0===(r=e[e.length-1])._color){var l=e[e.length-2];l.left===r?l.left=null:l.right===r&&(l.right=null),e.pop();for(u=0;u<e.length;++u)e[u]._count--;return new s(this.tree._compare,e[0])}if(r.left||r.right){r.left?p(r,r.left):r.right&&p(r,r.right),r._color=1;for(u=0;u<e.length-1;++u)e[u]._count--;return new s(this.tree._compare,e[0])}if(1===e.length)return new s(this.tree._compare,null);for(u=0;u<e.length;++u)e[u]._count--;var c=e[e.length-2];return function(t){for(var e,r,n,s,u=t.length-1;u>=0;--u){if(e=t[u],0===u)return void(e._color=1);if((r=t[u-1]).left===e){if((n=r.right).right&&0===n.right._color){if(s=(n=r.right=i(n)).right=i(n.right),r.right=n.left,n.left=r,n.right=s,n._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(n),u>1)(h=t[u-2]).left===r?h.left=n:h.right=n;return void(t[u-1]=n)}if(n.left&&0===n.left._color){if(s=(n=r.right=i(n)).left=i(n.left),r.right=s.left,n.left=s.right,s.left=r,s.right=n,s._color=r._color,r._color=1,n._color=1,e._color=1,a(r),a(n),a(s),u>1)(h=t[u-2]).left===r?h.left=s:h.right=s;return void(t[u-1]=s)}if(1===n._color){if(0===r._color)return r._color=1,void(r.right=o(0,n));r.right=o(0,n);continue}n=i(n),r.right=n.left,n.left=r,n._color=r._color,r._color=0,a(r),a(n),u>1&&((h=t[u-2]).left===r?h.left=n:h.right=n),t[u-1]=n,t[u]=r,u+1<t.length?t[u+1]=e:t.push(e),u+=2}else{if((n=r.left).left&&0===n.left._color){if(s=(n=r.left=i(n)).left=i(n.left),r.left=n.right,n.right=r,n.left=s,n._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(n),u>1)(h=t[u-2]).right===r?h.right=n:h.left=n;return void(t[u-1]=n)}if(n.right&&0===n.right._color){if(s=(n=r.left=i(n)).right=i(n.right),r.left=s.right,n.right=s.left,s.right=r,s.left=n,s._color=r._color,r._color=1,n._color=1,e._color=1,a(r),a(n),a(s),u>1)(h=t[u-2]).right===r?h.right=s:h.left=s;return void(t[u-1]=s)}if(1===n._color){if(0===r._color)return r._color=1,void(r.left=o(0,n));r.left=o(0,n);continue}var h;n=i(n),r.left=n.right,n.right=r,n._color=r._color,r._color=0,a(r),a(n),u>1&&((h=t[u-2]).right===r?h.right=n:h.left=n),t[u-1]=n,t[u]=r,u+1<t.length?t[u+1]=e:t.push(e),u+=2}}}(e),c.left===r?c.left=null:c.right=null,new s(this.tree._compare,e[0])},Object.defineProperty(d,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(d,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(d,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var n=e.length-2;n>=0;--n)e[n+1]===e[n].right&&(++t,e[n].left&&(t+=e[n].left._count));return t},enumerable:!0}),d.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(d,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),d.update=function(t){var e=this._stack;if(0===e.length)throw new Error("Can\'t update empty node!");var r=new Array(e.length),i=e[e.length-1];r[r.length-1]=new n(i._color,i.key,t,i.left,i.right,i._count);for(var o=e.length-2;o>=0;--o)(i=e[o]).left===e[o+1]?r[o]=new n(i._color,i.key,i.value,r[o+1],i.right,i._count):r[o]=new n(i._color,i.key,i.value,i.left,r[o+1],i._count);return new s(this.tree._compare,r[0])},d.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(d,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VectorFormat=void 0,function(t){t.geojson="json",t.mvt="mvt"}(e.VectorFormat||(e.VectorFormat={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoundaryLabelLayerProperties=void 0;var n=r(53),i=function(){function t(){}return t.getNameLeft=function(t,e){return t[e==n.MapLanguage.vi?"name:left:vi":"name:left:en"]||t["name:left"]},t.getNameRight=function(t,e){return t[e==n.MapLanguage.vi?"name:right:vi":"name:right:en"]||t["name:right"]},t}();e.BoundaryLabelLayerProperties=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RoadLayerRenderData=void 0;var n=r(11),i=r(54),o=r(25),a=r(55),s=r(16),u=function(){function t(){}return t.buildGlData=function(t,e,r,u,h){var f=a.PolylineUtils.buildPatternItem(u.getPatternStyle(h)),l={};if(f.getType()==s.PatternType.Dash||f.getType()==s.PatternType.Dot){var c=a.PolylineUtils.getLongestSegmentLengthForCollections(t,r);l=a.PolylineUtils.calculateDashTextureSize(e,c,f)}var d=l.width||1,p=l.height||1,g=[],v=new i.PolylineBuilderContext;return v.lineCapType=o.LineCapType.Round,v.lineJoinType=o.LineJoinType.Round,v.addVertex=function(t,e,r){g.push(t.x,t.y,e.x,e.y,r.x,r.y)},v.textureWidth=d,v.textureHeight=p,t.forEach((function(t){for(var i=t.geometryCoordinates,o=0;o<i.length;++o){for(var a=[],s=0;s<i[o].length;++s){var u=new n.Vector2(i[o][s][0],i[o][s][1]);u.x=u.x*r,u.y=u.y*r,a.push(u)}v.buildPolyLine(a,null,e)}})),{vertices:new Float32Array(g),indices:new Uint32Array(v.indices),patternTextureSize:{width:d,height:p}}},t}();e.RoadLayerRenderData=u},function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,s,u,h,f,d,p,v=e&&e.length,y=v?e[0]*r:t.length,m=i(t,0,y,r,!0),_=[];if(!m||m.next===m.prev)return _;if(v&&(m=function(t,e,r,n){var a,s,u,h,f,d=[];for(a=0,s=e.length;a<s;a++)u=e[a]*n,h=a<s-1?e[a+1]*n:t.length,(f=i(t,u,h,n,!1))===f.next&&(f.steiner=!0),d.push(g(f));for(d.sort(l),a=0;a<d.length;a++)r=o(r=c(d[a],r),r.next);return r}(t,e,m,r)),t.length>80*r){n=u=t[0],s=h=t[1];for(var w=r;w<y;w+=r)(f=t[w])<n&&(n=f),(d=t[w+1])<s&&(s=d),f>u&&(u=f),d>h&&(h=d);p=0!==(p=Math.max(u-n,h-s))?1/p:0}return a(m,_,r,n,s,p),_}function i(t,e,r,n,i){var o,a;if(i===A(t,e,r,n)>0)for(o=e;o<r;o+=n)a=S(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=S(o,t[o],t[o+1],a);return a&&_(a,a.next)&&(T(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!_(n,n.next)&&0!==m(n.prev,n,n.next))n=n.next;else{if(T(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function a(t,e,r,n,i,l,c){if(t){!c&&l&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,h=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<h&&(s++,n=n.nextZ);e++);for(u=h;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,h*=2}while(a>1)}(i)}(t,n,i,l);for(var d,g,v=t;t.prev!==t.next;)if(d=t.prev,g=t.next,l?u(t,n,i,l):s(t))e.push(d.i/r),e.push(t.i/r),e.push(g.i/r),T(t),t=g.next,v=g.next;else if((t=g)===v){c?1===c?a(t=h(o(t),e,r),e,r,n,i,l,2):2===c&&f(t,e,r,n,i,l):a(o(t),e,r,n,i,l,1);break}}}function s(t){var e=t.prev,r=t,n=t.next;if(m(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(v(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,r,n){var i=t.prev,o=t,a=t.next;if(m(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,h=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,f=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=p(s,u,e,r,n),c=p(h,f,e,r,n),d=t.prevZ,g=t.nextZ;d&&d.z>=l&&g&&g.z<=c;){if(d!==t.prev&&d!==t.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,g!==t.prev&&g!==t.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;d&&d.z>=l;){if(d!==t.prev&&d!==t.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&m(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;g&&g.z<=c;){if(g!==t.prev&&g!==t.next&&v(i.x,i.y,o.x,o.y,a.x,a.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!_(i,a)&&w(i,n,n.next,a)&&E(i,a)&&E(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),T(n),T(n.next),n=t=a),n=n.next}while(n!==t);return o(n)}function f(t,e,r,n,i,s){var u=t;do{for(var h=u.next.next;h!==u.prev;){if(u.i!==h.i&&y(u,h)){var f=k(u,h);return u=o(u,u.next),f=o(f,f.next),a(u,e,r,n,i,s),void a(f,e,r,n,i,s)}h=h.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function c(t,e){var r=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var u,h=r,f=r.x,l=r.y,c=1/0;n=r;do{i>=n.x&&n.x>=f&&i!==n.x&&v(o<l?i:a,o,f,l,o<l?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),E(n,t)&&(u<c||u===c&&(n.x>r.x||n.x===r.x&&d(r,n)))&&(r=n,c=u)),n=n.next}while(n!==h);return r}(t,e);if(!r)return e;var n=k(r,t),i=o(r,r.next);return o(n,n.next),e===r?i:e}function d(t,e){return m(t.prev,t,e.prev)<0&&m(e.next,t,t.next)<0}function p(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function v(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&w(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||_(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function w(t,e,r,n){var i=x(m(t,e,r)),o=x(m(t,e,n)),a=x(m(r,n,t)),s=x(m(r,n,e));return i!==o&&a!==s||(!(0!==i||!b(t,r,e))||(!(0!==o||!b(t,n,e))||(!(0!==a||!b(r,t,n))||!(0!==s||!b(r,e,n)))))}function b(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function x(t){return t>0?1:t<0?-1:0}function E(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function k(t,e){var r=new P(t.i,t.x,t.y),n=new P(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function S(t,e,r,n){var i=new P(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=n,t.exports.default=n,n.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(A(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var h=e[s]*r,f=s<u-1?e[s+1]*r:t.length;a-=Math.abs(A(t,h,f,r))}var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;l+=Math.abs((t[c]-t[p])*(t[d+1]-t[c+1])-(t[c]-t[d])*(t[p+1]-t[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceLayerRenderData=e.SurfaceType=void 0;var n=r(26),i=r(11),o=r(54),a=r(25),s=r(16),u=r(55);!function(t){t[t.LINE=0]="LINE",t[t.POLYGON=1]="POLYGON"}(e.SurfaceType||(e.SurfaceType={}));var h=function(){function t(){}return t.signedArea=function(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n+=((r=t[a]).x-e.x)*(e.y+r.y);return n},t.buildGlData=function(t,e,r,h,f,l){if(t==n.GeometryType.LineString){var c=u.PolylineUtils.buildPatternItem(f.getPatternStyle(l)),d={};if(c.getType()==s.PatternType.Dash||c.getType()==s.PatternType.Dot){var p=u.PolylineUtils.getLongestSegmentLengthForCollections([e],h);d=u.PolylineUtils.calculateDashTextureSize(r,p,c)}var g=d.width||1,v=d.height||1,y=[],m=new o.PolylineBuilderContext;m.lineCapType=a.LineCapType.Round,m.lineJoinType=a.LineJoinType.Round,m.addVertex=function(t,e,r){y.push(t.x,t.y,e.x,e.y,r.x,r.y)},m.textureWidth=g,m.textureHeight=v;for(var _=e.geometryCoordinates,w=0;w<_.length;++w){for(var b=[],x=0;x<_[w].length;++x){(L=new i.Vector2(_[w][x][0],_[w][x][1])).x=L.x*h,L.y=L.y*h,b.push(L)}m.buildPolyLine(b,null,r)}return{vertices:new Float32Array(y),indices:new Uint32Array(m.indices),patternTextureSize:{width:g,height:v}}}if(t==n.GeometryType.Polygon){var E=[],k=[],S=E.length/2,T=new o.PolygonBuilderContext;T.addVertex=function(t){E.push(t.x,t.y)};_=e.geometryCoordinates;var P=[];for(w=0;w<_.length;++w){var A=[];for(x=0;x<_[w].length;++x){var L;(L=new i.Vector2(_[w][x][0],_[w][x][1])).x=L.x*h,L.y=L.y*h,A.push(L)}var I=this.signedArea(A);0!==I&&(I<0?(P.length>0&&(o.buildPolygon(P,T),T.indices.forEach((function(t){return k.push(t+S)})),S=E.length/2),P=[A]):P.push(A))}return P.length>0&&(o.buildPolygon(P,T),T.indices.forEach((function(t){return k.push(t+S)}))),{vertices:new Float32Array(E),indices:new Uint32Array(k)}}return null},t}();e.SurfaceLayerRenderData=h},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.GeometryCollection=e.GeometryCoordinates=void 0;var o=r(6),a=function(t){this.geometryCoordinates=[],this.geometryCoordinates=t};e.GeometryCoordinates=a;var s=function(t){function e(e){var r=t.call(this,e)||this;return r.normalizeGeometryCoordinates(),r}return i(e,t),e.prototype.normalizeGeometryCoordinates=function(){for(var t=[],e=0;e<this.geometryCoordinates.length;++e){for(var r=[],n=0;n<this.geometryCoordinates[e].length;++n)r.push([this.geometryCoordinates[e][n][0]/o.MapConstants.tileExtend-.5,.5-this.geometryCoordinates[e][n][1]/o.MapConstants.tileExtend]);t.push(r)}this.geometryCoordinates=t},e}(a);e.GeometryCollection=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compareOrderDESC=e.compareOrderASC=e.Order=void 0;var n=function(){function t(t,e){this.id=t,this.order=e}return t.prototype.equal=function(t){return this.id==t.id},t.prototype.lessThan=function(t){return this.order==t.order?this.id<t.id:this.order<t.order},t}();e.Order=n,e.compareOrderASC=function(t,e){return t.order==e.order?t.id<e.id?-1:t.id>e.id?1:0:t.order-e.order},e.compareOrderDESC=function(t,e){return t.order==e.order?t.id<e.id?1:t.id>e.id?-1:0:e.order-t.order}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MapStyle=void 0;var n=r(15),i=r(6),o=r(136),a=r(139),s=function(){function t(t,e,r,n){void 0===e&&(e=!1),void 0===r&&(r=null),void 0===n&&(n=null),this.layers={},this.earthColor=i.MapConstants.mapBackgroundColor2D,this.load(t,e,r,n)}return t.prototype.getTextureStyle=function(t){return this.sources?this.sources.textures[t]:null},t.prototype.getPatternStyle=function(t){return this.sources?this.sources.patterns[t]:null},t.prototype.getMapBackgroundColor2D=function(){return this.earthColor},t.prototype.load=function(t,e,r,n){if(null!=t){e&&this.releaseTextures(n);var s={};if("string"==typeof t)try{s=JSON.parse(t)}catch(t){console.error(t)}else Object.assign(s,t);this.layers={};var u=s.layers;for(var h in u){var f=o.LayerStyle.parser(h,u[h],null);null!=f&&(this.layers[h]=f)}this.sources=null;var l=s.sources;if(l){var c=r||t.name;this.sources=a.SourcesStyle.parser(l,c,n,e),s.sources=this.sources}if(e){s.name=r,this.json=JSON.stringify(s);var d=this.build("earth","polygons",i.MapConstants.defaultMaxNativeZoom,null,null);this.earthColor=d?d.color:i.MapConstants.mapBackgroundColor2D}}},t.prototype.build=function(t,e,r,i,a,s){void 0===s&&(s=null);var u=this.layers[t];if(null==u)return null;var h={kind:i||null,kind_detail:a||null},f=u.match(h,e);if(0==f.length)return null;switch(e){case"polygons":if(c=o.LayerStyle.getValue(r,f,"color"))return{color:c};break;case"lines":var l=this.ignoreRoadsStyle(t,i,a,r)?null:o.LayerStyle.getValue(r,f,"width");if(l&&l>0){var c=o.LayerStyle.getValue(r,f,"color"),d=o.LayerStyle.getValue(r,f,"pattern");if(c||this.isIconPattern(d))return{width:l*(s?s.pixelScale:n.MapUtils.pixelScale),color:c,pattern:d,outline:{width:o.LayerStyle.getValue(r,f,"outline_width"),color:o.LayerStyle.getValue(r,f,"outline_color")}}}break;case"text":if((p=o.LayerStyle.getValue(r,f,"size"))&&p>0)return(g={}).size=p*(s?s.resourceScale:n.MapUtils.resourceScale),g.color=o.LayerStyle.getValue(r,f,"color"),g.halo={},g.halo.color=o.LayerStyle.getValue(r,f,"halo_color"),g;break;case"points":var p,g;if((p=o.LayerStyle.getValue(r,f,"size"))&&p>0)return(g={}).size=p*(s?s.pixelScale:n.MapUtils.pixelScale),g.color=o.LayerStyle.getValue(r,f,"color"),g.texture=o.LayerStyle.getValue(r,f,"texture"),g.iconIndex=o.LayerStyle.getValue(r,f,"icon_index"),g.halo={},g.halo.color=o.LayerStyle.getValue(r,f,"halo_color"),g;break;default:return null}return null},t.prototype.isIconPattern=function(t){var e=this.getPatternStyle(t);return e&&e.isIcon()},t.prototype.releaseTextures=function(t){},t.prototype.ignoreRoadsStyle=function(t,e,r,n){return"roads"==t&&(n<16&&("footway"==r&&"path"==e||"service"==r&&"minor_road"==e))},t}();e.MapStyle=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LayerStyle=void 0;var n=r(137),i=r(138),o=["filter","draw","data_source"],a=function(){function t(t,e){this.name=t,this.depth=e,this.sublayers=[]}return t.prototype.match=function(t,e){var r=this.matchRule(t,e);return r.sort((function(t,e){return t.match==e.match?e.depth-t.depth:e.match-t.match})),r},t.prototype.matchRule=function(t,e){var r=[],n=null==this.filter?0:this.filter.match(t);return n>=0&&(null!=this.draw&&null!=this.draw[e]&&r.push({match:n,depth:this.depth,layer:this.name,rule:this.draw[e]}),this.sublayers.forEach((function(n){n.matchRule(t,e).forEach((function(t){r.push(t)}))}))),r},t.getValue=function(t,e,r){for(var i=0,o=e;i<o.length;i++){var a=o[i].rule;if(a[r])return n.Draw.getValue(t,a[r])}return null},t.parser=function(e,r,a){if(null==r||"object"!=typeof r)return null;var s=new t(e,null==a?0:a.depth+1),u=i.Filter.parser(r.filter);if(null!=a&&(null!=a.filter&&(u=a.filter.intersect(u)),null==u))return console.warn("The filter for layer "+e+" is incorrect"),null;for(var h in s.filter=u,s.draw=n.Draw.parser(r.draw),r)if(!o.includes(h)){var f=t.parser(h,r[h],s);null!=f&&s.sublayers.push(f)}return s},t}();e.LayerStyle=a},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.Draw=e.PointRule=e.TextRule=e.PolygonRule=e.LineRule=void 0;var o=r(52),a=r(6);function s(t){if("string"==typeof t)return[[a.MapConstants.defaultMinZoom,o.Color.fromHex(t)]];var e=[];return(t||[]).forEach((function(t){var r=t||[];2==r.length&&"number"==typeof r[0]&&"string"==typeof r[1]&&e.push([r[0],o.Color.fromHex(r[1])])})),e.length>0?(e.sort((function(t,e){return t[0]-e[0]})),e):null}function u(t){if("number"==typeof t)return[[a.MapConstants.defaultMinZoom,t]];var e=[];return(t||[]).forEach((function(t){var r=t||[];2==r.length&&"number"==typeof r[0]&&"number"==typeof r[1]&&e.push([r[0],r[1]])})),e.length>0?(e.sort((function(t,e){return t[0]-e[0]})),e):null}var h=function(){function t(t,e){this.color=t,this.width=e}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color),n=u(e.width);return null!=r||null!=n?new t(r,n):null},t}(),f=function(t){function e(e,r,n,i){var o=t.call(this,e,r)||this;return o.pattern=n,o.outline=i,i&&(o.outline_color=i.color,o.outline_width=i.width),o}return i(e,t),e.parser=function(t){if(null==t||"object"!=typeof t)return null;var r=h.parser(t),n=h.parser(t.outline),i=t.pattern?[[a.MapConstants.defaultMinZoom,t.pattern]]:null;return null!=r?new e(r.color,r.width,i,n):null!=n||null!=i?new e(null,null,i,n):null},e}(h);e.LineRule=f;var l=function(){function t(t){this.color=t}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color);return null!=r?new t(r):null},t}();e.PolygonRule=l;var c=function(){function t(t,e,r){this.color=t,this.size=e,this.halo_color=r}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color),n=u(e.size),i=e.halo?s(e.halo.color):null;return null!=r||null!=n||null!=i?new t(r,n,i):null},t}();e.TextRule=c;var d=function(){function t(t,e,r,n,i){this.size=t,this.color=e,this.texture=r,this.icon_index=n,this.halo_color=i}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=u(e.size),n=s(e.color),i=e.texture?[[a.MapConstants.defaultMinZoom,e.texture]]:null,o=null!=e.iconIndex?[[a.MapConstants.defaultMinZoom,e.iconIndex]]:null,h=e.halo?s(e.halo.color):null;return null!=r||null!=n||null!=i||null!=o||null!=h?new t(r,n,i,o,h):null},t}();e.PointRule=d;var p=function(){function t(t,e,r,n){this.lines=t,this.polygons=e,this.text=r,this.points=n}return t.getValue=function(t,e){for(var r=null,n=0,i=e;n<i.length;n++){var o=i[n];if(o[0]>t)break;o[0]>0&&(r=o[1])}return r},t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=f.parser(e.lines),n=l.parser(e.polygons),i=c.parser(e.text),o=d.parser(e.points);return null==r&&null==n&&null==i&&null==o?null:new t(r,n,i,o)},t}();e.Draw=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Filter=void 0;var n=function(){function t(t,e){this.kind=t,this.kind_detail=e}return t.prototype.match=function(t){var e=0;if(this.kind){if(!this.kind.includes(t.kind))return-1;e++}if(this.kind_detail){if(!this.kind_detail.includes(t.kind_detail))return-1;e++}return e>0?e:-1},t.prototype.intersect=function(e){if(!e)return new t(this.kind,this.kind_detail);var r,n;if(this.kind&&e.kind){if(0==(r=this.kind.filter((function(t){return e.kind.includes(t)}))).length)return null}else r=this.kind?this.kind:e.kind;if(this.kind_detail&&e.kind_detail){if(0==(n=this.kind_detail.filter((function(t){return e.kind_detail.includes(t)}))).length)return null}else n=this.kind_detail?this.kind_detail:e.kind_detail;return new t(r,n)},t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=t.parserProperty(e,"kind");if(r&&0==r.length)return null;var n=t.parserProperty(e,"kind_detail");return n&&0==n.length?null:null!=r||null!=n?new t(r,n):null},t.parserProperty=function(t,e){var r=t[e];if(null==r)return null;if("string"==typeof r)return[r];var n=[];return(r||[]).forEach((function(t){"string"==typeof t&&(n.includes(t)||n.push(t))})),n},t}();e.Filter=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SourcesStyle=void 0;var n=r(140),i=r(141),o=function(){function t(){this.textures={},this.patterns={}}return t.parser=function(e,r,o,a){if(void 0===a&&(a=!1),!e)return null;var s=new t,u=e.textures;if(u)for(var h in u){var f=i.TextureStyle.parser(o,h,u[h],r,a);f&&(s.textures[h]=f)}var l=e.patterns;if(l)for(var h in l){var c=n.PatternStyle.parser(o,h,l[h],r,a);c&&(s.patterns[h]=c)}return s},t}();e.SourcesStyle=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PatternStyle=void 0;var n=r(16),i=function(){function t(){}return t.prototype.isDash=function(){return"dash"==this.type},t.prototype.isDot=function(){return"dot"==this.type},t.prototype.isIcon=function(){return"icon"==this.type},t.prototype.isSolid=function(){return"solid"==this.type},t.prototype.getPatternType=function(){switch(this.type){case"dash":return n.PatternType.Dash;case"dot":return n.PatternType.Dot;case"icon":return n.PatternType.Icon;default:return n.PatternType.Solid}},t.prototype.isValid=function(){switch(this.type){case"dash":return null!=this.length&&null!=this.gap;case"dot":return null!=this.repeat;case"icon":return null!=this.texture;case"solid":return!0;default:return!1}},t.parser=function(e,r,n,i,o){if(void 0===o&&(o=!1),!n)return null;var a=new t;return a.type=n.type,a.length=n.length,a.gap=n.gap,a.repeat=n.repeat,a.texture=n.texture,a.isValid()?a:null},t}();e.PatternStyle=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextureStyle=e.SpritesInfo=void 0;var n=r(15),i=r(24),o=r(6),a=function(t,e){this.width=t,this.height=e};e.SpritesInfo=a;var s=function(){function t(t,e){this.id=t,this.sprites=e}return t.prototype.isSprites=function(){return null!=this.sprites},t.prototype.getSpritesInfo=function(){return this.sprites},t.parser=function(e,r,s,u,h){if(void 0===h&&(h=!1),null==s)return null;var f=null,l=i.MathUtils.clamp(n.MapUtils.resourceScale,1,3)-1,c=s.sprites,d=null;if(c){var p=h?n.MapUtils.resourceScale:1,g=(c.width||o.MapConstants.placeWidth)*p,v=(c.height||o.MapConstants.placeHeight)*p;d=new a(g,v)}if(h){var y=s.url;if(null==y||"object"!=typeof y&&"string"!=typeof y)return console.warn("Texture "+r+" does not contains url"),null;var m=null;if("string"==typeof y)m=y;else{var _=y||[];if(0==_.length)return null;m=_[Math.min(l,_.length-1)]}f=this.isUrlRequest(m)?m:"!"+u+"_texture_"+r}else f=s.id;return new t(f,d)},t.isUrlRequest=function(t){return null!=t&&(t.startsWith("http")||t.startsWith("./")||t.startsWith("/")||t.startsWith("blob:"))},t}();e.TextureStyle=s},function(t,e,r){"use strict";function n(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var u=((t-r)*a+(e-n)*s)/(a*a+s*s);u>1?(r=i,n=o):u>0&&(r+=a*u,n+=s*u)}return(a=t-r)*a+(s=e-n)*s}function i(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)o(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)o(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)o(t,e[n][i])}(i),i}function o(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function a(t,e,r,n){if(e.geometry){var o=e.geometry.coordinates,f=e.geometry.type,l=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),c=[],d=e.id;if(r.promoteId?d=e.properties[r.promoteId]:r.generateId&&(d=n||0),"Point"===f)s(o,c);else if("MultiPoint"===f)for(var p=0;p<o.length;p++)s(o[p],c);else if("LineString"===f)u(o,c,l,!1);else if("MultiLineString"===f){if(r.lineMetrics){for(p=0;p<o.length;p++)c=[],u(o[p],c,l,!1),t.push(i(d,"LineString",c,e.properties));return}h(o,c,l,!1)}else if("Polygon"===f)h(o,c,l,!0);else{if("MultiPolygon"!==f){if("GeometryCollection"===f){for(p=0;p<e.geometry.geometries.length;p++)a(t,{id:d,geometry:e.geometry.geometries[p],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<o.length;p++){var g=[];h(o[p],g,l,!0),c.push(g)}}t.push(i(d,f,c,e.properties))}}function s(t,e){e.push(f(t[0])),e.push(l(t[1])),e.push(0)}function u(t,e,r,i){for(var o,a,s=0,u=0;u<t.length;u++){var h=f(t[u][0]),c=l(t[u][1]);e.push(h),e.push(c),e.push(0),u>0&&(s+=i?(o*c-h*a)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(c-a,2))),o=h,a=c}var d=e.length-3;e[2]=1,function t(e,r,i,o){for(var a,s=o,u=i-r>>1,h=i-r,f=e[r],l=e[r+1],c=e[i],d=e[i+1],p=r+3;p<i;p+=3){var g=n(e[p],e[p+1],f,l,c,d);if(g>s)a=p,s=g;else if(g===s){var v=Math.abs(p-u);v<h&&(a=p,h=v)}}s>o&&(a-r>3&&t(e,r,a,o),e[a+2]=s,i-a>3&&t(e,a,i,o))}(e,0,d,r),e[d+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function h(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];u(t[i],o,r,n),e.push(o)}}function f(t){return t/360+.5}function l(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function c(t,e,r,n,o,a,s,u){if(n/=e,a>=(r/=e)&&s<n)return t;if(s<r||a>=n)return null;for(var h=[],f=0;f<t.length;f++){var l=t[f],c=l.geometry,g=l.type,y=0===o?l.minX:l.minY,m=0===o?l.maxX:l.maxY;if(y>=r&&m<n)h.push(l);else if(!(m<r||y>=n)){var _=[];if("Point"===g||"MultiPoint"===g)d(c,_,r,n,o);else if("LineString"===g)p(c,_,r,n,o,!1,u.lineMetrics);else if("MultiLineString"===g)v(c,_,r,n,o,!1);else if("Polygon"===g)v(c,_,r,n,o,!0);else if("MultiPolygon"===g)for(var w=0;w<c.length;w++){var b=[];v(c[w],b,r,n,o,!0),b.length&&_.push(b)}if(_.length){if(u.lineMetrics&&"LineString"===g){for(w=0;w<_.length;w++)h.push(i(l.id,g,_[w],l.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===_.length?(g="LineString",_=_[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===_.length?"Point":"MultiPoint"),h.push(i(l.id,g,_,l.tags))}}}return h.length?h:null}function d(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function p(t,e,r,n,i,o,a){for(var s,u,h=g(t),f=0===i?m:_,l=t.start,c=0;c<t.length-3;c+=3){var d=t[c],p=t[c+1],v=t[c+2],w=t[c+3],b=t[c+4],x=0===i?d:p,E=0===i?w:b,k=!1;a&&(s=Math.sqrt(Math.pow(d-w,2)+Math.pow(p-b,2))),x<r?E>r&&(u=f(h,d,p,w,b,r),a&&(h.start=l+s*u)):x>n?E<n&&(u=f(h,d,p,w,b,n),a&&(h.start=l+s*u)):y(h,d,p,v),E<r&&x>=r&&(u=f(h,d,p,w,b,r),k=!0),E>n&&x<=n&&(u=f(h,d,p,w,b,n),k=!0),!o&&k&&(a&&(h.end=l+s*u),e.push(h),h=g(t)),a&&(l+=s)}var S=t.length-3;d=t[S],p=t[S+1],v=t[S+2],(x=0===i?d:p)>=r&&x<=n&&y(h,d,p,v),S=h.length-3,o&&S>=3&&(h[S]!==h[0]||h[S+1]!==h[1])&&y(h,h[0],h[1],h[2]),h.length&&e.push(h)}function g(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function v(t,e,r,n,i,o){for(var a=0;a<t.length;a++)p(t[a],e,r,n,i,o,!1)}function y(t,e,r,n){t.push(e),t.push(r),t.push(n)}function m(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function _(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function w(t,e){for(var r=[],n=0;n<t.length;n++){var o,a=t[n],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=b(a.geometry,e);else if("MultiLineString"===s||"Polygon"===s){o=[];for(var u=0;u<a.geometry.length;u++)o.push(b(a.geometry[u],e))}else if("MultiPolygon"===s)for(o=[],u=0;u<a.geometry.length;u++){for(var h=[],f=0;f<a.geometry[u].length;f++)h.push(b(a.geometry[u][f],e));o.push(h)}r.push(i(a.id,s,o,a.tags))}return r}function b(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function x(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],h=u.geometry,f=u.type;if(u.geometry=[],1===f)for(n=0;n<h.length;n+=2)u.geometry.push(E(h[n],h[n+1],e,o,a,s));else for(n=0;n<h.length;n++){var l=[];for(i=0;i<h[n].length;i+=2)l.push(E(h[n][i],h[n][i+1],e,o,a,s));u.geometry.push(l)}}return t.transformed=!0,t}function E(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function k(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,S(a,t[s],o,i);var u=t[s].minX,h=t[s].minY,f=t[s].maxX,l=t[s].maxY;u<a.minX&&(a.minX=u),h<a.minY&&(a.minY=h),f>a.maxX&&(a.maxX=f),l>a.maxY&&(a.maxY=l)}return a}function S(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)T(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)T(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var h=i[u];for(s=0;s<h.length;s++)T(a,h[s],t,r,!0,0===s)}if(a.length){var f=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var l in f={},e.tags)f[l]=e.tags[l];f.mapbox_clip_start=i.start/i.size,f.mapbox_clip_end=i.end/i.size}var c={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:f};null!==e.id&&(c.id=e.id),t.features.push(c)}}function T(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===n||e[u+2]>a)&&(r.numSimplified++,s.push(e[u]),s.push(e[u+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function P(t,e){return new A(t,e)}function A(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)a(r,t.features[n],e,n);else"Feature"===t.type?a(r,t,e):a(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=c(t,1,-1-r,r,0,-1,2,e),o=c(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=c(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=w(i,1).concat(n)),o&&(n=n.concat(w(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function L(t,e,r){return 32*((1<<t)*r+e)+t}r.r(e),r.d(e,"default",(function(){return P})),A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],u=this.options,h=u.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var f=1<<e,l=L(e,r,n),d=this.tiles[l];if(!d&&(h>1&&console.time("creation"),d=this.tiles[l]=k(t,e,r,n,u),this.tileCoords.push({z:e,x:r,y:n}),h)){h>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,i){if(e===u.maxZoom||e===i)continue;var g=1<<i-e;if(r!==Math.floor(o/g)||n!==Math.floor(a/g))continue}else if(e===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==t.length){h>1&&console.time("clipping");var v,y,m,_,w,b,x=.5*u.buffer/u.extent,E=.5-x,S=.5+x,T=1+x;v=y=m=_=null,w=c(t,f,r-x,r+S,0,d.minX,d.maxX,u),b=c(t,f,r+E,r+T,0,d.minX,d.maxX,u),t=null,w&&(v=c(w,f,n-x,n+S,1,d.minY,d.maxY,u),y=c(w,f,n+E,n+T,1,d.minY,d.maxY,u),w=null),b&&(m=c(b,f,n-x,n+S,1,d.minY,d.maxY,u),_=c(b,f,n+E,n+T,1,d.minY,d.maxY,u),b=null),h>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*r,2*n),s.push(y||[],e+1,2*r,2*n+1),s.push(m||[],e+1,2*r+1,2*n),s.push(_||[],e+1,2*r+1,2*n+1)}}},A.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=L(t,e=(e%a+a)%a,r);if(this.tiles[s])return x(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var u,h=t,f=e,l=r;!u&&h>0;)h--,f=Math.floor(f/2),l=Math.floor(l/2),u=this.tiles[L(h,f,l)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",h,f,l),o>1&&console.time("drilling down"),this.splitTile(u.source,h,f,l,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?x(this.tiles[s],i):null):null}}]);\r\n//# sourceMappingURL=worker.js.map'},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(29),n=r(0),o=r(160),a=function(){function t(t,e){this.mapState=e,this.gl=t,this.layerRenderers=i(n.compareLayerId)}return t.prototype.render=function(){this.mapState.is3dMode()&&this.effectManager.enableShadowEffect&&this.layerRenderers.forEach((function(t,e){e.renderShadowMapping()})),this.layerRenderers.forEach((function(t,e){e.render()}))},t.prototype.renderSelection=function(){this.layerRenderers.forEach((function(t,e){e.renderSelection()}))},t.prototype.addLayer=function(t){this.layerRenderers=this.layerRenderers.insert(new n.LayerId(t.getLayerId(),t.getOrder()),o.LayerRenderFactory.create(this.gl,this.mapState,t))},t.prototype.setEffectManager=function(t){this.effectManager=t},t.prototype.removeLayer=function(t,e){var r=new n.LayerId(t,e);this.layerRenderers=this.layerRenderers.remove(r)},t}();e.MapRenderer=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(161),o=r(163),a=r(164),s=r(165),l=r(68),u=r(166),h=r(69),c=r(167),p=r(168),f=r(169),d=r(170),g=r(171),y=r(172),m=r(173),v=r(174),_=r(175),b=r(176),w=r(177),x=r(178),M=function(){function t(){}return t.create=function(t,e,r){switch(r.getLayerType()){case i.LayerType.SURFACE:return new m.SurfaceLayerRenderer(e,r);case i.LayerType.BOUNDARY:return new v.BoundaryLayerRenderer(e,r);case i.LayerType.ROADS:return new _.RoadLayerRenderer(e,r);case i.LayerType.LABEL:return new b.LabelLayerRenderer(e,r);case i.LayerType.RASTER:return new n.RasterLayerRenderer(e,r);case i.LayerType.RASTER_OVERLAY:return new d.RasterOverlayRenderer(e,r);case i.LayerType.SKY:return new x.SkyLayerRenderer(e,r);case i.LayerType.BUILDING:return new l.BuildingLayerRenderer(t,e,r);case i.LayerType.LINE:return new o.LineLayerRenderer(e,r);case i.LayerType.FILL:return new a.FillLayerRenderer(e,r);case i.LayerType.CIRCLE:return new s.CircleLayerRenderer(e,r);case i.LayerType.SYMBOL:return new u.SymbolLayerRenderer(e,r);case i.LayerType.POI:return new h.POILayerRenderer(e,r);case i.LayerType.POI_OVERLAY:return new g.POIOverlayRenderer(e,r);case i.LayerType.USERPOI:return new p.UserPOILayerRenderer(e,r);case i.LayerType.USERBUILDING:return new f.UserBuildingLayerRenderer(t,e,r);case i.LayerType.BUILDING_OVERLAY:return new y.BuildingOverlayRender(t,e,r);case i.LayerType.GEOJSON:return new c.GeoJsonLayerRenderer(e,r);case i.LayerType.IMAGE_OVERLAY:return new w.ImageOverlayRenderer(e,r);default:console.error("Invalid layer type")}},t}();e.LayerRenderFactory=M},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(10),a=r(14),s=r(2),l=r(9),u=r(8),h=r(6),c=r(3),p=r(18),f=r(35),d=r(20),g=r(24),y=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.time=0,i.mvpMatrix=new l.Matrix4,i.modelMatrix=new l.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this,e=this.layer.mapView.gl,r=o.ResourceManager.getInstance(e),i=this.mapState.is3dMode()&&this.mapState.getTilt()>s.MapConstants.maxTiltIntersectWithScreen,n=r.getModel(o.ModelEnum.RASTER_MODEL),a=null,l=this.layer,y=l.effectManager,m=this.mapState.is3dMode()&&y.enableShadowEffect,v=this.mapState.getViewProjectionMatrix();if(n.bind(),i){(a=m?r.getShader(o.ShaderEnum.RASTER_3D_WITH_SHADOW_SHADER):r.getShader(o.ShaderEnum.RASTER_FOG_SHADER)).bind(),a.setAttributes(n.attributeInfos);var _=s.MapConstants.defaultMaxNativeZoom,b=l.timeEffectManager.getFogColor(),w=6*Math.max(this.mapState.getZoom()-_,0),x=l.lightManager.sunLight;e.uniform3fv(a.lightColorUniform,x.lightColor.rgbBuffer()),e.uniform3f(a.lightPositionUniform,x.lightPosition.x,x.lightPosition.y,x.lightPosition.z),e.uniform1f(a.fogStartUniform,22+w),e.uniform1f(a.fogRangeUniform,10+w),e.uniform3fv(a.fogColorUniform,b.rgbBuffer())}else(a=m?r.getShader(o.ShaderEnum.RASTER_WITH_SHADOW_SHADER):r.getShader(o.ShaderEnum.RASTER_SHADER)).bind(),a.setAttributes(n.attributeInfos);if(this.mapState.is3dMode()&&this.mapState.getTilt()>s.MapConstants.maxTiltIntersectWithScreen){var M=r.getTexture(o.TextureEnum.WHITE_TEXTURE);M.loadColor(s.MapConstants.mapBackgroundColor3D);var T=new d.CameraPosition(this.mapState.cameraPosition.target,this.mapState.cameraPosition.tilt,0,this.mapState.cameraPosition.zoom),A=this.mapState.getScreenSize(),L=g.CameraUtils.calculateViewProjectionMatrix(T,A.x,A.y),S=h.ProjectionMercator.projectScale(this.mapState.getTarget(),this.mapState.scale),E=u.GeometryUtils.pixelCoordinateToCameraCoordinate(new c.Vector2(S.x,S.y),this.mapState.cameraPosition);this.mvpMatrix.setIdentity(),this.mvpMatrix.translate(E.x,E.y,0),this.mvpMatrix.scale(s.MapConstants.mapBackgroundScaleRatio,s.MapConstants.mapBackgroundScaleRatio,1),this.mvpMatrix.concat(L),a.setTexture(a.textureUniform,M.textureId),e.uniformMatrix4fv(a.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),n.render(e.TRIANGLES),a.resetTextureUnit()}var P=r.getTexture(o.TextureEnum.WATER_DISPLACEMENT),C=r.getTexture(o.TextureEnum.WATER_COLOR),I=l.effectManager.enableWaterEffect&&this.mapState.is3dMode()?1:0,O=l.lightManager.sunLight;this.time+=8e-4,e.uniform3fv(a.lightColorUniform,O.lightColor.rgbBuffer()),e.uniform3f(a.lightPositionUniform,O.lightPosition.x,O.lightPosition.y,O.lightPosition.z),e.uniform1f(a.timeUniform,this.time),e.uniform1f(a.opacityUniform,1),e.uniform1i(a.enableWaterUniform,I);var R=this.getRenderTiles();R.forEach((function(r){var i=r.getTile();if(i.getKind()==p.Kind.BASEMAP){var o=i.getTileRenderData().getLayerRenderData(s.LayerConstants.rasterTileLayerId);if(o){var l=o.getTexture();if(null!=l){if(t.mapState.matrixFor(t.modelMatrix,r.getUnwrappedTileCoordinate()),m){var u=y.shadowMap,h=t.mvpMatrix.copy(t.modelMatrix);t.mvpMatrix.concat(u.getLightViewProjectionMatrix()).concat(s.MapConstants.biasMatrix),a.setTexture(a.shadowMapUniform,u.getShadowMapTexture().textureId),e.uniformMatrix4fv(a.shadowMvpMatrixUniform,!1,h.buffer())}t.mvpMatrix.copy(t.modelMatrix),t.mvpMatrix.concat(v),a.setTexture(a.waterDisplacementUniform,P.textureId),a.setTexture(a.waterColorUniform,C.textureId),a.setTexture(a.textureUniform,l.textureId),e.uniformMatrix4fv(a.mvpMatrixUniform,!1,t.mvpMatrix.buffer()),n.render(e.TRIANGLES),a.resetTextureUnit()}}}else console.log("Tile is not base map")})),f.Env.isTileDebug&&((a=r.getShader(o.ShaderEnum.TILE_DEBUG_SHADER)).bind(),a.setAttributes(n.attributeInfos),R.forEach((function(r){r.getTile().getKind()==p.Kind.BASEMAP?(t.mapState.matrixFor(t.modelMatrix,r.getUnwrappedTileCoordinate()),t.mvpMatrix.copy(t.modelMatrix),t.mvpMatrix.concat(v),e.uniformMatrix4fv(a.mvpMatrixUniform,!1,t.mvpMatrix.buffer()),n.render(e.LINE_STRIP)):console.log("Tile is not base map")}))),n.unbind(),a.disableAttributes()},e}(a.LayerRenderer);e.RasterLayerRenderer=y},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.lightEffect="\n    vec4 calculateLightEffect(vec3 normal, vec3 light, vec3 camera, vec3 light_color, vec4 material_color) {\n        vec4 ambient_color = vec4(0.03, 0.03, 0.03, 0);\n        material_color += ambient_color;\n        \n        float light_intensity = 1.0;\n        vec3 diffuse = vec3(1.0, 1.0, 1.0);\n        float diffuseCoefficient1 = max(0.0, dot(normal, light));\n        diffuseCoefficient1 = diffuseCoefficient1 * light_intensity;\n        diffuseCoefficient1 = clamp(diffuseCoefficient1, 0.0, 1.0);\n\n        float diffuseCoefficient2 = max(0.0, dot(normal, camera));\n        diffuseCoefficient2 = clamp(diffuseCoefficient2, 0.0, 1.0);\n        \n        vec4 finalColor = vec4(mix(material_color.rgb, diffuseCoefficient1 * light_color, diffuseCoefficient1 * 0.35), material_color.a);\n        finalColor = vec4(mix(finalColor.rgb, diffuseCoefficient2 * material_color.rgb, diffuseCoefficient2 * 0.35), finalColor.a);   \n        \n        return finalColor;\n    }\n  ",t.waterFragment="\n    vec4 calculateWaterColor(vec4 tileColor, sampler2D waterDispl, sampler2D waterColor, vec2 uv, float time) {\n      float eps = 0.01;\n      if (abs(tileColor.x - 0.639) < eps && abs(tileColor.y - 0.8) < eps && abs(tileColor.z - 1.0) < eps) {\n        vec2 displacement = texture2D( waterDispl, 4.0 * vec2(uv.x, uv.y + time )).rg;\n        vec2 offset = (displacement * 2.0 - 1.0) * 0.2;\n        vec4 color = texture2D(waterColor, uv * 2.0 + offset);\n        return color;\n      } else {\n        return tileColor;\n      } \n    }\n  ",t.basicVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n  v_uv = a_uv;\n}\n   ",t.basicFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nuniform sampler2D u_waterDisplacement;\nuniform sampler2D u_waterColor;\nuniform float u_time;\nuniform float u_opacity;\nuniform int u_enableWater;\n \nvec4 calculateWaterColor(vec4 tileColor, sampler2D waterDispl, sampler2D waterColor, vec2 uv, float time);\n\nvoid main() {\n    vec4 tileColor = texture2D(u_texture, v_uv);     \n  \n    vec4 vertexColor = u_enableWater == 0 ? tileColor: calculateWaterColor(tileColor, u_waterDisplacement, u_waterColor, v_uv, u_time);\n    gl_FragColor = vec4(vertexColor.rgb, vertexColor.a * u_opacity);\n}  \n  "+t.waterFragment,t.rasterFogVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n  v_uv = a_uv;\n}\n   ",t.rasterFogFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform vec3 u_light_color;\nuniform vec3 u_light_position;\nuniform float u_fogStart;\nuniform float u_fogRange;\nuniform vec3 u_fogColor;\n\nvarying vec2 v_uv;\n\nuniform sampler2D u_waterDisplacement;\nuniform sampler2D u_waterColor;\nuniform float u_time;\nuniform float u_opacity;\nuniform int u_enableWater;\n \nvec4 calculateWaterColor(vec4 tileColor, sampler2D waterDispl, sampler2D waterColor, vec2 uv, float time);\n\nvoid main() {\n    float light_intensity = 1.0;\n    \n    // initialize\n    vec3 diffuse = vec3(1.0, 1.0, 1.0);\n    vec3 v_normal = vec3(0.0, 0.0, 1.0);\n    vec4 tileColor = texture2D(u_texture, v_uv); \n    \n    // diffuse\n    float diffuseCoefficient = max(0.0, dot(normalize(v_normal), normalize(u_light_position)));\n    diffuseCoefficient = mix((1.0 - light_intensity), max((0.5 + light_intensity), 1.0), diffuseCoefficient);\n    diffuse = clamp(diffuseCoefficient * u_light_color, mix(vec3(0.0), vec3(0.3), 1.0 - u_light_color), vec3(1.0));\n    vec4 vertexLightColor = vec4(mix(tileColor.rgb, diffuseCoefficient * diffuse, 0.3), tileColor.a);\n    \n    vec4 vertexColor = u_enableWater == 0 ? tileColor: calculateWaterColor(tileColor, u_waterDisplacement, u_waterColor, v_uv, u_time);\n    vertexColor = vec4(mix(vertexColor.rgb, vertexLightColor.rgb, 0.2), vertexColor.a);\n    \n    // fog\n    float dist = (gl_FragCoord.z / gl_FragCoord.w);\n    float visibility = (dist - u_fogStart) / u_fogRange;\n    visibility = clamp(visibility, 0.0, 1.0);\n    gl_FragColor = vec4(mix(vertexColor.rgb, u_fogColor, visibility), vertexColor.a * u_opacity);\n} \n  "+t.waterFragment,t.polylineVS="\nattribute vec2 a_position;\nattribute vec2 a_extrude;\nattribute vec2 a_uv;\n\nuniform float u_lineWidth;\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  vec2 delta = (u_lineWidth / 2.0) * a_extrude;\n  v_uv = a_uv;\n  gl_Position = u_mvpMatrix * vec4(a_position + delta, 0.0, 1.0);\n}\n  ",t.polylineFS="\nprecision mediump float;\n\nuniform vec4 u_color;\nuniform float u_textureScale;\nuniform bool u_useStrokePattern;\nuniform bool u_useIcon;\nuniform sampler2D u_texture;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  if (u_useStrokePattern) {\n    vec2 line_st = vec2(v_uv.x * u_textureScale, v_uv.y);\n    vec4 line_color = texture2D(u_texture, line_st);\n    if (u_useIcon) {\n      gl_FragColor = line_color;\n    }\n    else {\n      gl_FragColor = vec4(u_color.rgb, line_color.a * u_color.a);\n    }\n  }\n  else {\n    gl_FragColor = u_color;\n  }\n}\n  ",t.fillVS="\nattribute vec2 a_position;\n\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 0.0, 1.0);\n}\n  ",t.fillFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n  ",t.geoJsonVS="\nattribute vec2 a_position;\nattribute vec2 a_extrude;\n\nuniform float u_lineWidth;\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n  vec2 delta = (u_lineWidth / 2.0) * a_extrude;\n  gl_Position = u_mvpMatrix * vec4(a_position + delta, 0.0, 1.0); \n}\n  ",t.geoJsonFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n  ",t.circleVS="\n  precision highp float;\nattribute vec2 a_extrude;\n\nuniform float u_radius;\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_extrude;\n\nvoid main() {\n    vec2 circleExtrude = u_radius * a_extrude;\n    gl_Position = u_mvpMatrix * vec4(circleExtrude, 0, 1);\n    v_extrude = circleExtrude;        \n}\n  ",t.circleFS="\nprecision highp float;\n\nuniform vec4 u_color;\nuniform mat4 u_mvpMatrix;\nuniform float u_strokeWidth;\nuniform vec4 u_strokeColor;\nuniform float u_outerRadius;\nuniform float u_innerRadius;\n\nvarying vec2 v_extrude;\n\nvoid main() {      \n \n    float dist = length(v_extrude);\n    if (dist - u_outerRadius >= 0.0) {\n      discard;\n    }            \n    if (dist - u_innerRadius >= 0.0){\n      gl_FragColor = u_strokeColor;\n    }\n    else {\n      gl_FragColor = u_color;\n    }\n}\n  ",t.markerVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n  v_uv = a_uv;\n}\n  ",t.markerFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform vec4 u_color;\nuniform vec4 u_spriteInfo;\nuniform vec2 u_padding;\nuniform int u_useMaskTexture;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  if (u_useMaskTexture > 0) {\n    float spriteWidth = u_spriteInfo.x;\n    float spriteHeight = u_spriteInfo.y;\n    float col = u_spriteInfo.z;\n    float row = u_spriteInfo.w;\n\n    vec2 mask_uv = vec2(spriteWidth * v_uv.x, 1.0 - spriteHeight * (1.0 - v_uv.y));\n    vec4 mask = texture2D(u_texture, mask_uv);\n\n    if (u_useMaskTexture == 1) {\n      vec2 icon_uv = vec2(spriteWidth * (col + v_uv.x) + u_padding.x * col, 1.0 - spriteHeight * (row + 1.0 - v_uv.y) - u_padding.y * row);\n      vec4 icon = texture2D(u_texture, icon_uv);\n\n      // gl_FragColor = vec4(mix(u_color.xyz, icon.xyz, icon.a), mask.g);\n      // gl_FragColor = u_color * mask.r + icon * icon.a;\n      gl_FragColor = vec4(mix(u_color.xyz * mask.r, icon.xyz, icon.a), mask.r);\n    }\n    else {\n      gl_FragColor = u_color * mask.r;\n    }\n  }\n  else {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n}\n  ",t.buildingVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\nattribute vec3 a_normal;\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_mvpMatrix;\n\nvarying vec2 v_uv;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nvoid main() {\n    gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n    v_uv = a_uv;\n    // Convert normal vector to world space (make sure that we don't translate it)\n    v_normal = normalize(vec3((u_modelMatrix * vec4(a_normal, 0.0)).xyz));\n    v_position = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n}\n  ",t.buildingFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform vec3 u_light_color;\nuniform vec3 u_light_position;\nuniform float u_fogStart;\nuniform float u_fogRange;\nuniform vec3 u_fogColor;\nuniform vec3 u_camera_direction;\n\nvarying vec2 v_uv;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nvec4 calculateLightEffect(vec3 normal, vec3 light, vec3 camera, vec3 light_color, vec4 material_color);\n\nvoid main() {\n    vec4 material_color = texture2D(u_texture, v_uv);\n    vec4 vertexColor = calculateLightEffect(normalize(v_normal), normalize(u_light_position), normalize(u_camera_direction), u_light_color, material_color);\n    \n    float distance = distance(v_position, vec3(0));\n    // fog\n    float visibility = (distance - u_fogStart) / u_fogRange;\n    visibility = clamp(visibility, 0.0, 1.0);\n    gl_FragColor = vec4(mix(vertexColor.rgb, u_fogColor, visibility), vertexColor.a);\n    \n    if (gl_FragColor.a < 0.3 || visibility >= 0.5) {\n      discard;\n    }\n}\n  "+t.lightEffect,t.buildingSelectionVS="\nattribute vec3 a_position;\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n    gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n}\n  ",t.buildingSelectionFS="\nprecision mediump float;\nuniform vec3 u_color;\n\nvoid main() {\n    gl_FragColor = vec4(u_color, 1.0);\n}\n  ",t.debugSelectionVS="\n    attribute vec3 a_position;\n    attribute vec2 a_uv;\n    \n    varying vec2 v_uv;\n    \n    void main() {\n      gl_Position = vec4(a_position, 1.0);\n      v_uv = a_uv;\n    }\n  ",t.debugSelectionFS="\n    precision mediump float;\n    \n    uniform sampler2D u_texture;\n    varying vec2 v_uv;\n    \n    void main() {\n        gl_FragColor = texture2D(u_texture, vec2(v_uv.x , 1.0 - v_uv.y));\n    }\n\n  ",t.skyVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\nuniform mat4 u_mvpMatrix;\n\nvarying vec3 v_position;\n\nvoid main() { \n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n  gl_Position.z = gl_Position.w - 0.000001;  \n  v_position = gl_Position.xyz;\n}\n  ",t.skyFS="\nprecision mediump float;\nuniform float u_lowerLimit;\nuniform float u_upperLimit;\n\nuniform vec3 u_skyColor;\nuniform vec3 u_fogColor;\n\nvarying vec3 v_position;\n\nvoid main() {\n  float factor = (v_position.y - u_lowerLimit) / (u_upperLimit - u_lowerLimit);       \n  factor = clamp(factor, 0.05, 1.0);  \n  if (v_position.y > u_lowerLimit) {\n    gl_FragColor = vec4(mix(u_fogColor.rgb, u_skyColor.rgb, factor), 1.0);\n  } else {\n    discard;\n  }      \n}\n  ",t.shadowMappingVS="\n    attribute vec3 a_position;\n\n    uniform mat4 u_shadowMvpMatrix;\n    \n    varying vec4 v_position;\n\n    void main() {\n      gl_Position = u_shadowMvpMatrix * vec4(a_position, 1.0);\n      v_position = gl_Position;\n    }\n   ",t.shadowMappingFS="\n    precision mediump float;\n    \n    varying vec4 v_position;\n    \n    vec4 pack(float depth) {\n        depth *= (256.0 * 256.0 * 256.0 - 1.0) / (256.0 * 256.0 * 256.0);\n        vec4 encode = fract(depth * vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0) );\n        return vec4(encode.xyz - encode.yzw / 256.0, encode.w ) + 1.0 / 512.0;\n    }\n\n    void main() {\n      float depth = v_position.z / v_position.w;\n      depth = (depth + 1.0) / 2.0;\n      gl_FragColor = pack(depth);\n    }  \n  ",t.shadowFS="\n  \n    float unpack(vec4 pack) {\n      float depth = dot(pack, 1.0 / vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0));\n      return depth * (256.0 * 256.0 * 256.0) / (256.0 * 256.0 * 256.0 - 1.0);\n    }\n  \n    float calculateShadowFactor(sampler2D shadowMap, vec4 shadowCoord, float bias) {\n      float shadowFactor = 1.0;\n      vec4 shadowMapPosition = shadowCoord / shadowCoord.w;\n      bool inShadowArea = (shadowMapPosition.x >= 0.0 && shadowMapPosition.x <= 1.0) && \n      (shadowMapPosition.y >= 0.0 && shadowMapPosition.y <= 1.0) && \n      (shadowMapPosition.z >= 0.0 && shadowMapPosition.z <= 1.0);\n      if (inShadowArea) {\n        float distanceFromLight = unpack(texture2D(shadowMap, shadowMapPosition.xy));\t\n        if (distanceFromLight  + bias < shadowMapPosition.z  ) {\n          shadowFactor = 0.7;   \n        }\n      }\n      return shadowFactor;\n    }\n    \n  ",t.raster3DWithShadowVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\nuniform mat4 u_shadowMvpMatrix;\n\nvarying vec2 v_uv;\nvarying vec4 v_shadowCoord;\nvarying vec3 v_position;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n  v_uv = a_uv;\n  // Calculate shadow coordinate\n  v_shadowCoord = u_shadowMvpMatrix * vec4(a_position, 1.0);\n}\n   ",t.raster3DWithShadowFS="\nprecision mediump float;\n\nuniform sampler2D u_texture;\n// The shadow map\nuniform sampler2D u_shadowMap;\nuniform float u_fogStart;\nuniform float u_fogRange;\nuniform vec3 u_fogColor;\nuniform vec3 u_light_color;\nuniform vec3 u_light_position;\n\nuniform sampler2D u_waterDisplacement;\nuniform sampler2D u_waterColor;\nuniform float u_time;\nuniform float u_opacity;\nuniform int u_enableWater;\n    \nvarying vec2 v_uv;\nvarying vec4 v_shadowCoord;\nvarying vec3 v_position;\n    \nfloat calculateShadowFactor(sampler2D shadowMap, vec4 shadowCoord, float bias);\nvec4 calculateWaterColor(vec4 tileColor, sampler2D waterDispl, sampler2D waterColor, vec2 uv, float time);\n\nvoid main() {\n    float light_intensity = 1.0;\n\n    // initialize\n    vec3 diffuse = vec3(1.0, 1.0, 1.0);\n    vec3 v_normal = vec3(0.0, 0.0, 1.0);\n    vec4 tileColor = texture2D(u_texture, v_uv);\n    \n    // diffuse\n    float diffuseCoefficient = max(0.0, dot(normalize(v_normal), normalize(u_light_position)));\n    diffuseCoefficient = mix((1.0 - light_intensity), max((0.5 + light_intensity), 1.0), diffuseCoefficient);\n    diffuse = clamp(diffuseCoefficient * u_light_color, mix(vec3(0.0), vec3(0.3), 1.0 - u_light_color), vec3(1.0));\n    vec4 vertexLightColor = vec4(mix(tileColor.rgb, diffuseCoefficient * diffuse, 0.3), tileColor.a);\n    \n    vec4 vertexColor = u_enableWater == 0 ? tileColor: calculateWaterColor(tileColor, u_waterDisplacement, u_waterColor, v_uv, u_time);\n    vertexColor = vec4(mix(vertexColor.rgb, vertexLightColor.rgb, 0.2), vertexColor.a);\n    \n    // fog\n    float dist = (gl_FragCoord.z / gl_FragCoord.w);\n    float visibility = (dist - u_fogStart) / u_fogRange;\n    visibility = clamp(visibility, 0.0, 1.0);\n    float shadowFactor = calculateShadowFactor(u_shadowMap, v_shadowCoord, 0.0005);\n    vec3 vertexWithFogColor = mix(vertexColor.rgb, u_fogColor.rgb, visibility);\n    gl_FragColor = vec4(mix(vec3(0.4, 0.4, 0.4), vertexWithFogColor, shadowFactor), vertexColor.a * u_opacity);\n} \n  "+t.waterFragment,t.rasterWithShadowVS="\n    attribute vec3 a_position;\n    attribute vec2 a_uv;\n\n    uniform mat4 u_mvpMatrix;\n    uniform mat4 u_shadowMvpMatrix;\n\n    varying vec2 v_uv;\n    varying vec4 v_shadowCoord;\n\n    void main() {\n      gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n      v_uv = a_uv;\n      // Calculate shadow coordinate\n      v_shadowCoord = u_shadowMvpMatrix * vec4(a_position, 1.0);\n    }\n   ",t.rasterWithShadowFS="\n    precision mediump float;\n    \n    // The texture\n    uniform sampler2D u_texture;\n    // The shadow map\n    uniform sampler2D u_shadowMap;\n    \n    uniform sampler2D u_waterDisplacement;\n    uniform sampler2D u_waterColor;\n    uniform float u_time;\n    uniform float u_opacity;\n    uniform int u_enableWater;\n \n    varying vec2 v_uv;\n    varying vec4 v_shadowCoord;\n    \n    float calculateShadowFactor(sampler2D shadowMap, vec4 shadowCoord, float bias);\n    vec4 calculateWaterColor(vec4 tileColor, sampler2D waterDispl, sampler2D waterColor, vec2 uv, float time);\n    \n    void main() {\n      vec4 tileColor = texture2D(u_texture, v_uv);\n      vec4 rasterColor = u_enableWater == 0 ? tileColor: calculateWaterColor(tileColor, u_waterDisplacement, u_waterColor, v_uv, u_time);\n      float shadowFactor = calculateShadowFactor(u_shadowMap, v_shadowCoord, 0.0005);\n      gl_FragColor = vec4(mix(vec3(0.4, 0.4, 0.4), rasterColor.rgb, shadowFactor), rasterColor.a * u_opacity);\n    }\n  "+t.waterFragment,t.buildingWithShadowVS="\n    attribute vec3 a_position;\n    attribute vec2 a_uv;\n    attribute vec3 a_normal;\n\n    uniform mat4 u_modelMatrix;\n    uniform mat4 u_mvpMatrix;\n    uniform mat4 u_shadowMvpMatrix;\n\n    varying vec2 v_uv;\n    varying vec4 v_shadowCoord;\n    varying vec3 v_normal;\n    varying vec3 v_position;\n    \n    void main() { \n      gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n      v_uv = a_uv;\n      // Convert normal vector to world space (make sure that we don't translate it)\n      vec3 normal = normalize(vec3((u_modelMatrix * vec4(a_normal, 0.0)).xyz));\n      v_position = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n      v_normal = normal;\n      \n      // Calculate shadow coordinate\n      v_shadowCoord = u_shadowMvpMatrix * vec4(a_position, 1.0); \n    }\n  ",t.buildingWithShadowFS="\n    precision mediump float;\n\n    uniform sampler2D u_texture;\n    uniform sampler2D u_shadowMap;   \n    uniform float u_fogStart;\n    uniform float u_fogRange;\n    uniform vec3 u_fogColor;\n    uniform vec3 u_light_color;\n    uniform vec3 u_light_position;\n    uniform vec3 u_camera_direction;\n    \n    varying vec2 v_uv;\n    varying vec4 v_shadowCoord;\n    varying vec3 v_normal;\n    varying vec3 v_position;\n    \n    float calculateShadowFactor(sampler2D shadowMap, vec4 shadowCoord, float bias);\n\n    float calculateBias() {\n      float bias;\n      vec3 n = normalize(v_normal); \n      vec3 l = normalize(u_light_position);\n      float cosTheta = clamp( dot( n,l ), 0.0, 1.0 );\n      bias = 0.0001 * tan(acos(cosTheta));\n      bias = clamp(bias, 0.0, 0.01);\n      return bias;\n    }\n    \n    vec4 calculateLightEffect(vec3 normal, vec3 light, vec3 camera, vec3 light_color, vec4 material_color);\n    \n    void main() {\n      vec4 material_color = texture2D(u_texture, v_uv);\n      float bias = calculateBias();\n      float shadowFactor = 1.0;\n      if (bias >= 0.01) {\n        shadowFactor = 0.7;\n      }\n      else {\n        shadowFactor = calculateShadowFactor(u_shadowMap, v_shadowCoord, bias);\n      }\n      \n      vec4 vertexColor = calculateLightEffect(normalize(v_normal), normalize(u_light_position), normalize(u_camera_direction), u_light_color, material_color);\n      \n      // fog\n      float distance = distance(v_position, vec3(0));\n      float visibility = (distance - u_fogStart) / u_fogRange;\n      visibility = clamp(visibility, 0.0, 1.0);\n      vec3 vertexWithFogColor = mix(vertexColor.rgb, u_fogColor.rgb, visibility);\n      \n      gl_FragColor = vec4(mix(vec3(0.4, 0.4, 0.4), vertexWithFogColor, shadowFactor), material_color.a);\n      \n      if (gl_FragColor.a < 0.3 || visibility >= 0.5) {\n        discard;\n      }\n    }\n  "+t.lightEffect,t.buildingOutliningFS="\nprecision mediump float;\n\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n  ",t.textLabelVS="\nattribute vec2 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\nuniform vec2 u_texsize;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 0.0, 1.0);\n  v_uv = a_uv / u_texsize;\n}\n   ",t.textLabelFS="\n#define SDF_PX 8.0\nprecision mediump float;\n\nuniform sampler2D u_texture;\nuniform float u_pixel_scale;\nuniform vec4 u_color;\nuniform float u_gamma_scale;\nuniform bool u_is_halo;\nuniform float u_text_size;\n\nvarying vec2 v_uv;\n\nvoid main() {\n     lowp float dist = texture2D(u_texture, v_uv).r;\n     float font_scale = u_text_size / 24.0;\n     lowp float buff = (256.0 - 64.0) / 256.0;\n     highp float edge_gamma = 0.105;\n     highp float gamma = edge_gamma / font_scale;\n     if (u_is_halo) {\n       // Reduce halo width base on pixel scale (reduce ratio: 1x -> 0.25, 2x -> 0.5, 3x -> 0.75 ...)\n       float haloWidthDecreaseRatio = 1.0 - (u_pixel_scale * 0.2);\n       \n       // float halo_width = u_pixel_scale * font_scale;\n       // replace u_pixel_scale by 2.75 to increase halo width on 1x screen same as on 2.75x, if not halo on 1x screen very slim.\n       float halo_width = (2.75 * font_scale) * haloWidthDecreaseRatio;\n       float halo_blur = 0.01;\n       gamma = (halo_blur * 1.19 / SDF_PX + edge_gamma) / (font_scale * u_gamma_scale);\n       buff = (6.0 - halo_width / font_scale) / SDF_PX;\n     }\n     highp float alpha = smoothstep(buff - gamma, buff + gamma, dist);\n     gl_FragColor = vec4(u_color.rgb, alpha * u_color.a);\n}  \n  ",t.tileDebugVS="\nattribute vec3 a_position;\nattribute vec2 a_uv;\n\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n}\n   ",t.tileDebugFS="\nprecision mediump float;  \n\nvoid main() {\n    gl_FragColor = vec4(0.1, 0.2, 0.3, 1.0);\n}\n  ",t.collisionDebugVS="\nprecision mediump float;\n\nattribute vec2 a_position;\n\nuniform mat4 u_mvpMatrix;\n\nvoid main() {\n  gl_Position = u_mvpMatrix * vec4(a_position, 0.0, 1.0);\n}\n  ",t.collisionDebugFS="\nprecision mediump float;  \n\nuniform vec3 u_color;\n\nvoid main() {\n  gl_FragColor = vec4(u_color, 1.0);\n}\n  ",t}();e.ShaderSource=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(3),s=r(10),l=r(1),u=r(9),h=r(18),c=r(8),p=r(6),f=r(14),d=r(28),g=r(11),y=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new u.Matrix4,i}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==o.LayerType.LINE){var t=this.layer;0!=t.renderTiles.size&&this.renderInternal(!1,t)}},e.prototype.renderSelection=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==o.LayerType.LINE){var t=this.layer;this.renderInternal(!0,t)}else console.warn("This layer is not line !")},e.prototype.renderInternal=function(t,e){var r=this,i=!1,n=!1,u=this.layer.mapView.gl,y=s.ResourceManager.getInstance(u).getShader(s.ShaderEnum.POLYLINE_SHADER);u.enable(u.BLEND),y.bind();var m=p.ProjectionMercator.worldSize(this.mapState.getScale()),v=this.layer.getLayerId(),_=null,b=this.mapState.getZoom(),w=1;w=b>this.mapState.getMaxNativeZoom()?Math.pow(2,b-this.mapState.getMaxNativeZoom()):Math.pow(2,b-Math.floor(b)),e.renderTiles.forEach((function(e){var p=e.getTile(),b=p.getKind();if(b==h.Kind.ANNOTATION||b==h.Kind.VECTOR){if(p.hasData(v)){var x=p.getLayerData(v);if(x)if(x.getType()==o.LayerType.LINE){var M=x;_||(_=M.getLayerProperties());var T=_.getStrokeWidth();i=!(_.getStrokePattern().getType()==d.PatternType.Solid),n=_.getStrokePattern().getType()==d.PatternType.Icon;var A=p.getTileCoordinate(),L=1<<A.getZoom(),S=m/L,E=S/l.MapUtils.getTileSize(),P=c.GeometryUtils.pixelCoordinateToCameraCoordinate(new a.Vector2(A.getX()*S+S/2,A.getY()*S+S/2),r.mapState.cameraPosition);r.mvpMatrix.setIdentity(E,E,1),r.mvpMatrix.translate(P.x,P.y,r.mapState.is3dMode()?c.GeometryUtils.getElevationPixelFromMeter(_.getElevation(),r.mapState.cameraPosition):0),r.mvpMatrix.concat(r.mapState.getViewProjectionMatrix());var C=M.getModel();if(C.bind(),y.setAttributes(C.attributeInfos),t){var I=f.LayerRenderer.getSelectionCode();M.setSelectionCode(I);var O=g.Color.fromInt(I);u.uniformMatrix4fv(y.mvpMatrixUniform,!1,r.mvpMatrix.buffer()),u.uniform1f(y.lineWidthUniform,T/w),u.uniform4fv(y.colorUniform,O.buffer()),u.uniform1i(y.useStrokePatternUniform,0)}else{r.layer.mapView._annotationManager.addVisibleAnnotation(_.getId()),u.uniformMatrix4fv(y.mvpMatrixUniform,!1,r.mvpMatrix.buffer());var R=void 0;if(i){var k=M.getTexture();k&&k.isLoaded||(k=s.ResourceManager.getInstance(u).getTexture(s.TextureEnum.WHITE_TEXTURE)),R=w/T*(k.height/k.width),y.setTexture(y.textureUniform,k.textureId)}u.uniform1f(y.lineWidthUniform,T/w),u.uniform4fv(y.colorUniform,_.getStrokeColor().buffer()),u.uniform1i(y.useStrokePatternUniform,i?1:0),i&&u.uniform1f(y.textureScaleUniform,R),u.uniform1i(y.useIconUniform,n?1:0)}C.render(u.TRIANGLES)}else console.warn("ERROR: layerData.getType() != LayerType.LINE .............")}}else console.warn("Invalid tile kind")})),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null),u.bindBuffer(u.ARRAY_BUFFER,null),y.disableAttributes(),u.disable(u.BLEND)},e}(f.LayerRenderer);e.LineLayerRenderer=y},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(3),s=r(10),l=r(1),u=r(9),h=r(18),c=r(8),p=r(6),f=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new u.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==o.LayerType.FILL){var e=this.layer;if(0!=e.renderTiles.size){var r=this.layer.mapView.gl,i=s.ResourceManager.getInstance(r).getShader(s.ShaderEnum.FILL_SHADER);r.enable(r.BLEND),i.bind();var n=p.ProjectionMercator.worldSize(this.mapState.getScale()),f=this.layer.getLayerId(),d=null,g=!1,y=new Map;e.renderTiles.forEach((function(e){var s=e.getTile(),p=s.getKind();if(p==h.Kind.ANNOTATION||p==h.Kind.VECTOR){if(s.hasData(f)){var m=s.getLayerData(f);if(m)if(m.getType()==o.LayerType.FILL){var v=m;if(d||(d=v.getLayerProperties(),g=d.getStrokeWidth()>0),d.isVisible()){t.layer.mapView._annotationManager.addVisibleAnnotation(d.annotationId);var _=s.getTileCoordinate(),b=1<<_.getZoom(),w=n/b,x=w/l.MapUtils.getTileSize(),M=c.GeometryUtils.pixelCoordinateToCameraCoordinate(new a.Vector2(_.getX()*w+w/2,_.getY()*w+w/2),t.mapState.cameraPosition);t.mvpMatrix.setIdentity(x,x,1),t.mvpMatrix.translate(M.x,M.y,t.mapState.is3dMode()?c.GeometryUtils.getElevationPixelFromMeter(d.getElevation(),t.mapState.cameraPosition):0);var T=t.mvpMatrix.concat(t.mapState.getViewProjectionMatrix());r.uniformMatrix4fv(i.mvpMatrixUniform,!1,T.buffer());var A=v.getFillModel();if(A.bind(),i.setAttributes(A.attributeInfos),r.uniform4fv(i.colorUniform,d.getFillColor().buffer()),A.render(r.TRIANGLES),A.unbind(),g){var L=new u.Matrix4;y.set(v.getLineModel(),L.copy(T))}}}else console.warn("ERROR: layerData.getType() != LayerType.FILL .............")}}else console.warn("Invalid tile kind")})),i.disableAttributes(),d&&d.isVisible()&&g&&this.renderLine(y,d.getStrokeColor(),d.getStrokeWidth()),r.disable(r.BLEND)}}else console.log("Invalid layer type")},e.prototype.renderLine=function(t,e,r){var i=1;this.mapState.getZoom()>this.mapState.getMaxNativeZoom()&&(i=Math.pow(2,Math.round(this.mapState.getZoom()-this.mapState.getMaxNativeZoom())));var n=this.layer.mapView.gl,o=s.ResourceManager.getInstance(n).getShader(s.ShaderEnum.POLYLINE_SHADER);o.bind(),n.uniform1f(o.lineWidthUniform,r/i),n.uniform4fv(o.colorUniform,e.buffer()),n.uniform1i(o.useStrokePatternUniform,0),t.forEach((function(t,e){e.bind(),o.setAttributes(e.attributeInfos),n.uniformMatrix4fv(o.mvpMatrixUniform,!1,t.buffer()),e.render(n.TRIANGLES),e.unbind()})),o.disableAttributes()},e}(r(14).LayerRenderer);e.FillLayerRenderer=f},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(10),s=r(9),l=r(8),u=r(14),h=r(6),c=r(2),p=r(18),f=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new s.Matrix4,i}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==o.LayerType.CIRCLE){var t=this.layer;if(0!=t.renderTiles.size){var e=this.layer.mapView.gl,r=a.ResourceManager.getInstance(e),i=r.getShader(a.ShaderEnum.CIRCLE_SHADER);e.enable(e.BLEND),i.bind();var n=r.getModel(a.ModelEnum.CIRCLE_MODEL);n.bind();for(var s=this.mapState.cameraPosition.getTarget(),u=h.ProjectionMercator.getMetersPerPixelAtLatitude(s.lat,this.mapState.getZoom()),f=this.layer.getLayerId(),d=Array.from(t.renderTiles),g=0;g<d.length;++g){var y=d[g][1].getTile(),m=y.getKind();if(m!=p.Kind.ANNOTATION&&m!=p.Kind.VECTOR&&console.warn("Invalid tile kind in CircleLayerRenderer"),y.hasData(f)){var v=y.getLayerData(f);if(!v)return;if(v.getType()==o.LayerType.CIRCLE){var _=v.getLayerProperties();if(_.isVisible()){var b=_.getRadius()/u,w=b/Math.cos(Math.PI/c.PolyConstants.numTrianglesPerCircle),x=_.getStrokeWidth(),M=l.GeometryUtils.pixelCoordinateToCameraCoordinate(h.ProjectionMercator.projectScale(_.getCenter(),this.mapState.scale),this.mapState.cameraPosition);this.mvpMatrix.setIdentity(),this.mvpMatrix.translate(M.x,M.y,this.mapState.is3dMode()?l.GeometryUtils.getElevationPixelFromMeter(_.getElevation(),this.mapState.cameraPosition):0),this.mvpMatrix.concat(this.mapState.getViewProjectionMatrix()),e.uniform4fv(i.colorUniform,_.getFillColor().buffer()),e.uniform1f(i.radiusUniform,w+_.getHypotenuseStrokeWidth()),e.uniform1f(i.outerRadiusUniform,b+x),e.uniform1f(i.innerRadiusUniform,b),e.uniform4fv(i.strokeColorUniform,_.getStrokeColor().buffer()),e.uniformMatrix4fv(i.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),i.setAttributes(n.attributeInfos),n.render(e.TRIANGLES),this.layer.mapView._annotationManager.addVisibleAnnotation(_.annotationId);break}}else console.warn("ERROR: layerData.getType() != LayerType.CIRCLE .............")}}n.unbind(),e.disable(e.BLEND)}}else console.log("Invalid layer type")},e}(u.LayerRenderer);e.CircleLayerRenderer=f},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(14),s=r(10),l=r(7),u=r(18),h=r(8),c=r(9),p=r(96),f=r(11),d=r(3),g=r(1),y=r(2),m=r(24),v=r(52),_=r(85),b=function(t){function e(e,r){var i=t.call(this,e,r)||this,n=s.ResourceManager.getInstance(i.layer.mapView.gl);return i.symbolShader=n.getShader(s.ShaderEnum.SYMBOL_SHADER),i.model=n.getModel(s.ModelEnum.SYMBOL_MODEL),i.mvpMatrix=new c.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==o.LayerType.SYMBOL){var e=this.layer;if(0!=e.renderTiles.size){var r=this.layer.mapView,i=e.getLayerId(),n=r.gl;n.enable(n.BLEND),this.flag=!0;var a=this.mapState.cameraPosition,s=this.mapState.getScreenSize(),c=m.CameraUtils.calculateViewProjectionMatrix(a,s.x,s.y),p=null;e.renderTiles.forEach((function(e){var f=e.getTile();if(f.getKind()==u.Kind.ANNOTATION){if(f.hasData(i)){var d=f.getLayerData(i);if(d)if(d.getType()==o.LayerType.SYMBOL){var m=d,b=m.getTexture();if(b&&b.isLoaded&&(p||(p=m.getLayerProperties()),p.isVisible())){r._annotationManager.addVisibleAnnotation(p.annotationId);var w=p.getWidth(),x=p.getHeight(),M=t.mapState.is3dMode()?p.getElevation():0,T=h.GeometryUtils.latLngToScreenCoordinate(p.getPosition(),M,a,s,c),A=p.getAnchor(),L=m.getTextLabelData(),S=p.getMarkerLabel();p.markerLabelDirty&&(L&&L.destroy(),L=l.MapResourceManager.getInstance(n).acquireText(S.getText(),S.getFontSize()*g.MapUtils.pixelScale,S.getFontWeight(),S.getMaxWidth(),S.getLine()),m.setTextLabelData(L),p.setMarkerLabelDirty(!1));var E=p.getAnimation();if(null!=E&&(E==v.Animation.DROP&&p._animationTime<y.MapConstants.dropAnimationDuration?(p._animationTime+=r.deltaTime,T.y*=_.Easing.easeOutBounce(p._animationTime/y.MapConstants.dropAnimationDuration),r.requestRender()):E==v.Animation.BOUNCE&&(p._animationTime+=r.deltaTime,T.y-=x*Math.abs(Math.cos(p._animationTime/1080)),r.requestRender())),t.renderSymbol(n,b,T,w,x,A,p.getRotation()),L){var P=p.getLabelAnchor();t.renderSymbolLabel(n,T,w,x,A,L,S,P),t.flag=!0}}}else console.warn("ERROR: layerData.getType() != LayerType.SYMBOL ....")}}else console.error("Invalid tile")})),this.model.unbind(),n.disable(n.BLEND)}}else console.log("Invalid layer type")},e.prototype.renderSymbol=function(t,e,r,i,n,o,a){void 0===a&&(a=0),e.isLoaded&&(this.flag&&(this.symbolShader.bind(),this.model.bind(),this.symbolShader.setAttributes(this.model.attributeInfos),this.flag=!1),this.mvpMatrix.setIdentity(i/2,n/2,1),this.mvpMatrix.rotateZ(a),this.mvpMatrix.translate((.5-o.x)*i,(.5-o.y)*n,0),this.mvpMatrix.translate(r.x,r.y,0),this.mvpMatrix.concat(this.mapState.getOrthoProjectionMatrix()),t.uniform1i(this.symbolShader.useMaskTextureUniform,0),t.uniformMatrix4fv(this.symbolShader.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),this.symbolShader.setTexture(this.symbolShader.textureUniform,e.textureId),this.model.render(t.TRIANGLES),this.symbolShader.resetTextureUnit())},e.prototype.renderSymbolLabel=function(t,e,r,i,n,o,a,s){var l=a.getMargin(),u=a.getAnchor(),h=g.MapUtils.pixelScale,c=o.widthPerLine==y.MapConstants.none?o.width:o.widthPerLine,m=(s.x-n.x)*r+(l.left-l.right)*h+c*(.5-u.x),v=(s.y-n.y)*i+(l.top-l.bottom)*h+o.height*(.5-u.y),_=e.add(new d.Vector2(m,v));p.TextLabelRenderer.render(t,this.mapState,o,_,f.Color.fromHex(a.getColor()),a.hasHalo(),f.Color.fromHex(a.getHaloColor()))},e}(a.LayerRenderer);e.SymbolLayerRenderer=b},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(14),s=r(10),l=r(6),u=r(18),h=r(1),c=r(9),p=r(3),f=r(8),d=r(2),g=r(7),y=r(24),m=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new c.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==o.LayerType.GEOJSON){var e=this.layer;if(0!=e.renderTiles.size){var r=this.mapState.getZoom();if(!(r<this.mapState.mapSettings.dataLayerMinZoom||r>this.mapState.mapSettings.dataLayerMaxZoom)){var i=this.layer.mapView.gl,n=s.ResourceManager.getInstance(i),a=n.getShader(s.ShaderEnum.GEOJSON_SHADER);i.enable(i.BLEND);var c=l.ProjectionMercator.worldSize(this.mapState.getScale()),m=this.layer.getLayerId(),v=1;v=r>this.mapState.getMaxNativeZoom()?Math.pow(2,r-this.mapState.getMaxNativeZoom()):Math.pow(2,r-Math.floor(r));var _=this.mapState.cameraPosition,b=this.mapState.getScreenSize();e.renderTiles.forEach((function(e){e.forEach((function(e){var r=e.getTile();if(r.getKind()==u.Kind.VECTOR){var n=r;if(n.hasData(m)){var s=n._getLayerData(m,o.LayerType.GEOJSON);if(s.getType()==o.LayerType.GEOJSON){a.bind();var l=s,d=n.getTileCoordinate(),g=1<<d.getZoom(),y=c/g,b=y/h.MapUtils.getTileSize(),w=f.GeometryUtils.pixelCoordinateToCameraCoordinate(new p.Vector2(d.getX()*y+y/2,d.getY()*y+y/2),_);t.mvpMatrix.setIdentity(b,b,1),t.mvpMatrix.translate(w.x,w.y,0);var x=t.mvpMatrix.concat(t.mapState.getViewProjectionMatrix());i.uniformMatrix4fv(a.mvpMatrixUniform,!1,x.buffer());var M=l.getPartials(),T=l.getFillOutlinedPartials(),A=l.getFillProperties(),L=l.getLineProperties(),S=l.getFillOutlinedProperties(),E=Array.from(M.keys()),P=l.getModel();P.bind(),a.setAttributes(P.attributeInfos),E.forEach((function(t){if(L.has(t))for(var e=M.get(t),r=L.get(t),n=0;n<e.length;++n){i.uniform1f(a.lineWidthUniform,r.strokeWidth/v),i.uniform4fv(a.colorUniform,r.strokeColor.buffer());var o=e[n];P.renderPartial(i.TRIANGLES,o.start,o.length)}else if(A.has(t)){i.uniform1f(a.lineWidthUniform,0);var s=M.get(t),l=T.get(t);for(n=0;n<s.length;++n){i.uniform4fv(a.colorUniform,A.get(t).fillColor.buffer());var u=s[n];if(P.renderPartial(i.TRIANGLES,u.start,u.length),l&&n<l.length)(h=l[n]).forEach((function(e){i.uniform4fv(a.colorUniform,S.get(t).strokeColor.buffer()),P.renderPartial(i.LINES,e.start,e.length)}))}if(l)for(n=s.length;n<l.length;++n){var h=l[n];i.uniform4fv(a.colorUniform,S.get(t).strokeColor.buffer()),h.forEach((function(t){P.renderPartial(i.LINES,t.start,t.length)}))}}else console.warn("Invalid geojson key: "+t)}))}else console.warn("ERROR: layerData.getType() != LayerType.GEOJSON .............")}}else console.warn("Invalid tile kind")}))}));var w=n.getShader(s.ShaderEnum.SYMBOL_SHADER),x=n.getModel(s.ModelEnum.SYMBOL_MODEL),M=g.MapResourceManager.getInstance(i),T=M.getTexture(d.SymbolConstants.geoJsonLayerId);T?T.retain():T=M.createMarkerTexture(d.SymbolConstants.geoJsonLayerId,d.SymbolConstants.defaultSymbol),w.bind(),x.bind(),w.setAttributes(x.attributeInfos),w.setTexture(w.textureUniform,T.textureId),e.renderTiles.forEach((function(e){e.forEach((function(e){var r=e.getTile();if(r.getKind()==u.Kind.VECTOR){var n=r;if(n.hasData(m)){var a=n._getLayerData(m,o.LayerType.GEOJSON);if(a.getType()==o.LayerType.GEOJSON){var s=y.CameraUtils.calculateViewProjectionMatrix(_,b.x,b.y);a.getPointCoordinates().forEach((function(e){e.forEach((function(e){var r=f.GeometryUtils.latLngToScreenCoordinate(e,0,_,b,s),n=d.MapConstants.pointGeoJsonAnchor,o=n[0],a=n[1],l=d.MapConstants.pointGeoJsonWidth*h.MapUtils.pixelScale,u=d.MapConstants.pointGeoJsonHeight*h.MapUtils.pixelScale;t.mvpMatrix.setIdentity(l/2,u/2,1),t.mvpMatrix.translate((.5-o)*l,(.5-a)*u,0),t.mvpMatrix.translate(r.x,r.y,0);var c=t.mvpMatrix.concat(t.mapState.getOrthoProjectionMatrix());i.uniformMatrix4fv(w.mvpMatrixUniform,!1,c.buffer()),x.render(i.TRIANGLES)}))}))}else console.warn("ERROR: layerData.getType() != LayerType.GEOJSON .............")}}else console.warn("Invalid tile kind")}))})),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindBuffer(i.ARRAY_BUFFER,null)}}}},e}(a.LayerRenderer);e.GeoJsonLayerRenderer=m},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==o.LayerType.USERPOI){var t=this.layer;if(0!=t.renderTiles.size){var e=t.getUserPOIRenderDatas();null!=e&&0!=e.length&&this.renderPOIs(e)}}else console.log("Invalid layer type")},e}(r(69).POILayerRenderer);e.UserPOILayerRenderer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(68),s=function(t){function e(e,r,i){return t.call(this,e,r,i)||this}return n(e,t),e.prototype.render=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==o.LayerType.USERBUILDING){var e=this.layer;t.prototype.renderInternal.call(this,a.BuildingRenderType.Building,e)}else console.warn("This layer is not user building !")},e.prototype.renderSelection=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==o.LayerType.USERBUILDING){var e=this.layer;t.prototype.renderInternal.call(this,a.BuildingRenderType.Selection,e)}else console.warn("This layer is not user building !")},e.prototype.renderShadowMapping=function(){if(this.mapState.is3dMode())if(this.layer.getLayerType()==o.LayerType.USERBUILDING){var e=this.layer;t.prototype.renderInternal.call(this,a.BuildingRenderType.Shadow,e)}else console.warn("This layer is not user building !")},e}(a.BuildingLayerRenderer);e.UserBuildingLayerRenderer=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(2),a=r(18),s=r(10),l=r(14),u=r(9),h=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.time=0,i.mvpMatrix=new u.Matrix4,i.modelMatrix=new u.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this,e=this.layer,r=e.getOverlayProperties();if(null!=r){var i=this.layer.mapView.gl;i.enable(i.BLEND);var n=s.ResourceManager.getInstance(i),l=this.mapState.is3dMode()&&this.mapState.getTilt()>o.MapConstants.maxTiltIntersectWithScreen,u=n.getModel(s.ModelEnum.RASTER_MODEL),h=null,c=e.effectManager,p=this.mapState.is3dMode()&&c.enableShadowEffect;if(u.bind(),l){(h=p?n.getShader(s.ShaderEnum.RASTER_3D_WITH_SHADOW_SHADER):n.getShader(s.ShaderEnum.RASTER_FOG_SHADER)).bind(),h.setAttributes(u.attributeInfos);var f=o.MapConstants.defaultMaxNativeZoom,d=e.timeEffectManager.getFogColor(),g=6*Math.max(this.mapState.getZoom()-f,0),y=e.lightManager.sunLight;i.uniform3fv(h.lightColorUniform,y.lightColor.rgbBuffer()),i.uniform3f(h.lightPositionUniform,y.lightPosition.x,y.lightPosition.y,y.lightPosition.z),i.uniform1f(h.fogStartUniform,22+g),i.uniform1f(h.fogRangeUniform,10+g),i.uniform3fv(h.fogColorUniform,d.rgbBuffer())}else(h=p?n.getShader(s.ShaderEnum.RASTER_WITH_SHADOW_SHADER):n.getShader(s.ShaderEnum.RASTER_SHADER)).bind(),h.setAttributes(u.attributeInfos);var m=n.getTexture(s.TextureEnum.WATER_DISPLACEMENT),v=n.getTexture(s.TextureEnum.WATER_COLOR),_=e.effectManager.enableWaterEffect&&this.mapState.is3dMode()?1:0,b=e.lightManager.sunLight;this.time+=8e-4,i.uniform3fv(h.lightColorUniform,b.lightColor.rgbBuffer()),i.uniform3f(h.lightPositionUniform,b.lightPosition.x,b.lightPosition.y,b.lightPosition.z),i.uniform1f(h.timeUniform,this.time),i.uniform1i(h.enableWaterUniform,_),e.mapView.overlayManager.getRenderTiles().forEach((function(n){var s=n.getTile();if(s.getKind()==a.Kind.OVERLAY){var l=null,f=s.getTileRenderData(),d=null;if(r.forEach((function(t,r){e.getLayerId()==r.getLayerId()&&null==l&&r.isVisible()&&(l=f.getLayerRenderData(r.getLayerId()),d=r.getOpacity())})),null!=l){var g=l.getTexture();if(null!=g){var y=t.mapState.getViewProjectionMatrix();if(t.mapState.matrixFor(t.modelMatrix,n.getUnwrappedTileCoordinate()),p){var _=c.shadowMap;t.mvpMatrix.copy(t.modelMatrix),t.mvpMatrix.concat(_.getLightViewProjectionMatrix()).concat(o.MapConstants.biasMatrix),h.setTexture(h.shadowMapUniform,_.getShadowMapTexture().textureId),i.uniformMatrix4fv(h.shadowMvpMatrixUniform,!1,t.mvpMatrix.buffer())}t.mvpMatrix.copy(t.modelMatrix),t.mvpMatrix.concat(y),h.setTexture(h.waterDisplacementUniform,m.textureId),h.setTexture(h.waterColorUniform,v.textureId),h.setTexture(h.textureUniform,g.textureId),i.uniform1f(h.opacityUniform,d),i.uniformMatrix4fv(h.mvpMatrixUniform,!1,t.mvpMatrix.buffer()),u.render(i.TRIANGLES),h.resetTextureUnit()}}}else console.log("Tile is not overlay")})),u.unbind(),h.disableAttributes(),i.disable(i.BLEND)}},e}(l.LayerRenderer);e.RasterOverlayRenderer=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==o.LayerType.POI_OVERLAY){var t=this.layer,e=t.poiRenderDatas;t.isVisible()&&null!=e&&0!=e.length&&this.renderPOIs(e)}else console.error("Invalid layer type")},e}(r(69).POILayerRenderer);e.POIOverlayRenderer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(68),a=r(0),s=function(t){function e(e,r,i){return t.call(this,e,r,i)||this}return n(e,t),e.prototype.render=function(){if(this.mapState.is3dMode()&&this.layer.getLayerType()==a.LayerType.BUILDING_OVERLAY){var e=this.layer;e.isVisible()&&t.prototype.renderInternal.call(this,o.BuildingRenderType.Building,e)}},e.prototype.renderSelection=function(){if(this.layer.getLayerType()==a.LayerType.BUILDING_OVERLAY){var e=this.layer;t.prototype.renderInternal.call(this,o.BuildingRenderType.Selection,e)}},e}(o.BuildingLayerRenderer);e.BuildingOverlayRender=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(10),a=r(0),s=r(14),l=r(67),u=r(7),h=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==a.LayerType.SURFACE){var t=this.layer.mapView.gl;t.enable(t.BLEND);var e=o.ResourceManager.getInstance(t).getShader(o.ShaderEnum.POLYLINE_SHADER),r=o.ResourceManager.getInstance(t).getShader(o.ShaderEnum.FILL_SHADER),i=this.layer,n=i.renderDatas,s=i.mvpMatrixs,h=this.layer.mapView.getMapStyle(),c=u.MapResourceManager.getInstance(t),p=this.mapState.getZoom(),f=1;f=p>this.mapState.getMaxNativeZoom()?Math.pow(2,p-this.mapState.getMaxNativeZoom()):Math.pow(2,p-Math.floor(p)),n.forEach((function(i,n){var o=n.layerRenderData,a=s[n.matrixIndex],u=o.getModel();if(null!=u){var p=o.getLayerProperties();switch(o.getSurfaceType()){case l.SurfaceType.LINE:e.bind(),u.bind(),e.setAttributes(u.attributeInfos);var d=p.getWidth(),g=0,y=0,m=h.getPatternStyle(p.pattern);if(m&&(y=m.isIcon()?1:0,g=m.isSolid()?0:1)){var v=void 0;if(y){var _=h.getTextureStyle(m.texture);_&&(v=c.getTexture(_.id))}else v=o.getTexture();if(v&&v.isLoaded){var b=f/d*(v.height/v.width);e.setTexture(e.textureUniform,v.textureId),t.uniform1f(e.textureScaleUniform,b)}else y=0,g=0}t.uniformMatrix4fv(e.mvpMatrixUniform,!1,a.buffer()),t.uniform1f(e.lineWidthUniform,d/f),t.uniform4fv(e.colorUniform,p.getColor().buffer()),t.uniform1i(e.useStrokePatternUniform,g),t.uniform1i(e.useIconUniform,y),u.render(t.TRIANGLES),e.resetTextureUnit(),e.disableAttributes();break;case l.SurfaceType.POLYGON:r.bind(),u.bind(),r.setAttributes(u.attributeInfos),t.uniformMatrix4fv(r.mvpMatrixUniform,!1,a.buffer()),t.uniform4fv(r.colorUniform,p.getColor().buffer()),u.render(t.TRIANGLES),r.resetTextureUnit(),r.disableAttributes()}}})),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null),t.disable(t.BLEND)}},e}(s.LayerRenderer);e.SurfaceLayerRenderer=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(7),a=r(0),s=r(10),l=r(67),u=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==a.LayerType.BOUNDARY){var t=this.layer.mapView.gl;t.enable(t.BLEND);var e=s.ResourceManager.getInstance(t).getShader(s.ShaderEnum.POLYLINE_SHADER);e.bind();var r=this.layer,i=r.renderDatas,n=r.mvpMatrixs,u=this.layer.mapView.getMapStyle(),h=o.MapResourceManager.getInstance(t),c=this.mapState.getZoom(),p=1;p=c>this.mapState.getMaxNativeZoom()?Math.pow(2,c-this.mapState.getMaxNativeZoom()):Math.pow(2,c-Math.floor(c)),i.forEach((function(r,i){var o=i.layerRenderData;if(o.getSurfaceType()!=l.SurfaceType.POLYGON){var a=o.getModel();if(null!=a){var s=n[i.matrixIndex],c=o.getLayerProperties(),f=c.getWidth();a.bind(),e.setAttributes(a.attributeInfos);var d=0,g=0,y=u.getPatternStyle(c.pattern);if(y&&(g=y.isIcon()?1:0,d=y.isSolid()?0:1)){var m=void 0;if(g){var v=u.getTextureStyle(y.texture);v&&(m=h.getTexture(v.id))}else m=o.getTexture();if(m&&m.isLoaded){var _=p/f*(m.height/m.width);e.setTexture(e.textureUniform,m.textureId),t.uniform1f(e.textureScaleUniform,_)}else g=0,d=0}t.uniformMatrix4fv(e.mvpMatrixUniform,!1,s.buffer()),t.uniform1f(e.lineWidthUniform,f/p),t.uniform4fv(e.colorUniform,c.getColor().buffer()),t.uniform1i(e.useStrokePatternUniform,d),t.uniform1i(e.useIconUniform,g),a.render(t.TRIANGLES),e.resetTextureUnit()}}})),e.disableAttributes(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null),t.disable(t.BLEND)}},e}(r(14).LayerRenderer);e.BoundaryLayerRenderer=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(17),a=r(0),s=r(10),l=r(14),u=r(7),h=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==a.LayerType.ROADS){var t=this.layer,e=t.renderDatas,r=t.mvpMatrixs;if(0!=e.length){var i=this.mapState.mapSettings.getMapType()==o.MapType.satellite,n=this.layer.mapView.gl,l=this.layer.mapView.getMapStyle(),h=u.MapResourceManager.getInstance(n);n.enable(n.BLEND),i&&n.enable(n.DEPTH_TEST);var c=s.ResourceManager.getInstance(n).getShader(s.ShaderEnum.POLYLINE_SHADER);c.bind();var p=this.mapState.getZoom(),f=1;f=p>this.mapState.getMaxNativeZoom()?Math.pow(2,p-this.mapState.getMaxNativeZoom()):Math.pow(2,p-Math.floor(p));for(var d=function(){return i?e.end:e.begin},g=function(t){i?t.prev():t.next()},y=d();y.valid;){var m=(w=y.value).getModel(),v=w.getLayerProperties();if(null!=m&&v.hasOutline()){var _=r[w.matrixIndex],b=2*v.getOutlineWidth()+v.getWidth();m.bind(),c.setAttributes(m.attributeInfos),n.uniformMatrix4fv(c.mvpMatrixUniform,!1,_.buffer()),n.uniform1f(c.lineWidthUniform,b/f),n.uniform4fv(c.colorUniform,v.getOutlineColor().buffer()),n.uniform1i(c.useStrokePatternUniform,0),n.uniform1i(c.useIconUniform,0),m.render(n.TRIANGLES),c.resetTextureUnit()}g(y)}for(y=d();y.valid;){var w;if(null!=(m=(w=y.value).getModel())){v=w.getLayerProperties(),_=r[w.matrixIndex];var x=v.getWidth();m.bind(),c.setAttributes(m.attributeInfos);var M=0,T=0,A=l.getPatternStyle(v.pattern);if(A&&(T=A.isIcon()?1:0,M=A.isSolid()?0:1)){var L=void 0;if(T){var S=l.getTextureStyle(A.texture);S&&(L=h.getTexture(S.id))}else L=w.getTexture();if(L&&L.isLoaded){var E=f/x*(L.height/L.width);c.setTexture(c.textureUniform,L.textureId),n.uniform1f(c.textureScaleUniform,E)}else T=0,M=0}n.uniformMatrix4fv(c.mvpMatrixUniform,!1,_.buffer()),n.uniform1f(c.lineWidthUniform,x/f),n.uniform4fv(c.colorUniform,v.getColor().buffer()),n.uniform1i(c.useStrokePatternUniform,M),n.uniform1i(c.useIconUniform,T),m.render(n.TRIANGLES),c.resetTextureUnit()}g(y)}c.disableAttributes(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindBuffer(n.ARRAY_BUFFER,null),i&&n.disable(n.DEPTH_TEST),n.disable(n.BLEND)}}},e}(l.LayerRenderer);e.RoadLayerRenderer=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(14),a=r(0),s=r(10),l=r(1),u=r(9),h=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new u.Matrix4,i}return n(e,t),e.prototype.render=function(){var t=this;if(this.layer.getLayerType()==a.LayerType.LABEL){var e=this.layer.mapView.gl;e.enable(e.BLEND);var r=s.ResourceManager.getInstance(e).getShader(s.ShaderEnum.TEXT_LABEL_SHADER);r.bind();var i=this.mapState.getOrthoProjectionMatrix();this.layer.renderDatas.forEach((function(n,o){var a=o.getLayerProperties();if(a&&a.isVisible()){var s=o.getTextData();if(s){var u=a.getColor(),h=a.getHaloColor(),c=o.getScreenCoordinate(),p=s.font.texture,f=s.model;null!=f&&(t.mvpMatrix.setIdentity(),t.mvpMatrix.translate(c.x,c.y,0),t.mvpMatrix.concat(i),f.bind(),r.setAttributes(f.attributeInfos),e.uniformMatrix4fv(r.mvpMatrixUniform,!1,t.mvpMatrix.buffer()),r.setTexture(r.textureUniform,p.textureId),e.uniform1f(r.pixelScaleUniform,l.MapUtils.pixelScale),e.uniform1f(r.textSizeUniform,s.size),e.uniform2fv(r.texsizeUniform,new Float32Array([p.width,p.height])),a.hasHalo()&&(e.uniform4fv(r.colorUniform,h.buffer()),e.uniform1i(r.isHaloUniform,1),f.render(e.TRIANGLES)),e.uniform4fv(r.colorUniform,u.buffer()),e.uniform1f(r.gammaScaleUniform,1),e.uniform1i(r.isHaloUniform,0),f.render(e.TRIANGLES),f.unbind(),r.resetTextureUnit())}}})),r.disableAttributes(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND)}},e}(o.LayerRenderer);e.LabelLayerRenderer=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(14),a=r(0),s=r(9),l=r(10),u=r(8),h=r(6),c=r(4),p=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.mvpMatrix=new s.Matrix4,i}return n(e,t),e.prototype.render=function(){if(this.layer.getLayerType()==a.LayerType.IMAGE_OVERLAY){var t=this.layer,e=t.getTexture();if(null!=e&&t.isVisible()&&!t.isOutOfScreen()){var r=this.layer.mapView.gl;r.enable(r.BLEND);var i=l.ResourceManager.getInstance(r),n=i.getShader(l.ShaderEnum.RASTER_SHADER),o=i.getModel(l.ModelEnum.RASTER_MODEL);o.bind(),n.bind(),n.setAttributes(o.attributeInfos);var s=this.mapState.cameraPosition,p=this.mapState.getViewProjectionMatrix(),f=this.mapState.getScale(),d=t.getProperties(),g=d.getBounds(),y=g.getSouthwest(),m=g.getNortheast(),v=h.ProjectionMercator.projectScale(new c.LatLng(m.lat,y.lng),f),_=h.ProjectionMercator.projectScale(new c.LatLng(y.lat,y.lng),f),b=h.ProjectionMercator.projectScale(new c.LatLng(y.lat,m.lng),f),w=Math.abs(b.x-_.x),x=Math.abs(_.y-v.y),M=u.GeometryUtils.pixelCoordinateToCameraCoordinate(h.ProjectionMercator.projectScale(d.getCenter(),f),s);this.mvpMatrix.setIdentity(w/2,x/2,1),this.mvpMatrix.translate(M.x,M.y,0),this.mvpMatrix.concat(p),n.setTexture(n.textureUniform,e.textureId),r.uniform1f(n.opacityUniform,d.getOpacity()),r.uniformMatrix4fv(n.mvpMatrixUniform,!1,this.mvpMatrix.buffer()),o.render(r.TRIANGLES),n.resetTextureUnit(),o.unbind(),n.disableAttributes(),r.disable(r.BLEND)}}else console.log("Invalid layer type")},e}(o.LayerRenderer);e.ImageOverlayRenderer=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(14),a=r(2),s=r(10),l=function(t){function e(e,r){return t.call(this,e,r)||this}return n(e,t),e.prototype.render=function(){if(this.mapState.is3dMode()&&!(this.mapState.getTilt()<a.MapConstants.maxTiltIntersectWithScreen)){var t=this.layer.mapView.skyObject;if(null!=t&&null!=t.getMvpMatrix()){var e=this.layer.mapView.gl,r=this.layer.mapView.timeEffectManager,i=s.ResourceManager.getInstance(e);e.enable(e.DEPTH_TEST);var n=i.getShader(s.ShaderEnum.SKY_SHARDER),o=i.getModel(s.ModelEnum.SKY_MODEL);n.bind();var l=1-2*this.mapState.getSkyRatio(),u=l+this.mapState.screenHeight/this.mapState.screenHeight/2,h=r.getSkyColor(),c=r.getFogColor();e.uniform1f(n.lowerLimitUniform,l),e.uniform1f(n.upperLimitUniform,u),e.uniformMatrix4fv(n.mvpMatrixUniform,!1,t.getMvpMatrix().buffer()),e.uniform3fv(n.skyColorUniform,h.rgbBuffer()),e.uniform3fv(n.fogColorUniform,c.rgbBuffer()),o.bind(),n.setAttributes(o.attributeInfos),o.render(e.TRIANGLES),o.unbind(),e.disable(e.DEPTH_TEST)}else console.warn("Can not render because skyObject is null !")}},e}(o.LayerRenderer);e.SkyLayerRenderer=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),n=r(180),o=r(181),a=r(182),s=r(183),l=r(70),u=r(185),h=r(97),c=r(186),p=r(187),f=r(188),d=r(189),g=r(190),y=r(191),m=r(98),v=r(192),_=r(193),b=r(194),w=r(195),x=r(196),M=function(){function t(){}return t.createLayer=function(t,e,r,M){switch(e){case i.LayerType.SURFACE:return new m.SurfaceLayer(t,M,r);case i.LayerType.BOUNDARY:return new v.BoundaryLayer(t,M,r);case i.LayerType.ROADS:return new _.RoadLayer(t,M,r);case i.LayerType.LABEL:return new b.LabelLayer(t,M,r);case i.LayerType.RASTER:return new n.RasterLayer(t,M,r);case i.LayerType.RASTER_OVERLAY:return new g.RasterOverlayLayer(t,M,r);case i.LayerType.SKY:return new x.SkyLayer(t,M,r);case i.LayerType.BUILDING:return new l.BuildingLayer(t,M,r);case i.LayerType.LINE:return new o.LineLayer(t,M,r);case i.LayerType.FILL:return new a.FillLayer(t,M,r);case i.LayerType.CIRCLE:return new s.CircleLayer(t,M,r);case i.LayerType.SYMBOL:return new u.SymbolLayer(t,M,r);case i.LayerType.POI:return new h.POILayer(t,M,r);case i.LayerType.POI_OVERLAY:return new c.POIOverlayLayer(t,M,r);case i.LayerType.USERPOI:return new f.UserPOILayer(t,M,r);case i.LayerType.USERBUILDING:return new d.UserBuildingLayer(t,M,r);case i.LayerType.BUILDING_OVERLAY:return new y.BuildingOverlayLayer(t,M,r);case i.LayerType.GEOJSON:return new p.GeoJsonLayer(t,M,r);case i.LayerType.IMAGE_OVERLAY:return new w.ImageOverlayLayer(t,M,r);default:return console.log("Un-support layer type"),null}},t}();e.LayerFactory=M},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){return t.call(this,e,r,o.LayerType.RASTER,i)||this}return n(e,t),e.prototype.update=function(){},Object.defineProperty(e.prototype,"effectManager",{get:function(){return this._effectManager},set:function(t){this._effectManager=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeEffectManager",{get:function(){return this._timeEffectManager},set:function(t){this._timeEffectManager=t},enumerable:!0,configurable:!0}),e.prototype.setLightingManager=function(t){this.lightManager=t},e}(o.Layer);e.RasterLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.LINE,i)||this;return n._renderTiles=new Map,n}return n(e,t),e.prototype.update=function(t){},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(e.tile.getTileRenderData().removeLayerRenderData(this.layerId.id),this._renderTiles.delete(t))},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){e.tile.getTileRenderData().removeLayerRenderData(t.layerId.id)})),this._renderTiles.clear()},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e}(o.Layer);e.LineLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.FILL,i)||this;return n._renderTiles=new Map,n}return n(e,t),e.prototype.update=function(t){},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(e.tile.getTileRenderData().removeLayerRenderData(this.layerId.id),this._renderTiles.delete(t))},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){e.tile.getTileRenderData().removeLayerRenderData(t.layerId.id)})),this._renderTiles.clear()},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e}(o.Layer);e.FillLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.CIRCLE,i)||this;return n._renderTiles=new Map,n}return n(e,t),e.prototype.update=function(t){},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(e.tile.getTileRenderData().removeLayerRenderData(this.layerId.id),this._renderTiles.delete(t))},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){e.tile.getTileRenderData().removeLayerRenderData(t.layerId.id)})),this._renderTiles.clear()},e}(o.Layer);e.CircleLayer=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.buildings=[],this.id=t}return t.prototype.addBuilding=function(t){this.buildings.push(t)},t.prototype.getModel=function(){return 0==this.buildings.length?null:this.buildings[0].getModel()},t}();e.BuildingGroup=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.SYMBOL,i)||this;return n._renderTiles=new Map,n}return n(e,t),e.prototype.update=function(t){},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(e.tile.getTileRenderData().removeLayerRenderData(this.layerId.id),this._renderTiles.delete(t))},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){e.tile.getTileRenderData().removeLayerRenderData(t.layerId.id)})),this._renderTiles.clear()},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e}(o.Layer);e.SymbolLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(0),s=r(97),l=r(16),u=r(24),h=function(t){function e(e,r,i){return t.call(this,e,r,i,a.LayerType.POI_OVERLAY)||this}return n(e,t),e.prototype.update=function(t){var e=this;if(this.poiRenderDatas=o(l.compareOrderDESC),this.properties.isVisible()){var r=this.mapView.overlayManager.getRenderTiles();r&&r.forEach((function(t){var r=t.getTile(),i=r.getTileData().getTileLayer(e.properties.getLayerId());if(null!=i){var n=r.getTileRenderData();i.getFeatures().forEach((function(t){var r=n.getLayerRenderData(t.getId());if(r.getType()==a.LayerType.POI_OVERLAY){r.getLayerProperties();var i=r;e.poiRenderDatas=e.poiRenderDatas.insert(i.getOrder(),i)}else console.warn("Type "+r.getType()+" is not POI overlay")}))}}));var i=t.getScreenSize(),n=u.CameraUtils.calculateViewProjectionMatrix(t.cameraPosition,i.x,i.y);this.poiRenderDatas.forEach((function(r,i){e.placePOIRenderData(r,i,t,n)}))}},e.prototype.setProperties=function(t){this.properties=t},e.prototype.isVisible=function(){return this.properties.isVisible()},e}(s.POILayer);e.POIOverlayLayer=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,o.LayerType.GEOJSON,i)||this;return n.renderTiles=new Map,n}return n(e,t),e.prototype.update=function(t){},e.prototype.addRenderTile=function(t,e){this.renderTiles.has(t)?this.renderTiles.get(t).push(e):this.renderTiles.set(t,[e])},e.prototype.removeRenderTile=function(t){this.renderTiles.delete(t)},e}(o.Layer);e.GeoJsonLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(0),s=r(2),l=r(1),u=r(8),h=r(3),c=r(16),p=r(7),f=r(24),d=r(39),g=r(72),y=r(43),m=r(73),v=function(t){function e(e,r,i){var n=t.call(this,e,r,a.LayerType.USERPOI,i)||this;return n._renderTiles=new Map,n.userPOIRenderDatas=null,n}return n(e,t),e.prototype.update=function(t){var e=this,r=this.mapView.getCollision2DManager();this.userPOIRenderDatas=o(c.compareOrderDESC),this._renderTiles.forEach((function(t){t.tile.getTileRenderData().getLayerRenderDatas().forEach((function(t){if(t.getType()==a.LayerType.USERPOI){var r=t;r.getLayerProperties()&&(e.userPOIRenderDatas=e.userPOIRenderDatas.insert(r.getOrder(),r))}}))}));var i=t.getScreenSize(),n=f.CameraUtils.calculateViewProjectionMatrix(t.cameraPosition,i.x,i.y),v=[],_=s.MapConstants.placeWidth*l.MapUtils.pixelScale,b=s.MapConstants.placeHeight*l.MapUtils.pixelScale;this.userPOIRenderDatas.forEach((function(o,s){if(s.getType()==a.LayerType.USERPOI){var l=s,c=l.getLayerProperties();if(l.setVisible(!1),l.setTextVisible(!1),c.isVisible()){var f=c.getPosition(),m=u.GeometryUtils.latLngToScreenCoordinate(f,0,t.cameraPosition,i,n);l.setScreenCoordinate(m);var w=m.x-_/2,x=m.x+_/2,M=m.y-b,T=m.y,A=new h.Vector2((w+x)/2,(M+T)/2),L=new d.OBB(A.x,A.y,0,x-w,T-M);r.insert(new g.POICollisionIconRenderData(L,y.CollisionType.USERPOI,null,l)),l.setVisible(!0),c.getTitle().length>0&&c.getFontSize()>0&&(null==l.getTextData()&&l.setTextData(p.MapResourceManager.getInstance(e.mapView.gl).acquireText(c.getTitle(),c.getFontSize())),v.push({order:o,renderData:l,coordinate:m}))}}})),v.forEach((function(t){var e=t.renderData,i=e.getTextData(),n=i.width,o=i.height,a=t.coordinate,s=new h.Vector2(a.x+_/2+n/2+1,a.y-b/2),l=s.x-n/2,u=s.x+n/2,c=s.y-o/2,p=s.y+o/2,f=new h.Vector2((l+u)/2,(c+p)/2);e.setTextVisible(!0);var v=new d.OBB(f.x,f.y,0,u-l,p-c);r.insert(new g.POICollisionTextRenderData(v,y.CollisionType.USERPOITEXT,m.TextDirection.RIGHT,e))}))},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e)},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(this.removeTileRenderData(e),this._renderTiles.delete(t))},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){t.removeTileRenderData(e)})),this._renderTiles.clear()},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e.prototype.getUserPOIRenderDatas=function(){return this.userPOIRenderDatas},e.prototype.queryFeature=function(t){if(null!=this.userPOIRenderDatas&&this.userPOIRenderDatas.length>0){var e=this.userPOIRenderDatas.get(t);if(null!=e){var r=e.getLayerProperties();if(r.isClickable())return this.mapView.annotationManager.getPOI(r.getAnnotationId())}}return null},e.prototype.removeTileRenderData=function(t){var e=t.tile.getTileRenderData().getLayerRenderDatas();e.forEach((function(t){if(t.getType()===a.LayerType.USERPOI){var r=t.getLayerProperties().getId();t.destroy(),e.delete(r)}}))},e}(a.Layer);e.UserPOILayer=v},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(70),a=r(0),s=function(t){function e(e,r,i){var n=t.call(this,e,r,i)||this;return n.layerType=a.LayerType.USERBUILDING,n._renderTiles=new Map,n}return n(e,t),e.prototype.update=function(e){if(e.is3dMode())if(this.getLayerType()==a.LayerType.USERBUILDING){if(this.dirty&&(this.dirty=!1,this.clear(),!(this._renderTiles.size<1))){var r=[];this._renderTiles.forEach((function(t){r.push(t)})),t.prototype.updateInternal.call(this,e,r)}}else console.warn("This layer is not user building !")},e.prototype.addRenderTile=function(t,e){this._renderTiles.has(t)||this._renderTiles.set(t,e),this.setDirty()},e.prototype.removeRenderTile=function(t){var e=this._renderTiles.get(t);e&&(this.removeTileRenderData(e),this._renderTiles.delete(t),this.setDirty())},e.prototype.clearRenderTiles=function(){var t=this;this._renderTiles.forEach((function(e){t.removeTileRenderData(e)})),this._renderTiles.clear(),this.setDirty()},Object.defineProperty(e.prototype,"renderTiles",{get:function(){return this._renderTiles},enumerable:!0,configurable:!0}),e.prototype.removeTileRenderData=function(t){var e=t.tile.getTileRenderData().getLayerRenderDatas();e.forEach((function(t){if(t.getType()===a.LayerType.USERBUILDING){var r=t.getLayerProperties().getId();t.destroy(),e.delete(r)}}))},e}(o.BuildingLayer);e.UserBuildingLayer=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(16),s=r(0),l=function(t){function e(e,r,i){var n=t.call(this,e,r,s.LayerType.RASTER_OVERLAY,i)||this;return n.dirty=!0,n.overlayProperties=null,n}return n(e,t),e.prototype.update=function(t){if(this.dirty){this.dirty=!1;var e=o(a.compareOrderDESC),r=this.mapView.overlayManager;r.tileOverlays.forEach((function(t){var r=t.getProperties();e=e.insert(r.getOrder(),r)})),r.groundOverlays.forEach((function(t){var r=t.getProperties();e=e.insert(r.getOrder(),r)})),e.length>0?this.overlayProperties=e:this.overlayProperties=null}},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.getOverlayProperties=function(){return this.overlayProperties},Object.defineProperty(e.prototype,"effectManager",{get:function(){return this._effectManager},set:function(t){this._effectManager=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeEffectManager",{get:function(){return this._timeEffectManager},set:function(t){this._timeEffectManager=t},enumerable:!0,configurable:!0}),e.prototype.setLightingManager=function(t){this.lightManager=t},e}(s.Layer);e.RasterOverlayLayer=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(70),a=r(0),s=function(t){function e(e,r,i){var n=t.call(this,e,r,i)||this;return n.layerType=a.LayerType.BUILDING_OVERLAY,n}return n(e,t),e.prototype.update=function(e){if(e.is3dMode())if(this.getLayerType()==a.LayerType.BUILDING_OVERLAY){if(this.dirty){this.dirty=!1,this.clear();var r=this.mapView.overlayManager.getRenderTiles();t.prototype.updateInternal.call(this,e,r)}}else console.warn("This layer is not building overlay !")},e.prototype.setProperties=function(t){this.properties=t},e.prototype.isVisible=function(){return this.properties.isVisible()},e}(o.BuildingLayer);e.BuildingOverlayLayer=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){var n=t.call(this,e,r,i,o.LayerType.BOUNDARY)||this;return n.renderDatas=null,n.mvpMatrixs=[],n}return n(e,t),e.prototype.update=function(t){this.updateLayer(t,o.LayerType.BOUNDARY)},e}(r(98).SurfaceLayer);e.BoundaryLayer=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(17),s=r(9),l=r(3),u=r(6),h=r(8),c=r(1),p=r(16),f=r(0),d=function(t){function e(e,r,i){var n=t.call(this,e,r,f.LayerType.ROADS,i)||this;return n.dirty=!0,n.roadIdCounter=0,n.renderDatas=null,n.mvpMatrixs=[],n}return n(e,t),e.prototype.destroy=function(){this.renderDatas=null},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.update=function(t){var e=this;if(this.dirty){this.dirty=!1,this.renderDatas=o(p.compareOrderASC);var r=t.mapSettings.getMapType();if(r==a.MapType.roadmap||r==a.MapType.satellite){var i=c.MapUtils.getTileSize(),n=u.ProjectionMercator.worldSize(t.getScale()),d=t.cameraPosition,g=t.getViewProjectionMatrix(),y=this.mapView.tileManager.getTilePyramid().getRenderTiles();y.forEach((function(t,r){var o=t.getTile(),a=o.getTileCoordinate(),u=1<<a.getZoom(),c=n/u,p=h.GeometryUtils.pixelCoordinateToCameraCoordinate(new l.Vector2(a.getX()*c+c/2,a.getY()*c+c/2),d),y=void 0;r<e.mvpMatrixs.length?y=e.mvpMatrixs[r]:(y=new s.Matrix4,e.mvpMatrixs.push(y));var m=c/i;y.setIdentity(m,m,1),y.translate(p.x,p.y,0),y.concat(g),o.getTileRenderData().getLayerRenderDatas().forEach((function(t,i){if(t.getType()==f.LayerType.ROADS&&t.getLayerProperties().isVisible()){var n=t,o=n.getOrder();o||(o=n.createOrder(e.roadIdCounter++)),n.matrixIndex=r,e.renderDatas=e.renderDatas.insert(o,n)}}))})),this.mvpMatrixs.length>y.length&&(this.mvpMatrixs.length=y.length)}}},e}(f.Layer);e.RoadLayer=d},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(29),a=r(0),s=r(1),l=r(6),u=r(16),h=r(3),c=r(42),p=r(33),f=r(2),d=r(88),g=r(20),y=r(8),m=r(39),v=r(72),_=r(43),b=r(4),w=r(71),x=function(t){function e(e,r,i){var n=t.call(this,e,r,a.LayerType.LABEL,i)||this;return n.renderDatas=null,n}return n(e,t),e.prototype.destroy=function(){this.renderDatas=null},e.prototype.update=function(t){var e=this,r=this.mapView.getCollision2DManager(),i=t.getScreenSize(),n=s.MapUtils.getTileSize(),g=l.ProjectionMercator.worldSize(t.getScale()),w=t.cameraPosition,x=w.getZoom(),M=this.mapView.tileManager.getTilePyramid().getRenderTiles();this.renderDatas=o(u.compareOrderASC),M.forEach((function(o,l){var u=o.getTile(),M=[],T=u.getTileCoordinate(),A=1<<T.getZoom(),L=g/A,S=new h.Vector2(T.getX()*L+L/2,T.getY()*L+L/2),E=L/n,P=u.getTileRenderData();P.getLayerRenderDatas().forEach((function(n,o){if(n.getType()==a.LayerType.LABEL){var l=n,u=l.getLayerProperties();if(u){var g=u.getName();if(g&&0!=g.length){u.setVisible(!0);var A=l.getLineCoordinates().length,L=l.gl,P=u.getId(),C=e.shouldUpdateTextData(t,l);if(u.getLabelType()==c.LabelType.PLACE){if(C){var I=150*s.MapUtils.pixelScale,O=p.TextLabelFactory.getInstance(L).createText(P,new d.TextLabel(g,u.getFontSize()),f.MapConstants.poiFontWeight,I,3);if(l.setTextData(O),!O)return void(Math.abs(x-Math.round(x))<f.MathConstants.epsilon&&T.getZoom()-x<f.MathConstants.epsilon&&M.push(o))}var R=l.getTextData(),k=u.getPosition()[0],D=y.GeometryUtils.latLngToScreenCoordinate(k,0,w,i);l.setScreenCoordinate(D);var B=R.width,U=R.height,j=new h.Vector2(D.x,D.y),N=new m.OBB(j.x,j.y,0,B,U);r.insert(new v.LabelCollisionRenderData(N,_.CollisionType.PLACE_LABEL,l))}else if(A>=2){if(C){l.buildScreenLineCoords(w,i,S,E);var V=p.TextLabelFactory.getInstance(L).createCurvedText(P,new d.TextLabel(g,u.getFontSize()),f.MapConstants.poiFontWeight,l.getScreenLineCoords(),u.isReverse(),u.align);if(l.setTextData(V),!V)return Math.abs(x-Math.round(x))<f.MathConstants.epsilon&&T.getZoom()-x<f.MathConstants.epsilon&&M.push(o),void u.setVisible(!1)}R=l.getTextData();for(var F=l.getScreenLineCoords(),z=A-1,Z=F[0],G=F[z];G.equals(Z);)G=F[z-=1];j=new h.Vector2(0,0);if(2==A&&u.getLabelType()!=c.LabelType.BOUNDARY){k=new b.LatLng((u.getPosition()[0].lat+u.getPosition()[1].lat)/2,(u.getPosition()[0].lng+u.getPosition()[1].lng)/2);var W=y.GeometryUtils.latLngToScreenCoordinate(k,0,w,i),Y=u.isReverse()?u.getPosition()[1]:u.getPosition()[0],H=y.GeometryUtils.latLngToScreenCoordinate(Y,0,w,i);l.setScreenCoordinate(H),j=W}else{var X=R.vertices;k=u.isReverse()?u.getPosition()[1]:u.getPosition()[0],W=y.GeometryUtils.latLngToScreenCoordinate(k,0,w,i);l.setScreenCoordinate(W);var q=0,J=0;X.forEach((function(t){q+=t.x,J+=t.y}));var Q=X.length;j=new h.Vector2(W.x+q/Q,W.y+J/Q)}var K=u.getLabelType()==c.LabelType.BOUNDARY?_.CollisionType.BOUNDARY_LABEL:_.CollisionType.VECTOR_LABEL,$=G.sub(Z),tt=Math.atan2($.y,$.x),et=new m.OBB(j.x,j.y,tt,R.width,R.height);r.insert(new v.LabelCollisionRenderData(et,K,l))}e.renderDatas=e.renderDatas.insert(l.getOrder(),l)}}}})),M.forEach((function(t){P.removeLayerRenderData(t)}))}))},e.prototype.shouldUpdateTextData=function(t,e){var r=!1;null==e.getTextData()&&(r=!0);var i=e.getLayerProperties();if(i.getLabelType()==c.LabelType.PLACE)return r;var n=t.getCamera();if(e.setCameraPosition(n)&&(r=!0),r){var o=e.getLineCoordinates(),a=t.getScreenSize(),s=new g.CameraPosition(n.getTarget(),0,n.getBearing(),n.getZoom()),l=void 0,u=void 0;l=y.GeometryUtils.latLngToScreenCoordinate(i.getPosition()[0],0,s,a),u=y.GeometryUtils.latLngToScreenCoordinate(i.getPosition()[1],0,s,a);var p=Math.atan2(u.y-l.y,u.x-l.x)*f.MathConstants.rad2Deg;l=y.GeometryUtils.latLngToScreenCoordinate(i.getPosition()[0],0,n,a),u=y.GeometryUtils.latLngToScreenCoordinate(i.getPosition()[1],0,n,a);var d=Math.atan2(u.y-l.y,u.x-l.x)*f.MathConstants.rad2Deg-p,m=new h.Vector2(o[0].x,o[0].y),v=new h.Vector2(o[o.length-1].x,o[o.length-1].y),_=new h.Vector2(v.x-m.x,-v.y+m.y),b=(n.getBearing()-d)*f.MathConstants.deg2Rad,w=new h.Vector2(Math.cos(b),Math.sin(b)),x=_.dot(w)<0;i.setReverse(x)}return r},e.prototype.queryFeature=function(t){var e=null;if(null!=this.renderDatas&&this.renderDatas.length>0){var r=this.renderDatas.get(t);if(null!=r){var i=r.getLayerProperties();e=new w.PlaceQueryResult(0,""+i.getOsmId(),i.getName(),"",i.getPosition()[0],"place")}}return e},e}(a.Layer);e.LabelLayer=x},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=r(7),s=r(99),l=function(t){function e(e,r,i){return t.call(this,e,r,o.LayerType.IMAGE_OVERLAY,i)||this}return n(e,t),e.prototype.init=function(t,e){var r=a.MapResourceManager.getInstance(t);this.texture=r.getTexture(e),this.texture||(this.texture=r.createImageOverlayTexture(e)),this.texture&&this.texture.retain()},e.prototype.update=function(t){this.outOfScreen=!0;for(var e=this.mapView.tileManager.getVisibleTiles(),r=0;r<e.length;++r){var i=e[r].getTileCoordinate(),n=i.getZoom(),o=this.properties.getBounds();if(s.TileRange.fromLatLngBounds(o,n,n).contains(i)){this.outOfScreen=!1;break}}},e.prototype.getTexture=function(){return this.texture},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(t){this.properties=t},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.isOutOfScreen=function(){return this.outOfScreen},e.prototype.release=function(t,e){this.texture.release(),this.texture=null,a.MapResourceManager.getInstance(t).releaseTexture(e)},e}(o.Layer);e.ImageOverlayLayer=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=function(t){function e(e,r,i){return t.call(this,e,r,o.LayerType.SKY,i)||this}return n(e,t),e.prototype.update=function(t){},e}(o.Layer);e.SkyLayer=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(36),n=r(4),o=r(58),a=r(55),s=r(12),l=function(){function t(t){this.userLocationDotId=-1,this.userLocationDot=null,this.lastKnownLocation=null,this.myLocationZoom=17,this.animate=!1,this.defaultPositionOptions={enableHighAccuracy:!0,maximumAge:0,timeout:6e3},this.mapView=t}return t.prototype.updateMapUI=function(t){var e=this;null!=t&&(this.myLocationButton=i.DOMUtils.create("div","mf-button",t),this.myLocationButton.innerHTML="<a class='mf-location'></a>",this.myLocationButton.addEventListener("click",(function(){e.onMyLocationButtonClick()})))},t.prototype.moveToMyLocation=function(t){void 0===t&&(t=!0),location.protocol.startsWith("https")||location.host.startsWith("localhost")?(this.animate=t,window.navigator.geolocation.getCurrentPosition(this.onGetCurrentPositionSuccess.bind(this),this.onGetCurrentPositionError.bind(this),this.defaultPositionOptions)):alert("This feature is available only in secure contexts (HTTPS)")},t.prototype.onMyLocationButtonClick=function(){this.moveToMyLocation()},t.prototype.onGetCurrentPositionSuccess=function(t){var e=new n.LatLng(t.coords.latitude,t.coords.longitude);if(this.mapView.moveCamera({target:e,zoom:this.myLocationZoom},{animate:this.animate}),this.lastKnownLocation=e,null==this.userLocationDot){var r=new o.Icon(32,32,"myPosition");this.userLocationDot=new a.Marker({position:e,visible:!0,anchor:new s.Point(.5,.5),icon:r}),this.userLocationDotId=this.mapView.addAnnotation(this.userLocationDot)}else this.userLocationDot.setPosition(e),this.userLocationDot.setVisible(!0)},t.prototype.onGetCurrentPositionError=function(t){-1!=this.userLocationDotId&&(this.mapView.removeAnnotation(this.userLocationDotId),this.userLocationDotId=-1,this.userLocationDot=null)},t}();e.GeolocateControl=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r,i,n,o,a,s,l,u,h,c,p,f,d,g,y,m,v){var _=t.call(this)||this;return _.annotationId=-1,_._animationTime=0,_._position=n,_._anchor=o,_._title=e,_._snippet=r,_._windowAnchor=i,_._width=a,_._height=s,_._url=l,_._iconView=u,_._icon=h,_._rotation=p,_._elevation=c,_._markerLabel=f,_._labelAnchor=d,_._visible=g,_._draggable=y,_.clickable=m,_.textureDirty=!1,_._needUpdateIconView=!1,_.animation=v||null,_}return n(e,t),Object.defineProperty(e.prototype,"markerLabelDirty",{get:function(){return this._markerLabelDirty},enumerable:!0,configurable:!0}),e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){this._id=t},e.prototype.getTitle=function(){return this._title},e.prototype.setTitle=function(t){this._title=t},e.prototype.getSnippet=function(){return this._snippet},e.prototype.setSnippet=function(t){this._snippet=t},e.prototype.getWindowAnchor=function(){return this._windowAnchor},e.prototype.setWindowAnchor=function(t){this._windowAnchor=t},e.prototype.getPosition=function(){return this._position},e.prototype.setPosition=function(t){this._position=t},e.prototype.getAnchor=function(){return this._anchor},e.prototype.setAnchor=function(t){this._anchor=t},e.prototype.getWidth=function(){return this._width},e.prototype.setWidth=function(t){this._width=t},e.prototype.getHeight=function(){return this._height},e.prototype.setHeight=function(t){this._height=t},e.prototype.getLabelAnchor=function(){return this._labelAnchor},e.prototype.setLabelAnchor=function(t){this._labelAnchor=t},e.prototype.getMarkerLabel=function(){return this._markerLabel},e.prototype.setMarkerLabel=function(t){this._markerLabel=t,this._markerLabelDirty=!0},e.prototype.setMarkerLabelDirty=function(t){this._markerLabelDirty=t},e.prototype.getUrl=function(){return this._url},e.prototype.setUrl=function(t){this._url=t},e.prototype.getIconView=function(){return this._iconView},e.prototype.setIconView=function(t){this._needUpdateIconView=!0,this._iconView=t},e.prototype.getIcon=function(){return this._icon},e.prototype.setIcon=function(t){this._icon=t},e.prototype.getRotation=function(){return this._rotation},e.prototype.setRotation=function(t){this._rotation=t},e.prototype.getElevation=function(){return this._elevation},e.prototype.setElevation=function(t){this._elevation=t},e.prototype.isVisible=function(){return this._visible},e.prototype.setVisible=function(t){this._visible=t},e.prototype.isDraggable=function(){return this._draggable},e.prototype.setDraggable=function(t){this._draggable=t},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e.prototype.isTextureDirty=function(){return this.textureDirty},e.prototype.setTextureDirty=function(t){this.textureDirty=t},e.prototype.getInfoWindow=function(){return this.infoWindow},e.prototype.setInfoWindow=function(t){this.infoWindow=t},e.prototype.getInfoContents=function(){return this.infoContents},e.prototype.setInfoContents=function(t){this.infoContents=t},Object.defineProperty(e.prototype,"needUpdateIconView",{get:function(){return this._needUpdateIconView},set:function(t){this._needUpdateIconView=t},enumerable:!0,configurable:!0}),e.prototype.getAnimation=function(){return this.animation},e.prototype.setAnimation=function(t){this.animation!=t&&(this.animation=t,this._animationTime=0)},e}(r(23).LayerProperties);e.SymbolLayerProperties=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(12),n=r(20),o=r(1),a=r(37),s=r(5),l=r(49),u=r(50),h=r(71),c=function(){function t(t,e,r){this._id=t,this._eventOptions=e,this._eventCallback=r}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventCallBack",{get:function(){return this._eventCallback},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventOptions",{get:function(){return this._eventOptions},set:function(t){this._eventOptions=t},enumerable:!0,configurable:!0}),t}(),p=function(){function t(t){this.eventIdCounter=0,this.mouseOverItem=null,this.events=new Map,this.geoJsonEvents=new Map,this.mapView=t}return t.convertEventFromName=function(t){switch(t){case"cameraWillChange":return a.MapEvent.cameraWillChange;case"cameraChanging":return a.MapEvent.cameraChanging;case"idle":return a.MapEvent.idle;case"click":return a.MapEvent.click;case"dblClick":return a.MapEvent.dblClick;case"drag":return a.MapEvent.drag;case"dragEnd":return a.MapEvent.dragEnd;case"dragStart":return a.MapEvent.dragStart;case"mouseMove":return a.MapEvent.mouseMove;case"mouseOut":return a.MapEvent.mouseOut;case"mouseOver":return a.MapEvent.mouseOver;case"rightClick":return a.MapEvent.rightClick;case"modeChanged":return a.MapEvent.modeChanged;case"longClick":return a.MapEvent.longClick;case"hover":return a.MapEvent.hover;case"tilesLoaded":return a.MapEvent.tilesLoaded;case"boundsChanged":return a.MapEvent.boundsChanged;case"limitedZoom":return a.MapEvent.limitedZoom;case"targetChanged":return a.MapEvent.targetChanged;case"zoomChanged":return a.MapEvent.zoomChanged;case"tiltChanged":return a.MapEvent.tiltChanged;case"bearingChanged":return a.MapEvent.bearingChanged;default:throw new Error("Event not supported: "+t)}},t.prototype.addGeoJsonListener=function(e,r){var i="string"==typeof e?t.convertEventFromName(e):e,n=this.eventIdCounter++,o=new c(n,{},r);this.geoJsonEvents.has(i)?this.geoJsonEvents.get(i).push(o):this.geoJsonEvents.set(i,[o]);var a=this.geoJsonEvents;return new(function(){function t(){}return t.prototype.remove=function(){if(a.has(i)){var t=a.get(i),e=t.findIndex((function(t){return t.id==n}));e>=0&&t.splice(e,1),0===t.length&&a.delete(i)}},t.prototype.updateEventOptions=function(t){},t}())},t.prototype.addEvent=function(e,r,i){var n="string"==typeof e?t.convertEventFromName(e):e,a={};o.MapUtils.extendOptions(a,t.defaultEventOptions,i),a.marker||a.polygon||a.polyline||a.directions||a.circle||a.location||a.poi||a.mappoi||a.building||a.mapbuilding||a.place||(a.location=!0);var s=this.eventIdCounter++,l=new c(s,a,r);this.events.has(n)?this.events.get(n).push(l):this.events.set(n,[l]);var u=this.events;return new(function(){function e(){}return e.prototype.remove=function(){if(u.has(n)){var t=u.get(n),e=t.findIndex((function(t){return t.id==s}));e>=0&&t.splice(e,1),0===t.length&&u.delete(n)}},e.prototype.updateEventOptions=function(e){var r={};o.MapUtils.extendOptions(r,t.defaultEventOptions,e),r.marker||r.polygon||r.polyline||r.directions||r.circle||r.location||r.poi||r.mappoi||r.building||r.mapbuilding||r.place||(r.location=!0),l.eventOptions=r},e}())},t.prototype.onHoverEvent=function(t,e){return this.onEvent(t,e,a.MapEvent.hover)},t.prototype.onMouseOutEvent=function(t,e){var r=this.events.get(a.MapEvent.mouseOut);if(null!=r&&0!=r.length&&null!=this.mouseOverItem){if(!s.Map4dObject.isClassType(this.mouseOverItem,s.ClassType.MARKER)){var n=s.Map4dObject.isClassType(this.mouseOverItem,s.ClassType.POI),h=this.mapView.getCollision2DManager().query(t);if(null!=h){var c=n?this.mouseOverItem.getProperties().getId():this.mouseOverItem.placeId;if(h.id==c)return}var p=n?(r||[]).filter((function(t){return t.eventOptions.poi})):(r||[]).filter((function(t){return t.eventOptions.mappoi}));if(p&&0!=p.length){var f=this.mapView.screenCoordinateToLatLng(t),d=(M=new i.Point(t.x,t.y),o.MapUtils.pixelToPoint(M)),g=this.mouseOverItem,y=n?this.mouseOverItem:{id:g.placeId,name:g.name,location:g.location,type:g.type};p.forEach((function(t){return t.eventCallBack({poi:y,pixel:d,xa:e,location:f})}))}return this.mouseOverItem=null,!0}var m=this.mouseOverItem,v=m.getProperties(),_=!1,b=new u.Box(new i.Point(t.x-o.MapUtils.touchBoxSize/2,t.y-o.MapUtils.touchBoxSize/2),new i.Point(t.x+o.MapUtils.touchBoxSize/2,t.y+o.MapUtils.touchBoxSize/2));if(m.getIconView()?_=!this.mapView.annotationManager.checkCollisionIconViewMarker(b,m):l.CollisionUtils.boxIntersectsSymbol(b,m.getPosition(),m.getElevation(),v.getWidth(),v.getHeight(),m.getAnchor(),this.mapView.mapState)||(_=!0),_){var w=(r||[]).filter((function(t){return t.eventOptions.marker}));if(w&&0!=w.length){var x=this.mapView.screenCoordinateToLatLng(t),M=new i.Point(t.x,t.y),T=o.MapUtils.pixelToPoint(M);w.forEach((function(t){return t.eventCallBack({marker:m,pixel:T,xa:e,location:x})}))}return this.mouseOverItem=null,!0}return!1}},t.prototype.onClickEvent=function(t,e){return this.onEvent(t,e,a.MapEvent.click)},t.prototype.onLongClickEvent=function(t,e){return this.onEvent(t,e,a.MapEvent.longClick)},t.prototype.onRightClickEvent=function(t,e){return this.onEvent(t,e,a.MapEvent.rightClick)},t.prototype.onDoubleClickEvent=function(t,e){return this.onEvent(t,e,a.MapEvent.dblClick)},t.prototype.onDragEvent=function(t,e,r){if(t==a.MapEvent.dragStart||t==a.MapEvent.drag||t==a.MapEvent.dragEnd){var n=this.events.get(t)||[];if(0!=n.length){var l={};if(s.Map4dObject.isClassType(r,s.ClassType.BUILDING)?(n=n.filter((function(t){return t.eventOptions.building})),l.building=r):s.Map4dObject.isClassType(r,s.ClassType.POI)?(n=n.filter((function(t){return t.eventOptions.poi})),l.poi=r):s.Map4dObject.isClassType(r,s.ClassType.MARKER)?(n=n.filter((function(t){return t.eventOptions.marker})),l.marker=r):s.Map4dObject.isClassType(r,s.ClassType.POLYLINE)?(n=n.filter((function(t){return t.eventOptions.polyline})),l.polyline=r):s.Map4dObject.isClassType(r,s.ClassType.POLYGON)?(n=n.filter((function(t){return t.eventOptions.polygon})),l.polygon=r):s.Map4dObject.isClassType(r,s.ClassType.CIRCLE)&&(n=n.filter((function(t){return t.eventOptions.circle})),l.circle=r),0!=n.length){var u=this.mapView.getCurrentMousePosition(e),h=new i.Point(u.x,u.y),c=o.MapUtils.pixelToPoint(h);l.location=this.mapView.screenCoordinateToLatLng(u),l.point=c,l.pixel=h,l.xa=e,n.forEach((function(t){return t.eventCallBack(l)}))}}}else console.error("Invalid event")},t.prototype.queryBuildingAndAnnotation=function(t,e,r,i,n,o){var l=this.mapView.queryBuildingAndAnnotation(e);if(s.Map4dObject.isClassType(l,s.ClassType.MARKER)){var u=l;if(i==a.MapEvent.click&&this.mapView.showInfoWindow(u.getId()),i==a.MapEvent.hover&&this.mouseOverItem==u)return;if(this.mouseOverItem=u,!this.mapView.directionsRendererManager.isDirectionsRendererMarker(u.getId())){var h=(t||[]).filter((function(t){return t.eventOptions.marker}));h&&0!=h.length&&u.getMap()&&h.forEach((function(t){return t.eventCallBack({marker:u,pixel:o,xa:r,location:n})}))}}else if(s.Map4dObject.isClassType(l,s.ClassType.POLYLINE)){var c=l,p=this.mapView.directionsRendererManager.getDirectionsRendererByPolylineId(c.getId());if(p){var f=(t||[]).filter((function(t){return t.eventOptions.directions}));f&&0!=f.length&&f.forEach((function(t){t.eventCallBack({renderer:p.renderer,routeIndex:p.routeIndex,pixel:o,xa:r,location:n})}))}else{var d=(t||[]).filter((function(t){return t.eventOptions.polyline}));d&&0!=d.length&&d.forEach((function(t){return t.eventCallBack({polyline:c,pixel:o,xa:r,location:n})}))}}else if(s.Map4dObject.isClassType(l,s.ClassType.POLYGON)){var g=(t||[]).filter((function(t){return t.eventOptions.polygon}));g&&0!=g.length&&g.forEach((function(t){return t.eventCallBack({polygon:l,pixel:o,xa:r,location:n})}))}else if(s.Map4dObject.isClassType(l,s.ClassType.CIRCLE)){var y=(t||[]).filter((function(t){return t.eventOptions.circle}));y&&0!=y.length&&y.forEach((function(t){return t.eventCallBack({circle:l,pixel:o,xa:r,location:n})}))}else if(s.Map4dObject.isClassType(l,s.ClassType.BUILDING_QUERY_RESULT)){var m,v=l;if(0!=v.annotationId){if((m=(t||[]).filter((function(t){return t.eventOptions.building})))&&m.length>0){var _=this.mapView.annotationManager.getBuilding(v.annotationId);m.forEach((function(t){t.eventCallBack({building:_,pixel:o,xa:r,location:n})}))}}else(m=(t||[]).filter((function(t){return t.eventOptions.mapbuilding})))&&m.length>0&&m.forEach((function(t){t.eventCallBack({building:{id:v.id,name:v.name,location:v.location},pixel:o,xa:r,location:n})}))}return null!=l},t.prototype.queryPlace=function(t,e,r,i,n,o,s){if(s){var l=this.mapView.queryUserPOI(e);if(null!=l){if(i==a.MapEvent.hover&&this.mouseOverItem==l)return;return this.mouseOverItem=l,(c=(t||[]).filter((function(t){return t.eventOptions.poi})))&&c.forEach((function(t){return t.eventCallBack({poi:l,pixel:o,xa:r,location:n})})),!0}}else{var u=this.mapView.queryPOI(e);if(null!=u&&0==u.annotationId){if(i==a.MapEvent.hover&&this.mouseOverItem instanceof h.PlaceQueryResult&&this.mouseOverItem.placeId==u.placeId)return;var c;return this.mouseOverItem=u,(c=(t||[]).filter((function(t){return t.eventOptions.mappoi})))&&c.forEach((function(t){return t.eventCallBack({poi:{id:u.placeId,name:u.name,location:u.location,type:u.type},pixel:o,xa:r,location:n})})),!0}if(null!=(u=this.mapView.queryPlace(e))){var p=(t||[]).filter((function(t){return t.eventOptions.place}));return p&&p.forEach((function(t){return t.eventCallBack({place:{id:u.placeId,name:u.name,location:u.location,type:u.type},pixel:o,xa:r,location:n})})),!0}}return!1},t.prototype.queryGeoJsonFeature=function(t,e,r,i,n,o){var a=this.geoJsonEvents.get(i);if(a&&a.length>0){var s=this.mapView.getGeoJsonManager().queryFeature(e);if(s)return a.forEach((function(t){return t.eventCallBack({feature:s,pixel:o,xa:r,location:n})})),!0}return!1},t.prototype.onEvent=function(t,e,r){var n=this.events.get(r);if(r==a.MapEvent.click)this.mapView.hideInfoWindow();else if(null==n||0==n.length){var s=this.events.get(a.MapEvent.mouseOut);if(null==s||0==s.length)return!1}var u=this.mapView.getCurrentMousePosition(e),h=this.mapView.screenCoordinateToLatLng(u),c=new i.Point(u.x,u.y),p=o.MapUtils.pixelToPoint(c);l.CollisionUtils.createCollisionBox(t,o.MapUtils.pixelScale);return this.mapView.mapState.is3dMode()?this.queryPlace(n,t,e,r,h,p,!0)||this.queryBuildingAndAnnotation(n,t,e,r,h,p)||this.queryGeoJsonFeature(n,t,e,r,h,p):this.queryPlace(n,t,e,r,h,p,!0)||this.queryBuildingAndAnnotation(n,t,e,r,h,p)||this.queryGeoJsonFeature(n,t,e,r,h,p)||this.queryPlace(n,t,e,r,h,p,!1)},t.prototype.notify=function(t,e,r){var s=this,l=this.events.get(t);if(l&&Array.isArray(l)&&0!==l.length)switch(t){case a.MapEvent.hover:case a.MapEvent.click:case a.MapEvent.rightClick:case a.MapEvent.dblClick:case a.MapEvent.longClick:case a.MapEvent.dragStart:case a.MapEvent.drag:case a.MapEvent.dragEnd:case a.MapEvent.mouseMove:case a.MapEvent.mouseOut:case a.MapEvent.mouseOver:var u=(l||[]).filter((function(t){return t.eventOptions.location}));if(0==u.length)return;var h=this.mapView.getCurrentMousePosition(e),c=new i.Point(h.x,h.y),p=o.MapUtils.pixelToPoint(c);u.forEach((function(t){return t.eventCallBack({location:s.mapView.screenCoordinateToLatLng(h),pixel:p,xa:e})}));break;case a.MapEvent.cameraWillChange:var f=this.mapView.getCamera();l.filter((function(t){return t.eventOptions.location})).forEach((function(t){return t.eventCallBack({camera:new n.CameraPosition(f.getTarget(),f.getTilt(),f.getBearing(),f.getZoom()),gesture:r})}));break;case a.MapEvent.cameraChanging:case a.MapEvent.idle:var d=this.mapView.getCamera();l.filter((function(t){return t.eventOptions.location})).forEach((function(t){return t.eventCallBack({camera:new n.CameraPosition(d.getTarget(),d.getTilt(),d.getBearing(),d.getZoom())})}));break;case a.MapEvent.modeChanged:break;case a.MapEvent.tilesLoaded:case a.MapEvent.boundsChanged:l.filter((function(t){return t.eventOptions.location})).forEach((function(t){return t.eventCallBack()}));break;case a.MapEvent.limitedZoom:l.filter((function(t){return t.eventOptions.location})).forEach((function(t){return t.eventCallBack({zoom:s.mapView.getCamera().getZoom()})}));break;default:l.filter((function(t){return t.eventOptions.location})).forEach((function(t){return t.eventCallBack()}))}},t.prototype.destroy=function(){this.events.clear()},t.defaultEventOptions={marker:!1,polygon:!1,polyline:!1,circle:!1,poi:!1,building:!1,location:!1,mappoi:!1,mapbuilding:!1,place:!1,directions:!1},t}();e.MapsEventManager=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(201),n=r(203),o=r(3),a=r(2),s=r(74),l=r(204),u=function(){function t(t,e){this._particleSystems=[],this.mapState=e,this._liveMode=!1,this._weather=s.Weather.Sunny,this._particlePool=new l.ParticlePool;var r=new i.ParticleRain(t,this._particlePool);r.init(),this._particleSystems.push(r);var o=new n.ParticleSnow(t,this._particlePool);o.init(),this._particleSystems.push(o),this._lastTime=NaN}return t.prototype.setWeather=function(e){var r="string"==typeof e?t.convertWeatherFromName(e):e;r===this._weather||this._liveMode&&r===s.Weather.Live||(r==s.Weather.Live?(this._liveMode=!0,this._lastTimeGetLive=Date.now(),this._lastLocationGetLive=this.mapState.getTarget(),this.getLiveInfomation()):this._liveMode=!1,r<s.Weather.Sunny&&this._particleSystems[r].cleanup(),this._weather=r,this._lastTime=NaN)},t.prototype.setProvider=function(t){this.weatherProvider=t},t.prototype.setWeatherFromLive=function(t){t!=this._weather&&(t<s.Weather.Sunny&&this._particleSystems[t].cleanup(),this._weather=t,this._lastTime=NaN)},t.prototype.getWeather=function(){return this._weather},t.prototype.dirty=function(){return this.mapState.is3dMode()&&(this._liveMode||this.getWeather()!=s.Weather.None&&this.getWeather()!=s.Weather.Sunny&&this.getWeather()!=s.Weather.Cloudy)},t.prototype.getLiveInfomation=function(){var e=this;this.weatherProvider&&this.weatherProvider.getWeather&&this.weatherProvider.getWeather(this.mapState.getTarget(),(function(r){var i=s.Weather.None;i="string"==typeof r?t.convertWeatherFromName(r):r,e.setWeatherFromLive(i)}))},t.prototype.update=function(){if(this.dirty()){if(this._weather<s.Weather.Sunny){var t=Date.now(),e=isNaN(this._lastTime)?0:t-this._lastTime;this._lastTime=t,this._particleSystems[this._weather].update(e/1e3)}if(this._liveMode){t=Date.now();var r=this.mapState.getTarget(),i=r.distanceTo(this._lastLocationGetLive),n=(this.weatherProvider||{}).refreshDistance||a.WeatherConstants.refreshDistance,o=1e3*(this.weatherProvider||{}).refreshTime||a.WeatherConstants.refreshTime;(null==this._lastLocationGetLive||i>n||t-this._lastTimeGetLive>o)&&(this._lastLocationGetLive=r,this._lastTimeGetLive=t,this.getLiveInfomation())}}},t.prototype.render=function(t){this.dirty()&&this._weather<s.Weather.Sunny&&this._particleSystems[this._weather].render(t)},t.prototype.resize=function(t,e){for(var r=0;r<s.Weather.Sunny;++r){var i=0;r==s.Weather.Rainy&&(i=Math.abs(Math.tan(a.ParticleConstants.rainParticleRotation*a.MathConstants.deg2Rad))*e);var n=t+i;this._particleSystems[r].spawnRect={width:n,height:2},this._particleSystems[r].emitterPosition=new o.Vector2(t/2-i/2,0),this._particleSystems[r].lifetimeFunc=function(r){return r.position.y>e||r.position.x>t}}},t.convertWeatherFromName=function(t){switch(t){case"rainy":return s.Weather.Rainy;case"snowy":return s.Weather.Snowy;case"sunny":return s.Weather.Sunny;case"cloudy":return s.Weather.Cloudy;case"live":return s.Weather.Live;case"none":return s.Weather.None;default:return console.warn("Weather not supported: "+t),s.Weather.None}},t.prototype.destroy=function(){for(var t=0;t<s.Weather.Sunny;++t)this._particleSystems[t].destroy();for(;0!=this._particleSystems.length;)this._particleSystems.pop();this._particleSystems=null,this._particlePool.destroy(),this._particlePool=null},t}();e.WeatherManager=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(102),a=r(10),s=r(3),l=r(2),u=function(t){function e(e,r){var i=a.ResourceManager.getInstance(e),n=i.getShader(a.ShaderEnum.PARTICLE_SHADER),o=i.getTexture(a.TextureEnum.RAIN_TEXTURE);return t.call(this,e,n,o,r)||this}return n(e,t),e.prototype.init=function(){t.prototype.init.call(this,{frequency:l.ParticleConstants.rainFrequency,maxParticles:1e3,acceleration:new s.Vector2(0,1e3).rotateBy(l.ParticleConstants.rainParticleRotation),minSpeed:0,maxSpeed:1e3,minScale:.35,maxScale:.35,maxRotation:l.ParticleConstants.rainParticleRotation,minRotation:l.ParticleConstants.rainParticleRotation})},e}(o.ParticleSystemQuad);e.ParticleRain=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=function(){function t(t){this._particlePool=t,this._acceleration=null,this._frequency=1,this._maxParticles=1e3,this._minSpeed=0,this._maxSpeed=0,this._minScale=1,this._maxScale=1,this._minLifetime=0,this._maxLifetime=0,this._minRotation=0,this._maxRotation=0,this._minRotationSpeed=0,this._maxRotationSpeed=0,this._lifetimeFunc=null,this._extraData=null,this._updateFunc=null,this._emitterPosition=new i.Vector2(0,0),this._activeParticlesFirst=null,this._activeParticlesLast=null,this._spawnRect=null,this._spawnTimer=0,this._particleCount=0}return t.prototype.init=function(t){this.cleanup(),t.frequency&&(this._frequency=t.frequency),t.maxParticles&&(this._maxParticles=t.maxParticles>0?t.maxParticles:1e3);var e=t.acceleration;e&&(e.x||e.y)&&(this._acceleration=new i.Vector2(e.x,e.y)),t.minSpeed&&(this._minSpeed=t.minSpeed),t.maxSpeed&&(this._maxSpeed=t.maxSpeed),t.minScale&&(this._minScale=t.minScale),t.maxScale&&(this._maxScale=t.maxScale),t.maxRotation&&(this._maxRotation=t.maxRotation),t.minRotation&&(this._minRotation=t.minRotation),t.minRotationSpeed&&(this._minRotationSpeed=t.minRotationSpeed),t.maxRotationSpeed&&(this._maxRotationSpeed=t.maxRotationSpeed),t.minLifetime&&(this._minLifetime=t.minLifetime),t.maxLifetime&&(this._maxLifetime=t.maxLifetime),t.extraData&&(this._extraData=t.extraData),t.updateFunc&&(this._updateFunc=t.updateFunc),t.lifetimeFunc&&(this._lifetimeFunc=t.lifetimeFunc),t.spawnRect&&(this._spawnRect=t.spawnRect),this._spawnTimer=0},t.prototype.update=function(e){var r,n;for(r=this._activeParticlesFirst;r;r=n)n=r.next,r.update(e);for(this._spawnTimer-=e<0?0:e;this._spawnTimer<=0;)if(this._particleCount>=this._maxParticles)this._spawnTimer+=this._frequency;else{var o=void 0;o=this._lifetimeFunc?0:Math.random()*(this._maxLifetime-this._minLifetime)+this._minLifetime;var a=this._emitterPosition.x,s=this._emitterPosition.y,l=this._particlePool.acquire(this);if(l.acceleration=this._acceleration?new i.Vector2(this._acceleration.x,this._acceleration.y):null,l.scale=(this._maxScale-this._minScale)*Math.random()+this._minScale,l.maxLife=o,l.lifetimeFunc=this._lifetimeFunc,l.velocity=new i.Vector2(0,(this._maxSpeed-this._minSpeed)*Math.random()+this._minSpeed),l.rotation=(this._maxRotation-this._minRotation)*Math.random()+this._minRotation,l.rotationSpeed=(this._maxRotationSpeed-this._minRotationSpeed)*Math.random()+this._minRotationSpeed,l.extraData=t.deepClone(this._extraData),l.updateFunc=this._updateFunc,this._spawnRect&&this._spawnRect.width&&this._spawnRect.height){var u=Math.random()*this._spawnRect.width,h=Math.random()*this._spawnRect.height;l.position=new i.Vector2(a+u-this._spawnRect.width/2,s+h-this._spawnRect.height/2)}else l.position=new i.Vector2(a,s);l.init(),this._activeParticlesLast?(this._activeParticlesLast.next=l,l.prev=this._activeParticlesLast,this._activeParticlesLast=l):this._activeParticlesLast=this._activeParticlesFirst=l,++this._particleCount,this._spawnTimer+=this._frequency}},t.prototype.recycle=function(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t==this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),this._particlePool.release(t),--this._particleCount},t.prototype.cleanup=function(){var t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t);this._activeParticlesFirst=this._activeParticlesLast=null,this._particleCount=0},t.prototype.destroy=function(){this.cleanup(),this._particlePool=null,this._lifetimeFunc=null,this._spawnRect=null,this._extraData=null,this._updateFunc=null},Object.defineProperty(t.prototype,"particleCount",{get:function(){return this._particleCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emitterPosition",{set:function(t){this._emitterPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spawnRect",{set:function(t){this._spawnRect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeFunc",{set:function(t){this._lifetimeFunc=t},enumerable:!0,configurable:!0}),t.deepClone=function(t){var e={};for(var r in t)e[r]=t[r];return e},t}();e.ParticleSystem=n},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(102),a=r(10),s=r(3),l=r(2),u=function(t){function e(e,r){var i=a.ResourceManager.getInstance(e),n=i.getShader(a.ShaderEnum.PARTICLE_SHADER),o=i.getTexture(a.TextureEnum.SNOW_TEXTURE);return t.call(this,e,n,o,r)||this}return n(e,t),e.prototype.init=function(){t.prototype.init.call(this,{frequency:l.ParticleConstants.snowFrequency,maxParticles:1e3,acceleration:new s.Vector2(0,50),minSpeed:50,maxSpeed:200,minScale:.25,maxScale:.35,maxRotation:0,minRotation:0,minRotationSpeed:0,maxRotationSpeed:200,extraData:{counter:0},updateFunc:function(t,e){t.acceleration&&(t.velocity.y+=t.acceleration.y*e),0!==t.rotationSpeed&&(t.rotation+=t.rotationSpeed*e),t.extraData.counter+=4,t.position.x+=2*Math.cos(t.extraData.counter*l.MathConstants.deg2Rad),t.position.y+=t.velocity.y*e}})},e}(o.ParticleSystemQuad);e.ParticleSnow=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(205),n=function(){function t(){}return t.prototype.acquire=function(t){var e;return this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null,e.emitter=t):e=new i.Particle(t),e},t.prototype.release=function(t){t.prev=null,t.next=this._poolFirst,this._poolFirst=t},t.prototype.destroy=function(){for(var t,e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=null},t}();e.ParticlePool=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=function(){function t(t){this._emitter=t,this._position=new i.Vector2(0,0),this._scale=1,this._velocity=new i.Vector2(0,0),this._rotation=0,this._rotationSpeed=0,this._acceleration=null,this._extraData=null,this._updateFunc=null,this._maxLife=0,this._age=0}return t.prototype.update=function(t){if(this._age+=t,this._lifetimeFunc){if(this._lifetimeFunc(this))return void this.kill()}else if(this._age>=this._maxLife||this._age<0)return void this.kill();this._updateFunc?this._updateFunc(this,t):(this._acceleration&&(this._velocity.x+=this._acceleration.x*t,this._velocity.y+=this._acceleration.y*t),0!==this._rotationSpeed&&(this._rotation+=this._rotationSpeed*t),this._position.x+=this._velocity.x*t,this._position.y+=this._velocity.y*t)},t.prototype.init=function(){this._age=0,this._velocity=this._velocity.rotateBy(this._rotation)},t.prototype.destroy=function(){this._emitter=null,this._lifetimeFunc=null,this._extraData=null,this._updateFunc=null,this._next=null,this._prev=null},t.prototype.kill=function(){this._emitter.recycle(this)},Object.defineProperty(t.prototype,"emitter",{set:function(t){this._emitter=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(t){this._rotationSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLife",{set:function(t){this._maxLife=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lifetimeFunc",{set:function(t){this._lifetimeFunc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateFunc",{set:function(t){this._updateFunc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prev",{get:function(){return this._prev},set:function(t){this._prev=t},enumerable:!0,configurable:!0}),t}();e.Particle=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(207),n=r(208),o=r(30),a=r(13),s=r(11),l=function(){function t(t){this._lastUpdateTime=0,this._sunLight=new n.DirectionalLight(s.Color.fromHex("FFFFFF"),new o.Vector3(0,0,1)),this._timeEffectManager=t,this._oldTimeEffect=this._timeEffectManager.getTimeEffect()}return t.prototype.update=function(t){var e=(new Date).getTime();if(!(e-this._lastUpdateTime<6e4&&this._oldTimeEffect==this._timeEffectManager.getTimeEffect())){this._lastUpdateTime=e,this._oldTimeEffect=this._timeEffectManager.getTimeEffect();var r=i.getPosition(this._timeEffectManager.getTime(),t.lat,t.lng),n=-1*r.azimuth,s=a.MathUtils.clamp(Math.abs(r.altitude),Math.PI/6,Math.PI/2);this._sunLight.lightColor=this._timeEffectManager.getBuildingColor(),this._sunLight.lightPosition=new o.Vector3(Math.cos(s)*Math.sin(n),Math.cos(s)*Math.cos(n),Math.sin(s)),this._onLightPositionChanged&&this._onLightPositionChanged()}},t.prototype.setOnLightPositionChanged=function(t){this._onLightPositionChanged=t},Object.defineProperty(t.prototype,"sunLight",{get:function(){return this._sunLight},enumerable:!0,configurable:!0}),t}();e.LightingManager=l},function(t,e,r){!function(){"use strict";var e=Math.PI,r=Math.sin,i=Math.cos,n=Math.tan,o=Math.asin,a=Math.atan2,s=Math.acos,l=e/180;function u(t){return new Date(864e5*(t+.5-2440588))}function h(t){return function(t){return t.valueOf()/864e5-.5+2440588}(t)-2451545}var c=23.4397*l;function p(t,e){return a(r(t)*i(c)-n(e)*r(c),i(t))}function f(t,e){return o(r(e)*i(c)+i(e)*r(c)*r(t))}function d(t,e,o){return a(r(t),i(t)*r(e)-n(o)*i(e))}function g(t,e,n){return o(r(e)*r(n)+i(e)*i(n)*i(t))}function y(t,e){return l*(280.16+360.9856235*t)-e}function m(t){return l*(357.5291+.98560028*t)}function v(t){return t+l*(1.9148*r(t)+.02*r(2*t)+3e-4*r(3*t))+102.9372*l+e}function _(t){var e=v(m(t));return{dec:f(e,0),ra:p(e,0)}}var b={getPosition:function(t,e,r){var i=l*-r,n=l*e,o=h(t),a=_(o),s=y(o,i)-a.ra;return{azimuth:d(s,n,a.dec),altitude:g(s,n,a.dec)}}},w=b.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];b.addTime=function(t,e,r){w.push([t,e,r])};function x(t,r,i){return 9e-4+(t+r)/(2*e)+i}function M(t,e,i){return 2451545+t+.0053*r(e)-.0069*r(2*i)}function T(t,e,n,o,a,l,u){return M(x(function(t,e,n){return s((r(t)-r(e)*r(n))/(i(e)*i(n)))}(t,n,o),e,a),l,u)}function A(t){var e=l*(134.963+13.064993*t),n=l*(93.272+13.22935*t),o=l*(218.316+13.176396*t)+6.289*l*r(e),a=5.128*l*r(n),s=385001-20905*i(e);return{ra:p(o,a),dec:f(o,a),dist:s}}function L(t,e){return new Date(t.valueOf()+864e5*e/24)}b.getTimes=function(t,r,i){var n,o,a,s,c,p=l*-i,d=l*r,g=function(t,r){return Math.round(t-9e-4-r/(2*e))}(h(t),p),y=x(0,p,g),_=m(y),b=v(_),A=f(b,0),L=M(y,_,b),S={solarNoon:u(L),nadir:u(L-.5)};for(n=0,o=w.length;n<o;n+=1)c=L-((s=T((a=w[n])[0]*l,p,d,A,g,_,b))-L),S[a[1]]=u(c),S[a[2]]=u(s);return S},b.getMoonPosition=function(t,e,o){var s=l*-o,u=l*e,c=h(t),p=A(c),f=y(c,s)-p.ra,m=g(f,u,p.dec),v=a(r(f),n(u)*i(p.dec)-r(p.dec)*i(f));return m+=function(t){return t<0&&(t=0),2967e-7/Math.tan(t+.00312536/(t+.08901179))}(m),{azimuth:d(f,u,p.dec),altitude:m,distance:p.dist,parallacticAngle:v}},b.getMoonIllumination=function(t){var e=h(t||new Date),n=_(e),o=A(e),l=s(r(n.dec)*r(o.dec)+i(n.dec)*i(o.dec)*i(n.ra-o.ra)),u=a(149598e3*r(l),o.dist-149598e3*i(l)),c=a(i(n.dec)*r(n.ra-o.ra),r(n.dec)*i(o.dec)-i(n.dec)*r(o.dec)*i(n.ra-o.ra));return{fraction:(1+i(u))/2,phase:.5+.5*u*(c<0?-1:1)/Math.PI,angle:c}},b.getMoonTimes=function(t,e,r,i){var n=new Date(t);i?n.setUTCHours(0,0,0,0):n.setHours(0,0,0,0);for(var o,a,s,u,h,c,p,f,d,g,y,m,v,_=.133*l,w=b.getMoonPosition(n,e,r).altitude-_,x=1;x<=24&&(o=b.getMoonPosition(L(n,x),e,r).altitude-_,f=((h=(w+(a=b.getMoonPosition(L(n,x+1),e,r).altitude-_))/2-o)*(p=-(c=(a-w)/2)/(2*h))+c)*p+o,g=0,(d=c*c-4*h*o)>=0&&(y=p-(v=Math.sqrt(d)/(2*Math.abs(h))),m=p+v,Math.abs(y)<=1&&g++,Math.abs(m)<=1&&g++,y<-1&&(y=m)),1===g?w<0?s=x+y:u=x+y:2===g&&(s=x+(f<0?m:y),u=x+(f<0?y:m)),!s||!u);x+=2)w=a;var M={};return s&&(M.rise=L(n,s)),u&&(M.set=L(n,u)),s||u||(M[f>0?"alwaysUp":"alwaysDown"]=!0),M},t.exports=b}()},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r){var i=t.call(this,e)||this;return i._lightPosition=r,i}return n(e,t),Object.defineProperty(e.prototype,"lightPosition",{get:function(){return this._lightPosition},set:function(t){this._lightPosition=t},enumerable:!0,configurable:!0}),e}(r(209).Light);e.DirectionalLight=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._lightColor=t}return Object.defineProperty(t.prototype,"lightColor",{get:function(){return this._lightColor},set:function(t){this._lightColor=t},enumerable:!0,configurable:!0}),t}();e.Light=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(101),n=r(9),o=r(30),a=r(1),s=r(2),l=r(7),u=function(){function t(t,e,r){this._gl=t,this._directionalLight=e,this._mapState=r,this._lightProjectionMatrix=n.Matrix4.ortho(-10,10,-10,10,-10,20),this._lookAtMatrix=new n.Matrix4,this._lightViewProjectionMatrix=new n.Matrix4,this.resize(r.screenWidth,r.screenHeight)}return t.prototype.bind=function(){this._frameBuffer.bind(),this._gl.viewport(0,0,this._width,this._height),this._gl.clearColor(1,1,1,1),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT);var t=this._mapState.is3dMode()?s.MapConstants.mapBackgroundColor3D:l.MapResourceManager.getInstance(this._gl).clear2DColor;this._gl.clearColor(t.red,t.green,t.blue,1)},t.prototype.unbind=function(){this._frameBuffer.unbind(),this._gl.viewport(0,0,this._mapState.screenWidth,this._mapState.screenHeight)},t.prototype.clear=function(){this.bind(),this.unbind()},t.prototype.getLightViewProjectionMatrix=function(){return this._lightViewProjectionMatrix},t.prototype.getShadowMapTexture=function(){return this._frameBuffer.colorTexture},t.prototype.resize=function(t,e){this._width=1.5*t,this._height=1.5*e,this._frameBuffer&&this._frameBuffer.destroy(),this._frameBuffer=new i.FrameBuffer(this._gl,this._width,this._height),this.updateMatrices(),this.clear()},t.prototype.updateMatrices=function(){var t=a.MapUtils.getTileSize(),e=s.CameraConstants.height*Math.tan(s.CameraConstants.fov/2)*t/this._mapState.screenHeight/(t/2);this._lookAtMatrix.lookAt(this._directionalLight.lightPosition,new o.Vector3(0,0,0),1,new o.Vector3(0,1,0)),this._lightViewProjectionMatrix.setIdentity(e,e,e),this._lightViewProjectionMatrix.concat(this._lookAtMatrix),this._lightViewProjectionMatrix.concat(this._lightProjectionMatrix)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.renderDebug=function(){this._frameBuffer.drawDebug()},t.prototype.destroy=function(){this._frameBuffer.destroy(),this._frameBuffer=null,this._directionalLight=null,this._gl=null,this._mapState=null,this._lightViewProjectionMatrix=null,this._lightProjectionMatrix=null},t}();e.ShadowMap=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(75),n=r(2),o=r(11),a=function(){function t(t){this._timeArray=[n.TimeConstants.morningTime,n.TimeConstants.noonTime,n.TimeConstants.afterNoonTime,n.TimeConstants.eveningTime],this.defaultTimeByString="Noon",this.mapState=t,this._timeEffect=i.TimeEffect.Noon}return t.prototype.dirty=function(){return this.mapState.is3dMode()&&this._timeEffect==i.TimeEffect.Live},t.prototype.getTimeEffect=function(){return this._timeEffect},t.prototype.getTime=function(){return this._timeEffect==i.TimeEffect.Live||null==this._time?(new Date).getTime():this._time},t.prototype.setTimeEffect=function(e){var r="string"==typeof e?t.convertTimeEffectFromName(e):e;if(null!=r){if(this._timeEffect!=r){this._timeEffect=r;var o=new Date;switch(r){case i.TimeEffect.Live:this._time=null;break;case i.TimeEffect.Morning:this._time=o.setHours(n.TimeConstants.morningTime,0,0,0);break;case i.TimeEffect.Noon:case i.TimeEffect.None:this._time=o.setHours(n.TimeConstants.noonTime,0,0,0);break;case i.TimeEffect.AfterNoon:this._time=o.setHours(n.TimeConstants.afterNoonTime,0,0,0);break;case i.TimeEffect.Evening:this._time=o.setHours(n.TimeConstants.eveningTime,0,0,0)}}}else console.error("TimeEffect value is invalid, please set again !")},t.prototype.getSkyColor=function(){if(this._timeEffect==i.TimeEffect.None)return n.ColorConstants.getSkyColor(this.defaultTimeByString);var e=null,r=t.getStringByTimeEffect(this._timeEffect);switch(this._timeEffect){case i.TimeEffect.Live:e=this.getSkyColorByTime();break;case i.TimeEffect.Morning:case i.TimeEffect.AfterNoon:case i.TimeEffect.Evening:e=n.ColorConstants.getSkyColor(r);break;default:e=n.ColorConstants.getSkyColor(this.defaultTimeByString)}return e},t.prototype.getFogColor=function(){if(this._timeEffect==i.TimeEffect.None)return n.ColorConstants.getFogColor(this.defaultTimeByString);var e=null,r=t.getStringByTimeEffect(this._timeEffect);switch(this._timeEffect){case i.TimeEffect.Live:e=this.getFogColorByTime();break;case i.TimeEffect.Morning:case i.TimeEffect.Noon:case i.TimeEffect.AfterNoon:case i.TimeEffect.Evening:e=n.ColorConstants.getFogColor(r);break;default:e=n.ColorConstants.getFogColor(this.defaultTimeByString)}return e},t.prototype.getSkyColorByTime=function(){for(var e=new Date(this.getTime()).getHours(),r=null,a=0;a<this._timeArray.length-1;++a)if(e>this._timeArray[a]&&e<=this._timeArray[a+1]){r=o.Color.mix(n.ColorConstants.getSkyColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a)),n.ColorConstants.getSkyColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a+1)),(this._timeArray[a+1]-e)/(this._timeArray[a+1]-this._timeArray[a]));break}if(null==r&&e>n.TimeConstants.eveningTime||null==r&&e<=n.TimeConstants.morningTime){if(e>=n.TimeConstants.eveningTime||e<n.TimeConstants.morningTime-2)return n.ColorConstants.getSkyColor(t.getStringByTimeEffect(i.TimeEffect.Evening));var s=e;e<=n.TimeConstants.morningTime&&(s+=24),r=o.Color.mix(n.ColorConstants.getSkyColor("Morning"),n.ColorConstants.getSkyColor("Evening"),(s-n.TimeConstants.eveningTime)/(24-(n.TimeConstants.eveningTime-n.TimeConstants.morningTime)))}return r},t.prototype.getFogColorByTime=function(){for(var e=new Date(this.getTime()).getHours(),r=null,a=0;a<this._timeArray.length-1;++a)if(e>this._timeArray[a]&&e<=this._timeArray[a+1]){r=o.Color.mix(n.ColorConstants.getFogColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a)),n.ColorConstants.getFogColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a+1)),(this._timeArray[a+1]-e)/(this._timeArray[a+1]-this._timeArray[a]));break}if(null==r&&e>n.TimeConstants.eveningTime||null==r&&e<=n.TimeConstants.morningTime){if(e>=n.TimeConstants.eveningTime||e<n.TimeConstants.morningTime-2)return n.ColorConstants.getFogColor(t.getStringByTimeEffect(i.TimeEffect.Evening));var s=e;e<=n.TimeConstants.morningTime&&(s+=24),r=o.Color.mix(n.ColorConstants.getFogColor("Morning"),n.ColorConstants.getFogColor("Evening"),(s-n.TimeConstants.eveningTime)/(24-(n.TimeConstants.eveningTime-n.TimeConstants.morningTime)))}return r},t.getStringByTimeEffect=function(t){switch(t){case i.TimeEffect.Live:return"Live";case i.TimeEffect.Morning:return"Morning";case i.TimeEffect.Noon:return"Noon";case i.TimeEffect.AfterNoon:return"AfterNoon";case i.TimeEffect.Evening:return"Evening";default:return null}},t.convertTimeEffectFromName=function(t){switch(t){case"live":return i.TimeEffect.Live;case"morning":return i.TimeEffect.Morning;case"noon":return i.TimeEffect.Noon;case"afternoon":return i.TimeEffect.AfterNoon;case"evening":return i.TimeEffect.Evening;case"none":return i.TimeEffect.None;default:return console.warn("TimeEffect not supported: "+t),i.TimeEffect.None}},t.prototype.isEveningTime=function(){var t=new Date(this.getTime()).getHours();return t>=n.TimeConstants.eveningTime||t<n.TimeConstants.morningTime},t.prototype.getBuildingColor=function(){if(this._timeEffect==i.TimeEffect.None)return n.ColorConstants.getSkyColor(this.defaultTimeByString);var e=null,r=t.getStringByTimeEffect(this._timeEffect);switch(this._timeEffect){case i.TimeEffect.Live:e=this.getLightColorByTime();break;case i.TimeEffect.Morning:case i.TimeEffect.AfterNoon:case i.TimeEffect.Evening:e=n.ColorConstants.getLightColor(r);break;default:e=n.ColorConstants.getLightColor(this.defaultTimeByString)}return e},t.prototype.getLightColorByTime=function(){for(var e=new Date(this.getTime()).getHours(),r=null,a=0;a<this._timeArray.length-1;++a)if(e>this._timeArray[a]&&e<=this._timeArray[a+1]){r=o.Color.mix(n.ColorConstants.getLightColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a)),n.ColorConstants.getLightColor(t.getStringByTimeEffect(i.TimeEffect.Morning+a+1)),(this._timeArray[a+1]-e)/(this._timeArray[a+1]-this._timeArray[a]));break}if(null==r&&e>n.TimeConstants.eveningTime||null==r&&e<=n.TimeConstants.morningTime){if(e>=n.TimeConstants.eveningTime||e<n.TimeConstants.morningTime-2)return n.ColorConstants.getLightColor(t.getStringByTimeEffect(i.TimeEffect.Evening));var s=e;e<=n.TimeConstants.morningTime&&(s+=24),r=o.Color.mix(n.ColorConstants.getSkyColor("Morning"),n.ColorConstants.getSkyColor("Evening"),(s-n.TimeConstants.eveningTime)/(24-(n.TimeConstants.eveningTime-n.TimeConstants.morningTime)))}return r},t}();e.TimeEffectManager=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}return t.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},t.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,i=e?this._queue.concat(e):this._queue;r<i.length;r++){var n=i[r];if(n.id===t)return void(n.cancelled=!0)}},t.prototype.run=function(){this._currentlyRunning&&console.log("Task is currently running");var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,r=t;e<r.length;e++){var i=r[e];if(!i.cancelled&&(i.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},t.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]},t}();e.TaskQueue=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(214),a=r(9),s=function(t){function e(){var e=t.call(this)||this;return e.viewMatrix=new a.Matrix4,e}return n(e,t),e.prototype.getViewMatrix=function(){return this.viewMatrix},e.prototype.updateMatrices=function(t){this.viewMatrix.setIdentity(),this.viewMatrix.translate(0,1-2*t.getSkyRatio(),-1),this.mvpMatrix.copy(this.viewMatrix),this.mvpMatrix.concat(t.getProjectionMatrix())},e.prototype.destroy=function(){},e}(o.Object3D);e.SkyObject=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),a=function(t){function e(){var e=t.call(this)||this;return e.mvpMatrix=new o.Matrix4,e.modelMatrix=new o.Matrix4,e}return n(e,t),e.prototype.setModel=function(t){this.model=t},e.prototype.setTexture=function(t){this.texture=t},e.prototype.getModel=function(){return this.model},e.prototype.getTexture=function(){return this.texture},e.prototype.hasTexture=function(){return null!=this.texture},e.prototype.getModelMatrix=function(){return this.modelMatrix},e.prototype.getMvpMatrix=function(){return this.mvpMatrix},e}(r(64).ResourceReference);e.Object3D=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this._shadowMap=t,this.mapState=e,this._enableShadowEffect=!1,this._enableWaterEffect=!1}return Object.defineProperty(t.prototype,"enableWaterEffect",{get:function(){return this._enableWaterEffect},set:function(t){this._enableWaterEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableShadowEffect",{get:function(){return this._enableShadowEffect},set:function(t){this._enableShadowEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMap",{get:function(){return this._shadowMap},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e){this._shadowMap.resize(t,e)},t.prototype.dirty=function(){return this.mapState.is3dMode()&&this.enableWaterEffect},t.prototype.destroy=function(){this._shadowMap.destroy(),this._shadowMap=null},t}();e.EffectManager=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(104),n=r(82),o=r(217),a=r(0),s=r(2),l=r(81),u=r(60),h=r(218),c=r(25),p=r(62),f=r(59),d=r(4),g=r(15),y=r(80),m=r(3),v=r(8),_=r(6),b=r(12),w=r(49),x=r(1),M=r(76),T=r(86),A=r(50),L=r(103),S=r(5),E=function(){function t(t,e,r,i){this._id=t,this._coordinate=e,this._properties=r,this._order=i,this._minX=e.lng,this._minY=e.lat,this._maxX=e.lng,this._maxY=e.lat}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordinate",{get:function(){return this._coordinate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"order",{get:function(){return this._order},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),t}(),P=function(){function t(t){this.pointTree=n(),this.tiles=new Map,this.features=new o,this.mapView=t,this.dirty=!1}return t.prototype.update=function(){var t=this;this.dirty&&(this.tiles.forEach((function(e){var r=t.getTileData(e.getTileCoordinate());t.updateRenderTile(r,e),e.setData(r)})),this.dirty=!1)},t.prototype.addFeature=function(t){var e=S.Map4dObject.isClassType(t,S.ClassType.FEATURE)?t:new M.Data.Feature(t.id,t.geometry,t.properties),r=e.getId();return this.features.push("string"==typeof r?r:r.toString(),e),this.reloadIndexer(),e},t.prototype.removeFeature=function(t){if(null!=t){var e=t.getId();e&&this.features.remove("string"==typeof e?e:e.toString())&&this.reloadIndexer()}},t.prototype.removeAllFeatures=function(){this.features.clear(),this.reloadIndexer()},t.prototype.addGeoJson=function(t){var e=this,r=[];return JSON.parse(t).features.forEach((function(t){var i=[],n=[],o=t.geometry.type,a=null;if("Point"===o){var s=t.geometry.coordinates;a=new M.Data.Point(s)}else if("MultiPoint"===o){var l=t.geometry.coordinates,u=[];l.forEach((function(t){u.push(d.LatLng.convert(t))})),a=new M.Data.MultiPoint(u)}else if("Polygon"===o){for(var h=t.geometry.coordinates,c=[],p=0;p<h.length;++p){h[p].forEach((function(t){i.push(d.LatLng.convert(t))})),c.push(i),i=[]}L.Polygon.normalizePaths(c);for(p=0;p<c.length;++p)n.push(new M.Data.LinearRing(c[p]));a=new M.Data.Polygon(n)}else if("MultiPolygon"===o){var f=[];t.geometry.coordinates.forEach((function(t){for(var e=[],r=[],i=function(e){var i=t[e],n=[];i.forEach((function(t){n.push(d.LatLng.convert(t))})),r.push(n)},n=0;n<t.length;++n)i(n);L.Polygon.normalizePaths(r);for(n=0;n<r.length;++n)e.push(new M.Data.LinearRing(r[n]));f.push(new M.Data.Polygon(e))})),a=new M.Data.MultiPolygon(f)}else if("LineString"===o)t.geometry.coordinates.forEach((function(t){i.push(d.LatLng.convert(t))})),a=new M.Data.LineString(i);else{if("MultiLineString"!==o)return void console.warn("Geometry type not supported: "+o);var g=[];t.geometry.coordinates.forEach((function(t){var e=[];t.forEach((function(t){e.push(d.LatLng.convert(t))})),g.push(new M.Data.LineString(e))})),a=new M.Data.MultiLineString(g)}var m=t.id?"string"==typeof t.id?t.id:t.id.toString():y.UUID.generate();if(e.features.get(m))console.warn("Feature id already exist! This feature will be ignored: "+m);else{var v=new M.Data.Feature(m,a,t.properties);e.features.push(m,v),r.push(v)}})),this.reloadIndexer(),r},t.prototype.addTile=function(t){var e=t.getTileCoordinate(),r=this.getTileData(e);this.updateRenderTile(r,t),t.setData(r),this.tiles.set(e.toString(),t)},t.prototype.removeTile=function(t){var e=this,r=this.tiles.get(t.toString());if(r){var i=r.getGeometryTileData();if(null!=i){var n=i.getLayerIds(),o=r.getTileCoordinate().toString();n.forEach((function(t){var r=e.mapView.getLayer(t);null!=r&&(r.getLayerType()==a.LayerType.GEOJSON&&r.removeRenderTile(o))}))}r.destroy(),this.tiles.delete(r.getTileCoordinate().toString())}},t.prototype.removeAllTiles=function(){var t=this;Array.from(this.tiles.values()).forEach((function(e){return t.removeTile(e.tileCoordinate)}))},t.prototype.queryFeature=function(t){var e=this.mapView.mapState,r=v.GeometryUtils.screenCoordinateToLatLng(t,e.cameraPosition,e.getScreenSize());if(!r.valid())return null;var i=new A.Box(new b.Point(t.x-x.MapUtils.touchBoxSize/2,t.y-x.MapUtils.touchBoxSize/2),new b.Point(t.x+x.MapUtils.touchBoxSize/2,t.y+x.MapUtils.touchBoxSize/2)),n=e.getZoom(),o=u.TileCoordinate.fromLatLng(r,Math.floor(n),e.is3dMode()),a=1,l=e.getMaxNativeZoom();n>l?(o=u.TileCoordinate.fromLatLng(r,e.getMaxNativeZoom(),e.is3dMode()),a=Math.pow(2,Math.round(n)-l)):a=Math.pow(2,n-Math.floor(n));var h=this.querySymbols(t);if(this.tiles.has(o.toString())){for(var c=0;c<h.length;++c){var p=h[c],f=s.MapConstants.pointGeoJsonAnchor,d=f[0],g=f[1];if(w.CollisionUtils.boxIntersectsSymbol(i,p.coordinate,0,s.MapConstants.pointGeoJsonWidth,s.MapConstants.pointGeoJsonHeight,new b.Point(d,g),e))return this.features.get(p.id)}var y=this.tiles.get(o.toString()).getGeometryTileData();if(null==y||0==y.getLayerIds().length)return null;var M=e.scale,T=o.getX(),L=o.getY(),S=v.GeometryUtils.screenCoordinateToLatLng(new m.Vector2(i.min.x,i.min.y),e.cameraPosition,e.getScreenSize()),E=v.GeometryUtils.screenCoordinateToLatLng(new m.Vector2(i.max.x,i.max.y),e.cameraPosition,e.getScreenSize()),P=v.GeometryUtils.pixelCoordinateToVectorTileCoordinate(_.ProjectionMercator.projectScale(S,M),T,L,a),C=v.GeometryUtils.pixelCoordinateToVectorTileCoordinate(_.ProjectionMercator.projectScale(E,M),T,L,a),I=this.queryShapeAnnotationInternal(P,C,y);if(I)return I}return null},t.prototype.querySymbols=function(t){var e=this,r=[];if(null==t)return r;var i=new A.Box(new b.Point(t.x-x.MapUtils.getTileSize()/2,t.y-x.MapUtils.getTileSize()/2),new b.Point(t.x+x.MapUtils.getTileSize()/2,t.y+x.MapUtils.getTileSize()/2));return this.tiles.forEach((function(t){var n=t.getTileCoordinate(),o=v.GeometryUtils.tileCoordinateToLatLngBounds(n),a=e.mapView.latLngToScreenCoordinate(o.getSouthwest()),s=e.mapView.latLngToScreenCoordinate(o.getNortheast()),l=new A.Box(new b.Point(a.x,s.y),new b.Point(s.x,a.y));if(w.CollisionUtils.boxIntersectsBox(l,i)){var u={minX:o.getSouthwest().lng,minY:o.getSouthwest().lat,maxX:o.getNortheast().lng,maxY:o.getNortheast().lat};e.pointTree.search(u).forEach((function(t){r.push(t)}))}})),r.length>0&&r.sort((function(t,e){return e.order-t.order})),r},t.prototype.queryShapeAnnotationInternal=function(t,e,r){var i=x.MapUtils.getTileSize(),n=r.getLayerIds();n.sort();for(var o=r.getLayerIds().length,a=this.mapView.mapState,s=[new b.Point(t.x,e.y),new b.Point(e.x,e.y),new b.Point(e.x,t.y),new b.Point(t.x,t.y)],l=0;l<o;++l)for(var u=n[l],h=r.getLayer(u),c=function(t){var e=h.getFeature(t),r=e.getType();if(!S.Map4dObject.isClassType(e,S.ClassType.VECTOR_TILE_FEATURE)||r==g.GeometryType.Point||r==g.GeometryType.Unknown)return"continue";var n=e,o=n.getGeometries().geometryCoordinates;if(null==p.mapView.getLayer(u))return console.error("There is problem while querying shape annotation"),{value:null};if(r==g.GeometryType.LineString){var l=(e.properties.get("stroke-width")||T.LineLayerRenderData.defaultStrokeWidth)*x.MapUtils.pixelScale/2;a.getZoom()>a.getMaxNativeZoom()&&(l/=Math.pow(2,Math.round(a.getZoom())-a.getMaxNativeZoom()));var c=[];if(o.forEach((function(t){var e=[];t.forEach((function(t){return e.push(new b.Point(t[0],t[1]))})),c.push(e)})),l*=x.MapUtils.pixelScale,w.CollisionUtils.polygonIntersectsBufferedMultiLine(s,c,l/i))return{value:p.features.get(n.getId())}}else if(r==g.GeometryType.Polygon){for(var f=!1,d=function(t){var e=o[t],r=[];if(e.forEach((function(t){return r.push(new b.Point(t[0],t[1]))})),0==t){if(!(f=w.CollisionUtils.polygonIntersectsPolygon(s,r)))return"break"}else if(w.CollisionUtils.polygonIntersectsPolygon(s,r)&&!w.CollisionUtils.polygonIntersectsBufferedMultiLine(s,[r],0))return f=!1,"break"},y=0;y<o.length;++y){if("break"===d(y))break}if(f)return{value:p.features.get(n.getId())}}},p=this,f=h.featureCount()-1;f>=0;--f){var d=c(f);if("object"==typeof d)return d.value}return null},t.prototype.updateRenderTile=function(t,e){var r=this;if(null!=t){var i=e.getTileCoordinate(),n=i.toString();t.getLayerIds().forEach((function(t){var o=r.mapView.getLayer(t);if(null!=o){var s=o.getLayerType(),l=new p.RenderTile(f.UnwrappedTileCoordinate.createWithXYZoom(i.getX(),i.getY(),i.getZoom()),e);if(s==a.LayerType.GEOJSON)o.addRenderTile(n,l)}}))}},t.prototype.reloadIndexer=function(){var t=this,e={type:"FeatureCollection",features:[]};this.pointTree.clear();var r=0;this.features.each((function(i,n){var o=n.getGeometry().getType(),a=n.getProperties(),s=[],l=!1,u=[];if("Point"===o){var h=n.getGeometry();t.pointTree.insert(new E(i,h.get(),a,r++))}else if("MultiPoint"===o){n.getGeometry().forEachLatLng((function(e){t.pointTree.insert(new E(i,e,a,r++))}))}else if("Polygon"===o){for(var c=n.getGeometry(),p=function(t){var e=[];c.getAt(t).elements.forEach((function(t){return e.push([t.lng,t.lat])})),s.push(e)},f=0;f<c.getLength();++f)p(f);(null==a||!a["stroke-width"]||a["stroke-width"]>0)&&(l=!0,u=s),t.addPolygonDataFeature(e,n,s)}else if("MultiPolygon"===o){var d=n.getGeometry(),g=d.getLength();(null==a||!a["stroke-width"]||a["stroke-width"]>0)&&(l=!0);for(f=0;f<g;++f){for(var y=[],m=(c=d.getAt(f),function(t){var e=[];c.getAt(t).elements.forEach((function(t){return e.push([t.lng,t.lat])})),y.push(e)}),v=0;v<c.getLength();++v)m(v);l&&y.forEach((function(t){return u.push(t)})),t.addPolygonDataFeature(e,n,y)}}else if("LineString"===o)n.getGeometry().forEachLatLng((function(t){s.push([t.lng,t.lat])}));else{if("MultiLineString"!==o)throw new Error("Not reachable");var _=n.getGeometry(),b=(g=_.getLength(),function(t){var e=[];_.getAt(t).forEachLatLng((function(t){e.push([t.lng,t.lat])})),s.push(e)});for(f=0;f<g;++f)b(f)}if("MultiPolygon"!==o&&"Point"!==o&&"Polygon"!=o){var w={type:"Feature",id:n.getId(),properties:a,geometry:{type:o,coordinates:s}};e.features.push(w)}if(l){var x="#555555",M=1;a&&(x=a.stroke||"#555555",M=a["stroke-opacity"]?a["stroke-opacity"]:1);for(f=0;f<u.length;++f){var T=u[f],A={type:"Feature",id:n.getId(),properties:{"fill-outlined":!0,stroke:x,"stroke-opacity":M},geometry:{type:"LineString",coordinates:T}};e.features.push(A)}}}));var n={maxZoom:Math.max(s.MapConstants.geoJsonMinNativeZoom,this.mapView.getMaxNativeZoom()),buffer:0,extent:s.MapConstants.tileExtend,tolerance:6};this.geoJsonIndexer=i.default(e,n),this.dirty=!0,this.mapView.dirty=!0;var o=[];Array.from(this.tiles.values()).forEach((function(t){return o.push(new l.VectorTile(t.tileCoordinate,t.gl))})),this.removeAllTiles(),o.forEach((function(e){return t.addTile(e)}))},t.prototype.addPolygonDataFeature=function(t,e,r){var i=e.getProperties(),n=[],o=[],a=r.length>0?r[0]:[];n.push(a);var s=[];a.forEach((function(t){return s.push(new b.Point(t[0],t[1]))}));for(var l=function(t){var e=!1,i=r[t],a=[];i.forEach((function(t){return a.push(new b.Point(t[0],t[1]))})),w.CollisionUtils.polygonIntersectsPolygon(s,a)&&(e=!0),e?n.push(i):o.push(i)},u=1;u<r.length;++u)l(u);var h={type:"Feature",id:e.getId(),properties:i,geometry:{type:"Polygon",coordinates:n}};t.features.push(h),o.forEach((function(r){var n={type:"Feature",id:e.getId(),properties:i,geometry:{type:"Polygon",coordinates:[r]}};t.features.push(n)}))},t.prototype.getTileData=function(e){if(0==this.features.size())return null;var r=new h.VectorTileData,i=this.geoJsonIndexer.getTile(e.getZoom(),e.getX(),e.getY());null!=i&&null!=i.features&&i.features.forEach((function(e){var i=e.type,n=new c.GeometryCollection(e.geometry),o=new Map,a=e.tags;for(var s in a)o.set(s,a[s]);var l=r.addLayer(t.geoJsonLayerId);i===g.GeometryType.Polygon?l.addFeature(e.id,i,n,o):i===g.GeometryType.LineString&&(o.has("fill-outlined"),l.addFeature(e.id,i,n,o))}));var n=v.GeometryUtils.tileCoordinateToLatLngBounds(e),o={minX:n.getSouthwest().lng,minY:n.getSouthwest().lat,maxX:n.getNortheast().lng,maxY:n.getNortheast().lat},a=this.pointTree.search(o),s=r.addLayer(t.geoJsonLayerId);return a.sort((function(t,e){return t.order-e.order})),a.forEach((function(t){var e=new Map;e.set("coordinate-lat",t.coordinate.lat),e.set("coordinate-lng",t.coordinate.lng),s.addFeature(t.id,g.GeometryType.Point,null,e)})),r},t.geoJsonLayerId="3.maplink.geojson.layer",t}();e.GeoJsonManager=P},function(t,e,r){!function(e){"use strict";function r(t){this._map=t}function i(){throw new Error("Cannot write to an immutable view of LinkedMap")}function n(){this.clear()}["size","get","headKey","head","tailKey","tail","each","nextKey","next","previousKey","previous","keys","values","toObject","toString"].forEach((function(t){r.prototype[t]=function(){var e=Array.prototype.slice.apply(arguments);return this._map[t].apply(this._map,e)}})),["unshift","push","shift","pop","remove","clear"].forEach((function(t){r.prototype[t]=i})),r.prototype.immutableView=function(){return this},n.prototype._add=function(t,e){var r=this._map[t];return r?(r.value=e,null):(r={key:t,value:e,next:null,prev:null},this._map[t]=r,this._size++,r)},n.prototype.size=function(){return this._size},n.prototype.get=function(t){return(this._map[t]||{}).value||null},n.prototype.headKey=function(){return(this._head||{}).key||null},n.prototype.tailKey=function(){return(this._tail||this._head||{}).key||null},n.prototype.head=function(){return(this._head||{}).value||null},n.prototype.tail=function(){return(this._tail||this._head||{}).value||null},n.prototype.unshift=function(t,e){var r=this._add(t,e);r&&(this._head?this._tail?(r.next=this._head,this._head.prev=r,this._head=r):(this._tail=this._head,this._head=r,this._head.next=this._tail,this._tail.prev=this._head):this._head=r)},n.prototype.push=function(t,e){var r=this._add(t,e);r&&(this._head?this._tail?(this._tail.next=r,r.prev=this._tail,this._tail=r):(this._tail=r,this._tail.prev=this._head,this._head.next=this._tail):this._head=r)},n.prototype._remove=function(t){return t&&this._head?(delete this._map[t.key],this._size--,t===this._head?this._tail?this._head.next===this._tail?(this._head.next=this._tail.prev=null,this._head=this._tail,this._tail=null):(this._head=this._head.next,this._head.prev=null):this._head=null:t===this._tail?this._head.next==this._tail?this._tail.prev=this._head.next=this._tail=null:(this._tail=this._tail.prev,this._tail.next=null):(t.prev.next=t.next,t.next.prev=t.prev),t.next=t.prev=null,t.value):null},n.prototype.shift=function(){return this._remove(this._head)},n.prototype.pop=function(){return this._remove(this._tail||this._head)},n.prototype.remove=function(t){return this._remove(this._map[t])},n.prototype.each=function(t,e,r){"function"==typeof t&&(r=e,e=t,t=!1);for(var i=t&&this._tail||this._head;i&&!1!==e.call(r,i.key,i.value);)i=t?i.prev:i.next},n.prototype.nextKey=function(t,e){var r=this._map[t];return r?(r=r.next)?r.key:e&&this._head?this._head.key:null:null},n.prototype.next=function(t,e){return this.get(this.nextKey(t,e))},n.prototype.previousKey=function(t,e){var r=this._map[t];return r?(r=r.prev)?r.key:e&&(this._tail||this._head)?(this._tail||this._head).key:null:null},n.prototype.previous=function(t,e){return this.get(this.previousKey(t,e))},n.prototype.clear=function(){this._map={},this._size=0,this._head=null,this._tail=null},n.prototype.keys=function(){var t=[];return this.each((function(e){t.push(e)})),t},n.prototype.values=function(){var t=[];return this.each((function(e,r){t.push(r)})),t},n.prototype.immutableView=function(){return new r(this)},n.prototype.toObject=function(){var t={};return this.each((function(e,r){t[e]=r})),t},n.prototype.toString=function(){return"LinkedMap[size="+this.size()+"]"},void 0!==t.exports?t.exports=n:e.LinkedMap=n}(this)},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(219),a=r(5),s=function(t){function e(e,r,i,n){var o=t.call(this,a.ClassType.VECTOR_TILE_FEATURE,r,i,n)||this;return o.id=e,o}return n(e,t),e.prototype.getId=function(){return this.id},e}(o.GeometryTileFeature);e.VectorTileFeature=s;var l=function(t){function e(e){return t.call(this,a.ClassType.VECTOR_TILE_LAYER,e)||this}return n(e,t),e.prototype.addFeature=function(t,e,r,i){void 0===i&&(i=new Map),this.features.push(new s(t,e,r,i))},e}(o.GeometryTileLayer);e.VectorTileLayer=l;var u=function(t){function e(){var e=t.call(this)||this;return e.layerIds=[],e.layers=new Map,e}return n(e,t),e.prototype.addLayer=function(t){return this.layers.has(t)||(this.layerIds.push(t),this.layers.set(t,new l(t))),this.layers.get(t)},e.prototype.getLayerIds=function(){return this.layerIds},e.prototype.getLayer=function(t){return this.layers.has(t)?this.layers.get(t):null},e}(o.GeometryTileData);e.VectorTileData=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=function(t){function e(e,r,i,n){var o=t.call(this,e)||this;return o.properties=new Map,o.type=r,o.geometries=i,o.properties=n,o}return n(e,t),e.prototype.getType=function(){return this.type},e.prototype.getGeometries=function(){return this.geometries},e.prototype.getProperties=function(){return this.properties},e}(o.Map4dObject);e.GeometryTileFeature=a;var s=function(t){function e(e,r){var i=t.call(this,e)||this;return i.features=[],i.name=r,i}return n(e,t),e.prototype.featureCount=function(){return this.features.length},e.prototype.getFeature=function(t){return this.features[t]},e.prototype.getName=function(){return this.name},e}(o.Map4dObject);e.GeometryTileLayer=s;var l=function(){};e.GeometryTileData=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(23),a=r(11),s=r(1),l=function(t){function e(e,r,i,n,o,l,u,h){var c=t.call(this)||this;return c.annotationId=-1,c.fillColor=a.Color.fromHex(e),c.fillColor.alpha=r,c.fillOpacity=r,c.strokeColor=a.Color.fromHex(i),c.strokeWidth=n*s.MapUtils.pixelScale,c.visible=l,c.draggable=u,c.elevation=o,c.clickable=h,c}return n(e,t),e.prototype.getFillColor=function(){return this.fillColor},e.prototype.setFillColor=function(t){null!=t?(this.fillColor=a.Color.fromHex(t),this.fillColor.alpha=this.fillOpacity):this.fillColor=new a.Color(255,0,0,this.fillOpacity)},e.prototype.getFillOpacity=function(){return this.fillOpacity},e.prototype.setFillOpacity=function(t){this.fillOpacity=t,this.fillColor.alpha=t},e.prototype.isVisible=function(){return this.visible},e.prototype.setVisible=function(t){this.visible=t},e.prototype.getStrokeColor=function(){return this.strokeColor},e.prototype.setStrokeColor=function(t){this.strokeColor=null!=t?a.Color.fromHex(t):new a.Color(255,0,0,1)},e.prototype.getStrokeWidth=function(){return this.strokeWidth},e.prototype.setStrokeWidth=function(t){this.strokeWidth=t*s.MapUtils.pixelScale},e.prototype.getElevation=function(){return this.elevation},e.prototype.setElevation=function(t){this.elevation=t},e.prototype.isDraggable=function(){return this.draggable},e.prototype.setDraggable=function(t){this.draggable=t},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e}(o.LayerProperties);e.FillLayerProperties=l},function(t,e,r){
/**
 * greiner-hormann v1.4.1
 * Greiner-Hormann clipping algorithm
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */
!function(t){"use strict";var e=function(t,e){1===arguments.length&&(Array.isArray(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),this.x=t,this.y=e,this.next=null,this.prev=null,this._corresponding=null,this._distance=0,this._isEntry=!0,this._isIntersection=!1,this._visited=!1};e.createIntersection=function(t,r,i){var n=new e(t,r);return n._distance=i,n._isIntersection=!0,n._isEntry=!1,n},e.prototype.visit=function(){this._visited=!0,null===this._corresponding||this._corresponding._visited||this._corresponding.visit()},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.isInside=function(t){var e=!1,r=t.first,i=r.next,n=this.x,o=this.y;do{(r.y<o&&i.y>=o||i.y<o&&r.y>=o)&&(r.x<=n||i.x<=n)&&(e^=r.x+(o-r.y)/(i.y-r.y)*(i.x-r.x)<n),i=(r=r.next).next||t.first}while(!r.equals(t.first));return e};var r=function(t,e,r,i){this.x=0,this.y=0,this.toSource=0,this.toClip=0;var n=(i.y-r.y)*(e.x-t.x)-(i.x-r.x)*(e.y-t.y);0!==n&&(this.toSource=((i.x-r.x)*(t.y-r.y)-(i.y-r.y)*(t.x-r.x))/n,this.toClip=((e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x))/n,this.valid()&&(this.x=t.x+this.toSource*(e.x-t.x),this.y=t.y+this.toSource*(e.y-t.y)))};r.prototype.valid=function(){return 0<this.toSource&&this.toSource<1&&0<this.toClip&&this.toClip<1};var i=function(t,r){this.first=null,this.vertices=0,this._lastUnprocessed=null,this._arrayVertices=void 0===r?Array.isArray(t[0]):r;for(var i=0,n=t.length;i<n;i++)this.addVertex(new e(t[i]))};function n(t,e,r,n){var o=new i(t),a=new i(e);return o.clip(a,r,n)}i.prototype.addVertex=function(t){if(null===this.first)this.first=t,this.first.next=t,this.first.prev=t;else{var e=this.first,r=e.prev;e.prev=t,t.next=e,t.prev=r,r.next=t}this.vertices++},i.prototype.insertVertex=function(t,e,r){for(var i,n=e;!n.equals(r)&&n._distance<t._distance;)n=n.next;t.next=n,i=n.prev,t.prev=i,i.next=t,n.prev=t,this.vertices++},i.prototype.getNext=function(t){for(var e=t;e._isIntersection;)e=e.next;return e},i.prototype.getFirstIntersect=function(){var t=this._firstIntersect||this.first;do{if(t._isIntersection&&!t._visited)break;t=t.next}while(!t.equals(this.first));return this._firstIntersect=t,t},i.prototype.hasUnprocessed=function(){var t=this._lastUnprocessed||this.first;do{if(t._isIntersection&&!t._visited)return this._lastUnprocessed=t,!0;t=t.next}while(!t.equals(this.first));return this._lastUnprocessed=null,!1},i.prototype.getPoints=function(){var t=[],e=this.first;if(this._arrayVertices)do{t.push([e.x,e.y]),e=e.next}while(e!==this.first);else do{t.push({x:e.x,y:e.y}),e=e.next}while(e!==this.first);return t},i.prototype.clip=function(t,n,o){var a,s,l=this.first,u=t.first,h=!n&&!o,c=n&&o;do{if(!l._isIntersection)do{if(!u._isIntersection){var p=new r(l,this.getNext(l.next),u,t.getNext(u.next));if(p.valid()){var f=e.createIntersection(p.x,p.y,p.toSource),d=e.createIntersection(p.x,p.y,p.toClip);f._corresponding=d,d._corresponding=f,this.insertVertex(f,l,this.getNext(l.next)),t.insertVertex(d,u,t.getNext(u.next))}}u=u.next}while(!u.equals(t.first));l=l.next}while(!l.equals(this.first));l=this.first,u=t.first,n^=a=l.isInside(t),o^=s=u.isInside(this);do{l._isIntersection&&(l._isEntry=n,n=!n),l=l.next}while(!l.equals(this.first));do{u._isIntersection&&(u._isEntry=o,o=!o),u=u.next}while(!u.equals(t.first));for(var g=[];this.hasUnprocessed();){var y=this.getFirstIntersect(),m=new i([],this._arrayVertices);m.addVertex(new e(y.x,y.y));do{if(y.visit(),y._isEntry)do{y=y.next,m.addVertex(new e(y.x,y.y))}while(!y._isIntersection);else do{y=y.prev,m.addVertex(new e(y.x,y.y))}while(!y._isIntersection);y=y._corresponding}while(!y._visited);g.push(m.getPoints())}return 0===g.length&&(h?a?g.push(t.getPoints()):s?g.push(this.getPoints()):g.push(this.getPoints(),t.getPoints()):c?a?g.push(this.getPoints()):s&&g.push(t.getPoints()):a?g.push(t.getPoints(),this.getPoints()):s?g.push(this.getPoints(),t.getPoints()):g.push(this.getPoints()),0===g.length&&(g=null)),g};var o=n;t.union=function(t,e){return n(t,e,!1,!1)},t.intersection=function(t,e){return n(t,e,!0,!0)},t.diff=function(t,e){return n(t,e,!1,!0)},t.clip=o,Object.defineProperty(t,"__esModule",{value:!0})}(e)},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(5),a=function(t){function e(e,r,i,n){var a=t.call(this,o.ClassType.BUILDING_QUERY_RESULT)||this;return a.annotationId=e,a.id=r,a.name=i,a.location=n,a}return n(e,t),e}(o.Map4dObject);e.BuildingQueryResult=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(16),o=r(43),a=r(224),s=r(39),l=r(2),u=r(10),h=r(35),c=r(11),p=r(225),f=r(0),d=r(42),g=r(73),y=r(1),m=function(){function t(t,e){this.aabbs=[],this.obbs=[],this.gl=t,this.mapState=e,this.isect2d=new a.ISect2D,this.collisionGridIndex=new p(l.MapConstants.gridIndexExtent,l.MapConstants.gridIndexN,l.MapConstants.gridIndexPadding)}return t.prototype.clearCollision=function(){this.obbs=[];var t=this.mapState.getScreenSize();this.isect2d.resize(new i.Vector2(t.x/128,t.y/128),t),this.isect2d.clear(),this.collisionGridIndex=new p(l.MapConstants.gridIndexExtent,l.MapConstants.gridIndexN,l.MapConstants.gridIndexPadding)},t.prototype.insert=function(t){this.obbs.push(t)},t.prototype.updateQueryDatas=function(){if(0!=this.obbs.length)for(var t=l.MapConstants.placeWidth*y.MapUtils.pixelScale,e=l.MapConstants.placeHeight*y.MapUtils.pixelScale,r=0;r<this.obbs.length;++r){var n=this.obbs[r];if(n.isVisible()){var a=n.type,s=n.renderData,u=s.getType(),h=void 0;switch(u){case f.LayerType.POI:var c=s;s.getLayerProperties();if(h=c.getScreenCoordinate(),a===o.CollisionType.POI)this.collisionGridIndex.insert(c.getOrder(),h.x-t/2,h.y-e,h.x+t/2,h.y);else if(c.isTextVisible()&&c.getTextDirection()===n.direction&&a===o.CollisionType.POITEXT){var p=c.getTextData().width,m=c.getTextData().height,v=new i.Vector2(h.x+t/2+p/2,h.y-e/2);switch(c.getTextDirection()){case g.TextDirection.RIGHT:break;case g.TextDirection.LEFT:v=new i.Vector2(h.x-(t/2+p/2),h.y-e/2);break;case g.TextDirection.TOP:v=new i.Vector2(h.x,h.y-e-m/2);break;case g.TextDirection.BOTTOM:v=new i.Vector2(h.x,h.y+m/2)}c.setTextCoordinate(v),this.collisionGridIndex.insert(c.getOrder(),v.x-p/2,v.y-m/2,v.x+p/2,v.y+m/2)}break;case f.LayerType.USERPOI:var _=s,b=s.getLayerProperties();if(h=_.getScreenCoordinate(),!b.isClickable())continue;if(a===o.CollisionType.USERPOI)this.collisionGridIndex.insert(_.getOrder(),h.x-t/2,h.y-e,h.x+t/2,h.y);else if(_.isTextVisible()&&a===o.CollisionType.USERPOITEXT){var w=_.getTextData();p=w.width,m=w.height,v=new i.Vector2(h.x+t/2+p/2+1,h.y-e/2);this.collisionGridIndex.insert(_.getOrder(),v.x-p/2,v.y-m/2,v.x+p/2,v.y+m/2),_.setTextCoordinate(v)}break;case f.LayerType.LABEL:if(s.getLayerProperties().getLabelType()!=d.LabelType.PLACE)break;var x=s;h=x.getScreenCoordinate();var M=x.getTextData();this.collisionGridIndex.insert(x.getOrder(),h.x-M.width/2,h.y-M.height/2,h.x+M.width/2,h.y+M.height/2);break;default:console.warn("LayerType %s is not valid",u)}}}},t.prototype.intersectAABBs=function(){var t=this;this.aabbs=[],this.obbs.forEach((function(e){var r=e.obb.getExtent();t.aabbs.push(r)})),this.isect2d.intersect(this.aabbs),this.isect2d.pairs.forEach((function(e){var r=t.obbs[e.first],i=t.obbs[e.second];(r.type>i.type||r.type==i.type&&(r.getRank()<i.getRank()||Math.abs(r.getRank()-i.getRank())<l.MathConstants.epsilon&&r.getId()>i.getId()))&&e.swapFirstAndSecond()})),this.isect2d.pairs.sort((function(e,r){if(e.first==r.first)return e.second-r.second;var i=t.obbs[e.first],n=t.obbs[r.first];return i.type!=n.type?i.type-n.type:Math.abs(i.getRank()-n.getRank())>l.MathConstants.epsilon?n.getRank()-i.getRank():i.getId()-n.getId()}))},t.prototype.hitTest=function(){this.intersectAABBs(),this.updateIntersectionItems(),this.updateQueryDatas()},t.prototype.updateIntersectionItems=function(){for(var t=0;t<this.isect2d.pairs.length;++t){var e=this.isect2d.pairs[t],r=this.obbs[e.first],i=this.obbs[e.second],n=null,a=null,u=null,h=null;if(r.isVisible()&&i.isVisible()&&((r.type!=o.CollisionType.USERPOI||r.type!=i.type)&&(r.type!=o.CollisionType.POI&&r.type!=o.CollisionType.POITEXT||i.type!=r.type||r.getId()!=i.getId())&&s.OBB.intersect(r.obb,i.obb))){if((r.type==o.CollisionType.VECTOR_LABEL||r.type==o.CollisionType.PLACE_LABEL||r.type==o.CollisionType.BOUNDARY_LABEL)&&i.type==r.type){var c=this.mapState.getZoom(),p=this.mapState.mapSettings.getZoomStep();if(Math.abs(r.getZoom()-i.getZoom())>=p){Math.abs(r.getZoom()-c)<l.MathConstants.epsilon?i.setVisible(!1):r.setVisible(!1);continue}}if(r.type==o.CollisionType.POI&&i.type==o.CollisionType.POITEXT&&r.getRank()<i.getRank()?(n=r,a=i):(n=i,a=r),a.type==o.CollisionType.POI&&n.type==o.CollisionType.POI){n.setVisible(!1);continue}if(a.type==o.CollisionType.POITEXT&&n.type==o.CollisionType.POI){u=a.renderData,a.direction==u.getTextDirection()&&n.setVisible(!1);continue}if(a.type==o.CollisionType.POI&&n.type==o.CollisionType.POITEXT){var f=n.renderData;if(n.direction==f.getTextDirection()){n.direction==g.TextDirection.RIGHT?f.getLineNumber()<2?f.setTextDirection(g.TextDirection.LEFT):f.setTextDirection(g.TextDirection.TOP):n.direction==g.TextDirection.LEFT?f.setTextDirection(g.TextDirection.TOP):n.direction==g.TextDirection.TOP?f.setTextDirection(g.TextDirection.BOTTOM):n.direction==g.TextDirection.BOTTOM&&n.setVisible(!1);continue}}else if(a.type==o.CollisionType.POITEXT&&n.type==o.CollisionType.POITEXT){if(u=a.renderData,h=n.renderData,a.direction==u.getTextDirection()&&n.direction==h.getTextDirection()){n.direction==g.TextDirection.RIGHT?h.getLineNumber()<2?h.setTextDirection(g.TextDirection.LEFT):h.setTextDirection(g.TextDirection.TOP):n.direction==g.TextDirection.LEFT?h.setTextDirection(g.TextDirection.TOP):n.direction==g.TextDirection.TOP?h.setTextDirection(g.TextDirection.BOTTOM):n.direction==g.TextDirection.BOTTOM&&n.setVisible(!1);continue}}else{if(a.type===o.CollisionType.USERPOI||a.type===o.CollisionType.USERPOITEXT||n.type!==o.CollisionType.USERPOI||n.type===o.CollisionType.USERPOITEXT){n.setVisible(!1);continue}if(a.type==o.CollisionType.VECTOR_LABEL||n.type==o.CollisionType.VECTOR_LABEL||a.type==o.CollisionType.PLACE_LABEL||n.type==o.CollisionType.PLACE_LABEL){if(a.getRank()<n.getRank()){var d=n;n=a,a=d}var y=a.type==o.CollisionType.POITEXT?a.renderData.getTextDirection():null,m=n.type==o.CollisionType.POITEXT?n.renderData.getTextDirection():null;(n.direction==m&&a.type==o.CollisionType.VECTOR_LABEL||a.direction==y&&n.type==o.CollisionType.VECTOR_LABEL||n.type==o.CollisionType.POI&&a.type==o.CollisionType.VECTOR_LABEL||a.type==o.CollisionType.POI&&n.type==o.CollisionType.VECTOR_LABEL||n.direction==m&&a.type==o.CollisionType.PLACE_LABEL||a.direction==y&&n.type==o.CollisionType.PLACE_LABEL||n.type==o.CollisionType.POI&&a.type==o.CollisionType.PLACE_LABEL||a.type==o.CollisionType.POI&&n.type==o.CollisionType.PLACE_LABEL)&&n.setVisible(!1);continue}n.setVisible(!1)}}}},t.prototype.query=function(t){var e=this.collisionGridIndex.query(t.x,t.y,t.x,t.y);return e&&e.length>0?(e.sort((function(t,e){return n.compareOrderDESC(t,e)})),e[0]):null},t.prototype.drawDebug=function(){if(h.Env.isCollisionDebug){var t=this.gl,e=u.ResourceManager.getInstance(t).getShader(u.ShaderEnum.LINE_COLLISION_SHADER);t.enable(t.BLEND),e.bind();var r=t.createBuffer();t.bindBuffer(this.gl.ARRAY_BUFFER,r);var i=c.Color.fromHex("#FF0000"),n=this.mapState.getOrthoProjectionMatrix();t.uniformMatrix4fv(e.mvpMatrixUniform,!1,n.buffer()),t.uniform3f(e.colorUniform,i.red,i.green,i.blue);var o=e.attributes.a_position;this.obbs.forEach((function(e){var r=new Array(8);r[0]=e.obb.getQuad()[0],r[1]=e.obb.getQuad()[1],r[2]=e.obb.getQuad()[2],r[3]=e.obb.getQuad()[3],r[4]=e.obb.getQuad()[4],r[5]=e.obb.getQuad()[5],r[6]=e.obb.getQuad()[6],r[7]=e.obb.getQuad()[7],t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,8,0),t.drawArrays(t.LINE_LOOP,0,4)})),t.bindBuffer(t.ARRAY_BUFFER,null),t.disable(t.BLEND)}},t}();e.Collision2DManager=m},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(13),n=function(){function t(t,e,r){this.first=t,this.second=e,this.next=r}return t.prototype.swapFirstAndSecond=function(){var t=this.first;this.first=this.second,this.second=t},t}();e.Pair=n;var o=function(){function t(){this.split_x=0,this.split_y=0,this.res_x=0,this.res_y=0,this.xpad=0,this.ypad=0,this.pairs=[],this.pairMap=new Array(2048).fill(-1)}return t.prototype.resize=function(t,e){this.split_x=Math.round(t.x),this.split_y=Math.round(t.y),this.res_x=Math.round(e.x),this.res_y=Math.round(e.y),this.split_x=Math.max(this.split_x,1),this.split_y=Math.max(this.split_y,1),this.res_x=Math.max(this.res_x,this.split_x),this.res_y=Math.max(this.res_y,this.split_y),this.xpad=Math.round(this.res_x/this.split_x),this.ypad=Math.round(this.res_y/this.split_y),this.gridAABBs=new Array(this.split_x*this.split_y);for(var r=0;r<this.gridAABBs.length;++r)this.gridAABBs[r]=[]},t.prototype.clear=function(){this.pairs=[],this.pairMap=new Array(this.pairMap.length).fill(-1),this.gridAABBs.forEach((function(t){[]}))},t.prototype.intersect=function(e){this.clear();for(var r=0,o=0;o<e.length;++o){var a=e[o],s=Math.round(a.getMin().x/this.xpad),l=Math.round(a.getMin().y/this.ypad),u=Math.round(a.getMax().x/this.xpad+1),h=Math.round(a.getMax().y/this.ypad+1);s=i.MathUtils.clamp(s,0,this.split_x-1),l=i.MathUtils.clamp(l,0,this.split_y-1),u=i.MathUtils.clamp(u,1,this.split_x),h=i.MathUtils.clamp(h,1,this.split_y);for(var c=l;c<h;++c)for(var p=s;p<u;++p)this.gridAABBs[p+c*this.split_x].push(r);r++}for(o=0;o<this.gridAABBs.length;++o){var f=this.gridAABBs[o];if(f&&0!=f.length){for(var d=0;d<f.length-1;++d)for(var g=e[f[d]],y=d+1;y<f.length;++y){var m=e[f[y]];if(g.intersect(m)){var v=t.hashKey(t.hashNumber(f[d])<<32|t.hashNumber(f[y]));v&=this.pairMap.length-1;for(var _=this.pairMap[v];-1!=_&&(this.pairs[_].first!=f[d]||this.pairs[_].second!=f[y]);)_=this.pairs[_].next;-1==_&&(this.pairs.push(new n(f[d],f[y],this.pairMap[v])),this.pairMap[v]=this.pairs.length-1)}}f=[]}}},t.hashNumber=function(t){return t+=~(t<<15),t^=t>>10,t+=t<<3,t^=t>>6,t+=~(t<<11),t^=t>>16},t.hashKey=function(t){return t=~t+(t<<18),t^=t>>31,t*=21,t^=t>>11,t+=t<<6,t^=t>>22},t}();e.ISect2D=o},function(t,e,r){"use strict";t.exports=i;function i(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],e=n[1],r=n[2],this.d=e+2*r;for(var o=0;o<this.d*this.d;o++){var a=n[3+o],s=n[3+o+1];i.push(a===s?null:n.subarray(a,s))}var l=n[3+i.length],u=n[3+i.length+1];this.keys=n.subarray(l,u),this.bboxes=n.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var h=0;h<this.d*this.d;h++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}i.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(t,e,r,i,n,o){this.cells[n].push(o)},i.prototype.query=function(t,e,r,i,n){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=i&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,i,this._queryCell,s,{},n),s},i.prototype._queryCell=function(t,e,r,i,n,o,a,s){var l=this.cells[n];if(null!==l)for(var u=this.keys,h=this.bboxes,c=0;c<l.length;c++){var p=l[c];if(void 0===a[p]){var f=4*p;(s?s(h[f+0],h[f+1],h[f+2],h[f+3]):t<=h[f+2]&&e<=h[f+3]&&r>=h[f+0]&&i>=h[f+1])?(a[p]=!0,o.push(u[p])):a[p]=!1}}},i.prototype._forEachCell=function(t,e,r,i,n,o,a,s){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),h=this._convertToCellCoord(r),c=this._convertToCellCoord(i),p=l;p<=h;p++)for(var f=u;f<=c;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&n.call(this,t,e,r,i,d,o,a,s))return}},i.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},i.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];n[3+a]=o,n.set(s,o),o+=s.length}return n[3+t.length]=o,n.set(this.keys,o),o+=this.keys.length,n[3+t.length+1]=o,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(61),n=r(92),o=r(0),a=r(2),s=r(18),l=r(32),u=r(34),h=r(99),c=r(7),p=function(){function t(t,e,r){var o=this;this.idCounter=1,this.map=t,this.mapState=t.mapState,this.rasterOverlayLayers=new Map,this.tileRequestsMap=new Map,this.tileOverlays=new Map,this.buildingOverlays=new Map,this.groundOverlays=new Map,this.poiOverlays=new Map,this.imageOverlays=new Map;this.tilePyramid=new i.TilePyramid(this.map,a.MapConstants.tileCacheSize,(function(t){return o.createTile(t)}),(function(t){o.removeTile(t)}),(function(t){o.updateTileFromCache(t)})),this.taskDataManager=new n.TaskDataManager(t,e,r,this.tileRequestsMap)}return t.prototype.visibleTilesChanged=function(){this.finishedLoad=!1},t.prototype.createTile=function(t){var e=new s.Tile(s.Kind.OVERLAY,t,this.map.gl);return this.requestOverlayData(e,t)||e.setRenderable(),e},t.prototype.requestOverlayData=function(t,e){var r=this,i=e.getX(),n=e.getY(),o=e.getZoom(),a=this.mapState.is3dMode(),s=!1;return a?this.buildingOverlays.forEach((function(e){var a=e.getUrl(i,n,o);if(a&&a.length>0){s=!0;var u=e.getProperties().getLayerId(),h=e.getPrefixId();r.taskDataManager.requestData(t,l.Resource.BuildingOverlay,a,u,h,(function(t){return e.parserData(t)}))}})):this.poiOverlays.forEach((function(e){var a=e.getUrl(i,n,o);if(a&&a.length>0){s=!0;var u=e.getProperties().getLayerId(),h=e.getPrefixId();r.taskDataManager.requestData(t,l.Resource.POIOverlay,a,u,h,(function(t){return e.parserData(t)}))}})),this.tileOverlays.forEach((function(e){var u=e.getUrl(i,n,o,a);if(null!=u&&0!=u.length){s=!0;var h=e.getProperties().getLayerId();r.taskDataManager.requestData(t,l.Resource.RasterOverlay,u,h)}})),this.groundOverlays.forEach((function(u){if(h.TileRange.fromLatLngBounds(u.getBounds(),o,o).contains(e)){var c=u.getUrl(i,n,o,a);if(c&&c.length>0){s=!0;var p=u.getProperties().getLayerId();r.taskDataManager.requestData(t,l.Resource.RasterOverlay,c,p)}}})),s},t.prototype.removeTile=function(t){if(t.getTileData().hasLayerType(o.LayerType.BUILDING_OVERLAY)&&this.dirtyBuildingOverlay(),this.taskDataManager.removeOverlayTaskResult(t.getTileCoordinate(),!0),this.mapState.is3dMode()){var e=c.MapResourceManager.getInstance(this.map.gl);t.getTileRenderData().getLayerRenderDatas().forEach((function(t){if(t.getType()==o.LayerType.BUILDING_OVERLAY){var r=t;e.removeVisibleBuildingId(r.getId())}}))}this.tilePyramid.getTileCache()||t.destroy()},t.prototype.updateTileFromCache=function(t){var e=this,r=t.getTileCoordinate(),i=t.getTileData(),n=i.getLayerIds(),a=r.getX(),s=r.getY(),u=r.getZoom(),p=this.map.mapState.is3dMode();if(p){if(i.hasLayerType(o.LayerType.BUILDING_OVERLAY)){var f=c.MapResourceManager.getInstance(this.map.gl);t.getTileRenderData().getLayerRenderDatas().forEach((function(t){if(t.getType()==o.LayerType.BUILDING_OVERLAY){var e=t,r=e.getId();f.hasVisibleBuildingId(r)||e.resetScaleZ(),f.retainVisibleBuildingId(r)}}))}this.buildingOverlays.forEach((function(r){var o=r.getProperties().getLayerId();if(null!=i.getTileLayer(o))n.splice(n.indexOf(o),1);else{var h=r.getUrl(a,s,u);null!=h&&h.length>0&&e.taskDataManager.requestData(t,l.Resource.BuildingOverlay,h,o,r.getPrefixId(),(function(t){return r.parserData(t)}))}}))}else this.poiOverlays.forEach((function(r){var o=r.getProperties().getLayerId();if(null!=i.getTileLayer(o))n.splice(n.indexOf(o),1);else{var h=r.getUrl(a,s,u);h&&h.length>0&&e.taskDataManager.requestData(t,l.Resource.POIOverlay,h,o,r.getPrefixId(),(function(t){return r.parserData(t)}))}}));this.tileOverlays.forEach((function(r){var o=r.getProperties().getLayerId();if(null!=i.getTileLayer(o))n.splice(n.indexOf(o),1);else{var h=r.getUrl(a,s,u,p);null!=h&&h.length>0&&e.taskDataManager.requestData(t,l.Resource.RasterOverlay,h,o)}})),this.groundOverlays.forEach((function(o){var c=o.getProperties().getLayerId();if(null!=i.getTileLayer(c))n.splice(n.indexOf(c),1);else if(h.TileRange.fromLatLngBounds(o.getBounds(),u,u).contains(r)){var f=o.getUrl(a,s,u,p);f&&f.length>0&&e.taskDataManager.requestData(t,l.Resource.RasterOverlay,f,c)}})),n.forEach((function(r){e.removeTileData(t,r)}))},t.prototype.removeTileDataFromTiles=function(t){var e=this,r=this.map.tileManager.getVisibleTiles();r&&r.forEach((function(r){var i=e.tilePyramid.getTile(r.getTileCoordinate());e.removeTileData(i,t)}))},t.prototype.removeTileData=function(t,e){var r=t.getTileData(),i=r.getTileLayer(e);if(null!=i){var n=t.getTileRenderData();i.getFeatures().forEach((function(t){n.removeLayerRenderData(t.getId())})),r.removeTileLayer(e)}},t.prototype.createRasterOverlayLayer=function(t){if(!this.rasterOverlayLayers.has(t)){var e=this.map.createLayer(a.LayerConstants.rasterOverlayLayerId+t.toString(),o.LayerType.RASTER_OVERLAY,a.MapConstants.baseMapLowestOrder);e.effectManager=this.map.effectManager,e.timeEffectManager=this.map.timeEffectManager,e.setLightingManager(this.map.lightManager),this.rasterOverlayLayers.set(t,e)}},t.prototype.removeRasterOverlayLayer=function(t){this.map.removeLayer(a.LayerConstants.rasterOverlayLayerId+t.toString(),a.MapConstants.baseMapLowestOrder),this.rasterOverlayLayers.delete(t)},t.prototype.getRenderTiles=function(){return this.tilePyramid.getRenderTiles()},t.prototype.isDirty=function(){return!(this.finishedLoad||this.mapState.isZoomIn()||this.mapState.isZoomOut())},t.prototype.update=function(){this.isDirty()&&(this.tilePyramid.update(this.map.tileManager.getVisibleTiles(),this.mapState,this.lastZoom),this.taskDataManager.isAllRequestFinished()&&(this.finishedLoad=!0,this.lastZoom=this.mapState.getZoom()))},t.prototype.reload=function(){var t=this;this.finishedLoad=!1,this.taskDataManager.reload(),this.tilePyramid.getTiles().forEach((function(t){t.tile.destroy()})),this.tilePyramid.clear(),this.mapState.is3dMode()&&this.buildingOverlays.forEach((function(e,r){var i=t.map.getLayer(a.LayerConstants.buildingOverlayLayerId+r);null==i&&console.error("Error when get layer "+(a.LayerConstants.buildingOverlayLayerId+r)+" from Map."),i&&i.clear()}))},t.prototype.dirtyBuildingOverlay=function(){var t=this;this.buildingOverlays.forEach((function(e,r){var i=t.map.getLayer(a.LayerConstants.buildingOverlayLayerId+r);null==i&&console.error("Error when get layer "+(a.LayerConstants.buildingOverlayLayerId+r)+" from Map."),i&&i.setDirty()}))},t.prototype.dirtyRasterOverlays=function(){this.rasterOverlayLayers.forEach((function(t){t.setDirty()}))},t.prototype.isOverrideBaseMapTile=function(t){var e=!1,r=t.getZoom(),i=this.mapState.is3dMode();return this.groundOverlays.forEach((function(n){if(!e&&n.isOverride()&&h.TileRange.fromLatLngBounds(n.getBounds(),r,r).contains(t)){var o=n.getUrl(t.getX(),t.getY(),r,i);o&&o.length>0&&(e=!0)}})),e},t.prototype.addOverlay=function(t){var e=0;switch(t.getType()){case u.OverlayType.TILE:e=this.addTileOverlay(t);break;case u.OverlayType.GROUND:e=this.addGroundOverlay(t);break;case u.OverlayType.POI:e=this.addPOIOverlay(t);break;case u.OverlayType.BUILDING:e=this.addBuildingOverlay(t);break;case u.OverlayType.IMAGE:e=this.addImageOverlay(t);break;default:console.warn("Unknown overlay type!")}return e},t.prototype.removeOverlay=function(t){this.tileOverlays.has(t)?this.removeTileOverlay(t):this.groundOverlays.has(t)?this.removeGroundOverlay(t):this.poiOverlays.has(t)?this.removePOIOverlay(t):this.buildingOverlays.has(t)?this.removeBuildingOverlay(t):this.imageOverlays.has(t)?this.removeImageOverlay(t):console.warn("Overlay "+t+" not exist")},t.prototype.addTileOverlay=function(t){var e=this,r=this.idCounter++,i=a.LayerConstants.rasterOverlayLayerId+r.toString();t.getProperties().setLayerId(i),this.tileOverlays.set(r,t),this.createRasterOverlayLayer(r);var n=this.map.tileManager.getVisibleTiles();return n&&n.forEach((function(r){var n=r.getTileCoordinate(),o=e.tilePyramid.getTile(n);if(null!=o){var a=t.getUrl(n.getX(),n.getY(),n.getZoom(),e.map.mapState.is3dMode());a&&a.length>0&&e.taskDataManager.requestData(o,l.Resource.RasterOverlay,a,i)}})),r},t.prototype.removeTileOverlay=function(t){var e=this.tileOverlays.get(t);null!=t&&(this.removeTileDataFromTiles(e.getProperties().getLayerId()),this.tileOverlays.delete(t),this.removeRasterOverlayLayer(t))},t.prototype.addBuildingOverlay=function(t){var e=this,r=this.idCounter++,i=a.LayerConstants.buildingOverlayLayerId+r.toString();if(this.buildingOverlays.set(r,t),t.createLayer(this.map,i),this.mapState.is3dMode()){var n=this.map.tileManager.getVisibleTiles();n&&n.forEach((function(r){var n=r.getTileCoordinate(),o=e.tilePyramid.getTile(n);if(null!=o){var a=t.getUrl(n.getX(),n.getY(),n.getZoom());a&&a.length>0&&e.taskDataManager.requestData(o,l.Resource.BuildingOverlay,a,i,t.getPrefixId(),(function(e){return t.parserData(e)}))}}))}return r},t.prototype.removeBuildingOverlay=function(t){var e=this.buildingOverlays.get(t);null!=e&&(e.removeLayer(this.map),this.mapState.is3dMode()&&this.removeTileDataFromTiles(e.getProperties().getLayerId()),this.buildingOverlays.delete(t))},t.prototype.addGroundOverlay=function(t){var e=this,r=this.idCounter++,i=a.LayerConstants.rasterOverlayLayerId+r.toString();t.getProperties().setLayerId(i),this.groundOverlays.set(r,t),this.createRasterOverlayLayer(r);var n=this.map.tileManager.getVisibleTiles(),o=t.getBounds();return n&&n.forEach((function(r){var n=r.getTileCoordinate(),a=e.tilePyramid.getTile(n);if(null!=a){var s=n.getZoom();if(h.TileRange.fromLatLngBounds(o,s,s).contains(n)){var u=t.getUrl(n.getX(),n.getY(),n.getZoom(),e.map.mapState.is3dMode());u&&u.length>0&&(e.taskDataManager.requestData(a,l.Resource.RasterOverlay,u,i),e.map.tileManager.dirtyOverriddenTiles())}}})),r},t.prototype.removeGroundOverlay=function(t){var e=this.groundOverlays.get(t);null!=e&&(this.removeTileDataFromTiles(e.getProperties().getLayerId()),this.groundOverlays.delete(t),this.removeRasterOverlayLayer(t),e.isOverride()&&this.map.tileManager.dirtyOverriddenTiles())},t.prototype.addImageOverlay=function(t){var e=this.idCounter++,r=a.LayerConstants.imageOverlayLayerId+t.getProperties().getZIndex()+"_"+e.toString();this.imageOverlays.set(e,t),t.getProperties().setLayerId(r);var i=this.map.createLayer(r,o.LayerType.IMAGE_OVERLAY,a.MapConstants.baseMapMiddleOrder);i.setProperties(t.getProperties());var n=t.getUrl();return n&&n.length>0&&i.init(this.map.gl,n),e},t.prototype.removeImageOverlay=function(t){var e=this.imageOverlays.get(t);if(null!=e){this.imageOverlays.delete(t);var r=e.getProperties().getLayerId(),i=this.map.getLayer(r);i&&i.getLayerType()==o.LayerType.IMAGE_OVERLAY&&i.release(this.map.gl,e.getUrl()),this.map.removeLayer(r,a.MapConstants.baseMapMiddleOrder)}},t.prototype.addPOIOverlay=function(t){var e=this,r=this.idCounter++,i=a.LayerConstants.pointOverlayLayerId+r.toString();if(t.getProperties().setLayerId(i),this.map.createLayer(i,o.LayerType.POI_OVERLAY,a.MapConstants.baseMapLowestOrder).setProperties(t.getProperties()),this.poiOverlays.set(r,t),!this.mapState.is3dMode()){var n=this.map.tileManager.getVisibleTiles();n&&n.forEach((function(r){var n=r.getTileCoordinate(),o=e.tilePyramid.getTile(n);if(null!=o){var a=t.getUrl(n.getX(),n.getY(),n.getZoom());a&&a.length>0&&e.taskDataManager.requestData(o,l.Resource.POIOverlay,a,i,t.getPrefixId(),(function(e){return t.parserData(e)}))}}))}return r},t.prototype.removePOIOverlay=function(t){var e=this.poiOverlays.get(t);if(null!=e){var r=e.getProperties().getLayerId();this.map.removeLayer(r,a.MapConstants.baseMapLowestOrder),this.mapState.is3dMode()||this.removeTileDataFromTiles(r),this.poiOverlays.delete(t)}},t}();e.OverlayManager=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._zoomGesturesEnabled=!0,this._scrollGesturesEnabled=!0,this._rotateGesturesEnabled=!0,this._tiltGesturesEnabled=!0}return t.prototype.isZoomGesturesEnabled=function(){return this._zoomGesturesEnabled},t.prototype.setZoomGesturesEnabled=function(t){this._zoomGesturesEnabled=t},t.prototype.isScrollGesturesEnabled=function(){return this._scrollGesturesEnabled},t.prototype.setScrollGesturesEnabled=function(t){this._scrollGesturesEnabled=t},t.prototype.isRotateGesturesEnabled=function(){return this._rotateGesturesEnabled},t.prototype.setRotateGesturesEnabled=function(t){this._rotateGesturesEnabled=t},t.prototype.isTiltGesturesEnabled=function(){return this._tiltGesturesEnabled},t.prototype.setTiltGesturesEnabled=function(t){this._tiltGesturesEnabled=t},t.prototype.setAllGesturesEnabled=function(t){this._zoomGesturesEnabled=t,this._scrollGesturesEnabled=t,this._rotateGesturesEnabled=t,this._tiltGesturesEnabled=t},t}();e.UISettings=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(17),n=r(45),o=r(229),a=r(236),s=r(237),l=function(){function t(t){this.gl=t,this.styles={raster:new o.MapStyle(a.default,!0,"raster",t),roadmap:new o.MapStyle(n.MapSettings.getRoadmapStyle,!0,"roadmap",t),satellite:new o.MapStyle(s.default,!0,"satellite",t)}}return t.prototype.getStyle=function(t){switch(t){case i.MapType.roadmap:return this.styles.roadmap;case i.MapType.satellite:return this.styles.satellite;default:return this.styles.raster}},t.prototype.setMapStyle=function(t){this.styles.roadmap.load(t,!0,"roadmap",this.gl)},t}();e.StyleManager=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(2),o=r(230),a=r(233),s=r(7),l=function(){function t(t,e,r,i){void 0===e&&(e=!1),void 0===r&&(r=null),void 0===i&&(i=null),this.layers={},this.earthColor=n.MapConstants.mapBackgroundColor2D,this.load(t,e,r,i)}return t.prototype.getTextureStyle=function(t){return this.sources?this.sources.textures[t]:null},t.prototype.getPatternStyle=function(t){return this.sources?this.sources.patterns[t]:null},t.prototype.getMapBackgroundColor2D=function(){return this.earthColor},t.prototype.load=function(t,e,r,i){if(null!=t){e&&this.releaseTextures(i);var s={};if("string"==typeof t)try{s=JSON.parse(t)}catch(t){console.error(t)}else Object.assign(s,t);this.layers={};var l=s.layers;for(var u in l){var h=o.LayerStyle.parser(u,l[u],null);null!=h&&(this.layers[u]=h)}this.sources=null;var c=s.sources;if(c){var p=r||t.name;this.sources=a.SourcesStyle.parser(c,p,i,e),s.sources=this.sources}if(e){s.name=r,this.json=JSON.stringify(s);var f=this.build("earth","polygons",n.MapConstants.defaultMaxNativeZoom,null,null);this.earthColor=f?f.color:n.MapConstants.mapBackgroundColor2D}}},t.prototype.build=function(t,e,r,n,a,s){void 0===s&&(s=null);var l=this.layers[t];if(null==l)return null;var u={kind:n||null,kind_detail:a||null},h=l.match(u,e);if(0==h.length)return null;switch(e){case"polygons":if(p=o.LayerStyle.getValue(r,h,"color"))return{color:p};break;case"lines":var c=o.LayerStyle.getValue(r,h,"width");if(c&&c>0){var p=o.LayerStyle.getValue(r,h,"color"),f=o.LayerStyle.getValue(r,h,"pattern");if(p||this.isIconPattern(f))return{width:c*(s?s.pixelScale:i.MapUtils.pixelScale),color:p,pattern:f,outline:{width:o.LayerStyle.getValue(r,h,"outline_width"),color:o.LayerStyle.getValue(r,h,"outline_color")}}}break;case"text":if((g=o.LayerStyle.getValue(r,h,"size"))&&g>0)return(d={}).size=g*(s?s.resourceScale:i.MapUtils.resourceScale),d.color=o.LayerStyle.getValue(r,h,"color"),d.halo={},d.halo.color=o.LayerStyle.getValue(r,h,"halo_color"),d;break;case"points":var d,g=o.LayerStyle.getValue(r,h,"size"),y=o.LayerStyle.getValue(r,h,"texture");if(null!=g||null!=y)return(d={}).size=g*(s?s.pixelScale:i.MapUtils.pixelScale),d.color=o.LayerStyle.getValue(r,h,"color"),d.texture=y,d.iconIndex=o.LayerStyle.getValue(r,h,"icon_index"),d.halo={},d.halo.color=o.LayerStyle.getValue(r,h,"halo_color"),d;break;default:return null}return null},t.prototype.isIconPattern=function(t){var e=this.getPatternStyle(t);return e&&e.isIcon()},t.prototype.releaseTextures=function(t){if(this.sources){var e=s.MapResourceManager.getInstance(t);for(var r in this.sources.textures){var i=this.getTextureStyle(r);e.releaseTexture(i.id)}}},t}();e.MapStyle=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(231),n=r(232),o=["filter","draw","data_source"],a=function(){function t(t,e){this.name=t,this.depth=e,this.sublayers=[]}return t.prototype.match=function(t,e){var r=this.matchRule(t,e);return r.sort((function(t,e){return t.match==e.match?e.depth-t.depth:e.match-t.match})),r},t.prototype.matchRule=function(t,e){var r=[],i=null==this.filter?0:this.filter.match(t);return i>=0&&(null!=this.draw&&null!=this.draw[e]&&r.push({match:i,depth:this.depth,layer:this.name,rule:this.draw[e]}),this.sublayers.forEach((function(i){i.matchRule(t,e).forEach((function(t){r.push(t)}))}))),r},t.getValue=function(t,e,r){for(var n=0,o=e;n<o.length;n++){var a=o[n].rule;if(a[r])return i.Draw.getValue(t,a[r])}return null},t.parser=function(e,r,a){if(null==r||"object"!=typeof r)return null;var s=new t(e,null==a?0:a.depth+1),l=n.Filter.parser(r.filter);if(null!=a&&(null!=a.filter&&(l=a.filter.intersect(l)),null==l))return console.warn("The filter for layer "+e+" is incorrect"),null;for(var u in s.filter=l,s.draw=i.Draw.parser(r.draw),r)if(!o.includes(u)){var h=t.parser(u,r[u],s);null!=h&&s.sublayers.push(h)}return s},t}();e.LayerStyle=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(11),a=r(2);function s(t){if("string"==typeof t)return[[a.MapConstants.defaultMinZoom,o.Color.fromHex(t)]];var e=[];return(t||[]).forEach((function(t){var r=t||[];2==r.length&&"number"==typeof r[0]&&"string"==typeof r[1]&&e.push([r[0],o.Color.fromHex(r[1])])})),e.length>0?(e.sort((function(t,e){return t[0]-e[0]})),e):null}function l(t){if("number"==typeof t)return[[a.MapConstants.defaultMinZoom,t]];var e=[];return(t||[]).forEach((function(t){var r=t||[];2==r.length&&"number"==typeof r[0]&&"number"==typeof r[1]&&e.push([r[0],r[1]])})),e.length>0?(e.sort((function(t,e){return t[0]-e[0]})),e):null}var u=function(){function t(t,e){this.color=t,this.width=e}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color),i=l(e.width);return null!=r||null!=i?new t(r,i):null},t}(),h=function(t){function e(e,r,i,n){var o=t.call(this,e,r)||this;return o.pattern=i,o.outline=n,n&&(o.outline_color=n.color,o.outline_width=n.width),o}return n(e,t),e.parser=function(t){if(null==t||"object"!=typeof t)return null;var r=u.parser(t),i=u.parser(t.outline),n=t.pattern?[[a.MapConstants.defaultMinZoom,t.pattern]]:null;return null!=r?new e(r.color,r.width,n,i):null!=i||null!=n?new e(null,null,n,i):null},e}(u);e.LineRule=h;var c=function(){function t(t){this.color=t}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color);return null!=r?new t(r):null},t}();e.PolygonRule=c;var p=function(){function t(t,e,r){this.color=t,this.size=e,this.halo_color=r}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=s(e.color),i=l(e.size),n=e.halo?s(e.halo.color):null;return null!=r||null!=i||null!=n?new t(r,i,n):null},t}();e.TextRule=p;var f=function(){function t(t,e,r,i,n){this.size=t,this.color=e,this.texture=r,this.icon_index=i,this.halo_color=n}return t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=l(e.size),i=s(e.color),n=e.texture?[[a.MapConstants.defaultMinZoom,e.texture]]:null,o=null!=e.iconIndex?[[a.MapConstants.defaultMinZoom,e.iconIndex]]:null,u=e.halo?s(e.halo.color):null;return null!=r||null!=i||null!=n||null!=o||null!=u?new t(r,i,n,o,u):null},t}();e.PointRule=f;var d=function(){function t(t,e,r,i){this.lines=t,this.polygons=e,this.text=r,this.points=i}return t.getValue=function(t,e){for(var r=null,i=0,n=e;i<n.length;i++){var o=n[i];if(o[0]>t)break;o[0]>0&&(r=o[1])}return r},t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=h.parser(e.lines),i=c.parser(e.polygons),n=p.parser(e.text),o=f.parser(e.points);return null==r&&null==i&&null==n&&null==o?null:new t(r,i,n,o)},t}();e.Draw=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.kind=t,this.kind_detail=e}return t.prototype.match=function(t){var e=0;if(this.kind){if(!this.kind.includes(t.kind))return-1;e++}if(this.kind_detail){if(!this.kind_detail.includes(t.kind_detail))return-1;e++}return e>0?e:-1},t.prototype.intersect=function(e){if(!e)return new t(this.kind,this.kind_detail);var r,i;if(this.kind&&e.kind){if(0==(r=this.kind.filter((function(t){return e.kind.includes(t)}))).length)return null}else r=this.kind?this.kind:e.kind;if(this.kind_detail&&e.kind_detail){if(0==(i=this.kind_detail.filter((function(t){return e.kind_detail.includes(t)}))).length)return null}else i=this.kind_detail?this.kind_detail:e.kind_detail;return new t(r,i)},t.parser=function(e){if(null==e||"object"!=typeof e)return null;var r=t.parserProperty(e,"kind");if(r&&0==r.length)return null;var i=t.parserProperty(e,"kind_detail");return i&&0==i.length?null:null!=r||null!=i?new t(r,i):null},t.parserProperty=function(t,e){var r=t[e];if(null==r)return null;if("string"==typeof r)return[r];var i=[];return(r||[]).forEach((function(t){"string"==typeof t&&(i.includes(t)||i.push(t))})),i},t}();e.Filter=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(234),n=r(235),o=function(){function t(){this.textures={},this.patterns={}}return t.parser=function(e,r,o,a){if(void 0===a&&(a=!1),!e)return null;var s=new t,l=e.textures;if(l)for(var u in l){var h=n.TextureStyle.parser(o,u,l[u],r,a);h&&(s.textures[u]=h)}var c=e.patterns;if(c)for(var u in c){var p=i.PatternStyle.parser(o,u,c[u],r,a);p&&(s.patterns[u]=p)}return s},t}();e.SourcesStyle=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(28),n=function(){function t(){}return t.prototype.isDash=function(){return"dash"==this.type},t.prototype.isDot=function(){return"dot"==this.type},t.prototype.isIcon=function(){return"icon"==this.type},t.prototype.isSolid=function(){return"solid"==this.type},t.prototype.getPatternType=function(){switch(this.type){case"dash":return i.PatternType.Dash;case"dot":return i.PatternType.Dot;case"icon":return i.PatternType.Icon;default:return i.PatternType.Solid}},t.prototype.isValid=function(){switch(this.type){case"dash":return null!=this.length&&null!=this.gap;case"dot":return null!=this.repeat;case"icon":return null!=this.texture;case"solid":return!0;default:return!1}},t.parser=function(e,r,i,n,o){if(void 0===o&&(o=!1),!i)return null;var a=new t;return a.type=i.type,a.length=i.length,a.gap=i.gap,a.repeat=i.repeat,a.texture=i.texture,a.isValid()?a:null},t}();e.PatternStyle=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(48),n=r(1),o=r(13),a=r(2),s=r(7),l=function(t,e){this.width=t,this.height=e};e.SpritesInfo=l;var u=function(){function t(t,e){this.id=t,this.sprites=e}return t.prototype.isSprites=function(){return null!=this.sprites},t.prototype.getSpritesInfo=function(){return this.sprites},t.parser=function(e,r,u,h,c){if(void 0===c&&(c=!1),null==u)return null;var p=null,f=o.MathUtils.clamp(n.MapUtils.resourceScale,1,3)-1,d=u.sprites,g=null;if(d){var y=c?n.MapUtils.resourceScale:1,m=(d.width||a.MapConstants.placeWidth)*y,v=(d.height||a.MapConstants.placeHeight)*y;g=new l(m,v)}if(c){var _=u.url;if(null==_||"object"!=typeof _&&"string"!=typeof _)return console.warn("Texture "+r+" does not contains url"),null;var b=null;if("string"==typeof _)b=_;else{var w=_||[];if(0==w.length)return null;b=w[Math.min(f,w.length-1)]}p=i.UrlUtils.isUrlRequest(b)?b:"!"+h+"_texture_"+r,s.MapResourceManager.getInstance(e).createStyleTexture(p,b)}else p=u.id;return new t(p,g)},t}();e.TextureStyle=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={layers:{pois:{draw:{points:{size:[[2,0],[15,12]],halo:{color:"#FFF"}}}}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={layers:{roads:{filter:{kind:["highway","major_road","minor_road","path"]},draw:{lines:{color:"#696b6e2f"},text:{color:"#fff",size:[[8,10],[17,12]],halo:{color:"#000"}}},highway:{filter:{kind:["highway"]},draw:{lines:{color:"#fbc0ac2f",width:[[7,1],[10,2],[14,3],[15,5],[16,8],[17,13],[18,20],[19,36]]},text:{size:[[8,12]]}}},major_road:{filter:{kind:["major_road"]},draw:{lines:{width:[[15,4],[16,8],[17,13],[18,20],[19,36]]},text:{size:[[8,12]]}},primary:{filter:{kind_detail:["primary","primary_link"]},draw:{lines:{width:[[15,5],[16,8],[17,13],[18,20],[19,36]]},text:{size:12}}},trunk:{filter:{kind_detail:["trunk","trunk_link"]},draw:{lines:{color:[[7,"#ebb97b2f"],[11,"#fde2932f"]],width:[[7,1],[10,2],[14,3],[15,5],[16,8],[17,13],[18,20],[19,36]]},text:{size:12}}}},minor_road:{filter:{kind:["minor_road","path"]},draw:{lines:{width:[[18,5],[19,10]]}},unclassified:{filter:{kind_detail:["unclassified"]},draw:{lines:{width:[[17,7],[18,10],[19,20]]}}},residential:{filter:{kind_detail:["residential"]},draw:{lines:{width:[[17,7],[18,10],[19,20]]}}}}},boundaries:{draw:{lines:{color:"#ffffff8f",width:[[2,0]]},text:{color:"#fff",size:10,halo:{color:"#000"}}},country:{filter:{kind_detail:["2"]},draw:{lines:{width:[[5,1]]}}},province:{filter:{kind:["province","province_sf"]},draw:{lines:{width:[[8,1],[11,0]]}}},district:{filter:{kind:["district"]},draw:{lines:{width:[[11,1]]}}},ward:{filter:{kind:"ward"},draw:{lines:{width:[[14,0]]}}}},places:{draw:{text:{color:"#fff",size:0,style:"bold",halo:{color:"#000"}}},country:{filter:{kind:["country","country_sf"]},draw:{text:{size:[[3,9],[5,12],[6,18],[9,0]]}}},archipelago:{filter:{kind:["archipelago"]},draw:{text:{size:[[5,9],[6,12],[8,14]]}}},province:{filter:{kind:["province"]},draw:{text:{size:[[7,9],[8,16],[10,20],[14,0]]}},city:{filter:{kind_detail:["city"]},draw:{text:{size:[[5,12],[8,18],[10,20],[14,0]]}}}},district:{filter:{kind:["district"]},draw:{text:{size:[[11,16],[13,18],[14,0]]}}},ward:{filter:{kind:["ward"]},draw:{text:{size:[[14,14],[15,16],[17,0]]}}}},pois:{draw:{points:{color:"#fff",size:[[2,0],[15,12]],halo:{color:"#000"}}}}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.idCounter=1,this.directionsRenderers=new Map}return t.prototype.addDirectionsRenderer=function(t){var e=this.idCounter++;return this.directionsRenderers.set(e,t),e},t.prototype.removeDirectionsRenderer=function(t){this.directionsRenderers.delete(t)},t.prototype.isDirectionsRendererMarker=function(t){var e=!1;return this.directionsRenderers.forEach((function(r){e||r.isMarker(t)&&(e=!0)})),e},t.prototype.getDirectionsRendererByPolylineId=function(t){var e=null;return this.directionsRenderers.forEach((function(r){if(!e){var i=r.getRouteIndexByPolylineId(t);-1!=i&&(e={renderer:r,routeIndex:i})}})),e},t.prototype.getDirectionsRendererByMarkerId=function(t){var e=null;return this.directionsRenderers.forEach((function(r){e||r.isMarker(t)&&(e=r)})),e},t}();e.DirectionsRendererManager=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(55),n=r(4),o=r(1),a=r(19),s=r(2),l=r(276),u=r(51),h=r(58),c=r(21),p=function(){function t(e,r){if(void 0===e&&(e=[]),this.clusters=[],this.events=[],null==e||0==e.length)throw Error("Markers list can not be null or empty");this.markers=e,this.markerClusterMap=new Map;var i={};o.MapUtils.extendOptions(i,t.defaultMarkerClusterOptions,r);for(var n=0,a=i;n<a.length;n++){if(null==a[n])throw Error("Parameters can not be null")}i.radius=i.radius*o.MapUtils.pixelScale,this.zoomOnClick=i.zoomOnClick,this.superCluster=new l.default(i);var s=this.getFeatures();this.superCluster.load(s)}return t.prototype.setMap=function(e){var r=this;if(this.map!==e&&(!e||e.isMapReady())&&(this.map&&(this.events.forEach((function(t){return t.remove()})),this.events=[],this.markers.forEach((function(t){return t.setMap(null)})),this.removeMarkerClusters()),this.map=e,this.map)){this.updateCluster(this.map.getCamera().getZoom());var i=this.map.addListener("click",(function(e){if("mouseup"==e.xa.type&&r.zoomOnClick){var i=e.marker,n=r.markerClusterMap.get(i.getId());if(null!=n){for(var o=r.superCluster.getLeaves(n,s.MapConstants.clusterMaxPointCount),l=new a.LatLngBounds,u=0,h=o;u<h.length;u++){var c=h[u];l.extend([c.geometry.coordinates[0],c.geometry.coordinates[1]])}var p=r.map.mapView.getCameraPositionForLatLngBounds(l,{top:0,left:0,right:0,bottom:0});r.map.fitBounds(l,t.defaultPadding,{animate:!0}),r.updateCluster(p.getZoom())}}}),{marker:!0}),n=this.map.addListener("idle",(function(){var t=r.map.mapView.mapState;(t.isZoomIn()||t.isZoomOut()||t.isFlyingTo())&&r.updateCluster(r.map.getCamera().getZoom())}));this.events.push(i),this.events.push(n)}},t.prototype.setZoomOnClick=function(t){null!=t?this.zoomOnClick=t:c.LogUtils.logNonNull("zoomOnClick")},t.prototype.updateCluster=function(t){this.removeMarkerClusters();var e=this.map.mapView.getBounds();if(null!=e){var r=[e.getSouthwest().lng,e.getSouthwest().lat,e.getNortheast().lng,e.getNortheast().lat],i=this.superCluster.getClusters(r,Math.round(t));this.update(i)}},t.prototype.removeMarkerClusters=function(){this.clusters.forEach((function(t){return t.setMap(null)})),this.clusters=[]},t.prototype.update=function(t){var e=this;for(var r in t)if(null!=t[r].id){var o=this.superCluster.getLeaves(t[r].id,s.MapConstants.clusterMaxPointCount),a=15*(o.length.toString().length-1),l=50+a,c=50+a,p=new h.Icon(l,c,"markerClusterIcon"),f=new i.Marker({position:n.LatLng.convert(t[r].geometry.coordinates),icon:p,label:new u.MarkerLabel({text:o.length.toString(),fontSize:13,color:"#000000",haloColor:"#b22525"})});f.setMap(this.map),this.clusters.push(f),this.markerClusterMap.set(f.getId(),t[r].id),o.forEach((function(t){return e.markers[t.properties.index].setMap(null)}))}else{this.markers[t[r].properties.index].setMap(this.map)}},t.prototype.getFeatures=function(){var t=[];return this.markers.forEach((function(e,r){var i={type:"Feature",properties:{index:r},geometry:{type:"Point",coordinates:[]}};i.geometry.coordinates.push(e.getPosition().lng),i.geometry.coordinates.push(e.getPosition().lat),t.push(i)})),t},t.defaultMarkerClusterOptions={minZoom:0,maxZoom:22,radius:100,zoomOnClick:!0},t.defaultPadding={top:10,bottom:10,left:10,right:10},t}();e.MarkerClusterer=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(4),o=r(12),a=r(1),s=r(6),l=function(){function t(t){this.map=t}return t.prototype.fromLatLngToScreen=function(t,e){void 0===e&&(e=0);var r=this.map.mapView.latLngToScreenCoordinate(n.LatLng.convert(t),e);return a.MapUtils.pixelToPoint(new o.Point(r.x,r.y))},t.prototype.fromScreenToLatLng=function(t,e){void 0===e&&(e=0);var r=o.Point.convert(t),n=a.MapUtils.pointToPixel(r);return this.map.mapView.screenCoordinateToLatLng(new i.Vector2(n.x,n.y),e)},t.prototype.fromLatLngToPoint=function(t){var e=s.ProjectionMercator.projectScale(n.LatLng.convert(t),1/a.MapUtils.pixelScale);return new o.Point(e.x,e.y)},t.prototype.fromPointToLatLng=function(t){var e=o.Point.convert(t);return s.ProjectionMercator.unproject(new i.Vector2(e.x,e.y),1/a.MapUtils.pixelScale)},t}();e.Projection=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),n=r(244),o=function(){function t(t){this._path=[],this._path=t.map((function(t){return i.LatLng.convert(t)}))}return t.prototype.setPath=function(t){this._path=t.map((function(t){return i.LatLng.convert(t)}))},t.prototype.addPath=function(t){var e=this;t.forEach((function(t){return e._path.push(i.LatLng.convert(t))}))},Object.defineProperty(t.prototype,"length",{get:function(){for(var t=0,e=0;e<this._path.length-1;++e)t+=n.SphericalUtil.computeDistanceBetween(this._path[e],this._path[e+1]);return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perimeter",{get:function(){if(this._path.length<3)return 0;var t=this.length;return t+=n.SphericalUtil.computeDistanceBetween(this._path[0],this._path[this._path.length-1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return n.SphericalUtil.computeArea(this._path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){if(0==this._path.length)return null;for(var t=new i.LatLng(0,0),e=0;e<this._path.length;++e)t.lat+=this._path[e].lat,t.lng+=this._path[e].lng;return t.lat/=this._path.length,t.lng/=this._path.length,t},enumerable:!0,configurable:!0}),t}();e.Measure=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(13),n=r(2),o=function(){function t(){}return t.computeDistanceBetweenHelper=function(t,e){var r=i.MathUtils.toRadians(t.lat),n=i.MathUtils.toRadians(t.lng),o=i.MathUtils.toRadians(e.lat),a=i.MathUtils.toRadians(e.lng);return 2*Math.asin(Math.sqrt(Math.pow(Math.sin((r-o)/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin((n-a)/2),2)))},t.sphericalExcess=function(e,r,i){for(var n=[e,r,i,e],o=[],a=0,s=0;s<3;s++)o[s]=t.computeDistanceBetweenHelper(n[s],n[s+1]),a+=o[s];var l=a/2,u=Math.tan(l/2);for(s=0;s<3;s++)u*=Math.tan((l-o[s])/2);return 4*Math.atan(Math.sqrt(Math.abs(u)))},t.sphericalSign=function(t,e,r){var n=[t,e,r].map((function(t){var e=i.MathUtils.toRadians(t.lat),r=i.MathUtils.toRadians(t.lng);return[Math.cos(e)*Math.cos(r),Math.cos(e)*Math.sin(r),Math.sin(e)]}));return 0<n[0][0]*n[1][1]*n[2][2]+n[1][0]*n[2][1]*n[0][2]+n[2][0]*n[0][1]*n[1][2]-n[0][0]*n[2][1]*n[1][2]-n[1][0]*n[0][1]*n[2][2]-n[2][0]*n[1][1]*n[0][2]?1:-1},t.computeSphericalExcess=function(e,r,i){return t.sphericalExcess(e,r,i)*t.sphericalSign(e,r,i)},t.computeSignedArea=function(e){if(e.length<3)return 0;for(var r=0,i=1;i<e.length-1;++i)r+=t.computeSphericalExcess(e[0],e[i],e[i+1]);return r*n.MapConstants.radiusEarthMeters*n.MapConstants.radiusEarthMeters},t.computeDistanceBetween=function(e,r){return t.computeDistanceBetweenHelper(e,r)*n.MapConstants.radiusEarthMeters},t.computeArea=function(e){return Math.abs(t.computeSignedArea(e))},t}();e.SphericalUtil=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),n=r(6),o=r(13),a=r(3),s=function(){function t(t){this.coordinates=[],this.coordinates=t.map((function(t){return i.LatLng.convert(t)}))}return t.prototype.setCoordinates=function(t){this.coordinates=t.map((function(t){return i.LatLng.convert(t)}))},t.prototype.addCoordinates=function(t){var e=this;t.forEach((function(t){return e.coordinates.push(i.LatLng.convert(t))}))},t.prototype.rotate=function(t,e){if(void 0===e&&(e=null),this.coordinates.length<=1)return this.coordinates.slice();var r=null;r=null!=e?i.LatLng.convert(r):this.center;var s=n.ProjectionMercator.convertToMeterFromLatLng(r),l=[],u=o.MathUtils.toRadians(t);return this.coordinates.forEach((function(t){var e=n.ProjectionMercator.convertToMeterFromLatLng(t);e.x-=s.x,e.y-=s.y;var r=e.x,i=e.y;e.x=r*Math.cos(u)-i*Math.sin(u),e.y=r*Math.sin(u)+i*Math.cos(u),l.push(n.ProjectionMercator.convertToLatLngFromMeter(new a.Vector2(s.x+e.x,s.y+e.y)))})),l},t.prototype.translate=function(t,e){if(void 0===e&&(e=null),this.coordinates.length<=0)return[];var r=i.LatLng.convert(t),n=null;n=null!=e?i.LatLng.convert(e):this.center;var o=[],a=r.lng-n.lng,s=r.lat-n.lat;return this.coordinates.forEach((function(t){o.push(new i.LatLng(t.lat+s,t.lng+a))})),o},t.prototype.scale=function(t,e){if(void 0===e&&(e=null),this.coordinates.length<=1)return this.coordinates.slice();var r=null;r=null!=e?i.LatLng.convert(e):this.center;var o=n.ProjectionMercator.convertToMeterFromLatLng(r),s=[];return this.coordinates.forEach((function(e){var r=n.ProjectionMercator.convertToMeterFromLatLng(e);r.x-=o.x,r.y-=o.y,r.x*=t,r.y*=t,s.push(n.ProjectionMercator.convertToLatLngFromMeter(new a.Vector2(o.x+r.x,o.y+r.y)))})),s},Object.defineProperty(t.prototype,"center",{get:function(){if(0==this.coordinates.length)return null;for(var t=new i.LatLng(0,0),e=0;e<this.coordinates.length;++e)t.lat+=this.coordinates[e].lat,t.lng+=this.coordinates[e].lng;return t.lat/=this.coordinates.length,t.lng/=this.coordinates.length,t},enumerable:!0,configurable:!0}),t}();e.CoordinateTransformer=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(31),a=r(247),s=r(1),l=r(4),u=r(11),h=r(5),c=r(21),p=function(t){function e(r){var i=t.call(this,h.ClassType.POI)||this,n={};s.MapUtils.extendOptions(n,e.defaultPOIOptions,r),(!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(c.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled);var o=n.color||n.titleColor;return i.properties=new a.UserPOILayerProperties(n.title,u.Color.fromHex(o||"#F00"),n.subtitle,l.LatLng.convert(n.position),n.type,n.icon,n.zIndex,n.visible,n.draggable,n.clickable),i.elevation=n.elevation,i}return n(e,t),e.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.id=-1),this.map=t,null!=this.map&&(this.id=this.map.mapView.addAnnotation(this)))},e.prototype.getTitle=function(){return this.properties.getTitle()},e.prototype.setTitle=function(t){this.properties.getTitle()!==t&&(this.properties.setTitle(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.getPosition=function(){return this.properties.getPosition()},e.prototype.setPosition=function(t){if(null!=t){var e=l.LatLng.convert(t);this.properties.getPosition().equals(e)||(this.properties.setPosition(e),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0))}else c.LogUtils.logNonNull("position")},e.prototype.getTitleColor=function(){return c.LogUtils.logDeprecated("getTitleColor()","getColor()",!0),this.getColor()},e.prototype.setTitleColor=function(t){c.LogUtils.logDeprecated("setTitleColor(string)","setColor()",!0),this.setColor(t)},e.prototype.getColor=function(){return this.properties.getColor().code},e.prototype.setColor=function(t){this.properties.setColor(u.Color.fromHex(t))},e.prototype.getSubtitle=function(){return this.properties.getSubtitle()},e.prototype.setSubtitle=function(t){this.properties.setSubtitle(t)},e.prototype.getType=function(){return this.properties.getType()},e.prototype.setType=function(t){this.properties.setType(t)},e.prototype.getIcon=function(){return this.properties.getIcon()},e.prototype.setIcon=function(t){this.properties.getIcon()!==t&&(this.properties.setTextureDirty(!0),this.properties.setIcon(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0))},e.prototype.getZIndex=function(){return this.properties.getRank()},e.prototype.setZIndex=function(t){this.properties.setRank(t)},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.setVisible=function(t){this.properties.setVisible(t)},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.setDraggable=function(t){this.properties.setDraggable(t)},e.prototype.getProperties=function(){return this.properties},e.prototype.isUserInteractionEnabled=function(){return c.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){c.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){this.properties.setClickable(t)},e.defaultPOIOptions={title:"",subtitle:"",type:"",elevation:0,zIndex:0,draggable:!1,visible:!0,userInteractionEnabled:!0,clickable:!0},e}(o.Annotation);e.POI=p},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(11),a=function(t){function e(e,r,i,n,a,s,l,u,h,c){var p=t.call(this)||this;return p.id="",p.annotationId=0,p.title=e,p.position=n,p.visible=u,p.draggable=h,p.color=r,p.subtitle=i,p.type=a,p.icon=s,p.rank=l,p.clickable=c,p.textureDirty=!1,p.haloColor=o.Color.fromInt(16777215),p}return n(e,t),e.prototype.getAnnotationId=function(){return this.annotationId},e.prototype.setAnnotationId=function(t){this.annotationId=t},e.prototype.getIcon=function(){return this.icon},e.prototype.setIcon=function(t){this.icon=t},e.prototype.isVisible=function(){return this.visible},e.prototype.setVisible=function(t){this.visible=t},e.prototype.isDraggable=function(){return this.draggable},e.prototype.setDraggable=function(t){this.draggable=t},e.prototype.isTextureDirty=function(){return this.textureDirty},e.prototype.setTextureDirty=function(t){this.textureDirty=t},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e.prototype.getColor=function(){return this.color},e.prototype.setColor=function(t){this.color=t},e}(r(94).POILayerProperties);e.UserPOILayerProperties=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(31),a=r(1),s=r(249),l=r(4),u=r(250),h=r(6),c=r(3),p=r(252),f=r(19),d=r(7),g=r(63),y=r(5),m=r(21),v=function(t){function e(r){var i=t.call(this,y.ClassType.BUILDING)||this,n={};a.MapUtils.extendOptions(n,e.defaultBuildingOptions,r);var o=[],u=null;if(n.position&&(u=l.LatLng.convert(n.position)),!n.model)if(n.coordinates.length>=2){var h=0,c=0;if(n.coordinates.forEach((function(t){var e=l.LatLng.convert(t);o.push(e),h+=e.lat,c+=e.lng})),h/=o.length,c/=o.length,u=new l.LatLng(h,c),n.position){var p=l.LatLng.convert(n.position),f=p.lng-u.lng,d=p.lat-u.lat;u=p;var g=[];o.forEach((function(t){g.push(new l.LatLng(t.lat+d,t.lng+f))})),o=g}}else console.warn("Coordinates size must be greater than 2");return(!n.userInteractionEnabled||null!=r.clickable&&r.userInteractionEnabled)&&(m.LogUtils.logDeprecated("userInteractionEnabled","clickable",!1),n.clickable=null!=r.clickable?n.clickable:n.userInteractionEnabled),i.properties=new s.UserBuildingLayerProperties(n.name,n.scale,n.bearing,u,n.height,n.elevation,n.model,n.texture,o,n.visible,n.draggable,n.clickable,n.selected,n.growUp),i.zIndex=n.zIndex,i.properties.onModelLoaded=null,i.properties.updateBounds(),i.properties.hasBounds=!1,i}return n(e,t),e.prototype.setMap=function(t){if(t&&!this.properties.getModelUrl()&&this.properties.getCoordinates().length<=2)console.error("Cannot add object to the map without any model information");else if(!t||0!=this.properties.getCoordinates().length||this.properties.getLocation()){if(this.map!==t&&(!t||t.isMapReady())&&(null!=this.map&&(this.map.mapView.removeAnnotation(this.id),this.id=-1),this.map=t,this.properties.setMap(t),null!=this.map)){if(!this.properties.getModelUrl()&&this.properties.getCoordinates().length>2){var e=this.properties.getCoordinates(),r=new f.LatLngBounds;e.forEach((function(t){r.extend(t)})),this.properties.updateBoundsFromLatLngBounds(r)}this.id=this.map.mapView.addAnnotation(this)}}else console.error("Cannot add object to the map without knowing object's position")},e.prototype.getPosition=function(){return this.properties.getLocation()},e.prototype.setPosition=function(t){if(null!=t){var e=this.properties.getLocation();this.properties.setLocation(l.LatLng.convert(t));var r=this.properties.getCoordinates();if(r.length>0&&null!=e){var i=this.properties.getLocation(),n=i.lng-e.lng,o=i.lat-e.lat,a=[];r.forEach((function(t){a.push(new l.LatLng(t.lat+o,t.lng+n))})),this.properties.setCoordinates(a)}if(null!=this.map){var s=d.MapResourceManager.getInstance(this.map.mapView.gl).getModel(this.properties.getModelName());s?(this.properties.setCoverPoints(s.points),this.properties.updateBounds(new g.BoundingBox(s.minX,s.minY,s.maxX,s.maxY))):this.properties.updateBounds(),this.map.mapView.updateAnnotation(this.id,!0)}}else m.LogUtils.logNonNull("location")},e.prototype.getName=function(){return this.properties.getName()},e.prototype.setName=function(t){null!=t?this.properties.setName(t):m.LogUtils.logNonNull("name")},e.prototype.getBearing=function(){return this.properties.getBearing()},e.prototype.setBearing=function(t){null!=t?this.properties.getBearing()!=t&&(this.properties.setBearing(t),this.properties.updateBounds(),this.properties.hasBounds=!1,null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):m.LogUtils.logNonNull("bearing")},e.prototype.getScale=function(){return this.properties.getScale()},e.prototype.setScale=function(t){null!=t?t<=0?console.warn("Parameter scale can not be less than 0"):this.properties.getScale()!=t&&(this.properties.setScale(t),this.properties.updateBounds(),this.properties.hasBounds=!1,null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):m.LogUtils.logNonNull("scale")},e.prototype.getHeight=function(){return this.properties.getHeight()},e.prototype.setHeight=function(t){null!=t?null!=this.properties.getCoordinates()&&0!=this.properties.getCoordinates().length?this.properties.getHeight()!=t&&(this.properties.setHeight(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):console.warn("Object with Obj model is unsupported this action"):m.LogUtils.logNonNull("height")},e.prototype.getElevation=function(){return this.properties.getElevation()},e.prototype.setElevation=function(t){null!=t?(this.properties.setElevation(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)):m.LogUtils.logNonNull("elevation")},e.prototype.isSelected=function(){return this.properties.isSelected()},e.prototype.setSelected=function(t){this.properties.isSelected()!=t&&(this.properties.setSelected(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id))},e.prototype.setModel=function(t){null!=t?this.properties.getModelUrl()!=t&&(this.properties.setModelUrl(t),this.properties.updateBounds(),this.properties.hasBounds=!1,null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):console.warn("Model data could not be null")},e.prototype.getCoordinates=function(){return(this.properties.getCoordinates()||[]).slice()},e.prototype.setCoordinates=function(t){if(null==t||t.length<=2)console.warn("Coordinates size must be != null or greater than 2");else{var e=0,r=0,i=[];t.forEach((function(t){var n=l.LatLng.convert(t);i.push(n),e+=n.lat,r+=n.lng})),e/=i.length,r/=i.length;var n=new l.LatLng(e,r);this.properties.setLocation(n),this.properties.setCoordinates(i),this.properties.updateBounds(),this.properties.hasBounds=!1,null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)}},e.prototype.setTexture=function(t){null!=t?this.properties.getTextureUrl()!=t&&(this.properties.setTextureUrl(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id,!0)):console.warn("Texture data could not be null")},e.prototype.isVisible=function(){return this.properties.isVisible()},e.prototype.setVisible=function(t){this.properties.setVisible(t),null!=this.map&&this.map.mapView.updateAnnotation(this.id)},e.prototype.isGrowUp=function(){return this.properties.isGrowUp()},e.prototype.setGrowUp=function(t){this.properties.setGrowUp(t)},e.prototype.isDraggable=function(){return this.properties.isDraggable()},e.prototype.setDraggable=function(t){null!=t?this.properties.setDraggable(t):m.LogUtils.logNonNull("draggable")},e.prototype.isUserInteractionEnabled=function(){return m.LogUtils.logDeprecated("isUserInteractionEnabled()","isClickable()",!0),this.properties.isClickable()},e.prototype.setUserInteraction=function(t){m.LogUtils.logDeprecated("setUserInteraction(boolean)","setClickable(boolean)",!0),this.properties.setClickable(t)},e.prototype.isClickable=function(){return this.properties.isClickable()},e.prototype.setClickable=function(t){this.properties.setClickable(t)},e.prototype.getProperties=function(){return this.properties},e.prototype.getTileCovers=function(t,e){var r=this;if(e){if(!this.map)return console.warn("This Building was not added to Map or it is not referenced to Building in Map"),void e([]);var i=function(){for(var i=[],n=0;n<t.length;++n){var o=u.tiles(r.createFeatureData(),{min_zoom:t[n],max_zoom:t[n]});o&&o.forEach((function(t){i.push({x:t[0],y:t[1],z:t[2]})}))}e(i)};this.properties.hasBounds?(i(),this.properties.onModelLoaded=null):this.properties.onModelLoaded=i}},e.prototype.getBoundsCoordinates=function(t){var e=this;if(t){if(!this.map)return console.warn("This Building was not added to Map or it is not referenced to Building in Map"),t([]),null;var r=function(){var r=[],i=e.properties.getCoverPoints();if(i){for(var n=0;n<i.length;++n)r.push(i[n]);r=p.ConvexHull.makeHull(r)}else{e.getCoverCoordinates().forEach((function(t){r.push(t)}))}t(r)};this.properties.hasBounds?(r(),this.properties.onModelLoaded=null):this.properties.onModelLoaded=r}},e.prototype.getCoverCoordinates=function(){var t=this,e=h.ProjectionMercator.convertToMeterFromLatLng(this.getPosition()),r=[],i=this.getBearing()*Math.PI/180;return this.properties.getCoordinates().forEach((function(n){var o=h.ProjectionMercator.convertToMeterFromLatLng(n);if(o.x-=e.x,o.y-=e.y,0!=i){var a=o.x,s=o.y;o.x=(a*Math.cos(i)-s*Math.sin(i))*t.getScale(),o.y=(a*Math.sin(i)+s*Math.cos(i))*t.getScale()}else o.x=o.x*t.getScale(),o.y=o.y*t.getScale();var l=h.ProjectionMercator.convertToLatLngFromMeter(new c.Vector2(e.x+o.x,e.y+o.y));r.push(l)})),r},e.prototype.createFeatureData=function(){var t,e=[],r=this.properties.getCoverPoints();if(r){for(var i=0;i<r.length;++i)e.push([r[i].lng,r[i].lat]);t={type:"MultiPoint",properties:{},coordinates:e}}else{var n=this.getCoverCoordinates();n.forEach((function(t){e.push([t.lng,t.lat])})),e.push([n[0].lng,n[0].lat]),t={type:"Polygon",properties:{},coordinates:[e]}}return t},e.defaultBuildingOptions={name:"Unknown name",scale:1,bearing:0,elevation:0,height:1,model:null,texture:null,coordinates:[],zIndex:0,draggable:!1,visible:!0,userInteractionEnabled:!0,selected:!1,growUp:!0,clickable:!0},e}(o.Annotation);e.Building=v},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(93),a=r(12),s=r(6),l=r(3),u=r(19),h=function(t){function e(e,r,i,n,o,a,s,l,u,h,c,p,f,d){void 0===u&&(u=[]);var g=t.call(this)||this;return g.growUpscale=0,g.name=e,g.scale=r,g.bearing=i,g.location=n,g.height=o,g.elevation=a,g.modelUrl=s,g.modelName=g.getNameFromUrl(s),g.textureUrl=l,g.textureName=g.getNameFromUrl(l),g.coordinates=u,g.visible=h,g.draggable=c,g.clickable=p,g.selected=f,g.growUp=d,g._annotationId=0,g._hasBounds=!1,g._updateExtrudeModel=!1,g._coverPoints=null,g._onModelLoaded=null,g._map=null,g}return n(e,t),e.prototype.getAnnotationId=function(){return this._annotationId},e.prototype.setAnnotationId=function(t){this._annotationId=t},e.prototype.setModelUrl=function(t){t?(this.modelUrl=t,this.modelName=this.getNameFromUrl(t),this.coordinates=[]):console.warn("Can not set Model Url with null")},e.prototype.setTextureUrl=function(t){t?(this.textureUrl=t,this.textureName=this.getNameFromUrl(t)):console.warn("Can not set Texture Url with null")},e.prototype.setCoordinates=function(e){t.prototype.setCoordinates.call(this,e),this.modelUrl=null,this.modelName=null,this._updateExtrudeModel=!0},e.prototype.isVisible=function(){return this.visible},e.prototype.setVisible=function(t){this.visible=t},e.prototype.setDraggable=function(t){this.draggable=t},e.prototype.isDraggable=function(){return this.draggable},e.prototype.isClickable=function(){return this.clickable},e.prototype.setClickable=function(t){this.clickable=t},e.prototype.isGrowUp=function(){return this.growUp},e.prototype.setGrowUp=function(t){this.growUp=t},Object.defineProperty(e.prototype,"updateExtrudeModel",{get:function(){return this._updateExtrudeModel},set:function(t){this._updateExtrudeModel=t},enumerable:!0,configurable:!0}),e.prototype.getNameFromUrl=function(t){if(!t)return null;var e=t.split("/");return e[e.length-1]},e.prototype.getCoverPoints=function(){return this._coverPoints},e.prototype.setCoverPoints=function(t){if(null!=t&&0!=t.length&&(t.sort((function(t,e){return t.y==e.y?t.x-e.x:t.y-e.y})),t=t.filter((function(t,e,r){return 0==e||t.x!=r[e-1].x||t.y!=r[e-1].y}))),null!=t&&0!=t.length){for(var e=this.getBearing(),r=this.getScale(),i=s.ProjectionMercator.convertToMeterFromLatLng(this.getLocation()),n=[],o=t.map((function(t){return new a.Point(t.x,t.y)})),u=0;u<o.length;++u){if(0!=e){var h=o[u].x,c=o[u].y;o[u].x=(h*Math.cos(e*Math.PI/180)+c*Math.sin(e*Math.PI/180))*r,o[u].y=(h*Math.sin(e*Math.PI/180)-c*Math.cos(e*Math.PI/180))*r}else o[u].x=o[u].x*r,o[u].y=-o[u].y*r;var p=s.ProjectionMercator.convertToLatLngFromMeter(new l.Vector2(i.x+o[u].x,i.y+o[u].y));n.push(p)}this._coverPoints=n}},e.prototype.updateBounds=function(t){this._boundingBox=t;var e=0,r=0,i=0,n=0;if(this._boundingBox){var o=this.getScale();e=this._boundingBox.minX*o,r=this._boundingBox.minY*o,i=this._boundingBox.maxX*o,n=this._boundingBox.maxY*o;var a=-this.getBearing();if(0!=a){var h=new l.Vector2(i,r),c=new l.Vector2(e,n),p=new l.Vector2(i,n),f=new l.Vector2(e,r);c=new l.Vector2(c.x*Math.cos(a*Math.PI/180)-c.y*Math.sin(a*Math.PI/180),c.x*Math.sin(a*Math.PI/180)+c.y*Math.cos(a*Math.PI/180)),h=new l.Vector2(h.x*Math.cos(a*Math.PI/180)-h.y*Math.sin(a*Math.PI/180),h.x*Math.sin(a*Math.PI/180)+h.y*Math.cos(a*Math.PI/180)),p=new l.Vector2(p.x*Math.cos(a*Math.PI/180)-p.y*Math.sin(a*Math.PI/180),p.x*Math.sin(a*Math.PI/180)+p.y*Math.cos(a*Math.PI/180)),f=new l.Vector2(f.x*Math.cos(a*Math.PI/180)-f.y*Math.sin(a*Math.PI/180),f.x*Math.sin(a*Math.PI/180)+f.y*Math.cos(a*Math.PI/180)),e=Math.min(c.x,h.x,p.x,f.x),i=Math.max(c.x,h.x,p.x,f.x),r=Math.min(c.y,h.y,p.y,f.y),n=Math.max(c.y,h.y,p.y,f.y)}}var d=this.getLocation(),g=s.ProjectionMercator.convertToMeterFromLatLng(d),y=new l.Vector2(g.x+e,g.y-n),m=new l.Vector2(g.x+i,g.y-r),v=new u.LatLngBounds(s.ProjectionMercator.convertToLatLngFromMeter(y),s.ProjectionMercator.convertToLatLngFromMeter(m));this.updateBoundsFromLatLngBounds(v)},e.prototype.updateBoundsFromLatLngBounds=function(t){var e=t.getSouthwest(),r=t.getNortheast();if(this.getMap()&&!this._boundingBox){var i=this.getScale();if(i>0){var n=this.getMap().mapView.mapState.getScale(),o=s.ProjectionMercator.projectScale(e,n),a=s.ProjectionMercator.projectScale(r,n),u=s.ProjectionMercator.projectScale(this.getLocation(),n),h=new l.Vector2(a.x-u.x,u.y-a.y),c=new l.Vector2(u.x-o.x,o.y-u.y),p=new l.Vector2(u.x+i*h.x,u.y-i*h.y),f=new l.Vector2(u.x-i*c.x,u.y+i*c.y);r=s.ProjectionMercator.unproject(p,n),e=s.ProjectionMercator.unproject(f,n)}}this._minX=e.lng,this._minY=e.lat,this._maxX=r.lng,this._maxY=r.lat,this._hasBounds=!0},Object.defineProperty(e.prototype,"onModelLoaded",{get:function(){return this._onModelLoaded},set:function(t){this._onModelLoaded=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasBounds",{get:function(){return this._hasBounds},set:function(t){this._hasBounds=t},enumerable:!0,configurable:!0}),e.prototype.getMap=function(){return this._map},e.prototype.setMap=function(t){this._map=t},Object.defineProperty(e.prototype,"minX",{get:function(){return this._minX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minY",{get:function(){return this._minY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxX",{get:function(){return this._maxX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxY",{get:function(){return this._maxY},enumerable:!0,configurable:!0}),e}(o.BuildingLayerProperties);e.UserBuildingLayerProperties=h},function(t,e,r){"use strict";var i=r(251);function n(t){return{type:"Feature",geometry:i.tileToGeoJSON(t),properties:{}}}function o(t,e){var r,n,o=t.coordinates,s=e.max_zoom,c={},p=[];if("Point"===t.type)return[i.pointToTile(o[0],o[1],s)];if("MultiPoint"===t.type)for(r=0;r<o.length;r++)c[h((n=i.pointToTile(o[r][0],o[r][1],s))[0],n[1],n[2])]=!0;else if("LineString"===t.type)l(c,o,s);else if("MultiLineString"===t.type)for(r=0;r<o.length;r++)l(c,o[r],s);else if("Polygon"===t.type)a(c,p,o,s);else{if("MultiPolygon"!==t.type)throw new Error("Geometry type not implemented");for(r=0;r<o.length;r++)a(c,p,o[r],s)}if(e.min_zoom!==s){var f=p.length;for(u(c,p),r=0;r<f;r++){var d=p[r];c[h(d[0],d[1],d[2])]=!0}return function(t,e,r){for(var i=[],n=r.max_zoom;n>r.min_zoom;n--){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s];if(l[0]%2==0&&l[1]%2==0){var u=h(l[0]+1,l[1],n),c=h(l[0],l[1]+1,n),p=h(l[0]+1,l[1]+1,n);if(t[u]&&t[c]&&t[p]){t[h(l[0],l[1],l[2])]=!1,t[u]=!1,t[c]=!1,t[p]=!1;var f=[l[0]/2,l[1]/2,n-1];n-1===r.min_zoom?i.push(f):(o[h(l[0]/2,l[1]/2,n-1)]=!0,a.push(f))}}}for(s=0;s<e.length;s++)l=e[s],t[h(l[0],l[1],l[2])]&&i.push(l);t=o,e=a}return i}(c,p,e)}return u(c,p),p}function a(t,e,r,i){for(var n=[],o=0;o<r.length;o++){var a=[];l(t,r[o],i,a);for(var u=0,c=a.length,p=c-1;u<c;p=u++){var f=(u+1)%c,d=a[u][1];(d>a[p][1]||d>a[f][1])&&(d<a[p][1]||d<a[f][1])&&d!==a[f][1]&&n.push(a[u])}}for(n.sort(s),o=0;o<n.length;o+=2){d=n[o][1];for(var g=n[o][0]+1;g<n[o+1][0];g++){t[h(g,d,i)]||e.push([g,d,i])}}}function s(t,e){return t[1]-e[1]||t[0]-e[0]}function l(t,e,r,n){for(var o,a,s=0;s<e.length-1;s++){var l=i.pointToTileFraction(e[s][0],e[s][1],r),u=i.pointToTileFraction(e[s+1][0],e[s+1][1],r),c=l[0],p=l[1],f=u[0]-c,d=u[1]-p;if(0!==d||0!==f){var g=f>0?1:-1,y=d>0?1:-1,m=Math.floor(c),v=Math.floor(p),_=0===f?1/0:Math.abs(((f>0?1:0)+m-c)/f),b=0===d?1/0:Math.abs(((d>0?1:0)+v-p)/d),w=Math.abs(g/f),x=Math.abs(y/d);for(m===o&&v===a||(t[h(m,v,r)]=!0,n&&v!==a&&n.push([m,v]),o=m,a=v);_<1||b<1;)_<b?(_+=w,m+=g):(b+=x,v+=y),t[h(m,v,r)]=!0,n&&v!==a&&n.push([m,v]),o=m,a=v}}n&&v===n[0][1]&&n.pop()}function u(t,e){for(var r,i,n,o,a,s=Object.keys(t),l=0;l<s.length;l++)e.push((r=+s[l],i=void 0,n=void 0,o=void 0,a=void 0,void 0,[a=(o=(r-(i=r%32))/32)%(n=2*(1<<i)),(o-a)/n%n,i]))}function h(t,e,r){return 32*(2*(1<<r)*e+t)+r}e.geojson=function(t,e){return{type:"FeatureCollection",features:o(t,e).map(n)}},e.tiles=o,e.indexes=function(t,e){return o(t,e).map(i.tileToQuadkey)}},function(t,e,r){"use strict";var i=Math.PI/180,n=180/Math.PI;function o(t){var e=a(t[0]+1,t[2]);return[a(t[0],t[2]),s(t[1]+1,t[2]),e,s(t[1],t[2])]}function a(t,e){return t/Math.pow(2,e)*360-180}function s(t,e){var r=Math.PI-2*Math.PI*t/Math.pow(2,e);return n*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}function l(t,e,r){var i=d(t,e,r);return i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i}function u(t){return[[2*t[0],2*t[1],t[2]+1],[2*t[0]+1,2*t[1],t[2]+1],[2*t[0]+1,2*t[1]+1,t[2]+1],[2*t[0],2*t[1]+1,t[2]+1]]}function h(t){return t[0]%2==0&&t[1]%2==0?[t[0]/2,t[1]/2,t[2]-1]:t[0]%2==0&&!t[1]%2==0?[t[0]/2,(t[1]-1)/2,t[2]-1]:!t[0]%2==0&&t[1]%2==0?[(t[0]-1)/2,t[1]/2,t[2]-1]:[(t[0]-1)/2,(t[1]-1)/2,t[2]-1]}function c(t){return u(h(t))}function p(t,e){for(var r=0;r<t.length;r++)if(f(t[r],e))return!0;return!1}function f(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function d(t,e,r){var n=Math.sin(e*i),o=Math.pow(2,r);return[o*(t/360+.5),o*(.5-.25*Math.log((1+n)/(1-n))/Math.PI),r]}t.exports={tileToGeoJSON:function(t){var e=o(t);return{type:"Polygon",coordinates:[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]}},tileToBBOX:o,getChildren:u,getParent:h,getSiblings:c,hasTile:p,hasSiblings:function(t,e){for(var r=c(t),i=0;i<r.length;i++)if(!p(e,r[i]))return!1;return!0},tilesEqual:f,tileToQuadkey:function(t){for(var e="",r=t[2];r>0;r--){var i=0,n=1<<r-1;0!=(t[0]&n)&&i++,0!=(t[1]&n)&&(i+=2),e+=i.toString()}return e},quadkeyToTile:function(t){for(var e=0,r=0,i=t.length,n=i;n>0;n--){var o=1<<n-1,a=+t[i-n];1===a&&(e|=o),2===a&&(r|=o),3===a&&(e|=o,r|=o)}return[e,r,i]},pointToTile:l,bboxToTile:function(t){var e=l(t[0],t[1],32),r=l(t[2],t[3],32),i=[e[0],e[1],r[0],r[1]],n=function(t){for(var e=0;e<28;e++){var r=1<<32-(e+1);if((t[0]&r)!=(t[2]&r)||(t[1]&r)!=(t[3]&r))return e}return 28}(i);return 0===n?[0,0,0]:[i[0]>>>32-n,i[1]>>>32-n,n]},pointToTileFraction:d}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.makeHullPresorted=function(t){if(t.length<=1)return t.slice();for(var e=[],r=0;r<t.length;r++){for(var i=t[r];e.length>=2;){var n=e[e.length-1],o=e[e.length-2];if(!((n.lng-o.lng)*(i.lat-o.lat)>=(n.lat-o.lat)*(i.lng-o.lng)))break;e.pop()}e.push(i)}e.pop();var a=[];for(r=t.length-1;r>=0;r--){for(i=t[r];a.length>=2;){n=a[a.length-1],o=a[a.length-2];if(!((n.lng-o.lng)*(i.lat-o.lat)>=(n.lat-o.lat)*(i.lng-o.lng)))break;a.pop()}a.push(i)}return a.pop(),1==e.length&&1==a.length&&e[0].lng==a[0].lng&&e[0].lat==a[0].lat?e:e.concat(a)},t.POINT_COMPARATOR=function(t,e){return t.lng<e.lng?-1:t.lng>e.lng?1:t.lat<e.lat?-1:t.lat>e.lat?1:0},t.makeHull=function(e){var r=e.slice();return r.sort(t.POINT_COMPARATOR),t.makeHullPresorted(r)},t}();e.ConvexHull=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(34),a=r(44),s=r(0),l=r(2),u=r(1),h=function(t){function e(r){var i=t.call(this,o.OverlayType.BUILDING)||this,n={};u.MapUtils.extendOptions(n,e.defaultBuildingOverlayOptions,r);var s=n.visible;return i.prefixId=n.prefixId||"",i.properties=new a.OverlayProperties(s),i.getBuildingUrl=n.getUrl,i.parserBuildingData=n.parserData,null!=i.getBuildingUrl&&null!=i.parserBuildingData||(i.isValid=!1,console.warn("The BuildingOverlay is invalid, getUrl or parserData undefined")),i}return n(e,t),e.prototype.getUrl=function(t,e,r){return this.getBuildingUrl(t,e,r)},e.prototype.parserData=function(t){return this.parserBuildingData(t)},e.prototype.getPrefixId=function(){return this.prefixId},e.prototype.createLayer=function(t,e){this.properties.setLayerId(e);var r=t.createLayer(e,s.LayerType.BUILDING_OVERLAY,l.MapConstants.buildingLayerOrder);r.effectManager=this.map.mapView.effectManager,r.timeEffectManager=this.map.mapView.timeEffectManager,r.setLightingManager(this.map.mapView.lightManager),r.setProperties(this.properties)},e.prototype.removeLayer=function(t){t.removeLayer(this.properties.getLayerId(),l.MapConstants.buildingLayerOrder)},e.defaultBuildingOverlayOptions={prefixId:"",visible:!0},e}(o.Overlay);e.BuildingOverlay=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(34),a=r(44),s=function(t){function e(e){var r=t.call(this,o.OverlayType.TILE)||this,i=e||{};return r.getTileUrl=i.getUrl,r.properties=new a.OverlayProperties(null==i.visible||i.visible,i.zIndex||0,i.opacity||1),null==r.getTileUrl&&(r.isValid=!1,console.warn("The TileOverlay is invalid, getUrl undefined")),r}return n(e,t),e.prototype.getUrl=function(t,e,r,i){return this.getTileUrl?this.getTileUrl(t,e,r,i):""},e.prototype.getZIndex=function(){return this.properties.getZIndex()},e}(o.Overlay);e.TileOverlay=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(19),a=r(34),s=r(44),l=function(t){function e(e){var r=t.call(this,a.OverlayType.GROUND)||this,i=e||{};return r.bounds=o.LatLngBounds.convert(i.bounds),r.override=null!=i.override&&i.override,r.getGroundUrl=i.getUrl,r.properties=new s.OverlayProperties(null==i.visible||i.visible,i.zIndex||0,i.opacity||1),null==r.getGroundUrl&&(r.isValid=!1,console.warn("The GroundOverlay is invalid, getUrl undefined")),r}return n(e,t),e.prototype.getBounds=function(){return this.bounds},e.prototype.getUrl=function(t,e,r,i){return null!=this.getGroundUrl?this.getGroundUrl(t,e,r,i):""},e.prototype.isOverride=function(){return this.override},e.prototype.getZIndex=function(){return this.properties.getZIndex()},e}(a.Overlay);e.GroundOverlay=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(34),a=r(44),s=function(t){function e(e){var r=t.call(this,o.OverlayType.POI)||this,i=e||{};return r.getPOIUrl=i.getUrl,r.parserPOIData=i.parserData,r.prefixId=i.prefixId||"",r.properties=new a.OverlayProperties(null==i.visible||i.visible),null!=r.getPOIUrl&&null!=r.parserPOIData||(r.isValid=!1,console.warn("The POIOverlay is invalid, getUrl or parserData undefined")),r}return n(e,t),e.prototype.getUrl=function(t,e,r){return this.getPOIUrl(t,e,r)},e.prototype.parserData=function(t){return this.parserPOIData(t)},e.prototype.getPrefixId=function(){return this.prefixId},e}(o.Overlay);e.POIOverlay=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(34),a=r(19),s=r(258),l=function(t){function e(e){var r=t.call(this,o.OverlayType.IMAGE)||this,i=e||{};return r.bounds=a.LatLngBounds.convert(i.bounds),r.url=i.url,r.properties=new s.ImageOverlayProperties(r.bounds,null==i.visible||i.visible,i.zIndex||0,i.opacity||1),null==r.url&&(r.isValid=!1,console.warn("The ImageOverlay is invalid, url undefined")),r}return n(e,t),e.prototype.getBounds=function(){return this.bounds},e.prototype.getUrl=function(){return this.url},e}(o.Overlay);e.ImageOverlay=l},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(44),a=r(4),s=function(t){function e(e,r,i,n){var o=t.call(this,r,i,n)||this;return o.bounds=e,o.center=new a.LatLng((e.getSouthwest().lat+e.getNortheast().lat)/2,(e.getSouthwest().lng+e.getNortheast().lng)/2),o}return n(e,t),e.prototype.getBounds=function(){return this.bounds},e.prototype.getCenter=function(){return this.center},e}(o.OverlayProperties);e.ImageOverlayProperties=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(4),o=r(55),a=r(40),s=r(260),l=r(28),u=r(21),h=function(){function t(t){this.id=0,this.initialize(t)}return t.prototype.initialize=function(e){var r={};i.MapUtils.extendOptions(r,t.defaultOptions,e),this.waypointsOnRoute=[];var s=r.routes;if(s)if(Array.isArray(s))this.routes=s.map((function(t){return t.map((function(t){return n.LatLng.convert(t)}))}));else if("object"==typeof s&&"paths"in s){var l=s.waypoints||[];this.waypointsOnRoute=l.map((function(t){return n.LatLng.convert(t)}));var h=s.paths||[];this.routes=h.map((function(t){return t.map((function(t){return n.LatLng.convert(t)}))}))}else"object"!=typeof s&&"string"!=typeof s||(this.routes=this.parseRoutesJsonData(s));else e.directions?(u.LogUtils.logDeprecated("directions","routes",!1),this.routes=[]):this.routes=[];this.activeStrokePattern=r.activeStrokePattern,this.inactiveStrokePattern=r.inactiveStrokePattern,this.activedIndex=r.activedIndex||0,this.activeStrokeWidth=r.activeStrokeWidth,this.activeStrokeColor=r.activeStrokeColor,this.activeOutlineWidth=r.activeOutlineWidth,this.activeOutlineColor=r.activeOutlineColor,this.inactiveStrokeWidth=r.inactiveStrokeWidth,this.inactiveStrokeColor=r.inactiveStrokeColor,this.inactiveOutlineWidth=r.inactiveOutlineWidth,this.inactiveOutlineColor=r.inactiveOutlineColor,this.onMarkerDragEnd=r.onMarkerDragEnd,this.lines=[],this.outlines=[],this.waypointMarkers=[],this.waypointToRoutePolylines=[];var c=r.originMarkerOptions||{};this.hasOriginPoint=!!c.position,c.position=c.position||[0,0];var p=r.destinationMarkerOptions||{};this.hasDestinationPoint=!!p.position,p.position=p.position||[0,0];var f=r.waypointMarkerOptions||[],d=f.length;if(this.hasMarkerWaypoint=d>0,!this.onMarkerDragEnd&&(c.draggable=!1,p.draggable=!1,this.hasMarkerWaypoint))for(var g=0;g<d;++g)f[g].draggable=!1;if(this.originMarker=new o.Marker(c),this.destinationMarker=new o.Marker(p),this.hasMarkerWaypoint)for(g=0;g<d;++g){var y=new o.Marker(f[g]);this.waypointMarkers.push(y),this.waypointToRoutePolylines.push(new a.Polyline({path:[],strokeWidth:2,zIndex:-32e5,style:"dotted",strokeColor:"#aaaaaa",clickable:!1,lineCapType:a.LineCapType.Round,lineJoinType:a.LineJoinType.Round}))}this.originToRoutePolyline=new a.Polyline({path:[],strokeWidth:2,zIndex:-32e5,style:"dotted",strokeColor:"#aaaaaa",clickable:!1,lineCapType:a.LineCapType.Round,lineJoinType:a.LineJoinType.Round}),this.destinationToRoutePolyline=new a.Polyline({path:[],strokeWidth:2,zIndex:-32e5,style:"dotted",strokeColor:"#aaaaaa",clickable:!1,lineCapType:a.LineCapType.Round,lineJoinType:a.LineJoinType.Round})},t.prototype.setOptions=function(t){this.initialize(t),this.updateAllAnnotations()},t.prototype.setActiveStrokePattern=function(t){this.activeStrokePattern=t,this.updateAllAnnotations()},t.prototype.setInactiveStrokePattern=function(t){this.inactiveStrokePattern=t,this.updateAllAnnotations()},t.prototype.setMap=function(t){this.map===t||t&&!t.isMapReady()||(null!=this.map&&(this.removeObjecsFromMap(),this.map.mapView.directionsRendererManager.removeDirectionsRenderer(this.id),this.id=0),this.map=t,null!=t&&(this.id=this.map.mapView.directionsRendererManager.addDirectionsRenderer(this),this.setupAllAnnotations()))},t.prototype.getMap=function(){return this.map},t.prototype.getOriginMarker=function(){return this.originMarker},t.prototype.getDestinationMarker=function(){return this.destinationMarker},t.prototype.getWaypointMarkers=function(){return this.waypointMarkers},t.prototype.setRoutes=function(t){if(t)if(Array.isArray(t))this.waypointsOnRoute=[],this.setRoutesInternal(t);else if("object"==typeof t&&"paths"in t){var e=t.waypoints||[];this.waypointsOnRoute=e.map((function(t){return n.LatLng.convert(t)})),this.setRoutesInternal(t.paths)}else"object"!=typeof t&&"string"!=typeof t||this.setRoutesInternal(this.parseRoutesJsonData(t))},t.prototype.getRoutes=function(){return(this.routes||[]).slice()},t.prototype.setDirections=function(t){u.LogUtils.logDeprecated("setDirections(string)","setRoutes()",!0)},t.prototype.setActivedIndex=function(t){var e=this.activedIndex;t>=this.routes.length?this.activedIndex=0:this.activedIndex=t,e!=this.activedIndex&&this.map&&(this.swapLineOptions(this.lines[e],this.lines[this.activedIndex]),this.swapLineOptions(this.outlines[e],this.outlines[this.activedIndex]))},t.prototype.getActivedIndex=function(){return this.activedIndex},t.prototype.getRouteIndexByPolylineId=function(t){for(var e=0;e<this.lines.length;e++)if(this.lines[e].getId()==t||this.outlines[e].getId()==t)return e;return-1},t.prototype.isMarker=function(t){var e=this.originMarker.getId()==t||this.destinationMarker.getId()==t;if(e)return!0;if(this.hasMarkerWaypoint)for(var r=0;r<this.waypointMarkers.length;r++)if(this.waypointMarkers[r].getId()==t)return!0;return e},t.prototype.setRoutesInternal=function(t){var e=t||[];this.routes=e.map((function(t){return t.map((function(t){return n.LatLng.convert(t)}))})),this.activedIndex>=this.routes.length&&(this.activedIndex=0),this.updateAllAnnotations()},t.prototype.setupAllAnnotations=function(){this.routes.length>0?(this.setupRouteLines(),this.setupOriginWaypoint(),this.setupDestinationWaypoint(),this.setUpMiddleWaypoints()):this.setupMarkerWithEmptyRoute()},t.prototype.updateAllAnnotations=function(){this.removeObjecsFromMap(),this.map&&(this.lines=[],this.outlines=[],this.setupAllAnnotations())},t.prototype.getWaypointsFromRoute=function(t){var e=[];if(!t)return e;var r=t.snappedWaypoints||[];if(r.length<3)return e;for(var i=1;i<r.length-1;++i)e.push(n.LatLng.convert(r[i]));return e},t.prototype.parseRoutesJsonData=function(t){var e=null;if("string"==typeof t)try{e=JSON.parse(t)||{}}catch(t){return[]}else"object"==typeof t&&(e=t);var r=((e=e||{}).result||{}).routes||[];if(0==r.length)return this.waypointsOnRoute=[],[];for(var i=[],o=0,a=r;o<a.length;o++){var l=a[o],u=l.legs||[];if(0!=u.length){for(var h=[],c=0,p=u;c<p.length;c++){var f=p[c];h.push(n.LatLng.convert(f.startLocation));for(var d=f.steps||[],g=0;g<d.length;g++){var y=d[g],m=s.PolylineCodec.decode(y.polyline);h.push.apply(h,m)}h.push(n.LatLng.convert(f.endLocation))}i.push(h),this.waypointsOnRoute=this.getWaypointsFromRoute(l)}}return i},t.prototype.setupOriginWaypoint=function(){var t=this.routes[this.activedIndex];if(t&&0!=t.length&&this.originMarker.isVisible()){var e=t[0];this.hasOriginPoint?(this.originToRoutePolyline.setPath([e,this.originMarker.getPosition()]),this.originToRoutePolyline.setMap(this.map)):(this.originMarker.setPosition(e),this.originToRoutePolyline.setMap(null)),this.originMarker.setMap(this.map)}},t.prototype.setupDestinationWaypoint=function(){var t=this.routes[this.activedIndex];if(t&&0!=t.length&&this.destinationMarker.isVisible()){var e=t[t.length-1];this.hasDestinationPoint?(this.destinationToRoutePolyline.setPath([e,this.destinationMarker.getPosition()]),this.destinationToRoutePolyline.setMap(this.map)):(this.destinationMarker.setPosition(e),this.destinationToRoutePolyline.setMap(null)),this.destinationMarker.setMap(this.map)}},t.prototype.setUpMiddleWaypoints=function(){var t=this;if(0==this.waypointsOnRoute.length?console.warn("There aren't any waypoints on the route of Directions Renderer "+this.id):this.waypointsOnRoute.length!=this.waypointMarkers.length&&console.warn("The number of waypoints on the route is not equal to the number of waypoints marker options on Directions Renderer "+this.id),this.waypointsOnRoute.length<=this.waypointMarkers.length){for(var e=0;e<this.waypointsOnRoute.length;++e){var r=this.waypointMarkers[e];(i=this.waypointToRoutePolylines[e]).setPath([this.waypointsOnRoute[e],r.getPosition()]),i.setMap(this.map)}this.waypointMarkers.forEach((function(e){e.setMap(t.map)}))}else for(e=0;e<this.waypointMarkers.length;++e){var i;(r=this.waypointMarkers[e]).setMap(this.map),(i=this.waypointToRoutePolylines[e]).setPath([this.waypointsOnRoute[e],r.getPosition()]),i.setMap(this.map)}},t.prototype.setupMarkerWithEmptyRoute=function(){this.hasOriginPoint&&this.originMarker.isVisible()&&this.originMarker.setMap(this.map),this.hasDestinationPoint&&this.destinationMarker.isVisible()&&this.destinationMarker.setMap(this.map)},t.prototype.swapLineOptions=function(t,e){var r={width:t.getStrokeWidth()/i.MapUtils.pixelScale,color:t.getStrokeColor(),strokePattern:t.getStrokePattern(),zIndex:t.getZIndex(),map:t.getMap()};t.setStrokeWidth(e.getStrokeWidth()/i.MapUtils.pixelScale),t.setStrokeColor(e.getStrokeColor()),t.setStrokePattern(e.getStrokePattern()),t.setZIndex(e.getZIndex()),r.map!=e.getMap()&&t.setMap(e.getMap()),e.setStrokeWidth(r.width),e.setStrokeColor(r.color),e.setStrokePattern(r.strokePattern),e.setZIndex(r.zIndex),r.map!=e.getMap()&&e.setMap(r.map),this.updateAllAnnotations()},t.prototype.setupRouteLines=function(){var t=this;this.routes.forEach((function(e,r){var i=r==t.activedIndex,n=new a.Polyline({path:e,strokeColor:i?t.activeStrokeColor:t.inactiveStrokeColor,strokeWidth:i?t.activeStrokeWidth:t.inactiveStrokeWidth,zIndex:i?-2e6:-3e6,strokePattern:i?t.activeStrokePattern:t.inactiveStrokePattern,lineCapType:a.LineCapType.Round,lineJoinType:a.LineJoinType.Round});n.setMap(t.map),t.lines.push(n);var o=new a.Polyline({path:e,zIndex:i?-21e5:-31e5,lineCapType:a.LineCapType.Round,lineJoinType:a.LineJoinType.Round});t.outlines.push(o),(i?t.activeOutlineWidth>0&&t.activeStrokePattern.getType()==l.PatternType.Solid:t.inactiveOutlineWidth>0&&t.inactiveStrokePattern.getType()==l.PatternType.Solid)&&(o.setStrokeColor(i?t.activeOutlineColor:t.inactiveOutlineColor),o.setStrokeWidth(i?t.activeStrokeWidth+2*t.activeOutlineWidth:t.inactiveStrokeWidth+2*t.inactiveOutlineWidth),o.setMap(t.map))}))},t.prototype.removeObjecsFromMap=function(){this.lines.forEach((function(t){t.setMap(null)})),this.outlines.forEach((function(t){t.setMap(null)})),this.waypointMarkers.forEach((function(t){t.setMap(null)})),this.waypointToRoutePolylines.forEach((function(t){t.setMap(null)})),this.originMarker.setMap(null),this.destinationMarker.setMap(null),this.originToRoutePolyline.setMap(null),this.destinationToRoutePolyline.setMap(null)},t.defaultOptions={activeStrokeWidth:8,activeStrokeColor:"#669DF6",activeOutlineWidth:2,activeOutlineColor:"#0000FF",activeStrokePattern:new l.SolidPattern,inactiveStrokeWidth:8,inactiveStrokeColor:"#BBBDBF",inactiveOutlineWidth:2,inactiveOutlineColor:"#000000",inactiveStrokePattern:new l.SolidPattern,onMarkerDragEnd:null},t}();e.DirectionsRenderer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(4),n=function(){function t(){}return t.decode=function(t,e){void 0===e&&(e=5);for(var r=Math.pow(10,e),n=t.length,o=new Array(Math.floor(t.length/2)),a=0,s=0,l=0,u=0;a<n;++u){var h=1,c=0,p=void 0;do{h+=(p=t.charCodeAt(a++)-63-1)<<c,c+=5}while(p>=31);s+=1&h?~(h>>1):h>>1,h=1,c=0;do{h+=(p=t.charCodeAt(a++)-63-1)<<c,c+=5}while(p>=31);l+=1&h?~(h>>1):h>>1,o[u]=new i.LatLng(s/r,l/r)}return o.length=u,o},t}();e.PolylineCodec=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.POIOptions=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.BuildingOptions=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";function i(t,e,r,o,a,s){if(a-o<=r)return;const l=o+a>>1;!function t(e,r,i,o,a,s){for(;a>o;){if(a-o>600){const n=a-o+1,l=i-o+1,u=Math.log(n),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(n-h)/n)*(l-n/2<0?-1:1),p=Math.max(o,Math.floor(i-l*h/n+c)),f=Math.min(a,Math.floor(i+(n-l)*h/n+c));t(e,r,i,p,f,s)}const l=r[2*i+s];let u=o,h=a;for(n(e,r,o,i),r[2*a+s]>l&&n(e,r,o,a);u<h;){for(n(e,r,u,h),u++,h--;r[2*u+s]<l;)u++;for(;r[2*h+s]>l;)h--}r[2*o+s]===l?n(e,r,o,h):(h++,n(e,r,h,a)),h<=i&&(o=h+1),i<=h&&(a=h-1)}}(t,e,l,o,a,s%2),i(t,e,r,o,l-1,s+1),i(t,e,r,l+1,a,s+1)}function n(t,e,r,i){o(t,r,i),o(e,2*r,2*i),o(e,2*r+1,2*i+1)}function o(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function a(t,e,r,i){const n=t-r,o=e-i;return n*n+o*o}r.r(e),r.d(e,"default",(function(){return c}));const s=t=>t[0],l=t=>t[1];class u{constructor(t,e=s,r=l,n=64,o=Float64Array){this.nodeSize=n,this.points=t;const a=t.length<65536?Uint16Array:Uint32Array,u=this.ids=new a(t.length),h=this.coords=new o(2*t.length);for(let i=0;i<t.length;i++)u[i]=i,h[2*i]=e(t[i]),h[2*i+1]=r(t[i]);i(u,h,n,0,u.length-1,0)}range(t,e,r,i){return function(t,e,r,i,n,o,a){const s=[0,t.length-1,0],l=[];let u,h;for(;s.length;){const c=s.pop(),p=s.pop(),f=s.pop();if(p-f<=a){for(let a=f;a<=p;a++)u=e[2*a],h=e[2*a+1],u>=r&&u<=n&&h>=i&&h<=o&&l.push(t[a]);continue}const d=Math.floor((f+p)/2);u=e[2*d],h=e[2*d+1],u>=r&&u<=n&&h>=i&&h<=o&&l.push(t[d]);const g=(c+1)%2;(0===c?r<=u:i<=h)&&(s.push(f),s.push(d-1),s.push(g)),(0===c?n>=u:o>=h)&&(s.push(d+1),s.push(p),s.push(g))}return l}(this.ids,this.coords,t,e,r,i,this.nodeSize)}within(t,e,r){return function(t,e,r,i,n,o){const s=[0,t.length-1,0],l=[],u=n*n;for(;s.length;){const h=s.pop(),c=s.pop(),p=s.pop();if(c-p<=o){for(let n=p;n<=c;n++)a(e[2*n],e[2*n+1],r,i)<=u&&l.push(t[n]);continue}const f=Math.floor((p+c)/2),d=e[2*f],g=e[2*f+1];a(d,g,r,i)<=u&&l.push(t[f]);const y=(h+1)%2;(0===h?r-n<=d:i-n<=g)&&(s.push(p),s.push(f-1),s.push(y)),(0===h?r+n>=d:i+n>=g)&&(s.push(f+1),s.push(c),s.push(y))}return l}(this.ids,this.coords,t,e,r,this.nodeSize)}}const h={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:t=>t};class c{constructor(t){this.options=_(Object.create(h),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:r,maxZoom:i,nodeSize:n}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let a=[];for(let e=0;e<t.length;e++)t[e].geometry&&a.push(f(t[e],e));this.trees[i+1]=new u(a,b,w,n,Float32Array),e&&console.timeEnd(o);for(let t=i;t>=r;t--){const r=+Date.now();a=this._cluster(a,t),this.trees[t]=new u(a,b,w,n,Float32Array),e&&console.log("z%d: %d clusters in %dms",t,a.length,+Date.now()-r)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let r=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){const t=this.getClusters([r,i,180,o],e),a=this.getClusters([-180,i,n,o],e);return t.concat(a)}const a=this.trees[this._limitZoom(e)],s=a.range(y(r),m(o),y(n),m(i)),l=[];for(const t of s){const e=a.points[t];l.push(e.numPoints?d(e):this.points[e.index])}return l}getChildren(t){const e=t>>5,r=t%32,i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);const o=n.points[e];if(!o)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=n.within(o.x,o.y,a),l=[];for(const e of s){const r=n.points[e];r.parentId===t&&l.push(r.numPoints?d(r):this.points[r.index])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,r){e=e||10,r=r||0;const i=[];return this._appendLeaves(i,t,e,r,0),i}getTile(t,e,r){const i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:a}=this.options,s=a/o,l=(r-s)/n,u=(r+1+s)/n,h={features:[]};return this._addTileFeatures(i.range((e-s)/n,l,(e+1+s)/n,u),i.points,e,r,n,h),0===e&&this._addTileFeatures(i.range(1-s/n,l,1,u),i.points,n,r,n,h),e===n-1&&this._addTileFeatures(i.range(0,l,s/n,u),i.points,-1,r,n,h),h.features.length?h:null}getClusterExpansionZoom(t){let e=t%32-1;for(;e<=this.options.maxZoom;){const r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e}_appendLeaves(t,e,r,i,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=i?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,r,i,n):n<i?n++:t.push(e),t.length===r)break}return n}_addTileFeatures(t,e,r,i,n,o){for(const a of t){const t=e[a],s={type:1,geometry:[[Math.round(this.options.extent*(t.x*n-r)),Math.round(this.options.extent*(t.y*n-i))]],tags:t.numPoints?g(t):this.points[t.index].properties},l=t.numPoints?t.id:this.points[t.index].id;void 0!==l&&(s.id=l),o.features.push(s)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))}_cluster(t,e){const r=[],{radius:i,extent:n,reduce:o}=this.options,a=i/(n*Math.pow(2,e));for(let i=0;i<t.length;i++){const n=t[i];if(n.zoom<=e)continue;n.zoom=e;const s=this.trees[e+1],l=s.within(n.x,n.y,a);let u=n.numPoints||1,h=n.x*u,c=n.y*u;const f=o?this._map(n,!0):null,d=(i<<5)+(e+1);for(const t of l){const r=s.points[t];if(r.zoom<=e)continue;r.zoom=e;const i=r.numPoints||1;h+=r.x*i,c+=r.y*i,u+=i,r.parentId=d,o&&o(f,this._map(r))}1===u?r.push(n):(n.parentId=d,r.push(p(h/u,c/u,d,u,f)))}return r}_map(t,e){if(t.numPoints)return e?_({},t.properties):t.properties;const r=this.points[t.index].properties,i=this.options.map(r);return e&&i===r?_({},i):i}}function p(t,e,r,i,n){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:n}}function f(t,e){const[r,i]=t.geometry.coordinates;return{x:y(r),y:m(i),zoom:1/0,index:e,parentId:-1}}function d(t){return{type:"Feature",id:t.id,properties:g(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),v(t.y)]}};var e}function g(t){const e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return _(_({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function y(t){return t/360+.5}function m(t){const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function v(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function _(t,e){for(const r in e)t[r]=e[r];return t}function b(t){return t.x}function w(t){return t.y}}]);